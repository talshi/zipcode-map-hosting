var KN=Object.create;var c1=Object.defineProperty,JN=Object.defineProperties,ez=Object.getOwnPropertyDescriptor,tz=Object.getOwnPropertyDescriptors,nz=Object.getOwnPropertyNames,my=Object.getOwnPropertySymbols,iz=Object.getPrototypeOf,u1=Object.prototype.hasOwnProperty,NS=Object.prototype.propertyIsEnumerable;var LS=(a,i,d)=>i in a?c1(a,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):a[i]=d,Yt=(a,i)=>{for(var d in i||={})u1.call(i,d)&&LS(a,d,i[d]);if(my)for(var d of my(i))NS.call(i,d)&&LS(a,d,i[d]);return a},tr=(a,i)=>JN(a,tz(i));var om=(a,i)=>{var d={};for(var c in a)u1.call(a,c)&&i.indexOf(c)<0&&(d[c]=a[c]);if(a!=null&&my)for(var c of my(a))i.indexOf(c)<0&&NS.call(a,c)&&(d[c]=a[c]);return d};var rz=(a,i)=>()=>(i||a((i={exports:{}}).exports,i),i.exports);var oz=(a,i,d,c)=>{if(i&&typeof i=="object"||typeof i=="function")for(let m of nz(i))!u1.call(a,m)&&m!==d&&c1(a,m,{get:()=>i[m],enumerable:!(c=ez(i,m))||c.enumerable});return a};var sz=(a,i,d)=>(d=a!=null?KN(iz(a)):{},oz(i||!a||!a.__esModule?c1(d,"default",{value:a,enumerable:!0}):d,a));var d1=(a,i,d)=>new Promise((c,m)=>{var r=F=>{try{M(d.next(F))}catch($){m($)}},T=F=>{try{M(d.throw(F))}catch($){m($)}},M=F=>F.done?c(F.value):Promise.resolve(F.value).then(r,T);M((d=d.apply(a,i)).next())});var fO=rz((fD,pD)=>{"use strict";(function(a,i){typeof fD=="object"&&typeof pD<"u"?pD.exports=i():typeof define=="function"&&define.amd?define(i):(a=typeof globalThis<"u"?globalThis:a||self,a.mapboxgl=i())})(fD,function(){"use strict";var a,i,d;function c(r,T){if(!a)a=T;else if(!i)i=T;else{var M="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+i+")(sharedChunk); self.onerror = null;",F={};a(F),d=T(F),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([M],{type:"text/javascript"})))}}c(["exports"],function(r){"use strict";var T="3.4.0";let M,F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(M==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{M=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{M=t}}return M},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!F.API_URL)return null;try{let t=new URL(F.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function $(t){return F.API_URL_REGEX.test(t)}function Q(t){return t.indexOf("mapbox:")===0}function ue(t){return F.API_CDN_URL_REGEX.test(t)}function Ae(t){return F.API_SPRITE_REGEX.test(t)}function xe(t){return F.API_STYLE_REGEX.test(t)&&!Ae(t)}let ke={create:"create",load:"load",fullLoad:"fullLoad"};function Qe(t){let e=t.name.split("?")[0];return ue(e)&&e.includes("mapbox-gl.js")?"javascript":ue(e)&&e.includes("mapbox-gl.css")?"css":function(n){return F.API_FONTS_REGEX.test(n)}(e)?"fontRange":Ae(e)?"sprite":xe(e)?"style":function(n){return F.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function dt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var st={},Nt={};Object.defineProperty(Nt,"__esModule",{value:!0}),Nt.setMatrixArrayType=function(t){Nt.ARRAY_TYPE=Xt=t},Nt.toRadian=function(t){return t*Xn},Nt.equals=function(t,e){return Math.abs(t-e)<=gn*Math.max(1,Math.abs(t),Math.abs(e))},Nt.RANDOM=Nt.ARRAY_TYPE=Nt.EPSILON=void 0;var gn=1e-6;Nt.EPSILON=gn;var Xt=typeof Float32Array<"u"?Float32Array:Array;Nt.ARRAY_TYPE=Xt;var Ni=Math.random;Nt.RANDOM=Ni;var Xn=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Gt={};function vi(t){return vi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},vi(t)}Object.defineProperty(Gt,"__esModule",{value:!0}),Gt.create=function(){var t=new $i.ARRAY_TYPE(4);return $i.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Gt.clone=function(t){var e=new $i.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Gt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Gt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Gt.fromValues=function(t,e,n,s){var u=new $i.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=s,u},Gt.set=function(t,e,n,s,u){return t[0]=e,t[1]=n,t[2]=s,t[3]=u,t},Gt.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Gt.invert=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=n*h-u*s;return g?(t[0]=h*(g=1/g),t[1]=-s*g,t[2]=-u*g,t[3]=n*g,t):null},Gt.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Gt.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Gt.multiply=Js,Gt.rotate=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=s*b+h*y,t[1]=u*b+g*y,t[2]=s*-y+h*b,t[3]=u*-y+g*b,t},Gt.scale=function(t,e,n){var s=e[1],u=e[2],h=e[3],g=n[0],y=n[1];return t[0]=e[0]*g,t[1]=s*g,t[2]=u*y,t[3]=h*y,t},Gt.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t},Gt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Gt.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Gt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Gt.LDU=function(t,e,n,s){return t[2]=s[2]/s[0],n[0]=s[0],n[1]=s[1],n[3]=s[3]-t[2]*n[1],[t,e,n]},Gt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Gt.subtract=Pi,Gt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Gt.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=t[3],g=e[0],y=e[1],b=e[2],w=e[3];return Math.abs(n-g)<=$i.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(s-y)<=$i.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-b)<=$i.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-w)<=$i.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))},Gt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Gt.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t},Gt.sub=Gt.mul=void 0;var $i=function(t,e){if(t&&t.__esModule)return t;if(t===null||vi(t)!=="object"&&typeof t!="function")return{default:t};var n=oo(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function oo(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(oo=function(s){return s?n:e})(t)}function Js(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=n[0],b=n[1],w=n[2],D=n[3];return t[0]=s*y+h*b,t[1]=u*y+g*b,t[2]=s*w+h*D,t[3]=u*w+g*D,t}function Pi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Gt.mul=Js,Gt.sub=Pi;var Wn={};function Ts(t){return Ts=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ts(t)}Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.create=function(){var t=new Ar.ARRAY_TYPE(6);return Ar.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Wn.clone=function(t){var e=new Ar.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Wn.fromValues=function(t,e,n,s,u,h){var g=new Ar.ARRAY_TYPE(6);return g[0]=t,g[1]=e,g[2]=n,g[3]=s,g[4]=u,g[5]=h,g},Wn.set=function(t,e,n,s,u,h,g){return t[0]=e,t[1]=n,t[2]=s,t[3]=u,t[4]=h,t[5]=g,t},Wn.invert=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=n*h-s*u;return b?(t[0]=h*(b=1/b),t[1]=-s*b,t[2]=-u*b,t[3]=n*b,t[4]=(u*y-h*g)*b,t[5]=(s*g-n*y)*b,t):null},Wn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Wn.multiply=Ht,Wn.rotate=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=Math.sin(n),D=Math.cos(n);return t[0]=s*D+h*w,t[1]=u*D+g*w,t[2]=s*-w+h*D,t[3]=u*-w+g*D,t[4]=y,t[5]=b,t},Wn.scale=function(t,e,n){var s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=n[0],w=n[1];return t[0]=e[0]*b,t[1]=s*b,t[2]=u*w,t[3]=h*w,t[4]=g,t[5]=y,t},Wn.translate=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=n[0],D=n[1];return t[0]=s,t[1]=u,t[2]=h,t[3]=g,t[4]=s*w+h*D+y,t[5]=u*w+g*D+b,t},Wn.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=-n,t[3]=s,t[4]=0,t[5]=0,t},Wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Wn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Wn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Wn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Wn.subtract=Kt,Wn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Wn.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t},Wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Wn.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=t[3],g=t[4],y=t[5],b=e[0],w=e[1],D=e[2],I=e[3],S=e[4],P=e[5];return Math.abs(n-b)<=Ar.EPSILON*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(s-w)<=Ar.EPSILON*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(u-D)<=Ar.EPSILON*Math.max(1,Math.abs(u),Math.abs(D))&&Math.abs(h-I)<=Ar.EPSILON*Math.max(1,Math.abs(h),Math.abs(I))&&Math.abs(g-S)<=Ar.EPSILON*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(y-P)<=Ar.EPSILON*Math.max(1,Math.abs(y),Math.abs(P))},Wn.sub=Wn.mul=void 0;var Ar=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ts(t)!=="object"&&typeof t!="function")return{default:t};var n=St(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function St(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(St=function(s){return s?n:e})(t)}function Ht(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=n[0],D=n[1],I=n[2],S=n[3],P=n[4],k=n[5];return t[0]=s*w+h*D,t[1]=u*w+g*D,t[2]=s*I+h*S,t[3]=u*I+g*S,t[4]=s*P+h*k+y,t[5]=u*P+g*k+b,t}function Kt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Wn.mul=Ht,Wn.sub=Kt;var Mt={};function Ri(t){return Ri=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ri(t)}Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=function(){var t=new wi.ARRAY_TYPE(9);return wi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Mt.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Mt.clone=function(t){var e=new wi.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Mt.fromValues=function(t,e,n,s,u,h,g,y,b){var w=new wi.ARRAY_TYPE(9);return w[0]=t,w[1]=e,w[2]=n,w[3]=s,w[4]=u,w[5]=h,w[6]=g,w[7]=y,w[8]=b,w},Mt.set=function(t,e,n,s,u,h,g,y,b,w){return t[0]=e,t[1]=n,t[2]=s,t[3]=u,t[4]=h,t[5]=g,t[6]=y,t[7]=b,t[8]=w,t},Mt.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Mt.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Mt.invert=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],w=e[7],D=e[8],I=D*g-y*w,S=-D*h+y*b,P=w*h-g*b,k=n*I+s*S+u*P;return k?(t[0]=I*(k=1/k),t[1]=(-D*s+u*w)*k,t[2]=(y*s-u*g)*k,t[3]=S*k,t[4]=(D*n-u*b)*k,t[5]=(-y*n+u*h)*k,t[6]=P*k,t[7]=(-w*n+s*b)*k,t[8]=(g*n-s*h)*k,t):null},Mt.adjoint=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],w=e[7],D=e[8];return t[0]=g*D-y*w,t[1]=u*w-s*D,t[2]=s*y-u*g,t[3]=y*b-h*D,t[4]=n*D-u*b,t[5]=u*h-n*y,t[6]=h*w-g*b,t[7]=s*b-n*w,t[8]=n*g-s*h,t},Mt.determinant=function(t){var e=t[3],n=t[4],s=t[5],u=t[6],h=t[7],g=t[8];return t[0]*(g*n-s*h)+t[1]*(-g*e+s*u)+t[2]*(h*e-n*u)},Mt.multiply=Pr,Mt.translate=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=e[8],S=n[0],P=n[1];return t[0]=s,t[1]=u,t[2]=h,t[3]=g,t[4]=y,t[5]=b,t[6]=S*s+P*g+w,t[7]=S*u+P*y+D,t[8]=S*h+P*b+I,t},Mt.rotate=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=e[8],S=Math.sin(n),P=Math.cos(n);return t[0]=P*s+S*g,t[1]=P*u+S*y,t[2]=P*h+S*b,t[3]=P*g-S*s,t[4]=P*y-S*u,t[5]=P*b-S*h,t[6]=w,t[7]=D,t[8]=I,t},Mt.scale=function(t,e,n){var s=n[0],u=n[1];return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=u*e[3],t[4]=u*e[4],t[5]=u*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Mt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Mt.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Mt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Mt.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Mt.fromQuat=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=n+n,y=s+s,b=u+u,w=n*g,D=s*g,I=s*y,S=u*g,P=u*y,k=u*b,L=h*g,B=h*y,V=h*b;return t[0]=1-I-k,t[3]=D-V,t[6]=S+B,t[1]=D+V,t[4]=1-w-k,t[7]=P-L,t[2]=S-B,t[5]=P+L,t[8]=1-w-I,t},Mt.normalFromMat4=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],w=e[7],D=e[8],I=e[9],S=e[10],P=e[11],k=e[12],L=e[13],B=e[14],V=e[15],W=n*y-s*g,K=n*b-u*g,Y=n*w-h*g,se=s*b-u*y,ee=s*w-h*y,le=u*w-h*b,de=D*L-I*k,_e=D*B-S*k,Ie=D*V-P*k,ve=I*B-S*L,Me=I*V-P*L,Se=S*V-P*B,Ce=W*Se-K*Me+Y*ve+se*Ie-ee*_e+le*de;return Ce?(t[0]=(y*Se-b*Me+w*ve)*(Ce=1/Ce),t[1]=(b*Ie-g*Se-w*_e)*Ce,t[2]=(g*Me-y*Ie+w*de)*Ce,t[3]=(u*Me-s*Se-h*ve)*Ce,t[4]=(n*Se-u*Ie+h*_e)*Ce,t[5]=(s*Ie-n*Me-h*de)*Ce,t[6]=(L*le-B*ee+V*se)*Ce,t[7]=(B*Y-k*le-V*K)*Ce,t[8]=(k*ee-L*Y+V*W)*Ce,t):null},Mt.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Mt.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Mt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Mt.subtract=Zn,Mt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Mt.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t[6]=e[6]+n[6]*s,t[7]=e[7]+n[7]*s,t[8]=e[8]+n[8]*s,t},Mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Mt.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=t[3],g=t[4],y=t[5],b=t[6],w=t[7],D=t[8],I=e[0],S=e[1],P=e[2],k=e[3],L=e[4],B=e[5],V=e[6],W=e[7],K=e[8];return Math.abs(n-I)<=wi.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(s-S)<=wi.EPSILON*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(u-P)<=wi.EPSILON*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-k)<=wi.EPSILON*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(g-L)<=wi.EPSILON*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(y-B)<=wi.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(b-V)<=wi.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(w-W)<=wi.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))&&Math.abs(D-K)<=wi.EPSILON*Math.max(1,Math.abs(D),Math.abs(K))},Mt.sub=Mt.mul=void 0;var wi=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ri(t)!=="object"&&typeof t!="function")return{default:t};var n=sr(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function sr(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(sr=function(s){return s?n:e})(t)}function Pr(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=e[8],S=n[0],P=n[1],k=n[2],L=n[3],B=n[4],V=n[5],W=n[6],K=n[7],Y=n[8];return t[0]=S*s+P*g+k*w,t[1]=S*u+P*y+k*D,t[2]=S*h+P*b+k*I,t[3]=L*s+B*g+V*w,t[4]=L*u+B*y+V*D,t[5]=L*h+B*b+V*I,t[6]=W*s+K*g+Y*w,t[7]=W*u+K*y+Y*D,t[8]=W*h+K*b+Y*I,t}function Zn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Mt.mul=Pr,Mt.sub=Zn;var At={};function Ds(t){return Ds=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ds(t)}Object.defineProperty(At,"__esModule",{value:!0}),At.create=function(){var t=new mn.ARRAY_TYPE(16);return mn.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},At.clone=function(t){var e=new mn.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},At.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},At.fromValues=function(t,e,n,s,u,h,g,y,b,w,D,I,S,P,k,L){var B=new mn.ARRAY_TYPE(16);return B[0]=t,B[1]=e,B[2]=n,B[3]=s,B[4]=u,B[5]=h,B[6]=g,B[7]=y,B[8]=b,B[9]=w,B[10]=D,B[11]=I,B[12]=S,B[13]=P,B[14]=k,B[15]=L,B},At.set=function(t,e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B){return t[0]=e,t[1]=n,t[2]=s,t[3]=u,t[4]=h,t[5]=g,t[6]=y,t[7]=b,t[8]=w,t[9]=D,t[10]=I,t[11]=S,t[12]=P,t[13]=k,t[14]=L,t[15]=B,t},At.identity=fr,At.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],u=e[3],h=e[6],g=e[7],y=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=s,t[9]=h,t[11]=e[14],t[12]=u,t[13]=g,t[14]=y}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},At.invert=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],w=e[7],D=e[8],I=e[9],S=e[10],P=e[11],k=e[12],L=e[13],B=e[14],V=e[15],W=n*y-s*g,K=n*b-u*g,Y=n*w-h*g,se=s*b-u*y,ee=s*w-h*y,le=u*w-h*b,de=D*L-I*k,_e=D*B-S*k,Ie=D*V-P*k,ve=I*B-S*L,Me=I*V-P*L,Se=S*V-P*B,Ce=W*Se-K*Me+Y*ve+se*Ie-ee*_e+le*de;return Ce?(t[0]=(y*Se-b*Me+w*ve)*(Ce=1/Ce),t[1]=(u*Me-s*Se-h*ve)*Ce,t[2]=(L*le-B*ee+V*se)*Ce,t[3]=(S*ee-I*le-P*se)*Ce,t[4]=(b*Ie-g*Se-w*_e)*Ce,t[5]=(n*Se-u*Ie+h*_e)*Ce,t[6]=(B*Y-k*le-V*K)*Ce,t[7]=(D*le-S*Y+P*K)*Ce,t[8]=(g*Me-y*Ie+w*de)*Ce,t[9]=(s*Ie-n*Me-h*de)*Ce,t[10]=(k*ee-L*Y+V*W)*Ce,t[11]=(I*Y-D*ee-P*W)*Ce,t[12]=(y*_e-g*ve-b*de)*Ce,t[13]=(n*ve-s*_e+u*de)*Ce,t[14]=(L*K-k*se-B*W)*Ce,t[15]=(D*se-I*K+S*W)*Ce,t):null},At.adjoint=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=e[4],y=e[5],b=e[6],w=e[7],D=e[8],I=e[9],S=e[10],P=e[11],k=e[12],L=e[13],B=e[14],V=e[15];return t[0]=y*(S*V-P*B)-I*(b*V-w*B)+L*(b*P-w*S),t[1]=-(s*(S*V-P*B)-I*(u*V-h*B)+L*(u*P-h*S)),t[2]=s*(b*V-w*B)-y*(u*V-h*B)+L*(u*w-h*b),t[3]=-(s*(b*P-w*S)-y*(u*P-h*S)+I*(u*w-h*b)),t[4]=-(g*(S*V-P*B)-D*(b*V-w*B)+k*(b*P-w*S)),t[5]=n*(S*V-P*B)-D*(u*V-h*B)+k*(u*P-h*S),t[6]=-(n*(b*V-w*B)-g*(u*V-h*B)+k*(u*w-h*b)),t[7]=n*(b*P-w*S)-g*(u*P-h*S)+D*(u*w-h*b),t[8]=g*(I*V-P*L)-D*(y*V-w*L)+k*(y*P-w*I),t[9]=-(n*(I*V-P*L)-D*(s*V-h*L)+k*(s*P-h*I)),t[10]=n*(y*V-w*L)-g*(s*V-h*L)+k*(s*w-h*y),t[11]=-(n*(y*P-w*I)-g*(s*P-h*I)+D*(s*w-h*y)),t[12]=-(g*(I*B-S*L)-D*(y*B-b*L)+k*(y*S-b*I)),t[13]=n*(I*B-S*L)-D*(s*B-u*L)+k*(s*S-u*I),t[14]=-(n*(y*B-b*L)-g*(s*B-u*L)+k*(s*b-u*y)),t[15]=n*(y*S-b*I)-g*(s*S-u*I)+D*(s*b-u*y),t},At.determinant=function(t){var e=t[0],n=t[1],s=t[2],u=t[3],h=t[4],g=t[5],y=t[6],b=t[7],w=t[8],D=t[9],I=t[10],S=t[11],P=t[12],k=t[13],L=t[14],B=t[15];return(e*g-n*h)*(I*B-S*L)-(e*y-s*h)*(D*B-S*k)+(e*b-u*h)*(D*L-I*k)+(n*y-s*g)*(w*B-S*P)-(n*b-u*g)*(w*L-I*P)+(s*b-u*y)*(w*k-D*P)},At.multiply=ao,At.translate=function(t,e,n){var s,u,h,g,y,b,w,D,I,S,P,k,L=n[0],B=n[1],V=n[2];return e===t?(t[12]=e[0]*L+e[4]*B+e[8]*V+e[12],t[13]=e[1]*L+e[5]*B+e[9]*V+e[13],t[14]=e[2]*L+e[6]*B+e[10]*V+e[14],t[15]=e[3]*L+e[7]*B+e[11]*V+e[15]):(u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=e[8],S=e[9],P=e[10],k=e[11],t[0]=s=e[0],t[1]=u,t[2]=h,t[3]=g,t[4]=y,t[5]=b,t[6]=w,t[7]=D,t[8]=I,t[9]=S,t[10]=P,t[11]=k,t[12]=s*L+y*B+I*V+e[12],t[13]=u*L+b*B+S*V+e[13],t[14]=h*L+w*B+P*V+e[14],t[15]=g*L+D*B+k*V+e[15]),t},At.scale=function(t,e,n){var s=n[0],u=n[1],h=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*h,t[9]=e[9]*h,t[10]=e[10]*h,t[11]=e[11]*h,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},At.rotate=function(t,e,n,s){var u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se,ee,le,de,_e,Ie,ve,Me=s[0],Se=s[1],Ce=s[2],ze=Math.hypot(Me,Se,Ce);return ze<mn.EPSILON?null:(Me*=ze=1/ze,Se*=ze,Ce*=ze,u=Math.sin(n),h=Math.cos(n),b=e[1],w=e[2],D=e[3],S=e[5],P=e[6],k=e[7],B=e[9],V=e[10],W=e[11],K=Me*Me*(g=1-h)+h,ee=Me*Se*g-Ce*u,le=Se*Se*g+h,de=Ce*Se*g+Me*u,_e=Me*Ce*g+Se*u,Ie=Se*Ce*g-Me*u,ve=Ce*Ce*g+h,t[0]=(y=e[0])*K+(I=e[4])*(Y=Se*Me*g+Ce*u)+(L=e[8])*(se=Ce*Me*g-Se*u),t[1]=b*K+S*Y+B*se,t[2]=w*K+P*Y+V*se,t[3]=D*K+k*Y+W*se,t[4]=y*ee+I*le+L*de,t[5]=b*ee+S*le+B*de,t[6]=w*ee+P*le+V*de,t[7]=D*ee+k*le+W*de,t[8]=y*_e+I*Ie+L*ve,t[9]=b*_e+S*Ie+B*ve,t[10]=w*_e+P*Ie+V*ve,t[11]=D*_e+k*Ie+W*ve,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},At.rotateX=function(t,e,n){var s=Math.sin(n),u=Math.cos(n),h=e[4],g=e[5],y=e[6],b=e[7],w=e[8],D=e[9],I=e[10],S=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=h*u+w*s,t[5]=g*u+D*s,t[6]=y*u+I*s,t[7]=b*u+S*s,t[8]=w*u-h*s,t[9]=D*u-g*s,t[10]=I*u-y*s,t[11]=S*u-b*s,t},At.rotateY=function(t,e,n){var s=Math.sin(n),u=Math.cos(n),h=e[0],g=e[1],y=e[2],b=e[3],w=e[8],D=e[9],I=e[10],S=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*u-w*s,t[1]=g*u-D*s,t[2]=y*u-I*s,t[3]=b*u-S*s,t[8]=h*s+w*u,t[9]=g*s+D*u,t[10]=y*s+I*u,t[11]=b*s+S*u,t},At.rotateZ=function(t,e,n){var s=Math.sin(n),u=Math.cos(n),h=e[0],g=e[1],y=e[2],b=e[3],w=e[4],D=e[5],I=e[6],S=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=h*u+w*s,t[1]=g*u+D*s,t[2]=y*u+I*s,t[3]=b*u+S*s,t[4]=w*u-h*s,t[5]=D*u-g*s,t[6]=I*u-y*s,t[7]=S*u-b*s,t},At.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},At.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},At.fromRotation=function(t,e,n){var s,u,h,g=n[0],y=n[1],b=n[2],w=Math.hypot(g,y,b);return w<mn.EPSILON?null:(g*=w=1/w,y*=w,b*=w,s=Math.sin(e),u=Math.cos(e),t[0]=g*g*(h=1-u)+u,t[1]=y*g*h+b*s,t[2]=b*g*h-y*s,t[3]=0,t[4]=g*y*h-b*s,t[5]=y*y*h+u,t[6]=b*y*h+g*s,t[7]=0,t[8]=g*b*h+y*s,t[9]=y*b*h-g*s,t[10]=b*b*h+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},At.fromXRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},At.fromYRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},At.fromZRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},At.fromRotationTranslation=xo,At.fromQuat2=function(t,e){var n=new mn.ARRAY_TYPE(3),s=-e[0],u=-e[1],h=-e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=s*s+u*u+h*h+g*g;return I>0?(n[0]=2*(y*g+D*s+b*h-w*u)/I,n[1]=2*(b*g+D*u+w*s-y*h)/I,n[2]=2*(w*g+D*h+y*u-b*s)/I):(n[0]=2*(y*g+D*s+b*h-w*u),n[1]=2*(b*g+D*u+w*s-y*h),n[2]=2*(w*g+D*h+y*u-b*s)),xo(t,e,n),t},At.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},At.getScaling=Ec,At.getRotation=function(t,e){var n=new mn.ARRAY_TYPE(3);Ec(n,e);var s=1/n[0],u=1/n[1],h=1/n[2],g=e[0]*s,y=e[1]*u,b=e[2]*h,w=e[4]*s,D=e[5]*u,I=e[6]*h,S=e[8]*s,P=e[9]*u,k=e[10]*h,L=g+D+k,B=0;return L>0?(B=2*Math.sqrt(L+1),t[3]=.25*B,t[0]=(I-P)/B,t[1]=(S-b)/B,t[2]=(y-w)/B):g>D&&g>k?(B=2*Math.sqrt(1+g-D-k),t[3]=(I-P)/B,t[0]=.25*B,t[1]=(y+w)/B,t[2]=(S+b)/B):D>k?(B=2*Math.sqrt(1+D-g-k),t[3]=(S-b)/B,t[0]=(y+w)/B,t[1]=.25*B,t[2]=(I+P)/B):(B=2*Math.sqrt(1+k-g-D),t[3]=(y-w)/B,t[0]=(S+b)/B,t[1]=(I+P)/B,t[2]=.25*B),t},At.fromRotationTranslationScale=function(t,e,n,s){var u=e[0],h=e[1],g=e[2],y=e[3],b=u+u,w=h+h,D=g+g,I=u*b,S=u*w,P=u*D,k=h*w,L=h*D,B=g*D,V=y*b,W=y*w,K=y*D,Y=s[0],se=s[1],ee=s[2];return t[0]=(1-(k+B))*Y,t[1]=(S+K)*Y,t[2]=(P-W)*Y,t[3]=0,t[4]=(S-K)*se,t[5]=(1-(I+B))*se,t[6]=(L+V)*se,t[7]=0,t[8]=(P+W)*ee,t[9]=(L-V)*ee,t[10]=(1-(I+k))*ee,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},At.fromRotationTranslationScaleOrigin=function(t,e,n,s,u){var h=e[0],g=e[1],y=e[2],b=e[3],w=h+h,D=g+g,I=y+y,S=h*w,P=h*D,k=h*I,L=g*D,B=g*I,V=y*I,W=b*w,K=b*D,Y=b*I,se=s[0],ee=s[1],le=s[2],de=u[0],_e=u[1],Ie=u[2],ve=(1-(L+V))*se,Me=(P+Y)*se,Se=(k-K)*se,Ce=(P-Y)*ee,ze=(1-(S+V))*ee,Le=(B+W)*ee,Ge=(k+K)*le,je=(B-W)*le,Pe=(1-(S+L))*le;return t[0]=ve,t[1]=Me,t[2]=Se,t[3]=0,t[4]=Ce,t[5]=ze,t[6]=Le,t[7]=0,t[8]=Ge,t[9]=je,t[10]=Pe,t[11]=0,t[12]=n[0]+de-(ve*de+Ce*_e+Ge*Ie),t[13]=n[1]+_e-(Me*de+ze*_e+je*Ie),t[14]=n[2]+Ie-(Se*de+Le*_e+Pe*Ie),t[15]=1,t},At.fromQuat=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=n+n,y=s+s,b=u+u,w=n*g,D=s*g,I=s*y,S=u*g,P=u*y,k=u*b,L=h*g,B=h*y,V=h*b;return t[0]=1-I-k,t[1]=D+V,t[2]=S-B,t[3]=0,t[4]=D-V,t[5]=1-w-k,t[6]=P+L,t[7]=0,t[8]=S+B,t[9]=P-L,t[10]=1-w-I,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},At.frustum=function(t,e,n,s,u,h,g){var y=1/(n-e),b=1/(u-s),w=1/(h-g);return t[0]=2*h*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*h*b,t[6]=0,t[7]=0,t[8]=(n+e)*y,t[9]=(u+s)*b,t[10]=(g+h)*w,t[11]=-1,t[12]=0,t[13]=0,t[14]=g*h*2*w,t[15]=0,t},At.perspectiveNO=fl,At.perspectiveZO=function(t,e,n,s,u){var h,g=1/Math.tan(e/2);return t[0]=g/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=u*(h=1/(s-u)),t[14]=u*s*h):(t[10]=-1,t[14]=-s),t},At.perspectiveFromFieldOfView=function(t,e,n,s){var u=Math.tan(e.upDegrees*Math.PI/180),h=Math.tan(e.downDegrees*Math.PI/180),g=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),b=2/(g+y),w=2/(u+h);return t[0]=b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=-(g-y)*b*.5,t[9]=(u-h)*w*.5,t[10]=s/(n-s),t[11]=-1,t[12]=0,t[13]=0,t[14]=s*n/(n-s),t[15]=0,t},At.orthoNO=Wi,At.orthoZO=function(t,e,n,s,u,h,g){var y=1/(e-n),b=1/(s-u),w=1/(h-g);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=w,t[11]=0,t[12]=(e+n)*y,t[13]=(u+s)*b,t[14]=h*w,t[15]=1,t},At.lookAt=function(t,e,n,s){var u,h,g,y,b,w,D,I,S,P,k=e[0],L=e[1],B=e[2],V=s[0],W=s[1],K=s[2],Y=n[0],se=n[1],ee=n[2];return Math.abs(k-Y)<mn.EPSILON&&Math.abs(L-se)<mn.EPSILON&&Math.abs(B-ee)<mn.EPSILON?fr(t):(D=k-Y,I=L-se,S=B-ee,u=W*(S*=P=1/Math.hypot(D,I,S))-K*(I*=P),h=K*(D*=P)-V*S,g=V*I-W*D,(P=Math.hypot(u,h,g))?(u*=P=1/P,h*=P,g*=P):(u=0,h=0,g=0),y=I*g-S*h,b=S*u-D*g,w=D*h-I*u,(P=Math.hypot(y,b,w))?(y*=P=1/P,b*=P,w*=P):(y=0,b=0,w=0),t[0]=u,t[1]=y,t[2]=D,t[3]=0,t[4]=h,t[5]=b,t[6]=I,t[7]=0,t[8]=g,t[9]=w,t[10]=S,t[11]=0,t[12]=-(u*k+h*L+g*B),t[13]=-(y*k+b*L+w*B),t[14]=-(D*k+I*L+S*B),t[15]=1,t)},At.targetTo=function(t,e,n,s){var u=e[0],h=e[1],g=e[2],y=s[0],b=s[1],w=s[2],D=u-n[0],I=h-n[1],S=g-n[2],P=D*D+I*I+S*S;P>0&&(D*=P=1/Math.sqrt(P),I*=P,S*=P);var k=b*S-w*I,L=w*D-y*S,B=y*I-b*D;return(P=k*k+L*L+B*B)>0&&(k*=P=1/Math.sqrt(P),L*=P,B*=P),t[0]=k,t[1]=L,t[2]=B,t[3]=0,t[4]=I*B-S*L,t[5]=S*k-D*B,t[6]=D*L-I*k,t[7]=0,t[8]=D,t[9]=I,t[10]=S,t[11]=0,t[12]=u,t[13]=h,t[14]=g,t[15]=1,t},At.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},At.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},At.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},At.subtract=hd,At.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},At.multiplyScalarAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t[4]=e[4]+n[4]*s,t[5]=e[5]+n[5]*s,t[6]=e[6]+n[6]*s,t[7]=e[7]+n[7]*s,t[8]=e[8]+n[8]*s,t[9]=e[9]+n[9]*s,t[10]=e[10]+n[10]*s,t[11]=e[11]+n[11]*s,t[12]=e[12]+n[12]*s,t[13]=e[13]+n[13]*s,t[14]=e[14]+n[14]*s,t[15]=e[15]+n[15]*s,t},At.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},At.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=t[3],g=t[4],y=t[5],b=t[6],w=t[7],D=t[8],I=t[9],S=t[10],P=t[11],k=t[12],L=t[13],B=t[14],V=t[15],W=e[0],K=e[1],Y=e[2],se=e[3],ee=e[4],le=e[5],de=e[6],_e=e[7],Ie=e[8],ve=e[9],Me=e[10],Se=e[11],Ce=e[12],ze=e[13],Le=e[14],Ge=e[15];return Math.abs(n-W)<=mn.EPSILON*Math.max(1,Math.abs(n),Math.abs(W))&&Math.abs(s-K)<=mn.EPSILON*Math.max(1,Math.abs(s),Math.abs(K))&&Math.abs(u-Y)<=mn.EPSILON*Math.max(1,Math.abs(u),Math.abs(Y))&&Math.abs(h-se)<=mn.EPSILON*Math.max(1,Math.abs(h),Math.abs(se))&&Math.abs(g-ee)<=mn.EPSILON*Math.max(1,Math.abs(g),Math.abs(ee))&&Math.abs(y-le)<=mn.EPSILON*Math.max(1,Math.abs(y),Math.abs(le))&&Math.abs(b-de)<=mn.EPSILON*Math.max(1,Math.abs(b),Math.abs(de))&&Math.abs(w-_e)<=mn.EPSILON*Math.max(1,Math.abs(w),Math.abs(_e))&&Math.abs(D-Ie)<=mn.EPSILON*Math.max(1,Math.abs(D),Math.abs(Ie))&&Math.abs(I-ve)<=mn.EPSILON*Math.max(1,Math.abs(I),Math.abs(ve))&&Math.abs(S-Me)<=mn.EPSILON*Math.max(1,Math.abs(S),Math.abs(Me))&&Math.abs(P-Se)<=mn.EPSILON*Math.max(1,Math.abs(P),Math.abs(Se))&&Math.abs(k-Ce)<=mn.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ce))&&Math.abs(L-ze)<=mn.EPSILON*Math.max(1,Math.abs(L),Math.abs(ze))&&Math.abs(B-Le)<=mn.EPSILON*Math.max(1,Math.abs(B),Math.abs(Le))&&Math.abs(V-Ge)<=mn.EPSILON*Math.max(1,Math.abs(V),Math.abs(Ge))},At.sub=At.mul=At.ortho=At.perspective=void 0;var mn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ds(t)!=="object"&&typeof t!="function")return{default:t};var n=so(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function so(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(so=function(s){return s?n:e})(t)}function fr(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ao(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=e[8],S=e[9],P=e[10],k=e[11],L=e[12],B=e[13],V=e[14],W=e[15],K=n[0],Y=n[1],se=n[2],ee=n[3];return t[0]=K*s+Y*y+se*I+ee*L,t[1]=K*u+Y*b+se*S+ee*B,t[2]=K*h+Y*w+se*P+ee*V,t[3]=K*g+Y*D+se*k+ee*W,t[4]=(K=n[4])*s+(Y=n[5])*y+(se=n[6])*I+(ee=n[7])*L,t[5]=K*u+Y*b+se*S+ee*B,t[6]=K*h+Y*w+se*P+ee*V,t[7]=K*g+Y*D+se*k+ee*W,t[8]=(K=n[8])*s+(Y=n[9])*y+(se=n[10])*I+(ee=n[11])*L,t[9]=K*u+Y*b+se*S+ee*B,t[10]=K*h+Y*w+se*P+ee*V,t[11]=K*g+Y*D+se*k+ee*W,t[12]=(K=n[12])*s+(Y=n[13])*y+(se=n[14])*I+(ee=n[15])*L,t[13]=K*u+Y*b+se*S+ee*B,t[14]=K*h+Y*w+se*P+ee*V,t[15]=K*g+Y*D+se*k+ee*W,t}function xo(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=s+s,b=u+u,w=h+h,D=s*y,I=s*b,S=s*w,P=u*b,k=u*w,L=h*w,B=g*y,V=g*b,W=g*w;return t[0]=1-(P+L),t[1]=I+W,t[2]=S-V,t[3]=0,t[4]=I-W,t[5]=1-(D+L),t[6]=k+B,t[7]=0,t[8]=S+V,t[9]=k-B,t[10]=1-(D+P),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ec(t,e){var n=e[4],s=e[5],u=e[6],h=e[8],g=e[9],y=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,s,u),t[2]=Math.hypot(h,g,y),t}function fl(t,e,n,s,u){var h,g=1/Math.tan(e/2);return t[0]=g/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+s)*(h=1/(s-u)),t[14]=2*u*s*h):(t[10]=-1,t[14]=-2*s),t}function Wi(t,e,n,s,u,h,g){var y=1/(e-n),b=1/(s-u),w=1/(h-g);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*w,t[11]=0,t[12]=(e+n)*y,t[13]=(u+s)*b,t[14]=(g+h)*w,t[15]=1,t}function hd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}At.perspective=fl,At.ortho=Wi,At.mul=ao,At.sub=hd;var jt={},zt={};function Tc(t){return Tc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tc(t)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=J,zt.clone=function(t){var e=new wo.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},zt.length=oe,zt.fromValues=function(t,e,n){var s=new wo.ARRAY_TYPE(3);return s[0]=t,s[1]=e,s[2]=n,s},zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},zt.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},zt.subtract=me,zt.multiply=Be,zt.divide=Ue,zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},zt.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t},zt.distance=Ye,zt.squaredDistance=vt,zt.squaredLength=Ne,zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},zt.normalize=function(t,e){var n=e[0],s=e[1],u=e[2],h=n*n+s*s+u*u;return h>0&&(h=1/Math.sqrt(h)),t[0]=e[0]*h,t[1]=e[1]*h,t[2]=e[2]*h,t},zt.dot=ft,zt.cross=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=n[0],y=n[1],b=n[2];return t[0]=u*b-h*y,t[1]=h*g-s*b,t[2]=s*y-u*g,t},zt.lerp=function(t,e,n,s){var u=e[0],h=e[1],g=e[2];return t[0]=u+s*(n[0]-u),t[1]=h+s*(n[1]-h),t[2]=g+s*(n[2]-g),t},zt.hermite=function(t,e,n,s,u,h){var g=h*h,y=g*(2*h-3)+1,b=g*(h-2)+h,w=g*(h-1),D=g*(3-2*h);return t[0]=e[0]*y+n[0]*b+s[0]*w+u[0]*D,t[1]=e[1]*y+n[1]*b+s[1]*w+u[1]*D,t[2]=e[2]*y+n[2]*b+s[2]*w+u[2]*D,t},zt.bezier=function(t,e,n,s,u,h){var g=1-h,y=g*g,b=h*h,w=y*g,D=3*h*y,I=3*b*g,S=b*h;return t[0]=e[0]*w+n[0]*D+s[0]*I+u[0]*S,t[1]=e[1]*w+n[1]*D+s[1]*I+u[1]*S,t[2]=e[2]*w+n[2]*D+s[2]*I+u[2]*S,t},zt.random=function(t,e){e=e||1;var n=2*wo.RANDOM()*Math.PI,s=2*wo.RANDOM()-1,u=Math.sqrt(1-s*s)*e;return t[0]=Math.cos(n)*u,t[1]=Math.sin(n)*u,t[2]=s*e,t},zt.transformMat4=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=n[3]*s+n[7]*u+n[11]*h+n[15];return t[0]=(n[0]*s+n[4]*u+n[8]*h+n[12])/(g=g||1),t[1]=(n[1]*s+n[5]*u+n[9]*h+n[13])/g,t[2]=(n[2]*s+n[6]*u+n[10]*h+n[14])/g,t},zt.transformMat3=function(t,e,n){var s=e[0],u=e[1],h=e[2];return t[0]=s*n[0]+u*n[3]+h*n[6],t[1]=s*n[1]+u*n[4]+h*n[7],t[2]=s*n[2]+u*n[5]+h*n[8],t},zt.transformQuat=function(t,e,n){var s=n[0],u=n[1],h=n[2],g=e[0],y=e[1],b=e[2],w=u*b-h*y,D=h*g-s*b,I=s*y-u*g,S=u*I-h*D,P=h*w-s*I,k=s*D-u*w,L=2*n[3];return D*=L,I*=L,P*=2,k*=2,t[0]=g+(w*=L)+(S*=2),t[1]=y+D+P,t[2]=b+I+k,t},zt.rotateX=function(t,e,n,s){var u=[],h=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],h[0]=u[0],h[1]=u[1]*Math.cos(s)-u[2]*Math.sin(s),h[2]=u[1]*Math.sin(s)+u[2]*Math.cos(s),t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t},zt.rotateY=function(t,e,n,s){var u=[],h=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],h[0]=u[2]*Math.sin(s)+u[0]*Math.cos(s),h[1]=u[1],h[2]=u[2]*Math.cos(s)-u[0]*Math.sin(s),t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t},zt.rotateZ=function(t,e,n,s){var u=[],h=[];return u[0]=e[0]-n[0],u[1]=e[1]-n[1],u[2]=e[2]-n[2],h[0]=u[0]*Math.cos(s)-u[1]*Math.sin(s),h[1]=u[0]*Math.sin(s)+u[1]*Math.cos(s),h[2]=u[2],t[0]=h[0]+n[0],t[1]=h[1]+n[1],t[2]=h[2]+n[2],t},zt.angle=function(t,e){var n=t[0],s=t[1],u=t[2],h=e[0],g=e[1],y=e[2],b=Math.sqrt(n*n+s*s+u*u)*Math.sqrt(h*h+g*g+y*y),w=b&&ft(t,e)/b;return Math.acos(Math.min(Math.max(w,-1),1))},zt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},zt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},zt.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=e[0],g=e[1],y=e[2];return Math.abs(n-h)<=wo.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(s-g)<=wo.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-y)<=wo.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))},zt.forEach=zt.sqrLen=zt.len=zt.sqrDist=zt.dist=zt.div=zt.mul=zt.sub=void 0;var wo=function(t,e){if(t&&t.__esModule)return t;if(t===null||Tc(t)!=="object"&&typeof t!="function")return{default:t};var n=We(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function We(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(We=function(s){return s?n:e})(t)}function J(){var t=new wo.ARRAY_TYPE(3);return wo.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function oe(t){return Math.hypot(t[0],t[1],t[2])}function me(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Be(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Ue(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function Ye(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function vt(t,e){var n=e[0]-t[0],s=e[1]-t[1],u=e[2]-t[2];return n*n+s*s+u*u}function Ne(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s}function ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}zt.sub=me,zt.mul=Be,zt.div=Ue,zt.dist=Ye,zt.sqrDist=vt,zt.len=oe,zt.sqrLen=Ne;var _t,Et=(_t=J(),function(t,e,n,s,u,h){var g,y;for(e||(e=3),n||(n=0),y=s?Math.min(s*e+n,t.length):t.length,g=n;g<y;g+=e)_t[0]=t[g],_t[1]=t[g+1],_t[2]=t[g+2],u(_t,_t,h),t[g]=_t[0],t[g+1]=_t[1],t[g+2]=_t[2];return t});zt.forEach=Et;var at={};function Kn(t){return Kn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Kn(t)}Object.defineProperty(at,"__esModule",{value:!0}),at.create=kn,at.clone=function(t){var e=new Rn.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},at.fromValues=function(t,e,n,s){var u=new Rn.ARRAY_TYPE(4);return u[0]=t,u[1]=e,u[2]=n,u[3]=s,u},at.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},at.set=function(t,e,n,s,u){return t[0]=e,t[1]=n,t[2]=s,t[3]=u,t},at.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},at.subtract=On,at.multiply=Jn,at.divide=bi,at.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},at.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},at.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},at.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},at.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},at.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},at.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t[3]=e[3]+n[3]*s,t},at.distance=pr,at.squaredDistance=pi,at.length=Br,at.squaredLength=Rr,at.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},at.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},at.normalize=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=n*n+s*s+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),t[0]=n*g,t[1]=s*g,t[2]=u*g,t[3]=h*g,t},at.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},at.cross=function(t,e,n,s){var u=n[0]*s[1]-n[1]*s[0],h=n[0]*s[2]-n[2]*s[0],g=n[0]*s[3]-n[3]*s[0],y=n[1]*s[2]-n[2]*s[1],b=n[1]*s[3]-n[3]*s[1],w=n[2]*s[3]-n[3]*s[2],D=e[0],I=e[1],S=e[2],P=e[3];return t[0]=I*w-S*b+P*y,t[1]=-D*w+S*g-P*h,t[2]=D*b-I*g+P*u,t[3]=-D*y+I*h-S*u,t},at.lerp=function(t,e,n,s){var u=e[0],h=e[1],g=e[2],y=e[3];return t[0]=u+s*(n[0]-u),t[1]=h+s*(n[1]-h),t[2]=g+s*(n[2]-g),t[3]=y+s*(n[3]-y),t},at.random=function(t,e){var n,s,u,h,g,y;e=e||1;do g=(n=2*Rn.RANDOM()-1)*n+(s=2*Rn.RANDOM()-1)*s;while(g>=1);do y=(u=2*Rn.RANDOM()-1)*u+(h=2*Rn.RANDOM()-1)*h;while(y>=1);var b=Math.sqrt((1-g)/y);return t[0]=e*n,t[1]=e*s,t[2]=e*u*b,t[3]=e*h*b,t},at.transformMat4=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3];return t[0]=n[0]*s+n[4]*u+n[8]*h+n[12]*g,t[1]=n[1]*s+n[5]*u+n[9]*h+n[13]*g,t[2]=n[2]*s+n[6]*u+n[10]*h+n[14]*g,t[3]=n[3]*s+n[7]*u+n[11]*h+n[15]*g,t},at.transformQuat=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=n[0],y=n[1],b=n[2],w=n[3],D=w*s+y*h-b*u,I=w*u+b*s-g*h,S=w*h+g*u-y*s,P=-g*s-y*u-b*h;return t[0]=D*w+P*-g+I*-b-S*-y,t[1]=I*w+P*-y+S*-g-D*-b,t[2]=S*w+P*-b+D*-y-I*-g,t[3]=e[3],t},at.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},at.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},at.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},at.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=t[3],g=e[0],y=e[1],b=e[2],w=e[3];return Math.abs(n-g)<=Rn.EPSILON*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(s-y)<=Rn.EPSILON*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(u-b)<=Rn.EPSILON*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(h-w)<=Rn.EPSILON*Math.max(1,Math.abs(h),Math.abs(w))},at.forEach=at.sqrLen=at.len=at.sqrDist=at.dist=at.div=at.mul=at.sub=void 0;var Rn=function(t,e){if(t&&t.__esModule)return t;if(t===null||Kn(t)!=="object"&&typeof t!="function")return{default:t};var n=Qn(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function Qn(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Qn=function(s){return s?n:e})(t)}function kn(){var t=new Rn.ARRAY_TYPE(4);return Rn.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function On(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Jn(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function bi(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function pr(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function pi(t,e){var n=e[0]-t[0],s=e[1]-t[1],u=e[2]-t[2],h=e[3]-t[3];return n*n+s*s+u*u+h*h}function Br(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Rr(t){var e=t[0],n=t[1],s=t[2],u=t[3];return e*e+n*n+s*s+u*u}at.sub=On,at.mul=Jn,at.div=bi,at.dist=pr,at.sqrDist=pi,at.len=Br,at.sqrLen=Rr;var No=function(){var t=kn();return function(e,n,s,u,h,g){var y,b;for(n||(n=4),s||(s=0),b=u?Math.min(u*n+s,e.length):e.length,y=s;y<b;y+=n)t[0]=e[y],t[1]=e[y+1],t[2]=e[y+2],t[3]=e[y+3],h(t,t,g),e[y]=t[0],e[y+1]=t[1],e[y+2]=t[2],e[y+3]=t[3];return e}}();function Zi(t){return Zi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Zi(t)}at.forEach=No,Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=it,jt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},jt.setAxisAngle=rt,jt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),s=Math.sin(n/2);return s>Ei.EPSILON?(t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s):(t[0]=1,t[1]=0,t[2]=0),n},jt.getAngle=function(t,e){var n=ei(t,e);return Math.acos(2*n*n-1)},jt.multiply=Je,jt.rotateX=function(t,e,n){n*=.5;var s=e[0],u=e[1],h=e[2],g=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=s*b+g*y,t[1]=u*b+h*y,t[2]=h*b-u*y,t[3]=g*b-s*y,t},jt.rotateY=function(t,e,n){n*=.5;var s=e[0],u=e[1],h=e[2],g=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=s*b-h*y,t[1]=u*b+g*y,t[2]=h*b+s*y,t[3]=g*b-u*y,t},jt.rotateZ=function(t,e,n){n*=.5;var s=e[0],u=e[1],h=e[2],g=e[3],y=Math.sin(n),b=Math.cos(n);return t[0]=s*b+u*y,t[1]=u*b-s*y,t[2]=h*b+g*y,t[3]=g*b-h*y,t},jt.calculateW=function(t,e){var n=e[0],s=e[1],u=e[2];return t[0]=n,t[1]=s,t[2]=u,t[3]=Math.sqrt(Math.abs(1-n*n-s*s-u*u)),t},jt.exp=lt,jt.ln=et,jt.pow=function(t,e,n){return et(t,e),xt(t,t,n),lt(t,t),t},jt.slerp=Ut,jt.random=function(t){var e=Ei.RANDOM(),n=Ei.RANDOM(),s=Ei.RANDOM(),u=Math.sqrt(1-e),h=Math.sqrt(e);return t[0]=u*Math.sin(2*Math.PI*n),t[1]=u*Math.cos(2*Math.PI*n),t[2]=h*Math.sin(2*Math.PI*s),t[3]=h*Math.cos(2*Math.PI*s),t},jt.invert=function(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=n*n+s*s+u*u+h*h,y=g?1/g:0;return t[0]=-n*y,t[1]=-s*y,t[2]=-u*y,t[3]=h*y,t},jt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},jt.fromMat3=_n,jt.fromEuler=function(t,e,n,s){var u=.5*Math.PI/180;e*=u,n*=u,s*=u;var h=Math.sin(e),g=Math.cos(e),y=Math.sin(n),b=Math.cos(n),w=Math.sin(s),D=Math.cos(s);return t[0]=h*b*D-g*y*w,t[1]=g*y*D+h*b*w,t[2]=g*b*w-h*y*D,t[3]=g*b*D+h*y*w,t},jt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},jt.setAxes=jt.sqlerp=jt.rotationTo=jt.equals=jt.exactEquals=jt.normalize=jt.sqrLen=jt.squaredLength=jt.len=jt.length=jt.lerp=jt.dot=jt.scale=jt.mul=jt.add=jt.set=jt.copy=jt.fromValues=jt.clone=void 0;var Ei=Xe(Nt),Oe=Xe(Mt),Fe=Xe(zt),$e=Xe(at);function Ke(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Ke=function(s){return s?n:e})(t)}function Xe(t,e){if(t&&t.__esModule)return t;if(t===null||Zi(t)!=="object"&&typeof t!="function")return{default:t};var n=Ke(e);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}function it(){var t=new Ei.ARRAY_TYPE(4);return Ei.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function rt(t,e,n){n*=.5;var s=Math.sin(n);return t[0]=s*e[0],t[1]=s*e[1],t[2]=s*e[2],t[3]=Math.cos(n),t}function Je(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=n[0],b=n[1],w=n[2],D=n[3];return t[0]=s*D+g*y+u*w-h*b,t[1]=u*D+g*b+h*y-s*w,t[2]=h*D+g*w+s*b-u*y,t[3]=g*D-s*y-u*b-h*w,t}function lt(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=Math.sqrt(n*n+s*s+u*u),y=Math.exp(h),b=g>0?y*Math.sin(g)/g:0;return t[0]=n*b,t[1]=s*b,t[2]=u*b,t[3]=y*Math.cos(g),t}function et(t,e){var n=e[0],s=e[1],u=e[2],h=e[3],g=Math.sqrt(n*n+s*s+u*u),y=g>0?Math.atan2(g,h)/g:0;return t[0]=n*y,t[1]=s*y,t[2]=u*y,t[3]=.5*Math.log(n*n+s*s+u*u+h*h),t}function Ut(t,e,n,s){var u,h,g,y,b,w=e[0],D=e[1],I=e[2],S=e[3],P=n[0],k=n[1],L=n[2],B=n[3];return(h=w*P+D*k+I*L+S*B)<0&&(h=-h,P=-P,k=-k,L=-L,B=-B),1-h>Ei.EPSILON?(u=Math.acos(h),g=Math.sin(u),y=Math.sin((1-s)*u)/g,b=Math.sin(s*u)/g):(y=1-s,b=s),t[0]=y*w+b*P,t[1]=y*D+b*k,t[2]=y*I+b*L,t[3]=y*S+b*B,t}function _n(t,e){var n,s=e[0]+e[4]+e[8];if(s>0)n=Math.sqrt(s+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var u=0;e[4]>e[0]&&(u=1),e[8]>e[3*u+u]&&(u=2);var h=(u+1)%3,g=(u+2)%3;n=Math.sqrt(e[3*u+u]-e[3*h+h]-e[3*g+g]+1),t[u]=.5*n,t[3]=(e[3*h+g]-e[3*g+h])*(n=.5/n),t[h]=(e[3*h+u]+e[3*u+h])*n,t[g]=(e[3*g+u]+e[3*u+g])*n}return t}jt.clone=$e.clone,jt.fromValues=$e.fromValues,jt.copy=$e.copy,jt.set=$e.set,jt.add=$e.add,jt.mul=Je;var xt=$e.scale;jt.scale=xt;var ei=$e.dot;jt.dot=ei,jt.lerp=$e.lerp;var Ti=$e.length;jt.length=Ti,jt.len=Ti;var Di=$e.squaredLength;jt.squaredLength=Di,jt.sqrLen=Di;var zi=$e.normalize;jt.normalize=zi,jt.exactEquals=$e.exactEquals,jt.equals=$e.equals;var Si,wn,lo,zo=(Si=Fe.create(),wn=Fe.fromValues(1,0,0),lo=Fe.fromValues(0,1,0),function(t,e,n){var s=Fe.dot(e,n);return s<-.999999?(Fe.cross(Si,wn,e),Fe.len(Si)<1e-6&&Fe.cross(Si,lo,e),Fe.normalize(Si,Si),rt(t,Si,Math.PI),t):s>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Fe.cross(Si,e,n),t[0]=Si[0],t[1]=Si[1],t[2]=Si[2],t[3]=1+s,zi(t,t))});jt.rotationTo=zo;var _r,Ma,Dc=(_r=it(),Ma=it(),function(t,e,n,s,u,h){return Ut(_r,e,u,h),Ut(Ma,n,s,h),Ut(t,_r,Ma,2*h*(1-h)),t});jt.sqlerp=Dc;var Vr,db=(Vr=Oe.create(),function(t,e,n,s){return Vr[0]=n[0],Vr[3]=n[1],Vr[6]=n[2],Vr[1]=s[0],Vr[4]=s[1],Vr[7]=s[2],Vr[2]=-e[0],Vr[5]=-e[1],Vr[8]=-e[2],zi(t,_n(t,Vr))});jt.setAxes=db;var dn={};function Df(t){return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Df(t)}Object.defineProperty(dn,"__esModule",{value:!0}),dn.create=function(){var t=new jr.ARRAY_TYPE(8);return jr.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},dn.clone=function(t){var e=new jr.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},dn.fromValues=function(t,e,n,s,u,h,g,y){var b=new jr.ARRAY_TYPE(8);return b[0]=t,b[1]=e,b[2]=n,b[3]=s,b[4]=u,b[5]=h,b[6]=g,b[7]=y,b},dn.fromRotationTranslationValues=function(t,e,n,s,u,h,g){var y=new jr.ARRAY_TYPE(8);y[0]=t,y[1]=e,y[2]=n,y[3]=s;var b=.5*u,w=.5*h,D=.5*g;return y[4]=b*s+w*n-D*e,y[5]=w*s+D*t-b*n,y[6]=D*s+b*e-w*t,y[7]=-b*t-w*e-D*n,y},dn.fromRotationTranslation=cg,dn.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},dn.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},dn.fromMat4=function(t,e){var n=Is.create();ag.getRotation(n,e);var s=new jr.ARRAY_TYPE(3);return ag.getTranslation(s,e),cg(t,n,s),t},dn.copy=ug,dn.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},dn.set=function(t,e,n,s,u,h,g,y,b){return t[0]=e,t[1]=n,t[2]=s,t[3]=u,t[4]=h,t[5]=g,t[6]=y,t[7]=b,t},dn.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},dn.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},dn.getTranslation=function(t,e){var n=e[4],s=e[5],u=e[6],h=e[7],g=-e[0],y=-e[1],b=-e[2],w=e[3];return t[0]=2*(n*w+h*g+s*b-u*y),t[1]=2*(s*w+h*y+u*g-n*b),t[2]=2*(u*w+h*b+n*y-s*g),t},dn.translate=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=.5*n[0],b=.5*n[1],w=.5*n[2],D=e[4],I=e[5],S=e[6],P=e[7];return t[0]=s,t[1]=u,t[2]=h,t[3]=g,t[4]=g*y+u*w-h*b+D,t[5]=g*b+h*y-s*w+I,t[6]=g*w+s*b-u*y+S,t[7]=-s*y-u*b-h*w+P,t},dn.rotateX=function(t,e,n){var s=-e[0],u=-e[1],h=-e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=y*g+D*s+b*h-w*u,S=b*g+D*u+w*s-y*h,P=w*g+D*h+y*u-b*s,k=D*g-y*s-b*u-w*h;return Is.rotateX(t,e,n),t[4]=I*(g=t[3])+k*(s=t[0])+S*(h=t[2])-P*(u=t[1]),t[5]=S*g+k*u+P*s-I*h,t[6]=P*g+k*h+I*u-S*s,t[7]=k*g-I*s-S*u-P*h,t},dn.rotateY=function(t,e,n){var s=-e[0],u=-e[1],h=-e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=y*g+D*s+b*h-w*u,S=b*g+D*u+w*s-y*h,P=w*g+D*h+y*u-b*s,k=D*g-y*s-b*u-w*h;return Is.rotateY(t,e,n),t[4]=I*(g=t[3])+k*(s=t[0])+S*(h=t[2])-P*(u=t[1]),t[5]=S*g+k*u+P*s-I*h,t[6]=P*g+k*h+I*u-S*s,t[7]=k*g-I*s-S*u-P*h,t},dn.rotateZ=function(t,e,n){var s=-e[0],u=-e[1],h=-e[2],g=e[3],y=e[4],b=e[5],w=e[6],D=e[7],I=y*g+D*s+b*h-w*u,S=b*g+D*u+w*s-y*h,P=w*g+D*h+y*u-b*s,k=D*g-y*s-b*u-w*h;return Is.rotateZ(t,e,n),t[4]=I*(g=t[3])+k*(s=t[0])+S*(h=t[2])-P*(u=t[1]),t[5]=S*g+k*u+P*s-I*h,t[6]=P*g+k*h+I*u-S*s,t[7]=k*g-I*s-S*u-P*h,t},dn.rotateByQuatAppend=function(t,e,n){var s=n[0],u=n[1],h=n[2],g=n[3],y=e[0],b=e[1],w=e[2],D=e[3];return t[0]=y*g+D*s+b*h-w*u,t[1]=b*g+D*u+w*s-y*h,t[2]=w*g+D*h+y*u-b*s,t[3]=D*g-y*s-b*u-w*h,t[4]=(y=e[4])*g+(D=e[7])*s+(b=e[5])*h-(w=e[6])*u,t[5]=b*g+D*u+w*s-y*h,t[6]=w*g+D*h+y*u-b*s,t[7]=D*g-y*s-b*u-w*h,t},dn.rotateByQuatPrepend=function(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=n[0],b=n[1],w=n[2],D=n[3];return t[0]=s*D+g*y+u*w-h*b,t[1]=u*D+g*b+h*y-s*w,t[2]=h*D+g*w+s*b-u*y,t[3]=g*D-s*y-u*b-h*w,t[4]=s*(D=n[7])+g*(y=n[4])+u*(w=n[6])-h*(b=n[5]),t[5]=u*D+g*b+h*y-s*w,t[6]=h*D+g*w+s*b-u*y,t[7]=g*D-s*y-u*b-h*w,t},dn.rotateAroundAxis=function(t,e,n,s){if(Math.abs(s)<jr.EPSILON)return ug(t,e);var u=Math.hypot(n[0],n[1],n[2]);s*=.5;var h=Math.sin(s),g=h*n[0]/u,y=h*n[1]/u,b=h*n[2]/u,w=Math.cos(s),D=e[0],I=e[1],S=e[2],P=e[3];t[0]=D*w+P*g+I*b-S*y,t[1]=I*w+P*y+S*g-D*b,t[2]=S*w+P*b+D*y-I*g,t[3]=P*w-D*g-I*y-S*b;var k=e[4],L=e[5],B=e[6],V=e[7];return t[4]=k*w+V*g+L*b-B*y,t[5]=L*w+V*y+B*g-k*b,t[6]=B*w+V*b+k*y-L*g,t[7]=V*w-k*g-L*y-B*b,t},dn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},dn.multiply=dg,dn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},dn.lerp=function(t,e,n,s){var u=1-s;return hg(e,n)<0&&(s=-s),t[0]=e[0]*u+n[0]*s,t[1]=e[1]*u+n[1]*s,t[2]=e[2]*u+n[2]*s,t[3]=e[3]*u+n[3]*s,t[4]=e[4]*u+n[4]*s,t[5]=e[5]*u+n[5]*s,t[6]=e[6]*u+n[6]*s,t[7]=e[7]*u+n[7]*s,t},dn.invert=function(t,e){var n=fd(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},dn.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},dn.normalize=function(t,e){var n=fd(e);if(n>0){n=Math.sqrt(n);var s=e[0]/n,u=e[1]/n,h=e[2]/n,g=e[3]/n,y=e[4],b=e[5],w=e[6],D=e[7],I=s*y+u*b+h*w+g*D;t[0]=s,t[1]=u,t[2]=h,t[3]=g,t[4]=(y-s*I)/n,t[5]=(b-u*I)/n,t[6]=(w-h*I)/n,t[7]=(D-g*I)/n}return t},dn.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},dn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},dn.equals=function(t,e){var n=t[0],s=t[1],u=t[2],h=t[3],g=t[4],y=t[5],b=t[6],w=t[7],D=e[0],I=e[1],S=e[2],P=e[3],k=e[4],L=e[5],B=e[6],V=e[7];return Math.abs(n-D)<=jr.EPSILON*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(s-I)<=jr.EPSILON*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(u-S)<=jr.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-P)<=jr.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(g-k)<=jr.EPSILON*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(y-L)<=jr.EPSILON*Math.max(1,Math.abs(y),Math.abs(L))&&Math.abs(b-B)<=jr.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(w-V)<=jr.EPSILON*Math.max(1,Math.abs(w),Math.abs(V))},dn.sqrLen=dn.squaredLength=dn.len=dn.length=dn.dot=dn.mul=dn.setReal=dn.getReal=void 0;var jr=If(Nt),Is=If(jt),ag=If(At);function lg(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(lg=function(s){return s?n:e})(t)}function If(t,e){if(t&&t.__esModule)return t;if(t===null||Df(t)!=="object"&&typeof t!="function")return{default:t};var n=lg(e);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}function cg(t,e,n){var s=.5*n[0],u=.5*n[1],h=.5*n[2],g=e[0],y=e[1],b=e[2],w=e[3];return t[0]=g,t[1]=y,t[2]=b,t[3]=w,t[4]=s*w+u*b-h*y,t[5]=u*w+h*g-s*b,t[6]=h*w+s*y-u*g,t[7]=-s*g-u*y-h*b,t}function ug(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function dg(t,e,n){var s=e[0],u=e[1],h=e[2],g=e[3],y=n[4],b=n[5],w=n[6],D=n[7],I=e[4],S=e[5],P=e[6],k=e[7],L=n[0],B=n[1],V=n[2],W=n[3];return t[0]=s*W+g*L+u*V-h*B,t[1]=u*W+g*B+h*L-s*V,t[2]=h*W+g*V+s*B-u*L,t[3]=g*W-s*L-u*B-h*V,t[4]=s*D+g*y+u*w-h*b+I*W+k*L+S*V-P*B,t[5]=u*D+g*b+h*y-s*w+S*W+k*B+P*L-I*V,t[6]=h*D+g*w+s*b-u*y+P*W+k*V+I*B-S*L,t[7]=g*D-s*y-u*b-h*w+k*W-I*L-S*B-P*V,t}dn.getReal=Is.copy,dn.setReal=Is.copy,dn.mul=dg;var hg=Is.dot;dn.dot=hg;var fg=Is.length;dn.length=fg,dn.len=fg;var fd=Is.squaredLength;dn.squaredLength=fd,dn.sqrLen=fd;var tn={};function Cf(t){return Cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cf(t)}Object.defineProperty(tn,"__esModule",{value:!0}),tn.create=mg,tn.clone=function(t){var e=new Aa.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},tn.fromValues=function(t,e){var n=new Aa.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},tn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},tn.set=function(t,e,n){return t[0]=e,t[1]=n,t},tn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},tn.subtract=gg,tn.multiply=_g,tn.divide=yg,tn.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},tn.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},tn.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},tn.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},tn.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},tn.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},tn.scaleAndAdd=function(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t},tn.distance=vg,tn.squaredDistance=bg,tn.length=xg,tn.squaredLength=pd,tn.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},tn.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},tn.normalize=function(t,e){var n=e[0],s=e[1],u=n*n+s*s;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t},tn.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},tn.cross=function(t,e,n){var s=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=s,t},tn.lerp=function(t,e,n,s){var u=e[0],h=e[1];return t[0]=u+s*(n[0]-u),t[1]=h+s*(n[1]-h),t},tn.random=function(t,e){e=e||1;var n=2*Aa.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},tn.transformMat2=function(t,e,n){var s=e[0],u=e[1];return t[0]=n[0]*s+n[2]*u,t[1]=n[1]*s+n[3]*u,t},tn.transformMat2d=function(t,e,n){var s=e[0],u=e[1];return t[0]=n[0]*s+n[2]*u+n[4],t[1]=n[1]*s+n[3]*u+n[5],t},tn.transformMat3=function(t,e,n){var s=e[0],u=e[1];return t[0]=n[0]*s+n[3]*u+n[6],t[1]=n[1]*s+n[4]*u+n[7],t},tn.transformMat4=function(t,e,n){var s=e[0],u=e[1];return t[0]=n[0]*s+n[4]*u+n[12],t[1]=n[1]*s+n[5]*u+n[13],t},tn.rotate=function(t,e,n,s){var u=e[0]-n[0],h=e[1]-n[1],g=Math.sin(s),y=Math.cos(s);return t[0]=u*y-h*g+n[0],t[1]=u*g+h*y+n[1],t},tn.angle=function(t,e){var n=t[0],s=t[1],u=e[0],h=e[1],g=Math.sqrt(n*n+s*s)*Math.sqrt(u*u+h*h);return Math.acos(Math.min(Math.max(g&&(n*u+s*h)/g,-1),1))},tn.zero=function(t){return t[0]=0,t[1]=0,t},tn.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},tn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},tn.equals=function(t,e){var n=t[0],s=t[1],u=e[0],h=e[1];return Math.abs(n-u)<=Aa.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=Aa.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))},tn.forEach=tn.sqrLen=tn.sqrDist=tn.dist=tn.div=tn.mul=tn.sub=tn.len=void 0;var Aa=function(t,e){if(t&&t.__esModule)return t;if(t===null||Cf(t)!=="object"&&typeof t!="function")return{default:t};var n=pg(void 0);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}(Nt);function pg(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(pg=function(s){return s?n:e})(t)}function mg(){var t=new Aa.ARRAY_TYPE(2);return Aa.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function gg(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function _g(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function yg(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function vg(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function bg(t,e){var n=e[0]-t[0],s=e[1]-t[1];return n*n+s*s}function xg(t){return Math.hypot(t[0],t[1])}function pd(t){var e=t[0],n=t[1];return e*e+n*n}tn.len=xg,tn.sub=gg,tn.mul=_g,tn.div=yg,tn.dist=vg,tn.sqrDist=bg,tn.sqrLen=pd;var hb=function(){var t=mg();return function(e,n,s,u,h,g){var y,b;for(n||(n=2),s||(s=0),b=u?Math.min(u*n+s,e.length):e.length,y=s;y<b;y+=n)t[0]=e[y],t[1]=e[y+1],h(t,t,g),e[y]=t[0],e[y+1]=t[1];return e}}();function md(t){return md=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},md(t)}tn.forEach=hb,Object.defineProperty(st,"__esModule",{value:!0}),r.aa=st.vec4=r.Q=st.vec3=st.vec2=st.quat2=r.bl=st.quat=r.a9=st.mat4=r.ct=st.mat3=st.mat2d=r.b7=st.mat2=st.glMatrix=void 0;var fb=ts(Nt);st.glMatrix=fb;var pb=ts(Gt);r.b7=st.mat2=pb;var mb=ts(Wn);st.mat2d=mb;var Ct=ts(Mt);r.ct=st.mat3=Ct;var Sf=ts(At);r.a9=st.mat4=Sf;var qt=ts(jt);r.bl=st.quat=qt;var gd=ts(dn);st.quat2=gd;var an=ts(tn);st.vec2=an;var Mf=ts(zt);r.Q=st.vec3=Mf;var Af=ts(at);function Vt(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(Vt=function(s){return s?n:e})(t)}function ts(t,e){if(t&&t.__esModule)return t;if(t===null||md(t)!=="object"&&typeof t!="function")return{default:t};var n=Vt(e);if(n&&n.has(t))return n.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var h in t)if(h!=="default"&&Object.prototype.hasOwnProperty.call(t,h)){var g=u?Object.getOwnPropertyDescriptor(t,h):null;g&&(g.get||g.set)?Object.defineProperty(s,h,g):s[h]=t[h]}return s.default=t,n&&n.set(t,s),s}r.aa=st.vec4=Af;var gb=Pa;function Pa(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}Pa.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var h=this.sampleCurveDerivativeX(n);if(Math.abs(h)<1e-6)break;n-=u/h}var g=0,y=1;for(n=t,s=0;s<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));s++)t>u?g=n:y=n,n=.5*(y-g)+g;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var wg=dt(gb),_d=Bo;function Bo(t,e){this.x=t,this.y=e}Bo.prototype={clone:function(){return new Bo(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),u=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Bo.convert=function(t){return t instanceof Bo?t:Array.isArray(t)?new Bo(t[0],t[1]):t};var tt=dt(_d);let Pf=Math.PI/180,Rf=180/Math.PI;function bn(t){return t*Pf}function Ur(t){return t*Rf}let Eg=[[0,0],[1,0],[1,1],[0,1]];function yd(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Tg(t,e,n,s){let u=new wg(t,e,n,s);return function(h){return u.solve(h)}}let Vo=Tg(.25,.1,.25,1);function hn(t,e,n){return Math.min(n,Math.max(e,t))}function Ic(t,e,n){return(n=hn((n-t)/(e-t),0,1))*n*(3-2*n)}function Cs(t,e,n){let s=n-e,u=((t-e)%s+s)%s+e;return u===e?n:u}function kf(t,e,n){if(!t.length)return n(null,[]);let s=t.length,u=new Array(t.length),h=null;t.forEach((g,y)=>{e(g,(b,w)=>{b&&(h=b),u[y]=w,--s==0&&n(h,u)})})}function Eo(t,...e){for(let n of e)for(let s in n)t[s]=n[s];return t}let Dg=1;function Sn(){return Dg++}function vd(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Of(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ig(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ff(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ra(t,e){return t.indexOf(e,t.length-e.length)!==-1}function pl(t,e,n){let s={};for(let u in t)s[u]=e.call(this,t[u],u,t);return s}function Cc(t,e,n){let s={};for(let u in t)e.call(this,t[u],u,t)&&(s[u]=t[u]);return s}function Ss(t){return Array.isArray(t)?t.map(Ss):typeof t=="object"&&t?pl(t,Ss):t}let Lf={};function Ii(t){Lf[t]||(typeof console<"u"&&console.warn(t),Lf[t]=!0)}function ea(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function Sc(t){let e=0;for(let n,s,u=0,h=t.length,g=h-1;u<h;g=u++)n=t[u],s=t[g],e+=(s.x-n.x)*(n.y+s.y);return e}function Mc([t,e,n]){let s=bn(e+90),u=bn(n);return{x:t*Math.cos(s)*Math.sin(u),y:t*Math.sin(s)*Math.sin(u),z:t*Math.cos(u),azimuthal:e,polar:n}}function Ms(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function co(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,u,h)=>{let g=u||h;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let bd,xd,wd,Ac,ta,ml,Ed=null;function Nf(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ka(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Oa(t,e,n,s){for(;e<n;){let u=e+n>>1;t[u]<s?e=u+1:n=u}return e}function zf(t,e,n,s){for(;e<n;){let u=e+n>>1;t[u]<=s?e=u+1:n=u}return e}function jo(t){return t>0?1/(1.001-t):1+t}function Cg(t){return t>0?1-1/(1.001-t):-t}function Td(){return bd==null&&(bd=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),bd}let ns={now:()=>Ac!==void 0?Ac:performance.now(),setNow(t){Ac=t},restoreNow(){Ac=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:s}=t;ta||(ta=document.createElement("canvas"));let u=ta.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>ta.width||s>ta.height)&&(ta.width=n,ta.height=s),u.clearRect(-e,-e,n+2*e,s+2*e),u.drawImage(t,0,0,n,s),u.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(xd||(xd=document.createElement("a")),xd.href=t,xd.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(wd==null&&(wd=window.matchMedia("(prefers-reduced-motion: reduce)")),wd.matches)},hasCanvasFingerprintNoise(){if(ml!==void 0)return ml;if(!Td())return ml=!1,!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let u=0;u<t.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);let s=e.getImageData(0,0,t.width,t.height);n=0;for(let u=0;u<s.data.length;++u)if(u%4!=3&&n++!==s.data[u])return ml=!0,!0;return ml=!1,!1}};function Dd(t,e){let n=t.indexOf("?");if(n<0)return`${t}?${new URLSearchParams(e).toString()}`;let s=new URLSearchParams(t.slice(n));for(let u in e)s.set(u,e[u]);return`${t.slice(0,n)}?${s.toString()}`}function Id(t,e={persistentParams:[]}){let n=t.indexOf("?");if(n<0)return t;let s=new URLSearchParams,u=new URLSearchParams(t.slice(n));for(let g of e.persistentParams){let y=u.get(g);y&&s.set(g,y)}let h=s.toString();return`${t.slice(0,n)}${h.length>0?`?${h}`:""}`}let gl="mapbox-tiles",Cd=500,Sg=50,As,Sd;function Bf(){try{return caches}catch{}}function _l(){let t=Bf();t&&!As&&(As=t.open(gl))}let Vf=1/0,Fa={supported:!1,testSupport:function(t){!jf&&yl&&(Mg?Pg(t):Pc=t)}},Pc,yl,jf=!1,Mg=!1,Ag=typeof self<"u"?self:{};function Pg(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,yl),t.isContextLost())return;Fa.supported=!0}catch{}t.deleteTexture(e),jf=!0}Ag.document&&(yl=Ag.document.createElement("img"),yl.onload=function(){Pc&&Pg(Pc),Pc=null,Mg=!0},yl.onerror=function(){jf=!0,Pc=null},yl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let Md={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Md);class Ad extends Error{constructor(e,n,s){n===401&&$(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let vl=Ms()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Rc=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(vl())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,u){let h=new AbortController,g=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:vl(),referrerPolicy:s.referrerPolicy,signal:h.signal}),y=!1,b=!1,w=(D=g.url).indexOf("sku=")>0&&$(D);var D;s.type==="json"&&g.headers.set("Accept","application/json");let I=(P,k,L)=>{if(b)return;if(P&&P.message!=="SecurityError"&&Ii(P.toString()),k&&L)return S(k);let B=Date.now();fetch(g).then(V=>{if(V.ok){let W=w?V.clone():null;return S(V,W,B)}return u(new Ad(V.statusText,V.status,s.url))}).catch(V=>{V.name!=="AbortError"&&u(new Error(`${V.message} ${s.url}`))})},S=(P,k,L)=>{(s.type==="arrayBuffer"?P.arrayBuffer():s.type==="json"?P.json():P.text()).then(B=>{b||(k&&L&&function(V,W,K){if(_l(),!As)return;let Y=co(W.headers.get("Cache-Control")||"");if(Y["no-store"])return;let se={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((de,_e)=>se.headers.set(_e,de)),Y["max-age"]&&se.headers.set("Expires",new Date(K+1e3*Y["max-age"]).toUTCString());let ee=se.headers.get("Expires");if(!ee||new Date(ee).getTime()-K<42e4)return;let le=Id(V.url,{persistentParams:["language","worldview"]});if(W.status===206){let de=V.headers.get("Range");if(!de)return;se.status=200,le=Dd(le,{range:de})}(function(de,_e){if(Sd===void 0)try{new Response(new ReadableStream),Sd=!0}catch{Sd=!1}Sd?_e(de.body):de.blob().then(_e)})(W,de=>{let _e=new Response(de,se);_l(),As&&As.then(Ie=>Ie.put(le,_e)).catch(Ie=>Ii(Ie.message))})}(g,k,L),y=!0,u(null,B,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(B=>{b||u(new Error(B.message))})};return w?function(P,k){if(_l(),!As)return k(null);As.then(L=>{let B=Id(P.url,{persistentParams:["language","worldview"]}),V=P.headers.get("Range");V&&(B=Dd(B,{range:V})),L.match(B).then(W=>{let K=function(Y){if(!Y)return!1;let se=new Date(Y.headers.get("Expires")||0),ee=co(Y.headers.get("Cache-Control")||"");return se>Date.now()&&!ee["no-cache"]}(W);L.delete(B),K&&L.put(B,W.clone()),k(null,W,K)}).catch(k)}).catch(k)}(g,I):I(null,null),{cancel:()=>{b=!0,y||h.abort()}}}(t,e);if(Ms()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,u){let h=new XMLHttpRequest;h.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(h.responseType="arraybuffer");for(let g in s.headers)h.setRequestHeader(g,s.headers[g]);return s.type==="json"&&(h.responseType="text",h.setRequestHeader("Accept","application/json")),h.withCredentials=s.credentials==="include",h.onerror=()=>{u(new Error(h.statusText))},h.onload=()=>{if((h.status>=200&&h.status<300||h.status===0)&&h.response!==null){let g=h.response;if(s.type==="json")try{g=JSON.parse(h.response)}catch(y){return u(y)}u(null,g,h.getResponseHeader("Cache-Control"),h.getResponseHeader("Expires"))}else u(new Ad(h.statusText,h.status,s.url))},h.send(s.body),{cancel:()=>h.abort()}}(t,e)},kc=function(t,e){return Rc(Eo(t,{type:"arrayBuffer"}),e)};function Uf(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let Rg="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Pd,Oc;Pd=[],Oc=0;let Gf=function(t,e){if(Fa.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Oc>=F.MAX_PARALLEL_IMAGE_REQUESTS){let h={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Pd.push(h),h}Oc++;let n=!1,s=()=>{if(!n)for(n=!0,Oc--;Pd.length&&Oc<F.MAX_PARALLEL_IMAGE_REQUESTS;){let h=Pd.shift(),{requestParameters:g,callback:y,cancelled:b}=h;b||(h.cancel=Gf(g,y).cancel)}},u=kc(t,(h,g,y,b)=>{s(),h?e(h):g&&(self.createImageBitmap?function(w,D){let I=new Blob([new Uint8Array(w)],{type:"image/png"});createImageBitmap(I).then(S=>{D(null,S)}).catch(S=>{D(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(w,D)=>e(w,D,y,b)):function(w,D){let I=new Image;I.onload=()=>{D(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Rg})},I.onerror=()=>D(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let S=new Blob([new Uint8Array(w)],{type:"image/png"});I.src=w.byteLength?URL.createObjectURL(S):Rg}(g,(w,D)=>e(w,D,y,b)))});return{cancel:()=>{u.cancel(),s()}}},Fc="01",Rd="NO_ACCESS_TOKEN",$f=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Uo(t){let e=t.match($f);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function bl(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let Lc="mapbox.eventData";function Hf(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class xl{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Hf(F.ACCESS_TOKEN),s="";return s=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,h)=>String.fromCharCode(+("0x"+h)))):F.ACCESS_TOKEN||"",e?`${Lc}.${e}:${s}`:`${Lc}:${s}`}fetchEventData(){let e=Nf("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{let u=localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));let h=localStorage.getItem(s);h&&(this.anonId=h)}catch{Ii("Unable to read from LocalStorage")}}saveEventData(){let e=Nf("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid"),u=this.anonId;if(e&&u)try{localStorage.setItem(s,u),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Ii("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,u){if(!F.EVENTS_URL)return;let h=Uo(F.EVENTS_URL);h.params.push(`access_token=${u||F.ACCESS_TOKEN||""}`);let g={event:this.type,created:new Date(e).toISOString()},y=n?Eo(g,n):g,b={url:bl(h),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(w,D){return Rc(Eo(w,{method:"POST"}),D)}(b,w=>{this.pendingRequest=null,s(w),this.saveEventData(),this.processRequests(u)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let kd=new class extends xl{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Q(n)||$(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Hf(F.ACCESS_TOKEN),n=e?e.u:F.ACCESS_TOKEN,s=n!==this.eventData.tokenU;Ig(this.anonId)||(this.anonId=vd(),s=!0);let u=this.queue.shift();if(this.eventData.lastSuccess){let h=new Date(this.eventData.lastSuccess),g=new Date(u),y=(u-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||h.getDate()!==g.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:Fc,"enabled.telemetry":!1,userId:this.anonId},h=>{h||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},Yr=kd.postTurnstileEvent.bind(kd),na=new class extends xl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,F.EVENTS_URL&&(n||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Rd)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ig(this.anonId)||(this.anonId=vd()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:Fc,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Xr=na.postMapLoadEvent.bind(na),kg=new class extends xl{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let e=this.mapInstanceIdMap.get(t);return e||(e=vd(),this.mapInstanceIdMap.set(t,e)),e}getEventId(t){let e=this.eventIdPerMapInstanceMap.get(t)||0;return this.eventIdPerMapInstanceMap.set(t,e+1),e}postStyleLoadEvent(t,e){let{map:n,style:s,importedStyles:u}=e;if(!F.EVENTS_URL||!t&&!F.ACCESS_TOKEN)return;let h=this.getMapInstanceId(n),g={mapInstanceId:h,eventId:this.getEventId(h),style:s};u.length&&(g.importedStyles=u),this.queueRequest({timestamp:Date.now(),payload:g},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,payload:n}=this.queue.shift();this.postEvent(e,n,()=>{},t)}},_b=kg.postStyleLoadEvent.bind(kg),Og=new class extends xl{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){F.EVENTS_URL&&(t||F.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),s=function(u){let h=performance.getEntriesByType("resource"),g=performance.getEntriesByType("mark"),y=function(P){let k={};if(P){for(let L in P)if(L!=="other")for(let B of P[L]){let V=`${L}ResolveRangeMin`,W=`${L}ResolveRangeMax`,K=`${L}RequestCount`,Y=`${L}RequestCachedCount`;k[V]=Math.min(k[V]||1/0,B.startTime),k[W]=Math.max(k[W]||-1/0,B.responseEnd);let se=ee=>{k[ee]===void 0&&(k[ee]=0),++k[ee]};B.transferSize!==void 0&&B.transferSize===0&&se(Y),se(K)}}return k}(function(P,k){let L={};if(P)for(let B of P){let V=k(B);L[V]===void 0&&(L[V]=[]),L[V].push(B)}return L}(h,Qe)),b=window.devicePixelRatio,w=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=w?w.effectiveType:void 0,I={counters:[],metadata:[],attributes:[]},S=(P,k,L)=>{L!=null&&P.push({name:k,value:L.toString()})};for(let P in y)S(I.counters,P,y[P]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(S(I.counters,"interactionRangeMin",u.interactionRange[0]),S(I.counters,"interactionRangeMax",u.interactionRange[1])),g)for(let P of Object.keys(ke)){let k=ke[P],L=g.find(B=>B.name===k);L&&S(I.counters,k,L.startTime)}return S(I.counters,"visibilityHidden",u.visibilityHidden),S(I.attributes,"style",function(P){if(P)for(let k of P){let L=k.name.split("?")[0];if(xe(L)){let B=L.split("/").slice(-2);if(B.length===2)return`mapbox://styles/${B[0]}/${B[1]}`}}}(h)),S(I.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),S(I.attributes,"fogEnabled",u.fogEnabled?"true":"false"),S(I.attributes,"projection",u.projection),S(I.attributes,"zoom",u.zoom),S(I.metadata,"devicePixelRatio",b),S(I.metadata,"connectionEffectiveType",D),S(I.metadata,"navigatorUserAgent",navigator.userAgent),S(I.metadata,"screenWidth",window.screen.width),S(I.metadata,"screenHeight",window.screen.height),S(I.metadata,"windowWidth",window.innerWidth),S(I.metadata,"windowHeight",window.innerHeight),S(I.metadata,"mapWidth",u.width/b),S(I.metadata,"mapHeight",u.height/b),S(I.metadata,"webglRenderer",u.renderer),S(I.metadata,"webglVendor",u.vendor),S(I.metadata,"sdkVersion",T),S(I.metadata,"sdkIdentifier","mapbox-gl-js"),I}(n);for(let u of s.metadata);for(let u of s.counters);for(let u of s.attributes);this.postEvent(e,s,()=>{},t)}},Od=Og.postPerformanceEvent.bind(Og),Fd=new class extends xl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!F.API_URL||!F.SESSION_PATH)return;let u=Uo(F.API_URL+F.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||F.ACCESS_TOKEN||""}`);let h={url:bl(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(g,y){return Rc(Eo(g,{method:"GET"}),y)}(h,g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,F.SESSION_PATH&&F.API_URL&&(n||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Rd)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},qf=Fd.getSessionAPI.bind(Fd),Ld=new Set;var is={exports:{}},Fg={exports:{}};Fg.exports=function(t,e){var n,s,u,h,g,y,b,w;for(s=t.length-(n=3&t.length),u=e,g=3432918353,y=461845907,w=0;w<s;)b=255&t.charCodeAt(w)|(255&t.charCodeAt(++w))<<8|(255&t.charCodeAt(++w))<<16|(255&t.charCodeAt(++w))<<24,++w,u=27492+(65535&(h=5*(65535&(u=(u^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(b=0,n){case 3:b^=(255&t.charCodeAt(w+2))<<16;case 2:b^=(255&t.charCodeAt(w+1))<<8;case 1:u^=b=(65535&(b=(b=(65535&(b^=255&t.charCodeAt(w)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*y+(((b>>>16)*y&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var yb=Fg.exports,Wf={exports:{}};Wf.exports=function(t,e){for(var n,s=t.length,u=e^s,h=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++h;switch(s){case 3:u^=(255&t.charCodeAt(h+2))<<16;case 2:u^=(255&t.charCodeAt(h+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(h)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Zf=yb,Go=Wf.exports;is.exports=Zf,is.exports.murmur3=Zf,is.exports.murmur2=Go;var Nc=dt(is.exports);function Qf(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Nd(t,e,n){if(n&&n[t]){let s=n[t].indexOf(e);s!==-1&&n[t].splice(s,1)}}class ia{constructor(e,n={}){Eo(this,n),this.type=e}}class zd extends ia{constructor(e,n={}){super("error",Eo({error:e},n))}}class La{on(e,n){return this._listeners=this._listeners||{},Qf(e,n,this._listeners),this}off(e,n){return Nd(e,n,this._listeners),Nd(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Qf(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){typeof e=="string"&&(e=new ia(e,n||{}));let s=e.type;if(this.listens(s)){e.target=this;let u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(let y of u)y.call(this,e);let h=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(let y of h)Nd(s,y,this._oneTimeListeners),y.call(this,e);let g=this._eventedParent;g&&(Eo(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof zd&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}r.z=void 0;var Yf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function zc(t){return(t=Math.round(t))<0?0:t>255?255:t}function Bd(t){return zc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Bc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Vd(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{r.z={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Yf)return Yf[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),u=n.indexOf(")");if(s!==-1&&u+1===n.length){var h=n.substr(0,s),g=n.substr(s+1,u-(s+1)).split(","),y=1;switch(h){case"rgba":if(g.length!==4)return null;y=Bc(g.pop());case"rgb":return g.length!==3?null:[Bd(g[0]),Bd(g[1]),Bd(g[2]),y];case"hsla":if(g.length!==4)return null;y=Bc(g.pop());case"hsl":if(g.length!==3)return null;var b=(parseFloat(g[0])%360+360)%360/360,w=Bc(g[1]),D=Bc(g[2]),I=D<=.5?D*(w+1):D+w-D*w,S=2*D-I;return[zc(255*Vd(S,I,b+1/3)),zc(255*Vd(S,I,b)),zc(255*Vd(S,I,b-1/3)),y];default:return null}}return null}}catch{}class Bn{constructor(e,n,s,u=1){this.r=e,this.g=n,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Bn)return e;if(typeof e!="string")return;let n=r.z(e);return n?new Bn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${u})`}toArray(){let{r:e,g:n,b:s,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*s/u,u]}toArray01(){let{r:e,g:n,b:s,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,s/u,u]}toArray01Scaled(e){let{r:n,g:s,b:u,a:h}=this;return h===0?[0,0,0]:[n/h*e,s/h*e,u/h*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:s,a:u}=this;return[e,n,s,u]}toArray01Linear(){let{r:e,g:n,b:s,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(n/u,2.2),Math.pow(s/u,2.2),u]}}function sn(t,e,n){return t*(1-n)+e*n}function Vc(t,e,n){return t.map((s,u)=>sn(s,e[u],n))}Bn.black=new Bn(0,0,0,1),Bn.white=new Bn(1,1,1,1),Bn.transparent=new Bn(0,0,0,0),Bn.red=new Bn(1,0,0,1),Bn.blue=new Bn(0,0,1,1);var jc=Object.freeze({__proto__:null,array:Vc,color:function(t,e,n){return new Bn(sn(t.r,e.r,n),sn(t.g,e.g,n),sn(t.b,e.b,n),sn(t.a,e.a,n))},number:sn});function jd(t,...e){for(let n of e)for(let s in n)t[s]=n[s];return t}class $o extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class ra{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[s,u]of n)this.bindings[s]=u}concat(e){return new ra(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}let ln={kind:"null"},ut={kind:"number"},Mn={kind:"string"},An={kind:"boolean"},uo={kind:"color"},wl={kind:"object"},xn={kind:"value"},Uc={kind:"collator"},El={kind:"formatted"},Tl={kind:"resolvedImage"};function mr(t,e){return{kind:"array",itemType:t,N:e}}function ki(t){if(t.kind==="array"){let e=ki(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let Lg=[ln,ut,Mn,An,uo,El,wl,mr(xn),Tl];function Gc(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Gc(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of Lg)if(!Gc(n,e))return null}}return`Expected ${ki(t)} but found ${ki(e)} instead.`}function $c(t,e){return e.some(n=>n.kind===t.kind)}function Na(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}class Xf{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ud{constructor(e,n,s,u,h){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=u,this.textColor=h}}class Er{constructor(e){this.sections=e}static fromString(e){return new Er([new Ud(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Er?e:Er.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class ho{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new ho({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Ng(t,e,n,s){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Dl(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bn||t instanceof Xf||t instanceof Er||t instanceof ho)return!0;if(Array.isArray(t)){for(let e of t)if(!Dl(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Dl(t[e]))return!1;return!0}return!1}function Qi(t){if(t===null)return ln;if(typeof t=="string")return Mn;if(typeof t=="boolean")return An;if(typeof t=="number")return ut;if(t instanceof Bn)return uo;if(t instanceof Xf)return Uc;if(t instanceof Er)return El;if(t instanceof ho)return Tl;if(Array.isArray(t)){let e=t.length,n;for(let s of t){let u=Qi(s);if(n){if(n===u)continue;n=xn;break}n=u}return mr(n||xn,e)}return wl}function To(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Bn||t instanceof Er||t instanceof ho?t.toString():JSON.stringify(t)}class rs{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Dl(e[1]))return n.error("invalid value");let s=e[1],u=Qi(s),h=n.expectedType;return u.kind!=="array"||u.N!==0||!h||h.kind!=="array"||typeof h.N=="number"&&h.N!==0||(u=h),new rs(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bn?["rgba"].concat(this.value.toArray()):this.value instanceof Er?this.value.serialize():this.value}}class ar{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}let Gd={string:Mn,number:ut,boolean:An,object:wl};class Ho{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,u=1,h=e[0];if(h==="array"){let y,b;if(e.length>2){let w=e[1];if(typeof w!="string"||!(w in Gd)||w==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Gd[w],u++}else y=xn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}s=mr(y,b)}else s=Gd[h];let g=[];for(;u<e.length;u++){let y=n.parse(e[u],u,xn);if(!y)return null;g.push(y)}return new Ho(s,g)}evaluate(e){for(let n=0;n<this.args.length;n++){let s=this.args[n].evaluate(e);if(!Gc(this.type,Qi(s)))return s;if(n===this.args.length-1)throw new ar(`Expected value to be of type ${ki(this.type)}, but found ${ki(Qi(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){n.push(s.kind);let u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(s=>s.serialize()))}}class Hc{constructor(e){this.type=El,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s=e[1];if(!Array.isArray(s)&&typeof s=="object")return n.error("First argument must be an image or text section.");let u=[],h=!1;for(let g=1;g<=e.length-1;++g){let y=e[g];if(h&&typeof y=="object"&&!Array.isArray(y)){h=!1;let b=null;if(y["font-scale"]&&(b=n.parse(y["font-scale"],1,ut),!b))return null;let w=null;if(y["text-font"]&&(w=n.parse(y["text-font"],1,mr(Mn)),!w))return null;let D=null;if(y["text-color"]&&(D=n.parse(y["text-color"],1,uo),!D))return null;let I=u[u.length-1];I.scale=b,I.font=w,I.textColor=D}else{let b=n.parse(e[g],1,xn);if(!b)return null;let w=b.type.kind;if(w!=="string"&&w!=="value"&&w!=="null"&&w!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");h=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Hc(u)}evaluate(e){return new Er(this.sections.map(n=>{let s=n.content.evaluate(e);return Qi(s)===Tl?new Ud("",s,null,null,null):new Ud(To(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Il{constructor(e,n){this.type=Tl,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let s=n.parse(e[1],1,Mn);if(!s)return n.error("No image name provided.");if(e.length===2)return new Il(s);let u=n.parse(e[2],1,Mn);return u?new Il(s,u):n.error("Secondary image variant is not a string.")}evaluate(e){let n=ho.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function oa(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let vb={"to-boolean":An,"to-color":uo,"to-number":ut,"to-string":Mn};class Ps{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s=e[0],u=[],h=ln;if(s==="to-array"){if(!Array.isArray(e[1]))return null;let g=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);h=mr(n.expectedType.itemType,g)}else{if(!(g>0&&Dl(e[1][0])))return null;h=mr(Qi(e[1][0]),g)}for(let y=0;y<g;y++){let b=e[1][y],w;if(oa(b)==="array")w=n.parse(b,void 0,h.itemType);else{let D=oa(b);if(D!==h.itemType.kind)return n.error(`Expected ${h.itemType.kind} but found ${D}.`);w=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!w)return null;u.push(w)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return n.error("Expected one argument.");h=vb[s];for(let g=1;g<e.length;g++){let y=n.parse(e[g],g,xn);if(!y)return null;u.push(y)}}return new Ps(h,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,s;for(let u of this.args){if(n=u.evaluate(e),s=null,n instanceof Bn)return n;if(typeof n=="string"){let h=e.parseColor(n);if(h)return h}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ng(n[0],n[1],n[2],n[3]),!s))return new Bn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ar(s||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let s of this.args){if(n=s.evaluate(e),n===null)return 0;let u=Number(n);if(!isNaN(u))return u}throw new ar(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Er.fromString(To(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?ho.fromString(To(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):To(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Hc([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Il(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}let bb=["Unknown","Point","LineString","Polygon"];class Kf{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?bb[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=Bn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class Kr{constructor(e,n,s,u,h){this.name=e,this.type=n,this._evaluate=s,this.args=u,this._overloadIndex=h}evaluate(e){if(!this._evaluate){let n=Kr.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let s=e[0],u=Kr.definitions[s];if(!u)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);let h=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[],b=null,w=-1;for(let[D,I]of g){if(Array.isArray(D)&&D.length!==e.length-1)continue;y.push(D),w++,b=new Kd(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let S=[],P=!1;for(let k=1;k<e.length;k++){let L=e[k],B=Array.isArray(D)?D[k-1]:D.type,V=b.parse(L,1+S.length,B);if(!V){P=!0;break}S.push(V)}if(!P)if(Array.isArray(D)&&D.length!==S.length)b.error(`Expected ${D.length} arguments, but found ${S.length} instead.`);else{for(let k=0;k<S.length;k++){let L=Array.isArray(D)?D[k]:D.type,B=S[k];b.concat(k+1).checkSubtype(L,B.type)}if(b.errors.length===0)return new Kr(s,h,I,S,w)}}if(y.length===1)n.errors.push(...b.errors);else{let D=(y.length?y:g.map(([S])=>S)).map(xb).join(" | "),I=[];for(let S=1;S<e.length;S++){let P=n.parse(e[S],1+I.length);if(!P)return null;I.push(ki(P.type))}n.error(`Expected arguments of type ${D}, but found (${I.join(", ")}) instead.`)}return null}static register(e,n){Kr.definitions=n;for(let s in n)e[s]=Kr}}function xb(t){return Array.isArray(t)?`(${t.map(ki).join(", ")})`:`(${ki(t.type)}...)`}class qc{constructor(e,n,s){this.type=Uc,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let s=e[1];if(typeof s!="object"||Array.isArray(s))return n.error("Collator options argument must be an object.");let u=n.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,An);if(!u)return null;let h=n.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,An);if(!h)return null;let g=null;return s.locale&&(g=n.parse(s.locale,1,Mn),!g)?null:new qc(u,h,g)}evaluate(e){return new Xf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Jf={exports:{}};Jf.exports=function(){function t(s,u,h,g,y){for(;g>h;){if(g-h>600){var b=g-h+1,w=u-h+1,D=Math.log(b),I=.5*Math.exp(2*D/3),S=.5*Math.sqrt(D*I*(b-I)/b)*(w-b/2<0?-1:1);t(s,u,Math.max(h,Math.floor(u-w*I/b+S)),Math.min(g,Math.floor(u+(b-w)*I/b+S)),y)}var P=s[u],k=h,L=g;for(e(s,h,u),y(s[g],P)>0&&e(s,h,g);k<L;){for(e(s,k,L),k++,L--;y(s[k],P)<0;)k++;for(;y(s[L],P)>0;)L--}y(s[h],P)===0?e(s,h,L):e(s,++L,g),L<=u&&(h=L+1),u<=L&&(g=L-1)}}function e(s,u,h){var g=s[u];s[u]=s[h],s[h]=g}function n(s,u){return s<u?-1:s>u?1:0}return function(s,u,h,g,y){t(s,u,h||0,g||s.length-1,y||n)}}();var zg=dt(Jf.exports);function wb(t){let e=0;for(let n,s,u=0,h=t.length,g=h-1;u<h;g=u++)n=t[u],s=t[g],e+=(s.x-n.x)*(n.y+s.y);return e}function Wc(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Zc(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Eb(t,e,n){let s=t[0]-e[0],u=t[1]-e[1],h=t[0]-n[0],g=t[1]-n[1];return s*g-h*u==0&&s*h<=0&&u*g<=0}function za(t,e,n=!1){let s=!1;for(let y=0,b=e.length;y<b;y++){let w=e[y];for(let D=0,I=w.length,S=I-1;D<I;S=D++){let P=w[S],k=w[D];if(Eb(t,P,k))return n;(h=P)[1]>(u=t)[1]!=(g=k)[1]>u[1]&&u[0]<(g[0]-h[0])*(u[1]-h[1])/(g[1]-h[1])+h[0]&&(s=!s)}}var u,h,g;return s}function ep(t,e,n,s){let u=s[0]-n[0],h=s[1]-n[1],g=(t[0]-n[0])*h-u*(t[1]-n[1]),y=(e[0]-n[0])*h-u*(e[1]-n[1]);return g>0&&y<0||g<0&&y>0}function Cl(t,e,n,s){return(u=[s[0]-n[0],s[1]-n[1]])[0]*(h=[e[0]-t[0],e[1]-t[1]])[1]-u[1]*h[0]!=0&&!(!ep(t,e,n,s)||!ep(n,s,t,e));var u,h}let sa=8192;function Tb(t,e){let n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*sa),Math.round(s*u*sa)]}function Db(t,e){for(let n=0;n<e.length;n++)if(za(t,e[n]))return!0;return!1}function tp(t,e,n){for(let s of n)for(let u=0,h=s.length,g=h-1;u<h;g=u++)if(Cl(t,e,s[g],s[u]))return!0;return!1}function $d(t,e){for(let n=0;n<t.length;++n)if(!za(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(tp(t[n],t[n+1],e))return!1;return!0}function Bg(t,e){for(let n=0;n<e.length;n++)if($d(t,e[n]))return!0;return!1}function np(t,e,n){let s=[];for(let u=0;u<t.length;u++){let h=[];for(let g=0;g<t[u].length;g++){let y=Tb(t[u][g],n);Wc(e,y),h.push(y)}s.push(h)}return s}function Qc(t,e,n){let s=[];for(let u=0;u<t.length;u++){let h=np(t[u],e,n);s.push(h)}return s}function ip(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){let u=.5*s,h=t[0]-n[0]>u?-s:n[0]-t[0]>u?s:0;h===0&&(h=t[0]-n[2]>u?-s:n[2]-t[0]>u?s:0),t[0]+=h}Wc(e,t)}function Yc(t,e,n,s){let u=Math.pow(2,s.z)*sa,h=[s.x*sa,s.y*sa],g=[];if(!t)return g;for(let y of t)for(let b of y){let w=[b.x+h[0],b.y+h[1]];ip(w,e,n,u),g.push(w)}return g}function rp(t,e,n,s){let u=Math.pow(2,s.z)*sa,h=[s.x*sa,s.y*sa],g=[];if(!t)return g;for(let b of t){let w=[];for(let D of b){let I=[D.x+h[0],D.y+h[1]];Wc(e,I),w.push(I)}g.push(w)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(let b of g)for(let w of b)ip(w,e,n,u)}var y;return g}class Ba{constructor(e,n){this.type=An,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Dl(e[1])){let s=e[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){let h=s.features[u].geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Ba(s,s.features[u].geometry)}else if(s.type==="Feature"){let u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ba(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Ba(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,s){let u=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if(s.type==="Polygon"){let y=np(s.coordinates,h,g),b=Yc(n.geometry(),u,h,g);if(!Zc(u,h))return!1;for(let w of b)if(!za(w,y))return!1}if(s.type==="MultiPolygon"){let y=Qc(s.coordinates,h,g),b=Yc(n.geometry(),u,h,g);if(!Zc(u,h))return!1;for(let w of b)if(!Db(w,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,s){let u=[1/0,1/0,-1/0,-1/0],h=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if(s.type==="Polygon"){let y=np(s.coordinates,h,g),b=rp(n.geometry(),u,h,g);if(!Zc(u,h))return!1;for(let w of b)if(!$d(w,y))return!1}if(s.type==="MultiPolygon"){let y=Qc(s.coordinates,h,g),b=rp(n.geometry(),u,h,g);if(!Zc(u,h))return!1;for(let w of b)if(!Bg(w,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Vg={exports:{}};(function(t,e){t.exports=function(){var n={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},s=1/298.257223563,u=s*(2-s),h=Math.PI/180,g=function(I,S){if(I===void 0)throw new Error("No latitude given.");if(S&&!n[S])throw new Error("Unknown unit "+S+". Use one of: "+Object.keys(n).join(", "));var P=6378.137*h*(S?n[S]:1),k=Math.cos(I*h),L=1/(1-u*(1-k*k)),B=Math.sqrt(L);this.kx=P*B*k,this.ky=P*B*L*(1-u)},y={units:{configurable:!0}};function b(I,S){return I[0]===S[0]&&I[1]===S[1]}function w(I,S,P){var k=D(S[0]-I[0]);return[I[0]+k*P,I[1]+(S[1]-I[1])*P]}function D(I){for(;I<-180;)I+=360;for(;I>180;)I-=360;return I}return g.fromTile=function(I,S,P){var k=Math.PI*(1-2*(I+.5)/Math.pow(2,S)),L=Math.atan(.5*(Math.exp(k)-Math.exp(-k)))/h;return new g(L,P)},y.units.get=function(){return n},g.prototype.distance=function(I,S){var P=D(I[0]-S[0])*this.kx,k=(I[1]-S[1])*this.ky;return Math.sqrt(P*P+k*k)},g.prototype.bearing=function(I,S){var P=D(S[0]-I[0])*this.kx;return Math.atan2(P,(S[1]-I[1])*this.ky)/h},g.prototype.destination=function(I,S,P){var k=P*h;return this.offset(I,Math.sin(k)*S,Math.cos(k)*S)},g.prototype.offset=function(I,S,P){return[I[0]+S/this.kx,I[1]+P/this.ky]},g.prototype.lineDistance=function(I){for(var S=0,P=0;P<I.length-1;P++)S+=this.distance(I[P],I[P+1]);return S},g.prototype.area=function(I){for(var S=0,P=0;P<I.length;P++)for(var k=I[P],L=0,B=k.length,V=B-1;L<B;V=L++)S+=D(k[L][0]-k[V][0])*(k[L][1]+k[V][1])*(P?-1:1);return Math.abs(S)/2*this.kx*this.ky},g.prototype.along=function(I,S){var P=0;if(S<=0)return I[0];for(var k=0;k<I.length-1;k++){var L=I[k],B=I[k+1],V=this.distance(L,B);if((P+=V)>S)return w(L,B,(S-(P-V))/V)}return I[I.length-1]},g.prototype.pointToSegmentDistance=function(I,S,P){var k=S[0],L=S[1],B=D(P[0]-k)*this.kx,V=(P[1]-L)*this.ky,W=0;return B===0&&V===0||((W=(D(I[0]-k)*this.kx*B+(I[1]-L)*this.ky*V)/(B*B+V*V))>1?(k=P[0],L=P[1]):W>0&&(k+=B/this.kx*W,L+=V/this.ky*W)),B=D(I[0]-k)*this.kx,V=(I[1]-L)*this.ky,Math.sqrt(B*B+V*V)},g.prototype.pointOnLine=function(I,S){for(var P,k,L,B,V=1/0,W=0;W<I.length-1;W++){var K=I[W][0],Y=I[W][1],se=D(I[W+1][0]-K)*this.kx,ee=(I[W+1][1]-Y)*this.ky,le=0;se===0&&ee===0||((le=(D(S[0]-K)*this.kx*se+(S[1]-Y)*this.ky*ee)/(se*se+ee*ee))>1?(K=I[W+1][0],Y=I[W+1][1]):le>0&&(K+=se/this.kx*le,Y+=ee/this.ky*le));var de=(se=D(S[0]-K)*this.kx)*se+(ee=(S[1]-Y)*this.ky)*ee;de<V&&(V=de,P=K,k=Y,L=W,B=le)}return{point:[P,k],index:L,t:Math.max(0,Math.min(1,B))}},g.prototype.lineSlice=function(I,S,P){var k=this.pointOnLine(P,I),L=this.pointOnLine(P,S);if(k.index>L.index||k.index===L.index&&k.t>L.t){var B=k;k=L,L=B}var V=[k.point],W=k.index+1,K=L.index;!b(P[W],V[0])&&W<=K&&V.push(P[W]);for(var Y=W+1;Y<=K;Y++)V.push(P[Y]);return b(P[K],L.point)||V.push(L.point),V},g.prototype.lineSliceAlong=function(I,S,P){for(var k=0,L=[],B=0;B<P.length-1;B++){var V=P[B],W=P[B+1],K=this.distance(V,W);if((k+=K)>I&&L.length===0&&L.push(w(V,W,(I-(k-K))/K)),k>=S)return L.push(w(V,W,(S-(k-K))/K)),L;k>I&&L.push(W)}return L},g.prototype.bufferPoint=function(I,S){var P=S/this.ky,k=S/this.kx;return[I[0]-k,I[1]-P,I[0]+k,I[1]+P]},g.prototype.bufferBBox=function(I,S){var P=S/this.ky,k=S/this.kx;return[I[0]-k,I[1]-P,I[2]+k,I[3]+P]},g.prototype.insideBBox=function(I,S){return D(I[0]-S[0])>=0&&D(I[0]-S[2])<=0&&I[1]>=S[1]&&I[1]<=S[3]},Object.defineProperties(g,y),g}()})(Vg);var Xc=dt(Vg.exports),Hd={exports:{}};(function(t,e){t.exports=function(){var n=function(u,h){if(u===void 0&&(u=[]),h===void 0&&(h=s),this.data=u,this.length=this.data.length,this.compare=h,this.length>0)for(var g=(this.length>>1)-1;g>=0;g--)this._down(g)};function s(u,h){return u<h?-1:u>h?1:0}return n.prototype.push=function(u){this.data.push(u),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var u=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),u}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(u){for(var h=this.data,g=this.compare,y=h[u];u>0;){var b=u-1>>1,w=h[b];if(g(y,w)>=0)break;h[u]=w,u=b}h[u]=y},n.prototype._down=function(u){for(var h=this.data,g=this.compare,y=this.length>>1,b=h[u];u<y;){var w=1+(u<<1),D=h[w],I=w+1;if(I<this.length&&g(h[I],D)<0&&(w=I,D=h[I]),g(D,b)>=0)break;h[u]=D,u=w}h[u]=b},n}()})(Hd);var qd=dt(Hd.exports),nt=8192;function Va(t,e){return e.dist-t.dist}let op=100,sp=50;function jg(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Wd(t){return t[1]-t[0]+1}function Rs(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Zd(t,e){if(t[0]>t[1])return[null,null];let n=Wd(t);if(e){if(n===2)return[t,null];let s=Math.floor(n/2);return[[t[0],t[0]+s],[t[0]+s,t[1]]]}{if(n===1)return[t,null];let s=Math.floor(n/2)-1;return[[t[0],t[0]+s],[t[0]+s+1,t[1]]]}}function ks(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Rs(e,t.length))return n;for(let s=e[0];s<=e[1];++s)Wc(n,t[s]);return n}function Qd(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)Wc(e,t[n][s]);return e}function Sl(t,e,n){if(jg(t)||jg(e))return NaN;let s=0,u=0;return t[2]<e[0]&&(s=e[0]-t[2]),t[0]>e[2]&&(s=t[0]-e[2]),t[1]>e[3]&&(u=t[1]-e[3]),t[3]<e[1]&&(u=e[1]-t[3]),n.distance([0,0],[s,u])}function Ib(t){return 360*t-180}function Cb(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ap(t,e){let n=Math.pow(2,e.z),s=(t.y/nt+e.y)/n;return[Ib((t.x/nt+e.x)/n),Cb(s)]}function Sb(t,e){let n=[];for(let s=0;s<t.length;++s)n.push(ap(t[s],e));return n}function Ug(t,e,n){let s=n.pointOnLine(e,t).point;return n.distance(t,s)}function Gg(t,e,n,s,u){let h=n.slice(s[0],s[1]+1),g=1/0;for(let y=e[0];y<=e[1];++y)if((g=Math.min(g,Ug(t[y],h,u)))===0)return 0;return g}function lp(t,e,n,s,u){let h=Math.min(u.pointToSegmentDistance(t,n,s),u.pointToSegmentDistance(e,n,s)),g=Math.min(u.pointToSegmentDistance(n,t,e),u.pointToSegmentDistance(s,t,e));return Math.min(h,g)}function Ml(t,e,n,s,u){if(!Rs(e,t.length)||!Rs(s,n.length))return NaN;let h=1/0;for(let g=e[0];g<e[1];++g)for(let y=s[0];y<s[1];++y){if(Cl(t[g],t[g+1],n[y],n[y+1]))return 0;h=Math.min(h,lp(t[g],t[g+1],n[y],n[y+1],u))}return h}function $g(t,e,n,s,u){if(!Rs(e,t.length)||!Rs(s,n.length))return NaN;let h=1/0;for(let g=e[0];g<=e[1];++g)for(let y=s[0];y<=s[1];++y)if((h=Math.min(h,u.distance(t[g],n[y])))===0)return h;return h}function Hg(t,e,n){if(za(t,e,!0))return 0;let s=1/0;for(let u of e){let h=u.length;if(h<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[h-1]&&(s=Math.min(s,n.pointToSegmentDistance(t,u[h-1],u[0])))===0||(s=Math.min(s,Ug(t,u,n)))===0)return s}return s}function Yd(t,e,n,s){if(!Rs(e,t.length))return NaN;for(let h=e[0];h<=e[1];++h)if(za(t[h],n,!0))return 0;let u=1/0;for(let h=e[0];h<e[1];++h)for(let g of n)for(let y=0,b=g.length,w=b-1;y<b;w=y++){if(Cl(t[h],t[h+1],g[w],g[y]))return 0;u=Math.min(u,lp(t[h],t[h+1],g[w],g[y],s))}return u}function qg(t,e){for(let n of t)for(let s=0;s<=n.length-1;++s)if(za(n[s],e,!0))return!0;return!1}function Mb(t,e,n,s=1/0){let u=Qd(t),h=Qd(e);if(s!==1/0&&Sl(u,h,n)>=s)return s;if(Zc(u,h)){if(qg(t,e))return 0}else if(qg(e,t))return 0;let g=s;for(let y of t)for(let b=0,w=y.length,D=w-1;b<w;D=b++)for(let I of e)for(let S=0,P=I.length,k=P-1;S<P;k=S++){if(Cl(y[D],y[b],I[k],I[S]))return 0;g=Math.min(g,lp(y[D],y[b],I[k],I[S],n))}return g}function qo(t,e,n,s,u,h,g){if(h===null||g===null)return;let y=Sl(ks(s,h),ks(u,g),n);y<e&&t.push({dist:y,range1:h,range2:g})}function Wg(t,e,n,s,u=1/0){let h=Math.min(s.distance(t[0],n[0][0]),u);if(h===0)return h;let g=new qd([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Va),y=e?sp:op,b=Qd(n);for(;g.length;){let w=g.pop();if(w.dist>=h)continue;let D=w.range1;if(Wd(D)<=y){if(!Rs(D,t.length))return NaN;if(e){let I=Yd(t,D,n,s);if((h=Math.min(h,I))===0)return h}else for(let I=D[0];I<=D[1];++I){let S=Hg(t[I],n,s);if((h=Math.min(h,S))===0)return h}}else{let I=Zd(D,e);if(I[0]!==null){let S=Sl(ks(t,I[0]),b,s);S<h&&g.push({dist:S,range1:I[0],range2:[0,0]})}if(I[1]!==null){let S=Sl(ks(t,I[1]),b,s);S<h&&g.push({dist:S,range1:I[1],range2:[0,0]})}}}return h}function ja(t,e,n,s,u,h=1/0){let g=Math.min(h,u.distance(t[0],n[0]));if(g===0)return g;let y=new qd([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Va),b=e?sp:op,w=s?sp:op;for(;y.length;){let D=y.pop();if(D.dist>=g)continue;let I=D.range1,S=D.range2;if(Wd(I)<=b&&Wd(S)<=w){if(!Rs(I,t.length)||!Rs(S,n.length))return NaN;if(e&&s?g=Math.min(g,Ml(t,I,n,S,u)):e||s?e&&!s?g=Math.min(g,Gg(n,S,t,I,u)):!e&&s&&(g=Math.min(g,Gg(t,I,n,S,u))):g=Math.min(g,$g(t,I,n,S,u)),g===0)return g}else{let P=Zd(I,e),k=Zd(S,s);qo(y,g,u,t,n,P[0],k[0]),qo(y,g,u,t,n,P[0],k[1]),qo(y,g,u,t,n,P[1],k[0]),qo(y,g,u,t,n,P[1],k[1])}}return g}function cp(t,e,n,s,u=1/0){let h=u,g=ks(t,[0,t.length-1]);for(let y of n)if(!(h!==1/0&&Sl(g,ks(y,[0,y.length-1]),s)>=h)&&(h=Math.min(h,ja(t,e,y,!0,s,h)),h===0))return h;return h}function Xd(t,e,n,s,u=1/0){let h=u,g=ks(t,[0,t.length-1]);for(let y of n){if(h!==1/0&&Sl(g,Qd(y),s)>=h)continue;let b=Wg(t,e,y,s,h);if(isNaN(b))return b;if((h=Math.min(h,b))===0)return h}return h}function up(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Ua{constructor(e,n){this.type=ut,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Dl(e[1])){let s=e[1];if(s.type==="FeatureCollection"){for(let u=0;u<s.features.length;++u)if(up(s.features[u].geometry.type))return new Ua(s,s.features[u].geometry)}else if(s.type==="Feature"){if(up(s.geometry.type))return new Ua(s,s.geometry)}else if(up(s.type))return new Ua(s,s)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),s=e.canonicalID();if(n!=null&&s!=null){if(e.geometryType()==="Point")return function(u,h,g){let y=[];for(let w of u)for(let D of w)y.push(ap(D,h));let b=new Xc(y[0][1],"meters");return g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString"?ja(y,!1,g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",b):g.type==="MultiLineString"?cp(y,!1,g.coordinates,b):g.type==="Polygon"||g.type==="MultiPolygon"?Xd(y,!1,g.type==="Polygon"?[g.coordinates]:g.coordinates,b):null}(n,s,this.geometries);if(e.geometryType()==="LineString")return function(u,h,g){let y=[];for(let w of u){let D=[];for(let I of w)D.push(ap(I,h));y.push(D)}let b=new Xc(y[0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return cp(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",y,b);if(g.type==="MultiLineString"){let w=1/0;for(let D=0;D<g.coordinates.length;D++){let I=cp(g.coordinates[D],!0,y,b,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}if(g.type==="Polygon"||g.type==="MultiPolygon"){let w=1/0;for(let D=0;D<y.length;D++){let I=Xd(y[D],!0,g.type==="Polygon"?[g.coordinates]:g.coordinates,b,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return null}(n,s,this.geometries);if(e.geometryType()==="Polygon")return function(u,h,g){let y=[];for(let w of function(D,I){let S=D.length;if(S<=1)return[D];let P=[],k,L;for(let B=0;B<S;B++){let V=wb(D[B]);V!==0&&(D[B].area=Math.abs(V),L===void 0&&(L=V<0),L===V<0?(k&&P.push(k),k=[D[B]]):k.push(D[B]))}return k&&P.push(k),P}(u)){let D=[];for(let I=0;I<w.length;++I)D.push(Sb(w[I],h));y.push(D)}let b=new Xc(y[0][0][0][1],"meters");if(g.type==="Point"||g.type==="MultiPoint"||g.type==="LineString")return Xd(g.type==="Point"?[g.coordinates]:g.coordinates,g.type==="LineString",y,b);if(g.type==="MultiLineString"){let w=1/0;for(let D=0;D<g.coordinates.length;D++){let I=Xd(g.coordinates[D],!0,y,b,w);if(isNaN(I))return I;if((w=Math.min(w,I))===0)return w}return w}return g.type==="Polygon"||g.type==="MultiPolygon"?function(w,D,I){let S=1/0;for(let P of w)for(let k of D){let L=Mb(P,k,I,S);if(isNaN(L))return L;if((S=Math.min(S,L))===0)return S}return S}(g.type==="Polygon"?[g.coordinates]:g.coordinates,y,b):null}(n,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function dp(t,e){switch(t){case"string":return To(e);case"number":return+e;case"boolean":return!!e;case"color":return Bn.parse(e);case"formatted":return Er.fromString(To(e));case"resolvedImage":return ho.fromString(To(e))}return e}function hp(t,e,n,s){return s!==void 0&&(t=s*Math.round(t/s)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}class aa{constructor(e,n,s){this.type=e,this.key=n,this.scope=s}static parse(e,n){let s=n.expectedType;if(s==null&&(s=xn),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");let u=n.parse(e[1],1);if(!(u instanceof rs))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){let h=n.parse(e[2],2);return h instanceof rs?new aa(s,To(u.value),To(h.value)):n.error("Scope of 'config' expression must be a string literal.")}return new aa(s,To(u.value))}evaluate(e){let n=[this.key,this.scope,e.scope].filter(Boolean).join(""),s=e.getConfig(n);if(!s)return null;let{type:u,value:h,values:g,minValue:y,maxValue:b,stepValue:w}=s,D=s.default.evaluate(e),I=D;if(h){let S=e.scope;e.scope=(S||"").split("").slice(1).join(""),I=h.evaluate(e),e.scope=S}return u&&(I=dp(u,I)),I===void 0||y===void 0&&b===void 0&&w===void 0||(typeof I=="number"?I=hp(I,y,b,w):Array.isArray(I)&&(I=I.map(S=>typeof S=="number"?hp(S,y,b,w):S))),h!==void 0&&I!==void 0&&g&&!g.includes(I)&&(I=D,u&&(I=dp(u,I))),(u&&u!==this.type||I!==void 0&&Qi(I)!==this.type)&&(I=dp(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){let e=["config",this.key];return this.scope&&e.concat(this.key),e}}function la(t){if(t instanceof Kr&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ba||t instanceof Ua)return!1;let e=!0;return t.eachChild(n=>{e&&!la(n)&&(e=!1)}),e}function Kc(t){if(t instanceof Kr&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Kc(n)&&(e=!1)}),e}function Jc(t){if(t instanceof aa)return!1;let e=!0;return t.eachChild(n=>{e&&!Jc(n)&&(e=!1)}),e}function eu(t,e){if(t instanceof Kr&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!eu(s,e)&&(n=!1)}),n}class fo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let s=e[1];return n.scope.has(s)?new fo(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Kd{constructor(e,n=[],s,u=new ra,h=[],g,y){this.registry=e,this.path=n,this.key=n.map(b=>`[${b}]`).join(""),this.scope=u,this.errors=h,this.expectedType=s,this._scope=g,this.options=y}parse(e,n,s,u,h={}){return n||s?this.concat(n,s,u)._parse(e,h):this._parse(e,h)}_parse(e,n){function s(u,h,g){return g==="assert"?new Ho(h,[u]):g==="coerce"?new Ps(h,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let h=u.parse(e,this);if(!h)return null;if(this.expectedType){let g=this.expectedType,y=h.type;if(g.kind!=="string"&&g.kind!=="number"&&g.kind!=="boolean"&&g.kind!=="object"&&g.kind!=="array"||y.kind!=="value")if(g.kind!=="color"&&g.kind!=="formatted"&&g.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(g,y))return null}else h=s(h,g,n.typeAnnotation||"coerce");else h=s(h,g,n.typeAnnotation||"assert")}if(!(h instanceof rs)&&h.type.kind!=="resolvedImage"&&Jd(h)){let g=new Kf(this._scope,this.options);try{h=new rs(h.type,h.evaluate(g))}catch(y){return this.error(y.message),null}}return h}return Ps.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){let u=typeof e=="number"?this.path.concat(e):this.path,h=s?this.scope.concat(s):this.scope;return new Kd(this.registry,u,n||null,h,this.errors,this._scope,this.options)}error(e,...n){let s=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new $o(s,e))}checkSubtype(e,n){let s=Gc(e,n);return s&&this.error(s),s}}function Jd(t){if(t instanceof fo)return Jd(t.boundExpression);if(t instanceof Kr&&t.name==="error"||t instanceof qc||t instanceof Ba||t instanceof Ua||t instanceof aa)return!1;let e=t instanceof Ps||t instanceof Ho,n=!0;return t.eachChild(s=>{n=e?n&&Jd(s):n&&s instanceof rs}),!!n&&la(t)&&eu(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function eh(t,e){let n=t.length-1,s,u,h=0,g=n,y=0;for(;h<=g;)if(y=Math.floor((h+g)/2),s=t[y],u=t[y+1],s<=e){if(y===n||e<u)return y;h=y+1}else{if(!(s>e))throw new ar("Input is not a number.");g=y-1}return 0}class tu{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[u,h]of s)this.labels.push(u),this.outputs.push(h)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let s=n.parse(e[1],1,ut);if(!s)return null;let u=[],h=null;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let g=1;g<e.length;g+=2){let y=g===1?-1/0:e[g],b=e[g+1],w=g,D=g+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',w);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',w);let I=n.parse(b,D,h);if(!I)return null;h=h||I.type,u.push([y,I])}return new tu(h,s,u)}evaluate(e){let n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);let u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);let h=n.length;return u>=n[h-1]?s[h-1].evaluate(e):s[eh(n,u)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}let Zg=.95047,Qg=1.08883,th=4/29,Ga=6/29,Yg=3*Ga*Ga,Xg=Ga*Ga*Ga,Ab=Math.PI/180,Kg=180/Math.PI;function Al(t){return t>Xg?Math.pow(t,1/3):t/Yg+th}function fp(t){return t>Ga?t*t*t:Yg*(t-th)}function pp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function mp(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Jg(t){let e=mp(t.r),n=mp(t.g),s=mp(t.b),u=Al((.4124564*e+.3575761*n+.1804375*s)/Zg),h=Al((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*h-16,a:500*(u-h),b:200*(h-Al((.0193339*e+.119192*n+.9503041*s)/Qg)),alpha:t.a}}function e_(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*fp(e),n=Zg*fp(n),s=Qg*fp(s),new Bn(pp(3.2404542*n-1.5371385*e-.4985314*s),pp(-.969266*n+1.8760108*e+.041556*s),pp(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function nh(t,e,n){let s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}let ca={forward:Jg,reverse:e_,interpolate:function(t,e,n){return{l:sn(t.l,e.l,n),a:sn(t.a,e.a,n),b:sn(t.b,e.b,n),alpha:sn(t.alpha,e.alpha,n)}}},Tr={forward:function(t){let{l:e,a:n,b:s}=Jg(t),u=Math.atan2(s,n)*Kg;return{h:u<0?u+360:u,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){let e=t.h*Ab,n=t.c;return e_({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:nh(t.h,e.h,n),c:sn(t.c,e.c,n),l:sn(t.l,e.l,n),alpha:sn(t.alpha,e.alpha,n)}}};var nu=Object.freeze({__proto__:null,hcl:Tr,lab:ca});class po{constructor(e,n,s,u,h){this.type=e,this.operator=n,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(let[g,y]of h)this.labels.push(g),this.outputs.push(y)}static interpolationFactor(e,n,s,u){let h=0;if(e.name==="exponential")h=gp(n,e.base,s,u);else if(e.name==="linear")h=gp(n,1,s,u);else if(e.name==="cubic-bezier"){let g=e.controlPoints;h=new wg(g[0],g[1],g[2],g[3]).solve(gp(n,1,s,u))}return h}static parse(e,n){let[s,u,h,...g]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){let w=u[1];if(typeof w!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:w}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{let w=u.slice(1);if(w.length!==4||w.some(D=>typeof D!="number"||D<0||D>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:w}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(h=n.parse(h,2,ut),!h)return null;let y=[],b=null;s==="interpolate-hcl"||s==="interpolate-lab"?b=uo:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let w=0;w<g.length;w+=2){let D=g[w],I=g[w+1],S=w+3,P=w+4;if(typeof D!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(y.length&&y[y.length-1][0]>=D)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',S);let k=n.parse(I,P,b);if(!k)return null;b=b||k.type,y.push([D,k])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new po(b,s,u,h,y):n.error(`Type ${ki(b)} is not interpolatable.`)}evaluate(e){let n=this.labels,s=this.outputs;if(n.length===1)return s[0].evaluate(e);let u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);let h=n.length;if(u>=n[h-1])return s[h-1].evaluate(e);let g=eh(n,u),y=po.interpolationFactor(this.interpolation,u,n[g],n[g+1]),b=s[g].evaluate(e),w=s[g+1].evaluate(e);return this.operator==="interpolate"?jc[this.type.kind.toLowerCase()](b,w,y):this.operator==="interpolate-hcl"?Tr.reverse(Tr.interpolate(Tr.forward(b),Tr.forward(w),y)):ca.reverse(ca.interpolate(ca.forward(b),ca.forward(w),y))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function gp(t,e,n,s){let u=s-n,h=t-n;return u===0?0:e===1?h/u:(Math.pow(e,h)-1)/(Math.pow(e,u)-1)}class ih{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null,u=n.expectedType;u&&u.kind!=="value"&&(s=u);let h=[];for(let y of e.slice(1)){let b=n.parse(y,1+h.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,h.push(b)}let g=u&&h.some(y=>Gc(u,y.type));return new ih(g?xn:s,h)}evaluate(e){let n,s=null,u=0;for(let h of this.args){if(u++,s=h.evaluate(e),s&&s instanceof ho&&!s.available&&(n||(n=s),s=null,u===this.args.length))return n;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class rh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let s=[];for(let h=1;h<e.length-1;h+=2){let g=e[h];if(typeof g!="string")return n.error(`Expected string, but found ${typeof g} instead.`,h);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",h);let y=n.parse(e[h+1],h+1);if(!y)return null;s.push([g,y])}let u=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return u?new rh(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}class iu{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,ut),u=n.parse(e[2],2,mr(n.expectedType||xn));return s&&u?new iu(u.type.itemType,s,u):null}evaluate(e){let n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new ar(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new ar(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new ar(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _p{constructor(e,n){this.type=An,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,xn),u=n.parse(e[2],2,xn);return s&&u?$c(s.type,[An,Mn,ut,ln,xn])?new _p(s,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(s.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Na(n,["boolean","string","number","null"]))throw new ar(`Expected first argument to be of type boolean, string, number or null, but found ${ki(Qi(n))} instead.`);if(!Na(s,["string","array"]))throw new ar(`Expected second argument to be of type array or string, but found ${ki(Qi(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Pl{constructor(e,n,s){this.type=ut,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,xn),u=n.parse(e[2],2,xn);if(!s||!u)return null;if(!$c(s.type,[An,Mn,ut,ln,xn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ki(s.type)} instead`);if(e.length===4){let h=n.parse(e[3],3,ut);return h?new Pl(s,u,h):null}return new Pl(s,u)}evaluate(e){let n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Na(n,["boolean","string","number","null"]))throw new ar(`Expected first argument to be of type boolean, string, number or null, but found ${ki(Qi(n))} instead.`);if(!Na(s,["string","array"]))throw new ar(`Expected second argument to be of type array or string, but found ${ki(Qi(s))} instead.`);if(this.fromIndex){let u=this.fromIndex.evaluate(e);return s.indexOf(n,u)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class yp{constructor(e,n,s,u,h,g){this.inputType=e,this.type=n,this.input=s,this.cases=u,this.outputs=h,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);let h={},g=[];for(let w=2;w<e.length-1;w+=2){let D=e[w],I=e[w+1];Array.isArray(D)||(D=[D]);let S=n.concat(w);if(D.length===0)return S.error("Expected at least one branch label.");for(let k of D){if(typeof k!="number"&&typeof k!="string")return S.error("Branch labels must be numbers or strings.");if(typeof k=="number"&&Math.abs(k)>Number.MAX_SAFE_INTEGER)return S.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof k=="number"&&Math.floor(k)!==k)return S.error("Numeric branch labels must be integer values.");if(s){if(S.checkSubtype(s,Qi(k)))return null}else s=Qi(k);if(h[String(k)]!==void 0)return S.error("Branch labels must be unique.");h[String(k)]=g.length}let P=n.parse(I,w,u);if(!P)return null;u=u||P.type,g.push(P)}let y=n.parse(e[1],1,xn);if(!y)return null;let b=n.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&n.concat(1).checkSubtype(s,y.type)?null:new yp(s,u,y,h,g,b):null}evaluate(e){let n=this.input.evaluate(e);return(Qi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],u={};for(let g of n){let y=u[this.cases[g]];y===void 0?(u[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[y][1].push(g)}let h=g=>this.inputType.kind==="number"?Number(g):g;for(let[g,y]of s)e.push(y.length===1?h(y[0]):y.map(h)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}class vp{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&n.expectedType.kind!=="value"&&(s=n.expectedType);let u=[];for(let g=1;g<e.length-1;g+=2){let y=n.parse(e[g],g,An);if(!y)return null;let b=n.parse(e[g+1],g+1,s);if(!b)return null;u.push([y,b]),s=s||b.type}let h=n.parse(e[e.length-1],e.length-1,s);return h?new vp(s,u,h):null}evaluate(e){for(let[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class Rl{constructor(e,n,s,u){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let s=n.parse(e[1],1,xn),u=n.parse(e[2],2,ut);if(!s||!u)return null;if(!$c(s.type,[mr(xn),Mn,xn]))return n.error(`Expected first argument to be of type array or string, but found ${ki(s.type)} instead`);if(e.length===4){let h=n.parse(e[3],3,ut);return h?new Rl(s.type,s,u,h):null}return new Rl(s.type,s,u)}evaluate(e){let n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Na(n,["string","array"]))throw new ar(`Expected first argument to be of type array or string, but found ${ki(Qi(n))} instead.`);if(this.endIndex){let u=this.endIndex.evaluate(e);return n.slice(s,u)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function t_(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function bp(t,e,n,s){return s.compare(e,n)===0}function $a(t,e,n){let s=t!=="=="&&t!=="!=";return class hO{constructor(h,g,y){this.type=An,this.lhs=h,this.rhs=g,this.collator=y,this.hasUntypedArgument=h.type.kind==="value"||g.type.kind==="value"}static parse(h,g){if(h.length!==3&&h.length!==4)return g.error("Expected two or three arguments.");let y=h[0],b=g.parse(h[1],1,xn);if(!b)return null;if(!t_(y,b.type))return g.concat(1).error(`"${y}" comparisons are not supported for type '${ki(b.type)}'.`);let w=g.parse(h[2],2,xn);if(!w)return null;if(!t_(y,w.type))return g.concat(2).error(`"${y}" comparisons are not supported for type '${ki(w.type)}'.`);if(b.type.kind!==w.type.kind&&b.type.kind!=="value"&&w.type.kind!=="value")return g.error(`Cannot compare types '${ki(b.type)}' and '${ki(w.type)}'.`);s&&(b.type.kind==="value"&&w.type.kind!=="value"?b=new Ho(w.type,[b]):b.type.kind!=="value"&&w.type.kind==="value"&&(w=new Ho(b.type,[w])));let D=null;if(h.length===4){if(b.type.kind!=="string"&&w.type.kind!=="string"&&b.type.kind!=="value"&&w.type.kind!=="value")return g.error("Cannot use collator to compare non-string types.");if(D=g.parse(h[3],3,Uc),!D)return null}return new hO(b,w,D)}evaluate(h){let g=this.lhs.evaluate(h),y=this.rhs.evaluate(h);if(s&&this.hasUntypedArgument){let b=Qi(g),w=Qi(y);if(b.kind!==w.kind||b.kind!=="string"&&b.kind!=="number")throw new ar(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${b.kind}, ${w.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){let b=Qi(g),w=Qi(y);if(b.kind!=="string"||w.kind!=="string")return e(h,g,y)}return this.collator?n(h,g,y,this.collator.evaluate(h)):e(h,g,y)}eachChild(h){h(this.lhs),h(this.rhs),this.collator&&h(this.collator)}outputDefined(){return!0}serialize(){let h=[t];return this.eachChild(g=>{h.push(g.serialize())}),h}}}let Pb=$a("==",function(t,e,n){return e===n},bp),xp=$a("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!bp(0,e,n,s)}),oh=$a("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),n_=$a(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),Rb=$a("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),i_=$a(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class wp{constructor(e,n,s,u,h,g){this.type=Mn,this.number=e,this.locale=n,this.currency=s,this.unit=u,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let s=n.parse(e[1],1,ut);if(!s)return null;let u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let h=null;if(u.locale&&(h=n.parse(u.locale,1,Mn),!h))return null;let g=null;if(u.currency&&(g=n.parse(u.currency,1,Mn),!g))return null;let y=null;if(u.unit&&(y=n.parse(u.unit,1,Mn),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=n.parse(u["min-fraction-digits"],1,ut),!b))return null;let w=null;return u["max-fraction-digits"]&&(w=n.parse(u["max-fraction-digits"],1,ut),!w)?null:new wp(s,h,g,y,b,w)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ru{constructor(e){this.type=ut,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let s=n.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${ki(s.type)} instead.`):new ru(s):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new ar(`Expected value to be of type string or array, but found ${ki(Qi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function r_(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let kl={"==":Pb,"!=":xp,">":n_,"<":oh,">=":i_,"<=":Rb,array:Ho,at:iu,boolean:Ho,case:vp,coalesce:ih,collator:qc,format:Hc,image:Il,in:_p,"index-of":Pl,interpolate:po,"interpolate-hcl":po,"interpolate-lab":po,length:ru,let:rh,literal:rs,match:yp,number:Ho,"number-format":wp,object:Ho,slice:Rl,step:tu,string:Ho,"to-boolean":Ps,"to-color":Ps,"to-number":Ps,"to-string":Ps,var:fo,within:Ba,distance:Ua,config:aa};function o_(t,[e,n,s,u]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);let h=u?u.evaluate(t):1,g=Ng(e,n,s,h);if(g)throw new ar(g);return new Bn(e/255*h,n/255*h,s/255*h,h)}function s_(t,[e,n,s,u]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);let h=u?u.evaluate(t):1,g=function(w,D,I,S){return typeof w=="number"&&w>=0&&w<=360?typeof D=="number"&&D>=0&&D<=100&&typeof I=="number"&&I>=0&&I<=100?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid hsla value [${[w,D,I,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof S=="number"?[w,D,I,S]:[w,D,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof S=="number"?[w,D,I,S]:[w,D,I]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,s,h);if(g)throw new ar(g);let y=`hsla(${e}, ${n}%, ${s}%, ${h})`,b=Bn.parse(y);if(!b)throw new ar(`Failed to parse HSLA color: ${y}`);return b}function Ep(t,e){return t in e}function Tp(t,e){let n=e[t];return n===void 0?null:n}function Ha(t){return{type:t}}function a_(t){return{result:"success",value:t}}function qa(t){return{result:"error",value:t}}function l_(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function sh(t){return t["property-type"]==="data-driven"}function c_(t){return l_(t.expression,"measure-light")}function u_(t){return l_(t.expression,"zoom")}function Ol(t){return!!t.expression&&t.expression.interpolated}function Dp(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function kb(t){return t}function ou(t,e){let n=e.type==="color",s=t.stops&&typeof t.stops[0][0]=="object",u=s||!(s||t.property!==void 0),h=t.type||(Ol(e)?"exponential":"interval");if(n&&((t=jd({},t)).stops&&(t.stops=t.stops.map(w=>[w[0],Bn.parse(w[1])])),t.default=Bn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!nu[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let g,y,b;if(h==="exponential")g=Ip;else if(h==="interval")g=Ob;else if(h==="categorical"){g=d_,y=Object.create(null);for(let w of t.stops)y[w[0]]=w[1];b=typeof t.stops[0][0]}else{if(h!=="identity")throw new Error(`Unknown function type "${h}"`);g=h_}if(s){let w={},D=[];for(let P=0;P<t.stops.length;P++){let k=t.stops[P],L=k[0].zoom;w[L]===void 0&&(w[L]={zoom:L,type:t.type,property:t.property,default:t.default,stops:[]},D.push(L)),w[L].stops.push([k[0].value,k[1]])}let I=[];for(let P of D)I.push([w[P].zoom,ou(w[P],e)]);let S={name:"linear"};return{kind:"composite",interpolationType:S,interpolationFactor:po.interpolationFactor.bind(void 0,S),zoomStops:I.map(P=>P[0]),evaluate:({zoom:P},k)=>Ip({stops:I,base:t.base},e,P).evaluate(P,k)}}if(u){let w=h==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:w,interpolationFactor:po.interpolationFactor.bind(void 0,w),zoomStops:t.stops.map(D=>D[0]),evaluate:({zoom:D})=>g(t,e,D,y,b)}}return{kind:"source",evaluate(w,D){let I=D&&D.properties?D.properties[t.property]:void 0;return I===void 0?su(t.default,e.default):g(t,e,I,y,b)}}}function su(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function d_(t,e,n,s,u){return su(typeof n===u?s[n]:void 0,t.default,e.default)}function Ob(t,e,n){if(oa(n)!=="number")return su(t.default,e.default);let s=t.stops.length;if(s===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];let u=eh(t.stops.map(h=>h[0]),n);return t.stops[u][1]}function Ip(t,e,n){let s=t.base!==void 0?t.base:1;if(oa(n)!=="number")return su(t.default,e.default);let u=t.stops.length;if(u===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];let h=eh(t.stops.map(D=>D[0]),n),g=function(D,I,S,P){let k=P-S,L=D-S;return k===0?0:I===1?L/k:(Math.pow(I,L)-1)/(Math.pow(I,k)-1)}(n,s,t.stops[h][0],t.stops[h+1][0]),y=t.stops[h][1],b=t.stops[h+1][1],w=jc[e.type]||kb;if(t.colorSpace&&t.colorSpace!=="rgb"){let D=nu[t.colorSpace];w=(I,S)=>D.reverse(D.interpolate(D.forward(I),D.forward(S),g))}return typeof y.evaluate=="function"?{evaluate(...D){let I=y.evaluate.apply(void 0,D),S=b.evaluate.apply(void 0,D);if(I!==void 0&&S!==void 0)return w(I,S,g)}}:w(y,b,g)}function h_(t,e,n){return e.type==="color"?n=Bn.parse(n):e.type==="formatted"?n=Er.fromString(n.toString()):e.type==="resolvedImage"?n=ho.fromString(n.toString()):oa(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),su(n,t.default,e.default)}Kr.register(kl,{error:[{kind:"error"},[Mn],(t,[e])=>{throw new ar(e.evaluate(t))}],typeof:[Mn,[xn],(t,[e])=>ki(Qi(e.evaluate(t)))],"to-rgba":[mr(ut,4),[uo],(t,[e])=>e.evaluate(t).toArray()],rgb:[uo,[ut,ut,ut],o_],rgba:[uo,[ut,ut,ut,ut],o_],hsl:[uo,[ut,ut,ut],s_],hsla:[uo,[ut,ut,ut,ut],s_],has:{type:An,overloads:[[[Mn],(t,[e])=>Ep(e.evaluate(t),t.properties())],[[Mn,wl],(t,[e,n])=>Ep(e.evaluate(t),n.evaluate(t))]]},get:{type:xn,overloads:[[[Mn],(t,[e])=>Tp(e.evaluate(t),t.properties())],[[Mn,wl],(t,[e,n])=>Tp(e.evaluate(t),n.evaluate(t))]]},"feature-state":[xn,[Mn],(t,[e])=>Tp(e.evaluate(t),t.featureState||{})],properties:[wl,[],t=>t.properties()],"geometry-type":[Mn,[],t=>t.geometryType()],id:[xn,[],t=>t.id()],zoom:[ut,[],t=>t.globals.zoom],pitch:[ut,[],t=>t.globals.pitch||0],"distance-from-center":[ut,[],t=>t.distanceFromCenter()],"measure-light":[ut,[Mn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ut,[],t=>t.globals.heatmapDensity||0],"line-progress":[ut,[],t=>t.globals.lineProgress||0],"raster-value":[ut,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[ut,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[ut,[],t=>t.globals.skyRadialProgress||0],accumulated:[xn,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ut,Ha(ut),(t,e)=>{let n=0;for(let s of e)n+=s.evaluate(t);return n}],"*":[ut,Ha(ut),(t,e)=>{let n=1;for(let s of e)n*=s.evaluate(t);return n}],"-":{type:ut,overloads:[[[ut,ut],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[ut],(t,[e])=>-e.evaluate(t)]]},"/":[ut,[ut,ut],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[ut,[ut,ut],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[ut,[],()=>Math.LN2],pi:[ut,[],()=>Math.PI],e:[ut,[],()=>Math.E],"^":[ut,[ut,ut],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[ut,[ut],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ut,[ut],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ut,[ut],(t,[e])=>Math.log(e.evaluate(t))],log2:[ut,[ut],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ut,[ut],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ut,[ut],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ut,[ut],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ut,[ut],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ut,[ut],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ut,[ut],(t,[e])=>Math.atan(e.evaluate(t))],min:[ut,Ha(ut),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[ut,Ha(ut),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[ut,[ut],(t,[e])=>Math.abs(e.evaluate(t))],round:[ut,[ut],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[ut,[ut],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ut,[ut],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[An,[Mn,xn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[An,[xn],(t,[e])=>t.id()===e.value],"filter-type-==":[An,[Mn],(t,[e])=>t.geometryType()===e.value],"filter-<":[An,[Mn,xn],(t,[e,n])=>{let s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<u}],"filter-id-<":[An,[xn],(t,[e])=>{let n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[An,[Mn,xn],(t,[e,n])=>{let s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>u}],"filter-id->":[An,[xn],(t,[e])=>{let n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[An,[Mn,xn],(t,[e,n])=>{let s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[An,[xn],(t,[e])=>{let n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[An,[Mn,xn],(t,[e,n])=>{let s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[An,[xn],(t,[e])=>{let n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[An,[xn],(t,[e])=>e.value in t.properties()],"filter-has-id":[An,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[An,[mr(Mn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[An,[mr(xn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[An,[Mn,mr(xn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[An,[Mn,mr(xn)],(t,[e,n])=>function(s,u,h,g){for(;h<=g;){let y=h+g>>1;if(u[y]===s)return!0;u[y]>s?g=y-1:h=y+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:An,overloads:[[[An,An],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Ha(An),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:An,overloads:[[[An,An],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Ha(An),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[An,[An],(t,[e])=>!e.evaluate(t)],"is-supported-script":[An,[Mn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Mn,[Mn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Mn,[Mn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Mn,Ha(xn),(t,e)=>e.map(n=>To(n.evaluate(t))).join("")],"resolved-locale":[Mn,[Uc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ut,[ut,ut,xn],(t,e)=>{let[n,s,u]=e.map(g=>g.evaluate(t));if(n>s||n===s)return n;let h;if(typeof u=="string")h=function(g){let y=0;if(g.length===0)return y;for(let b=0;b<g.length;b++)y=(y<<5)-y+g.charCodeAt(b),y|=0;return y}(u);else{if(typeof u!="number")throw new ar(`Invalid seed input: ${u}`);h=u}return n+r_(h)()*(s-n)}]});class ah{constructor(e,n,s,u){this.expression=e,this._warningHistory={},this._evaluator=new Kf(s,u),this._defaultValue=n?function(h){return h.type==="color"&&(Dp(h.default)||Array.isArray(h.default))?new Bn(0,0,0,0):h.type==="color"?Bn.parse(h.default)||null:h.default===void 0?null:h.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,s,u,h,g,y,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,u,h,g,y,b){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=h||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{let w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ar(`Expected value to be one of ${Object.keys(this._enumValues).map(D=>JSON.stringify(D)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function lh(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in kl}function Fl(t,e,n,s){let u=new Kd(kl,[],e?function(g){let y={color:uo,string:Mn,number:ut,enum:Mn,boolean:An,formatted:El,resolvedImage:Tl};return g.type==="array"?mr(y[g.value]||xn,g.length):y[g.type]}(e):void 0,void 0,void 0,n,s),h=u.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?a_(new ah(h,e,n,s)):qa(u.errors)}class au{constructor(e,n,s){this.kind=e,this._styleExpression=n,this.isLightConstant=s,this.isStateDependent=e!=="constant"&&!Kc(n.expression),this.isConfigDependent=!Jc(n.expression)}evaluateWithoutErrorHandling(e,n,s,u,h,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,h,g)}evaluate(e,n,s,u,h,g){return this._styleExpression.evaluate(e,n,s,u,h,g)}}class lu{constructor(e,n,s,u,h){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Kc(n.expression),this.isLightConstant=h,this.isConfigDependent=!Jc(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,s,u,h,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,h,g)}evaluate(e,n,s,u,h,g){return this._styleExpression.evaluate(e,n,s,u,h,g)}interpolationFactor(e,n,s){return this.interpolationType?po.interpolationFactor(this.interpolationType,e,n,s):0}}function f_(t,e,n,s){if((t=Fl(t,e,n,s)).result==="error")return t;let u=t.value.expression,h=la(u);if(!h&&!sh(e))return qa([new $o("","data expressions not supported")]);let g=eu(u,["zoom","pitch","distance-from-center"]);if(!g&&!u_(e))return qa([new $o("","zoom expressions not supported")]);let y=eu(u,["measure-light"]);if(!y&&!c_(e))return qa([new $o("","measure-light expression not supported")]);let b=e.expression&&e.expression.relaxZoomRestriction,w=ch(u);return w||g||b?w instanceof $o?qa([w]):w instanceof po&&!Ol(e)?qa([new $o("",'"interpolate" expressions cannot be used with this property')]):a_(w?new lu(h?"camera":"composite",t.value,w.labels,w instanceof po?w.interpolation:void 0,y):new au(h?"constant":"source",t.value,y)):qa([new $o("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class cu{constructor(e,n){this._parameters=e,this._specification=n,jd(this,ou(this._parameters,this._specification))}static deserialize(e){return new cu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ch(t){let e=null;if(t instanceof rh)e=ch(t.result);else if(t instanceof ih){for(let n of t.args)if(e=ch(n),e)break}else(t instanceof tu||t instanceof po)&&t.input instanceof Kr&&t.input.name==="zoom"&&(e=t);return e instanceof $o||t.eachChild(n=>{let s=ch(n);s instanceof $o?e=s:e&&s&&e!==s&&(e=new $o("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var p_=os,ua=3;function os(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var h=0;h<this.d*this.d;h++){var g=u[ua+h],y=u[ua+h+1];s.push(g===y?null:u.subarray(g,y))}var b=u[ua+s.length+1];this.keys=u.subarray(u[ua+s.length],b),this.bboxes=u.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var w=0;w<this.d*this.d;w++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var D=n/e*t;this.min=-D,this.max=t+D}os.prototype.insert=function(t,e,n,s,u){this._forEachCell(e,n,s,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(u)},os.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},os.prototype._insertCell=function(t,e,n,s,u,h){this.cells[u].push(h)},os.prototype.query=function(t,e,n,s,u){var h=this.min,g=this.max;if(t<=h&&e<=h&&g<=n&&g<=s&&!u)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,n,s,this._queryCell,y,{},u),y},os.prototype._queryCell=function(t,e,n,s,u,h,g,y){var b=this.cells[u];if(b!==null)for(var w=this.keys,D=this.bboxes,I=0;I<b.length;I++){var S=b[I];if(g[S]===void 0){var P=4*S;(y?y(D[P+0],D[P+1],D[P+2],D[P+3]):t<=D[P+2]&&e<=D[P+3]&&n>=D[P+0]&&s>=D[P+1])?(g[S]=!0,h.push(w[S])):g[S]=!1}}},os.prototype._forEachCell=function(t,e,n,s,u,h,g,y){for(var b=this._convertToCellCoord(t),w=this._convertToCellCoord(e),D=this._convertToCellCoord(n),I=this._convertToCellCoord(s),S=b;S<=D;S++)for(var P=w;P<=I;P++){var k=this.d*P+S;if((!y||y(this._convertFromCellCoord(S),this._convertFromCellCoord(P),this._convertFromCellCoord(S+1),this._convertFromCellCoord(P+1)))&&u.call(this,t,e,n,s,k,h,g,y))return}},os.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},os.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},os.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ua+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var h=e,g=0;g<t.length;g++){var y=t[g];u[ua+g]=h,u.set(y,h),h+=y.length}return u[ua+t.length]=h,u.set(this.keys,h),u[ua+t.length+1]=h+=this.keys.length,u.set(this.bboxes,h),h+=this.bboxes.length,u.buffer};var Ll=dt(p_);let uh={};function ht(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),uh[e]={klass:t,omit:n.omit||[]}}ht(Object,"Object"),Ll.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Ll.deserialize=function(t){return new Ll(t.buffer)},Object.defineProperty(Ll,"name",{value:"Grid"}),ht(Ll,"Grid"),ht(Bn,"Color"),ht(Error,"Error"),ht(Er,"Formatted"),ht(Ud,"FormattedSection"),ht(Ad,"AJAXError"),ht(ho,"ResolvedImage"),ht(cu,"StylePropertyFunction"),ht(ah,"StyleExpression",{omit:["_evaluator"]}),ht(lu,"ZoomDependentExpression"),ht(au,"ZoomConstantExpression"),ht(Kr,"CompoundExpression",{omit:["_evaluate"]});for(let t in kl)uh[kl[t]._classRegistryKey]||ht(kl[t],`Expression${t}`);function m_(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function g_(t){return self.ImageBitmap&&t instanceof ImageBitmap}function uu(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(m_(t)||g_(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let s of t)n.push(uu(s,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[s,u]of t.entries())n[s]=uu(u);return n}if(typeof t=="object"){let n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);let u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let h in t)t.hasOwnProperty(h)&&(uh[s].omit.indexOf(h)>=0||(u[h]=uu(t[h],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function f(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||m_(t)||g_(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(f);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let u=new Map;for(let h of Object.keys(t))h!=="$name"&&u.set(h,f(t[h]));return u}let{klass:n}=uh[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let s=Object.create(n.prototype);for(let u of Object.keys(t))u!=="$name"&&(s[u]=f(t[u]));return s}throw new Error("can't deserialize object of type "+typeof t)}let o={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function l(t){for(let e of t)if(v(e.charCodeAt(0)))return!0;return!1}function p(t){for(let e of t)if(!_(e.charCodeAt(0)))return!1;return!0}function _(t){return!(o.Arabic(t)||o["Arabic Supplement"](t)||o["Arabic Extended-A"](t)||o["Arabic Presentation Forms-A"](t)||o["Arabic Presentation Forms-B"](t))}function v(t){return!(t!==746&&t!==747&&(t<4352||!(o["Bopomofo Extended"](t)||o.Bopomofo(t)||o["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||o["CJK Compatibility Ideographs"](t)||o["CJK Compatibility"](t)||o["CJK Radicals Supplement"](t)||o["CJK Strokes"](t)||!(!o["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||o["CJK Unified Ideographs Extension A"](t)||o["CJK Unified Ideographs"](t)||o["Enclosed CJK Letters and Months"](t)||o["Hangul Compatibility Jamo"](t)||o["Hangul Jamo Extended-A"](t)||o["Hangul Jamo Extended-B"](t)||o["Hangul Jamo"](t)||o["Hangul Syllables"](t)||o.Hiragana(t)||o["Ideographic Description Characters"](t)||o.Kanbun(t)||o["Kangxi Radicals"](t)||o["Katakana Phonetic Extensions"](t)||o.Katakana(t)&&t!==12540||!(!o["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!o["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||o["Unified Canadian Aboriginal Syllabics"](t)||o["Unified Canadian Aboriginal Syllabics Extended"](t)||o["Vertical Forms"](t)||o["Yijing Hexagram Symbols"](t)||o["Yi Syllables"](t)||o["Yi Radicals"](t))))}function x(t){return!(v(t)||function(e){return!!(o["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||o["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||o["Letterlike Symbols"](e)||o["Number Forms"](e)||o["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||o["Control Pictures"](e)&&e!==9251||o["Optical Character Recognition"](e)||o["Enclosed Alphanumerics"](e)||o["Geometric Shapes"](e)||o["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||o["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||o["CJK Symbols and Punctuation"](e)||o.Katakana(e)||o["Private Use Area"](e)||o["CJK Compatibility Forms"](e)||o["Small Form Variants"](e)||o["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function E(t){return t>=1424&&t<=2303||o["Arabic Presentation Forms-A"](t)||o["Arabic Presentation Forms-B"](t)}function C(t,e){return!(!e&&E(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||o.Khmer(t))}function A(t){for(let e of t)if(E(e.charCodeAt(0)))return!0;return!1}let R="deferred",O="loading",N="loaded",z=null,U="unavailable",j=null,G=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(U="error"),z&&z(t)};function H(){Z.fire(new ia("pluginStateChange",{pluginStatus:U,pluginURL:j}))}let Z=new La,ne=function(){return U},te=function(){if(U!==R||!j)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");U=O,H(),j&&kc({url:j},t=>{t?G(t):(U=N,H())})},re={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>U===N||re.applyArabicShaping!=null,isLoading:()=>U===O,setState(t){U=t.pluginStatus,j=t.pluginURL},isParsed:()=>re.applyArabicShaping!=null&&re.processBidirectionalText!=null&&re.processStyledBidirectionalText!=null,getPluginURL:()=>j};class q{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,s){for(let u of n)if(!C(u.charCodeAt(0),s))return!1;return!0}(e,re.isLoaded())}}class X{constructor(e,n,s,u){this.property=e,this.value=n,this.expression=function(h,g,y,b){if(Dp(h))return new cu(h,g);if(lh(h)||Array.isArray(h)&&h.length>0){let w=f_(h,g,y,b);if(w.result==="error")throw new Error(w.value.map(D=>`${D.key}: ${D.message}`).join(", "));return w.value}{let w=h;return typeof h=="string"&&g.type==="color"&&(w=Bn.parse(h)),{kind:"constant",isConfigDependent:!1,evaluate:()=>w}}}(n===void 0?e.specification.default:n,e.specification,s,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class ce{constructor(e,n,s){this.property=e,this.value=new X(e,void 0,n,s)}transitioned(e,n){return new pe(this.property,this.value,n,Eo({},e.transition,this.transition),e.now)}untransitioned(){return new pe(this.property,this.value,null,{},0)}}class ae{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return Ss(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ce(this._values[e].property,this._scope,this._options)),this._values[e].value=new X(this._values[e].property,n===null?void 0:Ss(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let s=this._properties.properties;if(e)for(let u in e){let h=e[u];if(Ra(u,"-transition")){let g=u.slice(0,-11);s[g]&&this.setTransition(g,h)}else s[u]&&this.setValue(u,h)}}getTransition(e){return Ss(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new ce(this._values[e].property)),this._values[e].transition=Ss(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let s=this.getValue(n);s!==void 0&&(e[n]=s);let u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){let s=new Ee(this._properties);for(let u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,n._values[u]);return s}untransitioned(){let e=new Ee(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class pe{constructor(e,n,s,u,h){let g=u.delay||0,y=u.duration||0;h=h||0,this.property=e,this.value=n,this.begin=h+g,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){let u=e.now||0,h=this.value.possiblyEvaluate(e,n,s),g=this.prior;if(g){if(u>this.end)return this.prior=null,h;if(this.value.isDataDriven())return this.prior=null,h;if(u<this.begin)return g.possiblyEvaluate(e,n,s);{let y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,s),h,yd(y))}}return h}}class Ee{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){let u=new De(this._properties);for(let h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(e,n,s);return u}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class fe{constructor(e,n,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=s,this.isConfigDependent=!1}getValue(e){return Ss(this._values[e].value)}setValue(e,n){this._values[e]=new X(this._values[e].property,n===null?void 0:Ss(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let s=this.getValue(n);s!==void 0&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){let u=new De(this._properties);for(let h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(e,n,s);return u}}class be{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,s,u){return this.property.evaluate(this.value,this.parameters,e,n,s,u)}}class De{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class he{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){let u=jc[this.specification.type];return u?u(e,n,s):e}}class ye{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,u){return new be(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},s,u)}:e.expression,n)}interpolate(e,n,s){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new be(this,{kind:"constant",value:void 0},e.parameters);let u=jc[this.specification.type];return u?new be(this,{kind:"constant",value:u(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,u,h,g){return e.kind==="constant"?e.value:e.evaluate(n,s,u,h,g)}}class Ve{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,u){return!!e.expression.evaluate(n,null,{},s,u)}interpolate(){return!1}}class ge{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new q(0,{});for(let s in e){let u=e[s];u.specification.overridable&&this.overridableProperties.push(s);let h=this.defaultPropertyValues[s]=new X(u,void 0),g=this.defaultTransitionablePropertyValues[s]=new ce(u);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=h.possiblyEvaluate(n)}}}function we(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Te(t){if(Array.isArray(t))return t.map(Te);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Te(t[n]);return e}return we(t)}ht(ye,"DataDrivenProperty"),ht(he,"DataConstantProperty"),ht(Ve,"ColorRampProperty");var ie=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Re(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Re(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ot(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Re(t)||(t=yn(t));let n=t,s=!0;try{s=function(w){if(!yt(w))return w;let D=Te(w);return wt(D),D=pt(D),D}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let u=ie[`filter_${e}`],h=Fl(s,u),g=null;if(h.result==="error")throw new Error(h.value.map(w=>`${w.key}: ${w.message}`).join(", "));g=(w,D,I)=>h.value.evaluate(w,D,{},I);let y=null,b=null;if(s!==n){let w=Fl(n,u);if(w.result==="error")throw new Error(w.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,I,S,P,k)=>w.value.evaluate(D,I,{},S,void 0,void 0,P,k),b=!la(w.value.expression)}return{filter:g,dynamicFilter:y||void 0,needGeometry:$t(s),needFeature:!!b}}function pt(t){if(!Array.isArray(t))return t;let e=function(n){if(It.has(n[0])){for(let s=1;s<n.length;s++)if(yt(n[s]))return!0}return n}(t);return e===!0?e:e.map(n=>pt(n))}function wt(t){let e=!1,n=[];if(t[0]==="case"){for(let s=1;s<t.length-1;s+=2)e=e||yt(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||yt(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||yt(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)wt(t[s])}function yt(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(yt(t[n]))return!0;return!1}let It=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fn(t,e){return t<e?-1:t>e?1:0}function $t(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if($t(t[e]))return!0;return!1}function yn(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?pn(t[1],t[2],"=="):e==="!="?Yi(pn(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?pn(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(yn))):e==="all"?["all"].concat(t.slice(1).map(yn)):e==="none"?["all"].concat(t.slice(1).map(yn).map(Yi)):e==="in"?mi(t[1],t.slice(2)):e==="!in"?Yi(mi(t[1],t.slice(2))):e==="has"?Vn(t[1]):e!=="!has"||Yi(Vn(t[1]));var n}function pn(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function mi(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(fn)]]:["filter-in-small",t,["literal",e]]}}function Vn(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Yi(t){return["!",t]}let Bi="";function ni(t,e){return e?`${t}${Bi}${e}`:t}let Gn="-transition",nn=new Set(["fill","line","background","hillshade","raster"]);class on extends La{constructor(e,n,s,u){if(super(),this.id=e.id,this.fqid=ni(this.id,s),this.type=e.type,this.scope=s,this.options=u,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new fe(n.layout,this.scope,u),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new ae(n.paint,this.scope,u);for(let h in e.paint)this.setPaintProperty(h,e.paint[h]);for(let h in e.layout)this.setLayoutProperty(h,e.layout[h]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new De(n.paint)}}onAdd(e){}onRemove(e){}isDraped(e){return nn.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Ra(e,Gn)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){let s=this._transitionablePaint,u=s._properties.properties;if(Ra(e,Gn)){let I=e.slice(0,-11);return u[I]&&s.setTransition(I,n||void 0),!1}if(!u[e])return!1;let h=s._values[e],g=h.value.isDataDriven(),y=h.value;s.setValue(e,n),this.isConfigDependent=this.isConfigDependent||s.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let b=s._values[e].value,w=b.isDataDriven(),D=Ra(e,"pattern")||e==="line-dasharray";return w||g||D||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Cc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof be&&sh(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ot(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,s,u,h,g,y,b,w){}queryIntersectsMatchingFeature(e,n,s,u){}}let hi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ii{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class cn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Qt(t,e=1){let n=0,s=0;return{members:t.map(u=>{let h=hi[u.type].BYTES_PER_ELEMENT,g=n=Gr(n,Math.max(e,h)),y=u.components||1;return s=Math.max(s,h),n+=h*y,{name:u.name,type:u.type,components:y,offset:g}}),size:Gr(n,Math.max(s,e)),alignment:e}}function Gr(t,e){return Math.ceil(t/e)*e}class Dr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){let u=2*e;return this.int16[u+0]=n,this.int16[u+1]=s,e}}Dr.prototype.bytesPerElement=4,ht(Dr,"StructArrayLayout2i4");class lr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){let h=3*e;return this.int16[h+0]=n,this.int16[h+1]=s,this.int16[h+2]=u,e}}lr.prototype.bytesPerElement=6,ht(lr,"StructArrayLayout3i6");class Ir extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,u)}emplace(e,n,s,u,h){let g=4*e;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=u,this.int16[g+3]=h,e}}Ir.prototype.bytesPerElement=8,ht(Ir,"StructArrayLayout4i8");class $r extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,h)}emplace(e,n,s,u,h,g){let y=5*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=u,this.int16[y+3]=h,this.int16[y+4]=g,e}}$r.prototype.bytesPerElement=10,ht($r,"StructArrayLayout5i10");class kr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,h,g,y)}emplace(e,n,s,u,h,g,y,b){let w=6*e,D=12*e,I=3*e;return this.int16[w+0]=n,this.int16[w+1]=s,this.uint8[D+4]=u,this.uint8[D+5]=h,this.uint8[D+6]=g,this.uint8[D+7]=y,this.float32[I+2]=b,e}}kr.prototype.bytesPerElement=12,ht(kr,"StructArrayLayout2i4ub1f12");class cr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,u)}emplace(e,n,s,u,h){let g=4*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=u,this.float32[g+3]=h,e}}cr.prototype.bytesPerElement=16,ht(cr,"StructArrayLayout4f16");class yr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){let u=2*e;return this.float32[u+0]=n,this.float32[u+1]=s,e}}yr.prototype.bytesPerElement=8,ht(yr,"StructArrayLayout2f8");class vr extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,h)}emplace(e,n,s,u,h,g){let y=6*e,b=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=s,this.uint16[y+2]=u,this.uint16[y+3]=h,this.float32[b+2]=g,e}}vr.prototype.bytesPerElement=12,ht(vr,"StructArrayLayout4ui1f12");class ss extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,u)}emplace(e,n,s,u,h){let g=4*e;return this.uint16[g+0]=n,this.uint16[g+1]=s,this.uint16[g+2]=u,this.uint16[g+3]=h,e}}ss.prototype.bytesPerElement=8,ht(ss,"StructArrayLayout4ui8");class Wo extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,u,h,g)}emplace(e,n,s,u,h,g,y){let b=6*e;return this.int16[b+0]=n,this.int16[b+1]=s,this.int16[b+2]=u,this.int16[b+3]=h,this.int16[b+4]=g,this.int16[b+5]=y,e}}Wo.prototype.bytesPerElement=12,ht(Wo,"StructArrayLayout6i12");class as extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y,b,w,D,I,S){let P=this.length;return this.resize(P+1),this.emplace(P,e,n,s,u,h,g,y,b,w,D,I,S)}emplace(e,n,s,u,h,g,y,b,w,D,I,S,P){let k=12*e;return this.int16[k+0]=n,this.int16[k+1]=s,this.int16[k+2]=u,this.int16[k+3]=h,this.uint16[k+4]=g,this.uint16[k+5]=y,this.uint16[k+6]=b,this.uint16[k+7]=w,this.int16[k+8]=D,this.int16[k+9]=I,this.int16[k+10]=S,this.int16[k+11]=P,e}}as.prototype.bytesPerElement=24,ht(as,"StructArrayLayout4i4ui4i24");class ls extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,u,h,g)}emplace(e,n,s,u,h,g,y){let b=10*e,w=5*e;return this.int16[b+0]=n,this.int16[b+1]=s,this.int16[b+2]=u,this.float32[w+2]=h,this.float32[w+3]=g,this.float32[w+4]=y,e}}ls.prototype.bytesPerElement=20,ht(ls,"StructArrayLayout3i3f20");class da extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}da.prototype.bytesPerElement=4,ht(da,"StructArrayLayout1ul4");class Do extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){let u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=s,e}}Do.prototype.bytesPerElement=4,ht(Do,"StructArrayLayout2ui4");class du extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y,b,w,D,I,S,P){let k=this.length;return this.resize(k+1),this.emplace(k,e,n,s,u,h,g,y,b,w,D,I,S,P)}emplace(e,n,s,u,h,g,y,b,w,D,I,S,P,k){let L=20*e,B=10*e;return this.int16[L+0]=n,this.int16[L+1]=s,this.int16[L+2]=u,this.int16[L+3]=h,this.int16[L+4]=g,this.float32[B+3]=y,this.float32[B+4]=b,this.float32[B+5]=w,this.float32[B+6]=D,this.int16[L+14]=I,this.uint32[B+8]=S,this.uint16[L+18]=P,this.uint16[L+19]=k,e}}du.prototype.bytesPerElement=40,ht(du,"StructArrayLayout5i4f1i1ul2ui40");class Nl extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,h,g,y)}emplace(e,n,s,u,h,g,y,b){let w=8*e;return this.int16[w+0]=n,this.int16[w+1]=s,this.int16[w+2]=u,this.int16[w+4]=h,this.int16[w+5]=g,this.int16[w+6]=y,this.int16[w+7]=b,e}}Nl.prototype.bytesPerElement=16,ht(Nl,"StructArrayLayout3i2i2i16");class hu extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,h)}emplace(e,n,s,u,h,g){let y=4*e,b=8*e;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=u,this.int16[b+6]=h,this.int16[b+7]=g,e}}hu.prototype.bytesPerElement=16,ht(hu,"StructArrayLayout2f1f2i16");class Os extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,u)}emplace(e,n,s,u,h){let g=12*e,y=3*e;return this.uint8[g+0]=n,this.uint8[g+1]=s,this.float32[y+1]=u,this.float32[y+2]=h,e}}Os.prototype.bytesPerElement=12,ht(Os,"StructArrayLayout2ub2f12");class ur extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){let h=3*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,this.uint16[h+2]=u,e}}ur.prototype.bytesPerElement=6,ht(ur,"StructArrayLayout3ui6");class fu extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se){let ee=this.length;return this.resize(ee+1),this.emplace(ee,e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se)}emplace(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se,ee){let le=30*e,de=15*e,_e=60*e;return this.int16[le+0]=n,this.int16[le+1]=s,this.int16[le+2]=u,this.float32[de+2]=h,this.float32[de+3]=g,this.uint16[le+8]=y,this.uint16[le+9]=b,this.uint32[de+5]=w,this.uint32[de+6]=D,this.uint32[de+7]=I,this.uint16[le+16]=S,this.uint16[le+17]=P,this.uint16[le+18]=k,this.float32[de+10]=L,this.float32[de+11]=B,this.uint8[_e+48]=V,this.uint8[_e+49]=W,this.uint8[_e+50]=K,this.uint32[de+13]=Y,this.int16[le+28]=se,this.uint8[_e+58]=ee,e}}fu.prototype.bytesPerElement=60,ht(fu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Fb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se,ee,le,de,_e,Ie,ve,Me,Se,Ce,ze,Le){let Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se,ee,le,de,_e,Ie,ve,Me,Se,Ce,ze,Le)}emplace(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V,W,K,Y,se,ee,le,de,_e,Ie,ve,Me,Se,Ce,ze,Le,Ge){let je=20*e,Pe=40*e,mt=80*e;return this.float32[je+0]=n,this.float32[je+1]=s,this.int16[Pe+4]=u,this.int16[Pe+5]=h,this.int16[Pe+6]=g,this.int16[Pe+7]=y,this.int16[Pe+8]=b,this.int16[Pe+9]=w,this.int16[Pe+10]=D,this.int16[Pe+11]=I,this.int16[Pe+12]=S,this.uint16[Pe+13]=P,this.uint16[Pe+14]=k,this.uint16[Pe+15]=L,this.uint16[Pe+16]=B,this.uint16[Pe+17]=V,this.uint16[Pe+18]=W,this.uint16[Pe+19]=K,this.uint16[Pe+20]=Y,this.uint16[Pe+21]=se,this.uint16[Pe+22]=ee,this.uint16[Pe+23]=le,this.uint16[Pe+24]=de,this.uint16[Pe+25]=_e,this.uint16[Pe+26]=Ie,this.uint16[Pe+27]=ve,this.uint32[je+14]=Me,this.float32[je+15]=Se,this.float32[je+16]=Ce,this.float32[je+17]=ze,this.float32[je+18]=Le,this.uint8[mt+76]=Ge,e}}Fb.prototype.bytesPerElement=80,ht(Fb,"StructArrayLayout2f9i15ui1ul4f1ub80");class Cp extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Cp.prototype.bytesPerElement=4,ht(Cp,"StructArrayLayout1f4");class pu extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h){let g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,h)}emplace(e,n,s,u,h,g){let y=5*e;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=u,this.float32[y+3]=h,this.float32[y+4]=g,e}}pu.prototype.bytesPerElement=20,ht(pu,"StructArrayLayout5f20");class Lb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,h,g,y)}emplace(e,n,s,u,h,g,y,b){let w=7*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=u,this.float32[w+3]=h,this.float32[w+4]=g,this.float32[w+5]=y,this.float32[w+6]=b,e}}Lb.prototype.bytesPerElement=28,ht(Lb,"StructArrayLayout7f28");class Nb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,s,u)}emplace(e,n,s,u,h){let g=6*e;return this.uint32[3*e+0]=n,this.uint16[g+2]=s,this.uint16[g+3]=u,this.uint16[g+4]=h,e}}Nb.prototype.bytesPerElement=12,ht(Nb,"StructArrayLayout1ul3ui12");class zb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}zb.prototype.bytesPerElement=2,ht(zb,"StructArrayLayout1ui2");class mu extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){let h=3*e;return this.float32[h+0]=n,this.float32[h+1]=s,this.float32[h+2]=u,e}}mu.prototype.bytesPerElement=12,ht(mu,"StructArrayLayout3f12");class Bb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B){let V=this.length;return this.resize(V+1),this.emplace(V,e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B)}emplace(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V){let W=16*e;return this.float32[W+0]=n,this.float32[W+1]=s,this.float32[W+2]=u,this.float32[W+3]=h,this.float32[W+4]=g,this.float32[W+5]=y,this.float32[W+6]=b,this.float32[W+7]=w,this.float32[W+8]=D,this.float32[W+9]=I,this.float32[W+10]=S,this.float32[W+11]=P,this.float32[W+12]=k,this.float32[W+13]=L,this.float32[W+14]=B,this.float32[W+15]=V,e}}Bb.prototype.bytesPerElement=64,ht(Bb,"StructArrayLayout16f64");class __ extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,h,g,y){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,h,g,y)}emplace(e,n,s,u,h,g,y,b){let w=10*e,D=5*e;return this.uint16[w+0]=n,this.uint16[w+1]=s,this.uint16[w+2]=u,this.uint16[w+3]=h,this.float32[D+2]=g,this.float32[D+3]=y,this.float32[D+4]=b,e}}__.prototype.bytesPerElement=20,ht(__,"StructArrayLayout4ui3f20");class Vb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}Vb.prototype.bytesPerElement=2,ht(Vb,"StructArrayLayout1i2");class jb extends cn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}jb.prototype.bytesPerElement=1,ht(jb,"StructArrayLayout1ub1");class mD extends ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}mD.prototype.size=40;class gD extends du{get(e){return new mD(this,e)}}ht(gD,"CollisionBoxArray");class _D extends ii{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}_D.prototype.size=60;class yD extends fu{get(e){return new _D(this,e)}}ht(yD,"PlacedSymbolArray");class vD extends ii{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}vD.prototype.size=80;class bD extends Fb{get(e){return new vD(this,e)}}ht(bD,"SymbolInstanceArray");class xD extends Cp{getoffsetX(e){return this.float32[1*e+0]}}ht(xD,"GlyphOffsetArray");class wD extends Dr{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ht(wD,"SymbolLineVertexArray");class ED extends ii{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ED.prototype.size=12;class TD extends Nb{get(e){return new ED(this,e)}}ht(TD,"FeatureIndexArray");class DD extends Do{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ht(DD,"FillExtrusionCentroidArray");let _O=Qt([{name:"a_pos",components:2,type:"Int16"}],4),yO=Qt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vi{constructor(e=[]){this.segments=e}_prepareSegment(e,n,s,u){let h=this.segments[this.segments.length-1];return e>Vi.MAX_VERTEX_ARRAY_LENGTH&&Ii(`Max vertices per segment is ${Vi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!h||h.vertexLength+e>Vi.MAX_VERTEX_ARRAY_LENGTH||h.sortKey!==u)&&(h={vertexOffset:n,primitiveOffset:s,vertexLength:0,primitiveLength:0},u!==void 0&&(h.sortKey=u),this.segments.push(h)),h}prepareSegment(e,n,s,u){return this._prepareSegment(e,n.length,s.length,u)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,u){return new Vi([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function ID(t,e){return 256*(t=hn(Math.floor(t),0,255))+hn(Math.floor(e),0,255)}Vi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht(Vi,"SegmentVector");let vO=Qt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),bO=Qt([{name:"a_dash",components:4,type:"Uint16"}]);class Sp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,s,u){this.ids.push(CD(e)),this.positions.push(n,s,u)}eachPosition(e,n){let s=CD(e),u=0,h=this.ids.length-1;for(;u<h;){let g=u+h>>1;this.ids[g]>=s?h=g:u=g+1}for(;this.ids[u]===s;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){let s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Ub(s,u,0,s.length-1),n&&(n.add(s.buffer),n.add(u.buffer)),{ids:s,positions:u}}static deserialize(e){let n=new Sp,s;n.ids=e.ids,n.positions=e.positions;for(let u of n.ids)u!==s&&n.uniqueIds.push(u),s=u;return n.indexed=!0,n}}function CD(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Nc(String(t))}function Ub(t,e,n,s){for(;n<s;){let u=t[n+s>>1],h=n-1,g=s+1;for(;;){do h++;while(t[h]<u);do g--;while(t[g]>u);if(h>=g)break;y_(t,h,g),y_(e,3*h,3*g),y_(e,3*h+1,3*g+1),y_(e,3*h+2,3*g+2)}g-n<s-g?(Ub(t,e,n,g),n=g+1):(Ub(t,e,g+1,s),s=g)}}function y_(t,e,n){let s=t[e];t[e]=t[n],t[n]=s}ht(Sp,"FeaturePositionMap");class Wa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class v_ extends Wa{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Jr extends Wa{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class zl extends Wa{constructor(e){super(e),this.current=[0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Gb extends Wa{constructor(e){super(e),this.current=[0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class SD extends Wa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class MD extends Wa{constructor(e){super(e),this.current=Bn.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}let xO=new Float32Array(16);class Mp extends Wa{constructor(e){super(e),this.current=xO}set(e,n,s){if(this.fetchUniformLocation(e,n)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let u=1;u<16;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}let wO=new Float32Array(9),EO=new Float32Array(4);class $b extends Wa{constructor(e){super(e),this.current=EO}set(e,n,s){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Hb(t){return[ID(255*t.r,255*t.g),ID(255*t.b,255*t.a)]}class Ap{constructor(e,n,s){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=s}setUniform(e,n,s,u,h){n.set(e,h,u.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new MD(e):new Jr(e)}}class dh{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,u,h){let g=h==="u_pattern"||h==="u_dash"?this.pattern:h==="u_pixel_ratio"?this.pixelRatio:null;g&&n.set(e,h,g)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new SD(e):new Jr(e)}}class Za{constructor(e,n,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(h=>({name:`a_${h}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,s,u,h,g,y){let b=this.paintVertexArray.length,w=this.expression.evaluate(new q(0,{brightness:g}),n,{},h,u,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,w)}updatePaintArray(e,n,s,u,h,g,y){let b=this.expression.evaluate({zoom:0,brightness:y},s,u,void 0,h);this._setPaintValue(e,n,b)}_setPaintValue(e,n,s){if(this.type==="color"){let u=Hb(s);for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fs{constructor(e,n,s,u,h,g){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=h,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,s,u,h,g,y){let b=this.expression.evaluate(new q(this.zoom,{brightness:g}),n,{},h,u,y),w=this.expression.evaluate(new q(this.zoom+1,{brightness:g}),n,{},h,u,y),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,b,w)}updatePaintArray(e,n,s,u,h,g,y){let b=this.expression.evaluate({zoom:this.zoom,brightness:y},s,u,void 0,h),w=this.expression.evaluate({zoom:this.zoom+1,brightness:y},s,u,void 0,h);this._setPaintValue(e,n,b,w)}_setPaintValue(e,n,s,u){if(this.type==="color"){let h=Hb(s),g=Hb(u);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,h[0],h[1],g[0],g[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,u,h){let g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,y=hn(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);n.set(e,h,y)}getBinding(e,n){return new Jr(e)}}class Bl{constructor(e,n,s,u,h){this.expression=e,this.layerId=h,this.paintVertexAttributes=(s==="array"?bO:vO).members;for(let g=0;g<n.length;++g);this.paintVertexArray=new u}populatePaintArray(e,n,s){let u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,u,h,g,y){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(e,n,s,u){if(!u||!s)return;let h=u[s];if(!h)return;let{tl:g,br:y,pixelRatio:b}=h;for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,g[0],g[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class gu{constructor(e,n,s=()=>!0){this.binders={},this._buffers=[];let u=[];for(let h in e.paint._values){let g=e.paint.get(h);if(!s(h)||!(g instanceof be&&sh(g.property.specification)))continue;let y=DO(h,e.type),b=g.value,w=g.property.specification.type,D=!!g.property.useIntegerZoom,I=h==="line-dasharray"||h.endsWith("pattern"),S=h==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||S)if(b.kind==="source"||S||I){let P=AD(h,w,"source");this.binders[h]=I?new Bl(b,y,w,P,e.id):new Za(b,y,w,P),u.push(`/a_${h}`)}else{let P=AD(h,w,"composite");this.binders[h]=new Fs(b,y,w,D,n,P),u.push(`/z_${h}`)}else this.binders[h]=I?new dh(b.value,y):new Ap(b.value,y,w),u.push(`/u_${h}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof Za||n instanceof Fs?n.maxValue:0}populatePaintArrays(e,n,s,u,h,g,y){for(let b in this.binders){let w=this.binders[b];(w instanceof Za||w instanceof Fs||w instanceof Bl)&&w.populatePaintArray(e,n,s,u,h,g,y)}}setConstantPatternPositions(e){for(let n in this.binders){let s=this.binders[n];s instanceof dh&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,u,h,g,y,b){let w=!1,D=Object.keys(e),I=D.length!==0,S=I?D:n.uniqueIds;for(let P in this.binders){let k=this.binders[P];if((k instanceof Za||k instanceof Fs||k instanceof Bl)&&(k.expression.isStateDependent===!0||k.expression.isLightConstant===!1)){let L=h.paint.get(P);k.expression=L.value;for(let B of S){let V=e[B.toString()];n.eachPosition(B,(W,K,Y)=>{let se=u.feature(W);k.updatePaintArray(K,Y,se,V,g,y,b)})}if(!I)for(let B of s.uniqueIds){let V=e[B.toString()];s.eachPosition(B,(W,K,Y)=>{let se=u.feature(W);k.updatePaintArray(K,Y,se,V,g,y,b)})}w=!0}}return w}defines(){let e=[];for(let n in this.binders){let s=this.binders[n];(s instanceof Ap||s instanceof dh)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let s=this.binders[n];if(s instanceof Za||s instanceof Fs||s instanceof Bl)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let s=this.binders[n];if(s instanceof Ap||s instanceof dh||s instanceof Fs)for(let u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let s in this.binders){let u=this.binders[s];if(u instanceof Ap||u instanceof dh||u instanceof Fs)for(let h of u.uniformNames)n.push({name:h,property:s,binding:u.getBinding(e,h)})}return n}setUniforms(e,n,s,u,h){for(let{name:g,property:y,binding:b}of s)this.binders[y].setUniform(e,b,h,u.get(y),g)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof Za||n instanceof Fs||n instanceof Bl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let s=this.binders[n];(s instanceof Za||s instanceof Fs||s instanceof Bl)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof Za||n instanceof Fs||n instanceof Bl)&&n.destroy()}}}class Vl{constructor(e,n,s=()=>!0){this.programConfigurations={};for(let u of e)this.programConfigurations[u.id]=new gu(u,n,s);this.needsUpload=!1,this._featureMap=new Sp,this._featureMapWithoutIds=new Sp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,s,u,h,g,y,b){for(let w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,n,u,h,g,y,b);n.id!==void 0?this._featureMap.add(n.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,u,h,g){for(let y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,y,u,h,g||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let TO={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function DO(t,e){return TO[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let IO={"line-pattern":{source:vr,composite:vr},"fill-pattern":{source:vr,composite:vr},"fill-extrusion-pattern":{source:vr,composite:vr},"line-dasharray":{source:ss,composite:ss}},CO={color:{source:yr,composite:cr},number:{source:Cp,composite:yr}};function AD(t,e,n){let s=IO[t];return s&&s[n]||CO[e][n]}ht(Ap,"ConstantBinder"),ht(dh,"PatternConstantBinder"),ht(Za,"SourceExpressionBinder"),ht(Bl,"PatternCompositeBinder"),ht(Fs,"CompositeExpressionBinder"),ht(gu,"ProgramConfiguration",{omit:["_buffers"]}),ht(Vl,"ProgramConfigurationSet");let eo=nt/Math.PI/2,qb=5,PD=6,SO=16383,hh=64,Wb=[hh,32,16],cs=-eo,us=eo;function fh(t,e,n,s=eo){return n=bn(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function _u(t,e,n){return fh(Math.cos(bn(t)),Math.sin(bn(t)),e,n)}let ph=63710088e-1,Zb=2*Math.PI*ph;class En{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new En(Cs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,s=this.lat*n,u=e.lat*n,h=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return ph*Math.acos(Math.min(h,1))}toBounds(e=0){let n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new jl({lng:this.lng-s,lat:this.lat-n},{lng:this.lng+s,lat:this.lat+n})}toEcef(e){return _u(this.lat,this.lng,eo+e*eo/ph)}static convert(e){if(e instanceof En)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new En(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new En(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class jl{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){let s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{let s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof En?new En(e.lng,e.lat):En.convert(e),this}setSouthWest(e){return this._sw=e instanceof En?new En(e.lng,e.lat):En.convert(e),this}extend(e){let n=this._sw,s=this._ne,u,h;if(e instanceof En)u=e,h=e;else{if(!(e instanceof jl))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(jl.convert(e)):this.extend(En.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(En.convert(e)):this;if(u=e._sw,h=e._ne,!u||!h)return this}return n||s?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),s.lng=Math.max(h.lng,s.lng),s.lat=Math.max(h.lat,s.lat)):(this._sw=new En(u.lng,u.lat),this._ne=new En(h.lng,h.lat)),this}getCenter(){return new En((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new En(this.getWest(),this.getNorth())}getSouthEast(){return new En(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:s}=En.convert(e),u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof jl?e:new jl(e)}}var RD={};(function(t,e){(function(n){function s(h,g,y){var b=u(256*h,256*(g=Math.pow(2,y)-g-1),y),w=u(256*(h+1),256*(g+1),y);return b[0]+","+b[1]+","+w[0]+","+w[1]}function u(h,g,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[h*b-2*Math.PI*6378137/2,g*b-2*Math.PI*6378137/2]}n.getURL=function(h,g,y,b,w,D){return D=D||{},h+"?"+["bbox="+s(y,b,w),"format="+(D.format||"image/png"),"service="+(D.service||"WMS"),"version="+(D.version||"1.1.1"),"request="+(D.request||"GetMap"),"srs="+(D.srs||"EPSG:3857"),"width="+(D.width||256),"height="+(D.height||256),"layers="+g].join("&")},n.getTileBBox=s,n.getMercCoords=u,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,RD);var MO=RD;class yu{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Pp(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let s=MO.getTileBBox(this.x,this.y,this.z),u=function(h,g,y){let b,w="";for(let D=h;D>0;D--)b=1<<D-1,w+=(g&b?1:0)+(y&b?2:0);return w}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class kD{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Pp(e,n.z,n.z,n.x,n.y)}}class Or{constructor(e,n,s,u,h){this.overscaledZ=e,this.wrap=n,this.canonical=new yu(s,+u,+h),this.key=n===0&&e===s?this.canonical.key:Pp(n,e,s,u,h)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Or(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Or(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Pp(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let s=this.canonical.z-e;return Pp(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Or(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Or(n,this.wrap,n,s,u),new Or(n,this.wrap,n,s+1,u),new Or(n,this.wrap,n,s,u+1),new Or(n,this.wrap,n,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Or(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Or(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new kD(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Pp(t,e,n,s,u){let h=1<<Math.min(n,22),g=h*(u%h)+s%h;return t&&n<22&&(g+=h*h*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*g+n)+(e-n)}let AO=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Or(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Or(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Or(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Or(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];ht(yu,"CanonicalTileID"),ht(Or,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});let PO=0,RO=25.5;function Qb(t){return Zb*Math.cos(t*Math.PI/180)}function Ul(t){return(180+t)/360}function Qa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function to(t,e){return t/Qb(e)}function Io(t){return 360*t-180}function Cr(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function OD(t,e){return t*Qb(Cr(e))}let ji=85.051129;function FD(t){return Math.cos(bn(hn(t,-ji,ji)))}function vu(t,e){let n=hn(e,PO,RO),s=Math.pow(2,n);return FD(t)*Zb/(512*s)}function LD(t){return 1/Math.cos(t*Math.PI/180)}function b_(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/nt)/(1<<t.z)*2));return 80150034*n/(n*n+1)/nt/(1<<t.z)}class Fr{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){let s=En.convert(e);return new Fr(Ul(s.lng),Qa(s.lat),to(n,s.lat))}toLngLat(){return new En(Io(this.x),Cr(this.y))}toAltitude(){return OD(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Zb*LD(Cr(this.y))}}function Yb(t,e,n,s,u,h,g,y,b){let w=(e+s)/2,D=(n+u)/2,I=new tt(w,D);y(I),function(S,P,k,L,B,V){let W=k-B,K=L-V;return Math.abs((L-P)*W-(k-S)*K)/Math.hypot(W,K)}(I.x,I.y,h.x,h.y,g.x,g.y)>=b?(Yb(t,e,n,w,D,h,I,y,b),Yb(t,w,D,s,u,I,g,y,b)):t.push(g)}function ND(t,e,n){let s=t[0],u=s.x,h=s.y;e(s);let g=[s];for(let y=1;y<t.length;y++){let b=t[y],{x:w,y:D}=b;e(b),Yb(g,u,h,w,D,s,b,e,n),u=w,h=D,s=b}return g}function Xb(t,e,n,s){if(s(e,n)){let u=e.add(n)._mult(.5);Xb(t,e,u,s),Xb(t,u,n,s)}else t.push(n)}function kO(t,e){let n=t[0],s=[n];for(let u=1;u<t.length;u++){let h=t[u];Xb(s,n,h,e),n=h}return s}let Kb=Math.pow(2,14)-1,zD=-Kb-1;function OO(t,e){let n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=hn(n,zD,Kb),t.y=hn(s,zD,Kb),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&Ii("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ya(t,e,n){let s=t.loadGeometry(),u=t.extent,h=nt/u;if(e&&n&&n.projection.isReprojectedInTileSpace){let g=1<<e.z,{scale:y,x:b,y:w,projection:D}=n,I=S=>{let P=Io((e.x+S.x/u)/g),k=Cr((e.y+S.y/u)/g),L=D.project(P,k);S.x=(L.x*y-b)*u,S.y=(L.y*y-w)*u};for(let S=0;S<s.length;S++)if(t.type!==1)s[S]=ND(s[S],I,1);else{let P=[];for(let k of s[S])k.x<0||k.x>=u||k.y<0||k.y>=u||(I(k),P.push(k));s[S]=P}}for(let g of s)for(let y of g)OO(y,h);return s}function Gl(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ya(t):[]}}function x_(t,e,n,s,u){t.emplaceBack(2*e+(s+1)/2,2*n+(u+1)/2)}function w_(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class Jb{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Dr,this.indexArray=new ur,this.segments=new Vi,this.programConfigurations=new Vl(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){let h=this.layers[0],g=[],y=null;h.type==="circle"&&(y=h.layout.get("circle-sort-key"));for(let{feature:w,id:D,index:I,sourceLayerIndex:S}of e){let P=this.layers[0]._featureFilter.needGeometry,k=Gl(w,P);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),k,s))continue;let L=y?y.evaluate(k,{},s):void 0,B={id:D,properties:w.properties,type:w.type,sourceLayerIndex:S,index:I,geometry:P?k.geometry:Ya(w,s,u),patterns:{},sortKey:L};g.push(B)}y&&g.sort((w,D)=>w.sortKey-D.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Wo,b=u.projection);for(let w of g){let{geometry:D,index:I,sourceLayerIndex:S}=w,P=e[I].feature;this.addFeature(w,D,I,n.availableImages,s,b,n.brightness),n.featureIndex.insert(P,D,I,S,this.index)}}update(e,n,s,u,h){let g=Object.keys(e).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,g?this.stateDependentLayers:this.layers,s,u,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_O.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yO.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,u,h,g,y){for(let b of n)for(let w of b){let D=w.x,I=w.y;if(D<0||D>=nt||I<0||I>=nt)continue;if(g){let k=g.projectTilePoint(D,I,h),L=g.upVector(h,D,I),B=this.globeExtVertexArray;w_(B,k,L),w_(B,k,L),w_(B,k,L),w_(B,k,L)}let S=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=S.vertexLength;x_(this.layoutVertexArray,D,I,-1,-1),x_(this.layoutVertexArray,D,I,1,-1),x_(this.layoutVertexArray,D,I,1,1),x_(this.layoutVertexArray,D,I,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),S.vertexLength+=4,S.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,h,y)}}function ex(t,e){for(let n=0;n<t.length;n++)if(bu(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(bu(t,e[n]))return!0;return!!tx(t,e)}function FO(t,e,n){return!!bu(t,e)||!!nx(e,t,n)}function BD(t,e){if(t.length===1)return jD(e,t[0]);for(let n=0;n<e.length;n++){let s=e[n];for(let u=0;u<s.length;u++)if(bu(t,s[u]))return!0}for(let n=0;n<t.length;n++)if(jD(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(tx(t,e[n]))return!0;return!1}function LO(t,e,n){if(t.length>1){if(tx(t,e))return!0;for(let s=0;s<e.length;s++)if(nx(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(nx(t[s],e,n))return!0;return!1}function tx(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let s=t[n],u=t[n+1];for(let h=0;h<e.length-1;h++)if(NO(s,u,e[h],e[h+1]))return!0}return!1}function NO(t,e,n,s){return ea(t,n,s)!==ea(e,n,s)&&ea(t,e,n)!==ea(t,e,s)}function nx(t,e,n){let s=n*n;if(e.length===1)return t.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(VD(t,e[u-1],e[u])<s)return!0;return!1}function VD(t,e,n){let s=e.distSqr(n);if(s===0)return t.distSqr(e);let u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function jD(t,e){let n,s,u,h=!1;for(let g=0;g<t.length;g++){n=t[g];for(let y=0,b=n.length-1;y<n.length;b=y++)s=n[y],u=n[b],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(h=!h)}return h}function bu(t,e){let n=!1;for(let s=0,u=t.length-1;s<t.length;u=s++){let h=t[s],g=t[u];h.y>e.y!=g.y>e.y&&e.x<(g.x-h.x)*(e.y-h.y)/(g.y-h.y)+h.x&&(n=!n)}return n}function UD(t,e,n,s,u){for(let g of t)if(e<=g.x&&n<=g.y&&s>=g.x&&u>=g.y)return!0;let h=[new tt(e,n),new tt(e,u),new tt(s,u),new tt(s,n)];if(t.length>2){for(let g of h)if(bu(t,g))return!0}for(let g=0;g<t.length-1;g++)if(zO(t[g],t[g+1],h))return!0;return!1}function zO(t,e,n){let s=n[0],u=n[2];if(t.x<s.x&&e.x<s.x||t.x>u.x&&e.x>u.x||t.y<s.y&&e.y<s.y||t.y>u.y&&e.y>u.y)return!1;let h=ea(t,e,n[0]);return h!==ea(t,e,n[1])||h!==ea(t,e,n[2])||h!==ea(t,e,n[3])}function mh(t,e,n,s,u,h){let g=e.y-t.y,y=t.x-e.x;if(h=h||0){let b=g*g+y*y;if(b===0)return!0;let w=Math.sqrt(b);g/=w,y/=w}return!((n.x-t.x)*g+(n.y-t.y)*y-h<0||(s.x-t.x)*g+(s.y-t.y)*y-h<0||(u.x-t.x)*g+(u.y-t.y)*y-h<0)}function ix(t,e,n,s,u,h,g){return!(mh(t,e,s,u,h,g)||mh(e,n,s,u,h,g)||mh(n,t,s,u,h,g)||mh(s,u,t,e,n,g)||mh(u,h,t,e,n,g)||mh(h,s,t,e,n,g))}function gh(t,e,n){let s=e.paint.get(t).value;return s.kind==="constant"?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function E_(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function GD(t,e,n,s,u){if(!e[0]&&!e[1])return t;let h=tt.convert(e)._mult(u);n==="viewport"&&h._rotate(-s);let g=[];for(let y=0;y<t.length;y++)g.push(t[y].sub(h));return g}function $D(t,e,n,s){let u=tt.convert(t)._mult(s);return e==="viewport"&&u._rotate(-n),u}ht(Jb,"CircleBucket",{omit:["layers"]});let BO=new ge({"circle-sort-key":new ye(ie.layout_circle["circle-sort-key"]),visibility:new he(ie.layout_circle.visibility)});var VO={paint:new ge({"circle-radius":new ye(ie.paint_circle["circle-radius"]),"circle-color":new ye(ie.paint_circle["circle-color"]),"circle-blur":new ye(ie.paint_circle["circle-blur"]),"circle-opacity":new ye(ie.paint_circle["circle-opacity"]),"circle-translate":new he(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new he(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new he(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new he(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ye(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ye(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ye(ie.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new he(ie.paint_circle["circle-emissive-strength"])}),layout:BO};class rx{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){let u=r.Q.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;let h=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return s[0]=this.pos[0]+this.dir[0]*h,s[1]=this.pos[1]+this.dir[1]*h,s[2]=this.pos[2]+this.dir[2]*h,!0}closestPointOnSphere(e,n,s){if(r.Q.equals(this.pos,e)||n===0)return s[0]=s[1]=s[2]=0,!1;let[u,h,g]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],w=this.pos[2]-e[2],D=u*u+h*h+g*g,I=2*(y*u+b*h+w*g),S=I*I-4*D*(y*y+b*b+w*w-n*n);if(S<0){let P=Math.max(-I/2,0),k=y+u*P,L=b+h*P,B=w+g*P,V=Math.hypot(k,L,B);return s[0]=k*n/V,s[1]=L*n/V,s[2]=B*n/V,!1}{let P=(-I-Math.sqrt(S))/(2*D);if(P<0){let k=Math.hypot(y,b,w);return s[0]=y*n/k,s[1]=b*n/k,s[2]=w*n/k,!1}return s[0]=y+u*P,s[1]=b+h*P,s[2]=w+g*P,!0}}}class ox{constructor(e,n,s,u,h){this.TL=e,this.TR=n,this.BR=s,this.BL=u,this.horizon=h}static fromInvProjectionMatrix(e,n,s){let u=[-1,1,1],h=[1,1,1],g=[1,-1,1],y=[-1,-1,1],b=r.Q.transformMat4(u,u,e),w=r.Q.transformMat4(h,h,e),D=r.Q.transformMat4(g,g,e),I=r.Q.transformMat4(y,y,e);return new ox(b,w,D,I,n/s)}}function Rp(t,e,n){let s=1/0,u=-1/0,h=[];for(let g of t){r.Q.sub(h,g,e);let y=r.Q.dot(h,n);s=Math.min(s,y),u=Math.max(u,y)}return[s,u]}function HD(t,e){let n=!0;for(let s=0;s<t.planes.length;s++){let u=t.planes[s],h=0;for(let g=0;g<e.length;g++)h+=r.Q.dot(u,e[g])+u[3]>=0;if(h===0)return 0;h!==e.length&&(n=!1)}return n?2:1}function qD(t,e){for(let n of t.projections){let s=Rp(e,t.points[0],n.axis);if(n.projection[1]<s[0]||n.projection[0]>s[1])return 0}return 1}function WD(t,e){let n=0,s=[0,0,0,0];for(let u=0;u<t.length;u++)s[0]=t[u][0],s[1]=t[u][1],s[2]=t[u][2],s[3]=1,r.aa.dot(s,e)>=0&&n++;return n}class sx{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=gi.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.Q.sub([],this.points[2],this.points[3]),r.Q.sub([],this.points[0],this.points[3]),r.Q.sub([],this.points[4],this.points[0]),r.Q.sub([],this.points[5],this.points[1]),r.Q.sub([],this.points[6],this.points[2]),r.Q.sub([],this.points[7],this.points[3])];for(let s of this.frustumEdges){let u=[0,-s[2],s[1]],h=[s[2],0,-s[0]];this.projections.push({axis:u,projection:Rp(this.points,this.points[0],u)}),this.projections.push({axis:h,projection:Rp(this.points,this.points[0],h)})}}static fromInvProjectionMatrix(e,n,s,u){let h=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{let D=r.aa.transformMat4([],w,e),I=1/D[3]/n*h;return r.aa.mul(D,D,[I,I,u?1/D[3]:I,I])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{let D=r.Q.sub([],g[w[0]],g[w[1]]),I=r.Q.sub([],g[w[2]],g[w[1]]),S=r.Q.normalize([],r.Q.cross([],D,I)),P=-r.Q.dot(S,g[w[1]]);return S.concat(P)}),b=[];for(let w=0;w<g.length;w++)b.push([g[w][0],g[w][1],g[w][2]]);return new sx(b,y)}intersectsPrecise(e,n,s){for(let u=0;u<n.length;u++)if(!WD(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!WD(e,this.planes[u]))return 0;for(let u of s)for(let h of this.frustumEdges){let g=r.Q.cross([],u,h),y=r.Q.length(g);if(y===0)continue;r.Q.scale(g,g,1/y);let b=Rp(this.points,this.points[0],g),w=Rp(e,this.points[0],g);if(b[0]>w[1]||w[0]>b[1])return 0}return 1}}class gi{static fromPoints(e){let n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(let u of e)r.Q.min(n,n,u),r.Q.max(s,s,u);return new gi(n,s)}static fromTileIdAndHeight(e,n,s){let u=1<<e.canonical.z,h=e.canonical.x,g=e.canonical.y;return new gi([h/u,g/u,n],[(h+1)/u,(g+1)/u,s])}static applyTransform(e,n){let s=e.getCorners();for(let u=0;u<s.length;++u)r.Q.transformMat4(s[u],s[u],n);return gi.fromPoints(s)}static projectAabbCorners(e,n){let s=e.getCorners();for(let u=0;u<s.length;++u)r.Q.transformMat4(s[u],s[u],n);return s}constructor(e,n){this.min=e,this.max=n,this.center=r.Q.scale([],r.Q.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],s=r.Q.clone(this.min),u=r.Q.clone(this.max);for(let h=0;h<n.length;h++)s[h]=n[h]?this.min[h]:this.center[h],u[h]=n[h]?this.center[h]:this.max[h];return u[2]=this.max[2],new gi(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?HD(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?HD(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?qD(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?qD(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ht(gi,"Aabb");let jO=Qt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:T_}=jO,UO=Qt([{name:"a_pos_3",components:3,type:"Int16"}]);var ZD=Qt([{name:"a_pos",type:"Int16",components:2}]);function D_(t){return t*eo/ph}let GO=[new gi([cs,cs,cs],[us,us,us]),new gi([cs,cs,cs],[0,0,us]),new gi([0,cs,cs],[us,0,us]),new gi([cs,0,cs],[0,us,us]),new gi([0,0,cs],[us,us,us])];function QD(t,e,n,s=!0){let u=r.Q.scale([],t._camera.position,t.worldSize),h=[e,n,1,1];r.aa.transformMat4(h,h,t.pixelMatrixInverse),r.aa.scale(h,h,1/h[3]);let g=r.Q.sub([],h,u),y=r.Q.normalize([],g),b=t.globeMatrix,w=[b[12],b[13],b[14]],D=r.Q.sub([],w,u),I=r.Q.length(D),S=r.Q.normalize([],D),P=t.worldSize/(2*Math.PI),k=r.Q.dot(S,y),L=Math.asin(P/I);if(L<Math.acos(k)){if(!s)return null;let ve=[],Me=[];r.Q.scale(ve,y,I/k),r.Q.normalize(Me,r.Q.sub(Me,ve,D)),r.Q.normalize(y,r.Q.add(y,D,r.Q.scale(y,Me,Math.tan(L)*I)))}let B=[];new rx(u,y).closestPointOnSphere(w,P,B);let V=r.Q.normalize([],ka(b,0)),W=r.Q.normalize([],ka(b,1)),K=r.Q.normalize([],ka(b,2)),Y=r.Q.dot(V,B),se=r.Q.dot(W,B),ee=r.Q.dot(K,B),le=Ur(Math.asin(-se/P)),de=Ur(Math.atan2(Y,ee));de=t.center.lng+function(ve,Me){let Se=(Me-ve+180)%360-180;return Se<-180?Se+360:Se}(t.center.lng,de);let _e=Ul(de),Ie=hn(Qa(le),0,1);return new Fr(_e,Ie)}class $O{constructor(e,n,s){this.a=r.Q.sub([],e,s),this.b=r.Q.sub([],n,s),this.center=s;let u=r.Q.normalize([],this.a),h=r.Q.normalize([],this.b);this.angle=Math.acos(r.Q.dot(u,h))}}function ax(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,u,h,g){let y=Math.sin(h);return s*(Math.sin((1-g)*h)/y)+u*(Math.sin(g*h)/y)}(t.a[e],t.b[e],t.angle,hn(n,0,1))+t.center[e]}function ha(t){if(t.z<=1)return GO[t.z+2*t.y+t.x];let e=lx(I_(t));return gi.fromPoints(e)}function Xa(t,e,n){return r.Q.scale(t,t,1-n),r.Q.scaleAndAdd(t,t,e,n)}function YD(t,e,n){for(let s of t)r.Q.transformMat4(s,s,e),r.Q.scale(s,s,n)}function XD(t,e,n,s){let u=e/t.worldSize,h=t.globeMatrix;if(n.z<=1){let _e=ha(n).getCorners();return YD(_e,h,u),gi.fromPoints(_e)}let g=I_(n,s),y=lx(g,eo+D_(t._tileCoverLift));YD(y,h,u);let b=Number.MAX_VALUE,w=[-b,-b,-b],D=[b,b,b];if(g.contains(t.center)){for(let ve of y)r.Q.min(D,D,ve),r.Q.max(w,w,ve);w[2]=0;let _e=t.point,Ie=[_e.x*u,_e.y*u,0];return r.Q.min(D,D,Ie),r.Q.max(w,w,Ie),new gi(D,w)}if(t._tileCoverLift>0){for(let _e of y)r.Q.min(D,D,_e),r.Q.max(w,w,_e);return new gi(D,w)}let I=[h[12]*u,h[13]*u,h[14]*u],S=g.getCenter(),P=hn(t.center.lat,-ji,ji),k=hn(S.lat,-ji,ji),L=Ul(t.center.lng),B=Qa(P),V=L-Ul(S.lng),W=B-Qa(k);V>.5?V-=1:V<-.5&&(V+=1);let K=0;if(Math.abs(V)>Math.abs(W))K=V>=0?1:3;else{K=W>=0?0:2;let _e=[h[4]*u,h[5]*u,h[6]*u],Ie=-Math.sin(bn(W>=0?g.getSouth():g.getNorth()))*eo;r.Q.scaleAndAdd(I,I,_e,Ie)}let Y=y[K],se=y[(K+1)%4],ee=new $O(Y,se,I),le=[ax(ee,0)||Y[0],ax(ee,1)||Y[1],ax(ee,2)||Y[2]],de=$l(t.zoom);if(de>0){let _e=function({x:ve,y:Me,z:Se},Ce,ze,Le,Ge){let je=1/(1<<Se),Pe=ve*je,mt=Pe+je,ct=Me*je,He=ct+je,Rt=0,bt=(Pe+mt)/2-Le;return bt>.5?Rt=-1:bt<-.5&&(Rt=1),Pe=((Pe+Rt)*Ce-(Le*=Ce))*ze+Le,mt=((mt+Rt)*Ce-Le)*ze+Le,ct=(ct*Ce-(Ge*=Ce))*ze+Ge,He=(He*Ce-Ge)*ze+Ge,[[Pe,He,0],[mt,He,0],[mt,ct,0],[Pe,ct,0]]}(n,e,t._pixelsPerMercatorPixel,L,B);for(let ve=0;ve<y.length;ve++)Xa(y[ve],_e[ve],de);let Ie=r.Q.add([],_e[K],_e[(K+1)%4]);r.Q.scale(Ie,Ie,.5),Xa(le,Ie,de)}for(let _e of y)r.Q.min(D,D,_e),r.Q.max(w,w,_e);return D[2]=Math.min(Y[2],se[2]),r.Q.min(D,D,le),r.Q.max(w,w,le),new gi(D,w)}function I_({x:t,y:e,z:n},s=!1){let u=1/(1<<n),h=new En(Io(t*u),e===(1<<n)-1&&s?-90:Cr((e+1)*u)),g=new En(Io((t+1)*u),e===0&&s?90:Cr(e*u));return new jl(h,g)}function lx(t,e=eo){let n=bn(t.getNorth()),s=bn(t.getSouth()),u=Math.cos(n),h=Math.cos(s),g=Math.sin(n),y=Math.sin(s),b=t.getWest(),w=t.getEast();return[fh(h,y,b,e),fh(h,y,w,e),fh(u,g,w,e),fh(u,g,b,e)]}function kp(t,e,n,s){let u=1<<n.z,h=(t/nt+n.x)/u;return _u(Cr((e/nt+n.y)/u),Io(h),s)}function C_({min:t,max:e}){return SO/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let KD=new Float64Array(16);function S_(t){let e=C_(t),n=r.a9.fromScaling(KD,[e,e,e]);return r.a9.translate(n,n,r.Q.negate([],t.min))}function cx(t){let e=r.a9.fromTranslation(KD,t.min),n=1/C_(t);return r.a9.scale(e,e,[n,n,n])}function ux(t){let e=nt/(2*Math.PI);return t/(2*Math.PI)/e}function JD(t,e){return nt/(512*Math.pow(2,t))*C_(ha(e))}function eI(t,e,n,s,u){let h=ux(n),g=[t,e,-n/(2*Math.PI)],y=r.a9.identity(new Float64Array(16));return r.a9.translate(y,y,g),r.a9.scale(y,y,[h,h,h]),r.a9.rotateX(y,y,bn(-u)),r.a9.rotateY(y,y,bn(-s)),y}function $l(t){return Ic(qb,PD,t)}function tI(t,e){let n=_u(e.lat,e.lng),s=function(h){let g=_u(h._center.lat,h._center.lng),y=r.Q.fromValues(0,1,0),b=r.Q.cross([],y,g),w=r.a9.fromRotation([],-h.angle,g);b=r.Q.transformMat4(b,b,w),r.a9.fromRotation(w,-h._pitch,b);let D=r.Q.normalize([],g);return r.Q.scale(D,D,D_(h.cameraToCenterDistance/h.pixelsPerMeter)),r.Q.transformMat4(D,D,w),r.Q.add([],g,D)}(t),u=r.Q.subtract([],s,n);return r.Q.angle(u,n)}function dx(t,e){return tI(t,e)>Math.PI/2*1.01}let nI=bn(85),HO=Math.cos(nI),qO=Math.sin(nI),WO=r.a9.create(),iI=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function rI(t,e,n,s,u,h,g,y,b){if(h&&t.queryGeometry.isAboveHorizon)return!1;h&&(b*=t.pixelToTileUnitsFactor);let w=t.tileID.canonical,D=n.projection.upVectorScale(w,n.center.lat,n.worldSize).metersToTile;for(let I of e)for(let S of I){let P=S.add(y),k=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(P.x,P.y,!0):0,L=n.projection.projectTilePoint(P.x,P.y,w);if(k>0){let K=n.projection.upVector(w,P.x,P.y);L.x+=K[0]*D*k,L.y+=K[1]*D*k,L.z+=K[2]*D*k}let B=h?P:ZO(L.x,L.y,L.z,s),V=h?t.tilespaceRays.map(K=>YO(K,k)):t.queryGeometry.screenGeometry,W=r.aa.transformMat4([],[L.x,L.y,L.z,1],s);if(!g&&h?b*=W[3]/n.cameraToCenterDistance:g&&!h&&(b*=n.cameraToCenterDistance/W[3]),h){let K=Cr((S.y/nt+w.y)/(1<<w.z));b/=n.projection.pixelsPerMeter(K,1)/to(1,K)}if(FO(V,B,b))return!0}return!1}function ZO(t,e,n,s){let u=r.aa.transformMat4([],[t,e,n,1],s);return new tt(u[0]/u[3],u[1]/u[3])}let oI=r.Q.fromValues(0,0,0),QO=r.Q.fromValues(0,0,1);function YO(t,e){let n=r.Q.create();return oI[2]=e,t.intersectsPlane(oI,QO,n),new tt(n[0],n[1])}class sI extends Jb{}function aI(t,{width:e,height:n},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=u,t}function lI(t,e,n){let{width:s,height:u}=e;s===t.width&&u===t.height||(hx(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,u)},n),t.width=s,t.height=u,t.data=e.data)}function hx(t,e,n,s,u,h,g){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");let y=t.data,b=e.data,w=h===4&&g;for(let D=0;D<u.height;D++){let I=((n.y+D)*t.width+n.x)*h,S=((s.y+D)*e.width+s.x)*h;if(w)for(let P=0;P<u.width;P++){let k=I+P*h+3,L=S+P*h;b[L+0]=255,b[L+1]=255,b[L+2]=255,b[L+3]=y[k]}else for(let P=0;P<u.width*h;P++)b[S+P]=y[I+P]}return e}ht(sI,"HeatmapBucket",{omit:["layers"]});class Hl{constructor(e,n){aI(this,e,1,n)}resize(e){lI(this,new Hl(e),1)}clone(){return new Hl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,h){hx(e,n,s,u,h,1)}}class Zo{constructor(e,n){aI(this,e,4,n)}resize(e){lI(this,new Zo(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,h,g){hx(e,n,s,u,h,4,g)}}class cI{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}ht(Hl,"AlphaImage"),ht(Zo,"RGBAImage");let XO=new ge({visibility:new he(ie.layout_heatmap.visibility)});var KO={paint:new ge({"heatmap-radius":new ye(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ye(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new he(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ve(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new he(ie.paint_heatmap["heatmap-opacity"])}),layout:XO};function Op(t){let e={},n=t.resolution||256,s=t.clips?t.clips.length:1,u=t.image||new Zo({width:n,height:s}),h=(g,y,b)=>{e[t.evaluationKey]=b;let w=t.expression.evaluate(e);w&&(u.data[g+y+0]=Math.floor(255*w.r/w.a),u.data[g+y+1]=Math.floor(255*w.g/w.a),u.data[g+y+2]=Math.floor(255*w.b/w.a),u.data[g+y+3]=Math.floor(255*w.a))};if(t.clips)for(let g=0,y=0;g<s;++g,y+=4*n)for(let b=0,w=0;b<n;b++,w+=4){let D=b/(n-1),{start:I,end:S}=t.clips[g];h(y,w,I*(1-D)+S*D)}else for(let g=0,y=0;g<n;g++,y+=4)h(0,y,g/(n-1));return u}let JO=new ge({visibility:new he(ie.layout_hillshade.visibility)});var eF={paint:new ge({"hillshade-illumination-direction":new he(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new he(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new he(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new he(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new he(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new he(ie.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new he(ie.paint_hillshade["hillshade-emissive-strength"])}),layout:JO};let tF=Qt([{name:"a_pos",components:2,type:"Int16"}],4),{members:nF}=tF;var fx={exports:{}};function M_(t,e,n){n=n||2;var s,u,h,g,y,b,w,D=e&&e.length,I=D?e[0]*n:t.length,S=uI(t,0,I,n,!0),P=[];if(!S||S.next===S.prev)return P;if(D&&(S=function(L,B,V,W){var K,Y,se,ee=[];for(K=0,Y=B.length;K<Y;K++)(se=uI(L,B[K]*W,K<Y-1?B[K+1]*W:L.length,W,!1))===se.next&&(se.steiner=!0),ee.push(uF(se));for(ee.sort(aF),K=0;K<ee.length;K++)V=lF(ee[K],V);return V}(t,e,S,n)),t.length>80*n){s=h=t[0],u=g=t[1];for(var k=n;k<I;k+=n)(y=t[k])<s&&(s=y),(b=t[k+1])<u&&(u=b),y>h&&(h=y),b>g&&(g=b);w=(w=Math.max(h-s,g-u))!==0?32767/w:0}return Fp(S,P,n,s,u,w,0),P}function uI(t,e,n,s,u){var h,g;if(u===gx(t,e,n,s)>0)for(h=e;h<n;h+=s)g=fI(h,t[h],t[h+1],g);else for(h=n-s;h>=e;h-=s)g=fI(h,t[h],t[h+1],g);return g&&A_(g,g.next)&&(Np(g),g=g.next),g}function xu(t,e){if(!t)return t;e||(e=t);var n,s=t;do if(n=!1,s.steiner||!A_(s,s.next)&&er(s.prev,s,s.next)!==0)s=s.next;else{if(Np(s),(s=e=s.prev)===s.next)break;n=!0}while(n||s!==e);return e}function Fp(t,e,n,s,u,h,g){if(t){!g&&h&&function(D,I,S,P){var k=D;do k.z===0&&(k.z=px(k.x,k.y,I,S,P)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==D);k.prevZ.nextZ=null,k.prevZ=null,function(L){var B,V,W,K,Y,se,ee,le,de=1;do{for(V=L,L=null,Y=null,se=0;V;){for(se++,W=V,ee=0,B=0;B<de&&(ee++,W=W.nextZ);B++);for(le=de;ee>0||le>0&&W;)ee!==0&&(le===0||!W||V.z<=W.z)?(K=V,V=V.nextZ,ee--):(K=W,W=W.nextZ,le--),Y?Y.nextZ=K:L=K,K.prevZ=Y,Y=K;V=W}Y.nextZ=null,de*=2}while(se>1)}(k)}(t,s,u,h);for(var y,b,w=t;t.prev!==t.next;)if(y=t.prev,b=t.next,h?rF(t,s,u,h):iF(t))e.push(y.i/n|0),e.push(t.i/n|0),e.push(b.i/n|0),Np(t),t=b.next,w=b.next;else if((t=b)===w){g?g===1?Fp(t=oF(xu(t),e,n),e,n,s,u,h,2):g===2&&sF(t,e,n,s,u,h):Fp(xu(t),e,n,s,u,h,1);break}}}function iF(t){var e=t.prev,n=t,s=t.next;if(er(e,n,s)>=0)return!1;for(var u=e.x,h=n.x,g=s.x,y=e.y,b=n.y,w=s.y,D=u<h?u<g?u:g:h<g?h:g,I=y<b?y<w?y:w:b<w?b:w,S=u>h?u>g?u:g:h>g?h:g,P=y>b?y>w?y:w:b>w?b:w,k=s.next;k!==e;){if(k.x>=D&&k.x<=S&&k.y>=I&&k.y<=P&&_h(u,y,h,b,g,w,k.x,k.y)&&er(k.prev,k,k.next)>=0)return!1;k=k.next}return!0}function rF(t,e,n,s){var u=t.prev,h=t,g=t.next;if(er(u,h,g)>=0)return!1;for(var y=u.x,b=h.x,w=g.x,D=u.y,I=h.y,S=g.y,P=y<b?y<w?y:w:b<w?b:w,k=D<I?D<S?D:S:I<S?I:S,L=y>b?y>w?y:w:b>w?b:w,B=D>I?D>S?D:S:I>S?I:S,V=px(P,k,e,n,s),W=px(L,B,e,n,s),K=t.prevZ,Y=t.nextZ;K&&K.z>=V&&Y&&Y.z<=W;){if(K.x>=P&&K.x<=L&&K.y>=k&&K.y<=B&&K!==u&&K!==g&&_h(y,D,b,I,w,S,K.x,K.y)&&er(K.prev,K,K.next)>=0||(K=K.prevZ,Y.x>=P&&Y.x<=L&&Y.y>=k&&Y.y<=B&&Y!==u&&Y!==g&&_h(y,D,b,I,w,S,Y.x,Y.y)&&er(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;K&&K.z>=V;){if(K.x>=P&&K.x<=L&&K.y>=k&&K.y<=B&&K!==u&&K!==g&&_h(y,D,b,I,w,S,K.x,K.y)&&er(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;Y&&Y.z<=W;){if(Y.x>=P&&Y.x<=L&&Y.y>=k&&Y.y<=B&&Y!==u&&Y!==g&&_h(y,D,b,I,w,S,Y.x,Y.y)&&er(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function oF(t,e,n){var s=t;do{var u=s.prev,h=s.next.next;!A_(u,h)&&dI(u,s,s.next,h)&&Lp(u,h)&&Lp(h,u)&&(e.push(u.i/n|0),e.push(s.i/n|0),e.push(h.i/n|0),Np(s),Np(s.next),s=t=h),s=s.next}while(s!==t);return xu(s)}function sF(t,e,n,s,u,h){var g=t;do{for(var y=g.next.next;y!==g.prev;){if(g.i!==y.i&&dF(g,y)){var b=hI(g,y);return g=xu(g,g.next),b=xu(b,b.next),Fp(g,e,n,s,u,h,0),void Fp(b,e,n,s,u,h,0)}y=y.next}g=g.next}while(g!==t)}function aF(t,e){return t.x-e.x}function lF(t,e){var n=function(u,h){var g,y=h,b=u.x,w=u.y,D=-1/0;do{if(w<=y.y&&w>=y.next.y&&y.next.y!==y.y){var I=y.x+(w-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(I<=b&&I>D&&(D=I,g=y.x<y.next.x?y:y.next,I===b))return g}y=y.next}while(y!==h);if(!g)return null;var S,P=g,k=g.x,L=g.y,B=1/0;y=g;do b>=y.x&&y.x>=k&&b!==y.x&&_h(w<L?b:D,w,k,L,w<L?D:b,w,y.x,y.y)&&(S=Math.abs(w-y.y)/(b-y.x),Lp(y,u)&&(S<B||S===B&&(y.x>g.x||y.x===g.x&&cF(g,y)))&&(g=y,B=S)),y=y.next;while(y!==P);return g}(t,e);if(!n)return e;var s=hI(n,t);return xu(s,s.next),xu(n,n.next)}function cF(t,e){return er(t.prev,t,e.prev)<0&&er(e.next,t,t.next)<0}function px(t,e,n,s,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function uF(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function _h(t,e,n,s,u,h,g,y){return(u-g)*(e-y)>=(t-g)*(h-y)&&(t-g)*(s-y)>=(n-g)*(e-y)&&(n-g)*(h-y)>=(u-g)*(s-y)}function dF(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==s.i&&u.next.i!==s.i&&dI(u,u.next,n,s))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(Lp(t,e)&&Lp(e,t)&&function(n,s){var u=n,h=!1,g=(n.x+s.x)/2,y=(n.y+s.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&g<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(h=!h),u=u.next;while(u!==n);return h}(t,e)&&(er(t.prev,t,e.prev)||er(t,e.prev,e))||A_(t,e)&&er(t.prev,t,t.next)>0&&er(e.prev,e,e.next)>0)}function er(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function A_(t,e){return t.x===e.x&&t.y===e.y}function dI(t,e,n,s){var u=R_(er(t,e,n)),h=R_(er(t,e,s)),g=R_(er(n,s,t)),y=R_(er(n,s,e));return u!==h&&g!==y||!(u!==0||!P_(t,n,e))||!(h!==0||!P_(t,s,e))||!(g!==0||!P_(n,t,s))||!(y!==0||!P_(n,e,s))}function P_(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function R_(t){return t>0?1:t<0?-1:0}function Lp(t,e){return er(t.prev,t,t.next)<0?er(t,e,t.next)>=0&&er(t,t.prev,e)>=0:er(t,e,t.prev)<0||er(t,t.next,e)<0}function hI(t,e){var n=new mx(t.i,t.x,t.y),s=new mx(e.i,e.x,e.y),u=t.next,h=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,s.next=n,n.prev=s,h.next=s,s.prev=h,s}function fI(t,e,n,s){var u=new mx(t,e,n);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function Np(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function mx(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gx(t,e,n,s){for(var u=0,h=e,g=n-s;h<n;h+=s)u+=(t[g]-t[h])*(t[h+1]+t[g+1]),g=h;return u}fx.exports=M_,fx.exports.default=M_,M_.deviation=function(t,e,n,s){var u=e&&e.length,h=Math.abs(gx(t,0,u?e[0]*n:t.length,n));if(u)for(var g=0,y=e.length;g<y;g++)h-=Math.abs(gx(t,e[g]*n,g<y-1?e[g+1]*n:t.length,n));var b=0;for(g=0;g<s.length;g+=3){var w=s[g]*n,D=s[g+1]*n,I=s[g+2]*n;b+=Math.abs((t[w]-t[I])*(t[D+1]-t[w+1])-(t[w]-t[D])*(t[I+1]-t[w+1]))}return h===0&&b===0?0:Math.abs((b-h)/h)},M_.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,u=0;u<t.length;u++){for(var h=0;h<t[u].length;h++)for(var g=0;g<e;g++)n.vertices.push(t[u][h][g]);u>0&&n.holes.push(s+=t[u-1].length)}return n};var k_=dt(fx.exports);function _x(t,e){let n=t.length;if(n<=1)return[t];let s=[],u,h;for(let g=0;g<n;g++){let y=Sc(t[g]);y!==0&&(t[g].area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(u&&s.push(u),u=[t[g]]):u.push(t[g]))}if(u&&s.push(u),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(zg(s[g],e,1,s[g].length-1,hF),s[g]=s[g].slice(0,e));return s}function hF(t,e){return e.area-t.area}function yx(t,e,n){let s=n.patternDependencies,u=!1;for(let h of e){let g=h.paint.get(`${t}-pattern`);g.isConstant()||(u=!0);let y=g.constantOr(null);y&&(u=!0,s[y]=!0)}return u}function vx(t,e,n,s,u){let h=u.patternDependencies;for(let g of e){let y=g.paint.get(`${t}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:s},n,{},u.availableImages);b=b&&b.name?b.name:b,h[b]=!0,n.patterns[g.id]=b}}return n}class bx{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dr,this.indexArray=new ur,this.indexArray2=new Do,this.programConfigurations=new Vl(e.layers,e.zoom),this.segments=new Vi,this.segments2=new Vi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,u){this.hasPattern=yx("fill",this.layers,n);let h=this.layers[0].layout.get("fill-sort-key"),g=[];for(let{feature:y,id:b,index:w,sourceLayerIndex:D}of e){let I=this.layers[0]._featureFilter.needGeometry,S=Gl(y,I);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),S,s))continue;let P=h?h.evaluate(S,{},s,n.availableImages):void 0,k={id:b,properties:y.properties,type:y.type,sourceLayerIndex:D,index:w,geometry:I?S.geometry:Ya(y,s,u),patterns:{},sortKey:P};g.push(k)}h&&g.sort((y,b)=>y.sortKey-b.sortKey);for(let y of g){let{geometry:b,index:w,sourceLayerIndex:D}=y;if(this.hasPattern){let I=vx("fill",this.layers,y,this.zoom,n);this.patternFeatures.push(I)}else this.addFeature(y,b,w,s,{},n.availableImages,n.brightness);n.featureIndex.insert(e[w].feature,b,w,D,this.index)}}update(e,n,s,u,h){let g=Object.keys(e).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,g?this.stateDependentLayers:this.layers,s,u,h)}addFeatures(e,n,s,u,h,g){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nF),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,u,h,g=[],y){for(let b of _x(n,500)){let w=0;for(let L of b)w+=L.length;let D=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),I=D.vertexLength,S=[],P=[];for(let L of b){if(L.length===0)continue;L!==b[0]&&P.push(S.length/2);let B=this.segments2.prepareSegment(L.length,this.layoutVertexArray,this.indexArray2),V=B.vertexLength;this.layoutVertexArray.emplaceBack(L[0].x,L[0].y),this.indexArray2.emplaceBack(V+L.length-1,V),S.push(L[0].x),S.push(L[0].y);for(let W=1;W<L.length;W++)this.layoutVertexArray.emplaceBack(L[W].x,L[W].y),this.indexArray2.emplaceBack(V+W-1,V+W),S.push(L[W].x),S.push(L[W].y);B.vertexLength+=L.length,B.primitiveLength+=L.length}let k=k_(S,P);for(let L=0;L<k.length;L+=3)this.indexArray.emplaceBack(I+k[L],I+k[L+1],I+k[L+2]);D.vertexLength+=w,D.primitiveLength+=k.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,g,u,y)}}ht(bx,"FillBucket",{omit:["layers","patternFeatures"]});let fF=new ge({"fill-sort-key":new ye(ie.layout_fill["fill-sort-key"]),visibility:new he(ie.layout_fill.visibility)});var pF={paint:new ge({"fill-antialias":new he(ie.paint_fill["fill-antialias"]),"fill-opacity":new ye(ie.paint_fill["fill-opacity"]),"fill-color":new ye(ie.paint_fill["fill-color"]),"fill-outline-color":new ye(ie.paint_fill["fill-outline-color"]),"fill-translate":new he(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new he(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new ye(ie.paint_fill["fill-pattern"]),"fill-emissive-strength":new he(ie.paint_fill["fill-emissive-strength"])}),layout:fF};let mF=Qt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),gF=Qt([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),_F=Qt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),yF=Qt([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),vF=Qt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bF}=mF;var O_={},xF=_d,pI=yh;function yh(t,e,n,s,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=u,t.readFields(wF,this,e)}function wF(t,e,n){t==1?e.id=n.readVarint():t==2?function(s,u){for(var h=s.readVarint()+s.pos;s.pos<h;){var g=u._keys[s.readVarint()],y=u._values[s.readVarint()];u.properties[g]=y}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function EF(t){for(var e,n,s=0,u=0,h=t.length,g=h-1;u<h;g=u++)s+=((n=t[g]).x-(e=t[u]).x)*(e.y+n.y);return s}yh.types=["Unknown","Point","LineString","Polygon"],yh.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,u=0,h=0,g=0,y=[];t.pos<n;){if(u<=0){var b=t.readVarint();s=7&b,u=b>>3}if(u--,s===1||s===2)h+=t.readSVarint(),g+=t.readSVarint(),s===1&&(e&&y.push(e),e=[]),e.push(new xF(h,g));else{if(s!==7)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},yh.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,u=0,h=0,g=1/0,y=-1/0,b=1/0,w=-1/0;t.pos<e;){if(s<=0){var D=t.readVarint();n=7&D,s=D>>3}if(s--,n===1||n===2)(u+=t.readSVarint())<g&&(g=u),u>y&&(y=u),(h+=t.readSVarint())<b&&(b=h),h>w&&(w=h);else if(n!==7)throw new Error("unknown command "+n)}return[g,b,y,w]},yh.prototype.toGeoJSON=function(t,e,n){var s,u,h=this.extent*Math.pow(2,n),g=this.extent*t,y=this.extent*e,b=this.loadGeometry(),w=yh.types[this.type];function D(P){for(var k=0;k<P.length;k++){var L=P[k];P[k]=[360*(L.x+g)/h-180,360/Math.PI*Math.atan(Math.exp((180-360*(L.y+y)/h)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(s=0;s<b.length;s++)I[s]=b[s][0];D(b=I);break;case 2:for(s=0;s<b.length;s++)D(b[s]);break;case 3:for(b=function(P){var k=P.length;if(k<=1)return[P];for(var L,B,V=[],W=0;W<k;W++){var K=EF(P[W]);K!==0&&(B===void 0&&(B=K<0),B===K<0?(L&&V.push(L),L=[P[W]]):L.push(P[W]))}return L&&V.push(L),V}(b),s=0;s<b.length;s++)for(u=0;u<b[s].length;u++)D(b[s][u])}b.length===1?b=b[0]:w="Multi"+w;var S={type:"Feature",geometry:{type:w,coordinates:b},properties:this.properties};return"id"in this&&(S.id=this.id),S};var TF=pI,mI=gI;function gI(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(DF,this,e),this.length=this._features.length}function DF(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(s){for(var u=null,h=s.readVarint()+s.pos;s.pos<h;){var g=s.readVarint()>>3;u=g===1?s.readString():g===2?s.readFloat():g===3?s.readDouble():g===4?s.readVarint64():g===5?s.readVarint():g===6?s.readSVarint():g===7?s.readBoolean():null}return u}(n))}gI.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new TF(this._pbf,e,this.extent,this._keys,this._values)};var IF=mI;function CF(t,e,n){if(t===3){var s=new IF(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var xx=O_.VectorTile=function(t,e){this.layers=t.readFields(CF,{},e)},F_=O_.VectorTileFeature=pI;function L_(t,e,n,s){let u=[],h=s===0?(g,y,b,w,D,I)=>{g.push(new tt(I,b+(I-y)/(w-y)*(D-b)))}:(g,y,b,w,D,I)=>{g.push(new tt(y+(I-b)/(D-b)*(w-y),I))};for(let g of t){let y=[];for(let b of g){if(b.length<=2)continue;let w=[];for(let S=0;S<b.length-1;S++){let P=b[S].x,k=b[S].y,L=b[S+1].x,B=b[S+1].y,V=s===0?P:k,W=s===0?L:B;V<e?W>e&&h(w,P,k,L,B,e):V>n?W<n&&h(w,P,k,L,B,n):w.push(b[S]),W<e&&V>=e&&h(w,P,k,L,B,e),W>n&&V<=n&&h(w,P,k,L,B,n)}let D=b[b.length-1],I=s===0?D.x:D.y;I>=e&&I<=n&&w.push(D),w.length&&(D=w[w.length-1],w[0].x===D.x&&w[0].y===D.y||w.push(w[0]),y.push(w))}y.length&&u.push(y)}return u}function N_(t,e){return t.x-e.x||t.y-e.y}function _I(t,e){return N_(t.min,e.min)===0&&N_(t.max,e.max)===0}function yI(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function vI(t,e,n){let s=1/nt,u=1/(1<<n.canonical.z),h=(e.x*s+n.canonical.x)*u+n.wrap,g=(e.y*s+n.canonical.y)*u;return{min:new tt((t.x*s+n.canonical.x)*u+n.wrap,(t.y*s+n.canonical.y)*u),max:new tt(h,g)}}function SF(t,e,n){let s=1<<n.canonical.z,u=((e.x-n.wrap)*s-n.canonical.x)*nt,h=(e.y*s-n.canonical.y)*nt;return{min:new tt(((t.x-n.wrap)*s-n.canonical.x)*nt,(t.y*s-n.canonical.y)*nt),max:new tt(u,h)}}function bI(t,e,n,s,u,h,g){let y=t.indices,b=t.vertices,w=[];for(let D=s;D<s+u;D+=3){let I=e[n[D+0]+h],S=e[n[D+1]+h],P=e[n[D+2]+h],k=Math.min(I.x,S.x,P.x),L=Math.max(I.x,S.x,P.x),B=Math.min(I.y,S.y,P.y),V=Math.max(I.y,S.y,P.y);w.length=0,t.grid.query(new tt(k,B),new tt(L,V),w);for(let W=0;W<w.length;W++){let K=w[W];if(ix(b[y[3*K+0]],b[y[3*K+1]],b[y[3*K+2]],I,S,P,g))return!0}}return!1}function xI(t,e,n,s){if(!t||!n)return!1;let u=t.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(n.vertices.length<t.vertices.length)return xI(n,s,t,e);let h=e.canonical,g=s.canonical,y=Math.pow(2,g.z-h.z);u=t.vertices.map(b=>new tt((b.x+h.x*nt)*y-g.x*nt,(b.y+h.y*nt)*y-g.y*nt))}return bI(n,u,t.indices,0,t.indices.length,0,0)}O_.VectorTileLayer=mI;class wI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function EI(t,e,n,s){let u=0,h=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(n[g]<t[g]||n[g]>e[g])return null}else{let y=1/s[g],b=(t[g]-n[g])*y,w=(e[g]-n[g])*y;if(b>w){let D=b;b=w,w=D}if(b>u&&(u=b),w<h&&(h=w),u>h)return null}return u}function TI(t,e,n,s,u,h,g,y,b,w,D){let I=s-t,S=u-e,P=h-n,k=g-t,L=y-e,B=b-n,V=D[1]*B-D[2]*L,W=D[2]*k-D[0]*B,K=D[0]*L-D[1]*k,Y=I*V+S*W+P*K;if(Math.abs(Y)<1e-15)return null;let se=1/Y,ee=w[0]-t,le=w[1]-e,de=w[2]-n,_e=(ee*V+le*W+de*K)*se;if(_e<0||_e>1)return null;let Ie=le*P-de*S,ve=de*I-ee*P,Me=ee*S-le*I,Se=(D[0]*Ie+D[1]*ve+D[2]*Me)*se;return Se<0||_e+Se>1?null:(k*Ie+L*ve+B*Me)*se}function DI(t,e,n){return(t-e)/(n-e)}function II(t,e,n,s,u,h,g,y,b){let w=1<<n,D=h-s,I=g-u,S=(t+1)/w*D+s,P=(e+0)/w*I+u,k=(e+1)/w*I+u;y[0]=(t+0)/w*D+s,y[1]=P,b[0]=S,b[1]=k}class CI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(h){let g=Math.ceil(Math.log2(h.dim/8)),y=[],b=Math.ceil(Math.pow(2,g)),w=1/b,D=(P,k,L,B,V)=>{let W=B?1:0,K=(P+1)*L-W,Y=k*L,se=(k+1)*L-W;V[0]=P*L,V[1]=Y,V[2]=K,V[3]=se},I=new wI(b),S=[];for(let P=0;P<b*b;P++){D(P%b,Math.floor(P/b),w,!1,S);let k=ql(S[0],S[1],h),L=ql(S[2],S[1],h),B=ql(S[2],S[3],h),V=ql(S[0],S[3],h);I.minimums.push(Math.min(k,L,B,V)),I.maximums.push(Math.max(k,L,B,V)),I.leaves.push(1)}for(y.push(I),b/=2;b>=1;b/=2){let P=y[y.length-1];I=new wI(b);for(let k=0;k<b*b;k++){D(k%b,Math.floor(k/b),2,!0,S);let L=P.getElevation(S[0],S[1]),B=P.getElevation(S[2],S[1]),V=P.getElevation(S[2],S[3]),W=P.getElevation(S[0],S[3]),K=P.isLeaf(S[0],S[1]),Y=P.isLeaf(S[2],S[1]),se=P.isLeaf(S[2],S[3]),ee=P.isLeaf(S[0],S[3]),le=Math.min(L.min,B.min,V.min,W.min),de=Math.max(L.max,B.max,V.max,W.max),_e=K&&Y&&se&&ee;I.maximums.push(de),I.minimums.push(le),I.leaves.push(de-le<=5&&_e?1:0)}y.push(I)}return y}(this.dem),s=n.length-1,u=n[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,u,h,g,y=1){return EI([e,n,-100],[s,u,this.maximums[0]*y],h,g)}raycast(e,n,s,u,h,g,y=1){if(!this.nodeCount)return null;let b=this.raycastRoot(e,n,s,u,h,g,y);if(b==null)return null;let w=[],D=[],I=[],S=[],P=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;P.length>0;){let{idx:k,t:L,nodex:B,nodey:V,depth:W}=P.pop();if(this.leaves[k]){II(B,V,W,e,n,s,u,I,S);let Y=1<<W,se=(B+0)/Y,ee=(B+1)/Y,le=(V+0)/Y,de=(V+1)/Y,_e=ql(se,le,this.dem)*y,Ie=ql(ee,le,this.dem)*y,ve=ql(ee,de,this.dem)*y,Me=ql(se,de,this.dem)*y,Se=TI(I[0],I[1],_e,S[0],I[1],Ie,S[0],S[1],ve,h,g),Ce=TI(S[0],S[1],ve,I[0],S[1],Me,I[0],I[1],_e,h,g),ze=Math.min(Se!==null?Se:Number.MAX_VALUE,Ce!==null?Ce:Number.MAX_VALUE);if(ze!==Number.MAX_VALUE)return ze;{let Le=r.Q.scaleAndAdd([],h,g,L);if(SI(_e,Ie,Me,ve,DI(Le[0],I[0],S[0]),DI(Le[1],I[1],S[1]))>=Le[2])return L}continue}let K=0;for(let Y=0;Y<this._siblingOffset.length;Y++){II((B<<1)+this._siblingOffset[Y][0],(V<<1)+this._siblingOffset[Y][1],W+1,e,n,s,u,I,S),I[2]=-100,S[2]=this.maximums[this.childOffsets[k]+Y]*y;let se=EI(I,S,h,g);if(se!=null){let ee=se;w[Y]=ee;let le=!1;for(let de=0;de<K&&!le;de++)ee>=w[D[de]]&&(D.splice(de,0,Y),le=!0);le||(D[K]=Y),K++}}for(let Y=0;Y<K;Y++){let se=D[Y];P.push({idx:this.childOffsets[k]+se,t:w[se],nodex:(B<<1)+this._siblingOffset[se][0],nodey:(V<<1)+this._siblingOffset[se][1],depth:W+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,u,h){if(e[u].isLeaf(n,s)===1)return;this.childOffsets[h]||(this.childOffsets[h]=this.nodeCount);let g=u-1,y=e[g],b=0,w=0;for(let D=0;D<this._siblingOffset.length;D++){let I=2*n+this._siblingOffset[D][0],S=2*s+this._siblingOffset[D][1],P=y.getElevation(I,S),k=y.isLeaf(I,S),L=this._addNode(P.min,P.max,k);k&&(b|=1<<D),w||(w=L)}for(let D=0;D<this._siblingOffset.length;D++)b&1<<D||this._construct(e,2*n+this._siblingOffset[D][0],2*s+this._siblingOffset[D][1],g,w+D)}}function SI(t,e,n,s,u,h){return sn(sn(t,n,h),sn(e,s,h),u)}function ql(t,e,n){let s=n.dim,u=hn(t*s-.5,0,s-1),h=hn(e*s-.5,0,s-1),g=Math.floor(u),y=Math.floor(h),b=Math.min(g+1,s-1),w=Math.min(y+1,s-1);return SI(n.get(g,y),n.get(b,y),n.get(g,w),n.get(b,w),u-g,h-y)}let MF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function AF(t,e,n){return(256*t*256+256*e+n)/10-1e4}function PF(t,e,n){return 256*t+e+n/256-32768}class z_{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Ii(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let h=this.dim=n.height-2,g=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<h;b++)g[this._idx(-1,b)]=g[this._idx(0,b)],g[this._idx(h,b)]=g[this._idx(h-1,b)],g[this._idx(b,-1)]=g[this._idx(b,0)],g[this._idx(b,h)]=g[this._idx(b,h-1)];g[this._idx(-1,-1)]=g[this._idx(0,0)],g[this._idx(h,-1)]=g[this._idx(h-1,0)],g[this._idx(-1,h)]=g[this._idx(0,h-1)],g[this._idx(h,h)]=g[this._idx(h-1,h-1)]}let y=s==="terrarium"?PF:AF;for(let b=0;b<g.length;++b){let w=4*b;this.floatView[b]=y(this.pixels[w],this.pixels[w+1],this.pixels[w+2])}this._timestamp=ns.now()}_buildQuadTree(){this._tree=new CI(this)}get(e,n,s=!1){s&&(e=hn(e,-1,this.dim),n=hn(n,-1,this.dim));let u=this._idx(e,n);return this.floatView[u]}set(e,n,s){let u=this._idx(e,n),h=this.floatView[u];return this.floatView[u]=s,s-h}static getUnpackVector(e){return MF[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let s=[0,0,0,0],u=z_.getUnpackVector(n),h=Math.floor((e+u[3])/u[2]);return s[2]=h%256,h=Math.floor(h/256),s[1]=h%256,h=Math.floor(h/256),s[0]=h,s}getPixels(){return new cI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,h=n*this.dim+this.dim,g=s*this.dim,y=s*this.dim+this.dim;switch(n){case-1:u=h-1;break;case 1:h=u+1}switch(s){case-1:g=y-1;break;case 1:y=g+1}let b=-n*this.dim,w=-s*this.dim;for(let D=g;D<y;D++)for(let I=u;I<h;I++){let S=4*this._idx(I,D),P=4*this._idx(I+b,D+w);this.pixels[S+0]=e.pixels[P+0],this.pixels[S+1]=e.pixels[P+1],this.pixels[S+2]=e.pixels[P+2],this.pixels[S+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ht(z_,"DEMData"),ht(CI,"DemMinMaxQuadTree",{omit:["dem"]});class vh{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){let u=s||e.findDEMTileFor(n);if(!u||!u.dem)return;let h=u.dem,g=u.tileID,y=1<<n.canonical.z-g.canonical.z;return new vh(u,h.dim/nt/y,[(n.canonical.x/y-g.canonical.x)*h.dim,(n.canonical.y/y-g.canonical.y)*h.dim])}tileCoordToPixel(e,n){let s=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),h=Math.floor(s);return new tt(u,h)}getElevationAt(e,n,s,u){let h=e*this._scale+this._offset[0],g=n*this._scale+this._offset[1],y=Math.floor(h),b=Math.floor(g),w=this._dem;return u=!!u,s?sn(sn(w.get(y,b,u),w.get(y,b+1,u),g-b),sn(w.get(y+1,b,u),w.get(y+1,b+1,u),g-b),h-y):w.get(y,b,u)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*to(1,e)*this._dem.stride}}let RF=F_.types,kF=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],OF=["fill-extrusion-flood-light-ground-radius"],FF=Math.pow(2,13),LF=Math.pow(2,15)-1,MI=new tt(0,1),Wl=2147483648;function zp(t,e,n,s,u,h,g,y){t.emplaceBack((e<<1)+g,(n<<1)+h,(Math.floor(s*FF)<<1)+u,Math.round(y))}function B_(t,e,n,s,u,h){t.emplaceBack(e.x,e.y,(n.x<<1)+s,(n.y<<1)+u,h)}function Bp(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class AI{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class PI{constructor(){this.centroidXY=new tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class RI{constructor(){this.acc=new tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,s){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===nt)&&n.x===s.x)!=((n.y===0||n.y===nt)&&n.y===s.y)&&this.processBorderOverlap(n,s),u&&this.checkBorderIntersection(n,s)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,sn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>nt!=e.x>nt&&this.addBorderIntersection(1,sn(n.y,e.y,(nt-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,sn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>nt!=e.y>nt&&this.addBorderIntersection(3,sn(n.x,e.x,(nt-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let s=e.x===0?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{let s=e.y===0?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new tt(0,0):new tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function kI(t,e){let n=t.add(e)._unit(),s=hn(t.x*n.x+t.y*n.y,-1,1);var u,h,g;return u=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(u)))/4*LF*((h=t).x*(g=e).y-h.y*g.x<0?-1:1)}let NF=[t=>t.x<0,t=>t.x>nt,t=>t.y<0,t=>t.y>nt];function zF(t,e,n,s){let u=[4];if(s===0)return u;n._mult(s);let h=t.sub(n),g=e.sub(n),y=[t,e,h,g];for(let b=0;b<4;b++)for(let w of y)if(NF[b](w)){u.push(b);break}return u}class OI{constructor(e){this.vertexArray=new $r,this.indexArray=new ur,this.programConfigurations=new Vl(e.layers,e.zoom,n=>OF.includes(n)),this._segments=new Vi,this.hiddenByLandmarkVertexArray=new jb,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Vi}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,s,u=!1){let h=e.length;if(h>2){let g=Math.max(0,this._segments.get().length-1),y=this._segments._prepareSegment(4*h,this.vertexArray.length,2*this._segmentToGroundQuads[g].length),b;g!==this._segments.get().length-1&&(g++,this._segmentToGroundQuads[g]=[],this._segmentToRegionTriCounts[g]=[0,0,0,0,0]);{let w=e[0],D=e[1];b=kI(w.sub(e[h-1])._perp()._unit(),D.sub(w)._perp()._unit())}for(let w=0;w<h;w++){let D=w===h-1?0:w+1,I=e[w],S=e[D],P=e[D===h-1?0:D+1],k=S.sub(I)._perp()._unit(),L=kI(k,P.sub(S)._perp()._unit()),B=b,V=L;if(wx(I,S,n)||u&&NI(I,n)&&NI(S,n)){b=L;continue}let W=y.vertexLength;B_(this.vertexArray,I,S,1,1,B),B_(this.vertexArray,I,S,1,0,B),B_(this.vertexArray,I,S,0,1,V),B_(this.vertexArray,I,S,0,0,V),y.vertexLength+=4;let K=zF(I,S,k,s);for(let Y of K)this._segmentToGroundQuads[g].push({id:W,region:Y}),this._segmentToRegionTriCounts[g][Y]+=2,y.primitiveLength+=2;b=L}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let s=0;s<n;s++)this._segmentToGroundQuads[s].sort((u,h)=>u.region-h.region);for(let s=0;s<n;s++){let u=this._segmentToGroundQuads[s],h=e[s],g=this._segmentToRegionTriCounts[s];g.reduce((b,w)=>b+w,0);let y=0;for(let b=0;b<=4;b++){let w=g[b];if(w!==0){let D=this.regionSegments[b];D||(D=this.regionSegments[b]=new Vi);let I={vertexOffset:h.vertexOffset,primitiveOffset:h.primitiveOffset+y,vertexLength:h.vertexLength,primitiveLength:w};D.get().push(I)}y+=w}for(let b=0;b<u.length;b++){let w=u[b].id;this.indexArray.emplaceBack(w,w+1,w+3),this.indexArray.emplaceBack(w,w+3,w+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,s,u,h,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,s,u,h,g)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,gF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,s,u,h,g){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,s,u,h,g)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let s=e.flags&Wl?1:0;for(let u=e.groundVertexArrayOffset;u<n;++u)this.hiddenByLandmarkVertexArray.emplace(u,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,yF.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class V_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ur,this.footprintVertices=new Dr,this.footprintSegments=[],this.layoutVertexArray=new Ir,this.centroidVertexArray=new DD,this.indexArray=new ur,this.programConfigurations=new Vl(e.layers,e.zoom,n=>kF.includes(n)),this.segments=new Vi,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new OI(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,s,u){this.features=[],this.hasPattern=yx("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=b_(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:h,id:g,index:y,sourceLayerIndex:b}of e){let w=this.layers[0]._featureFilter.needGeometry,D=Gl(h,w);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),D,s))continue;let I={id:g,sourceLayerIndex:b,index:y,geometry:w?D.geometry:Ya(h,s,u),properties:h.properties,type:h.type,patterns:{}},S=this.layoutVertexArray.length;this.hasPattern?this.features.push(vx("fill-extrusion",this.layers,I,this.zoom,n)):this.addFeature(I,I.geometry,y,s,{},n.availableImages,u,n.brightness),n.featureIndex.insert(h,I.geometry,y,b,this.index,S)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,s,u,h,g){for(let y of this.features){let{geometry:b}=y;this.addFeature(y,b,y.index,n,s,u,h,g)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,s,u,h){let g=Object.keys(e).length!==0;if(g&&!this.stateDependentLayers.length)return;let y=g?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,y,s,u,h),this.groundEffect.update(e,n,y,s,u,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bF),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,vF.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,_F.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,u,h,g,y,b){let w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,D=[new tt(0,0),new tt(nt,nt)],I=y.projection,S=I.name==="globe",P=RF[e.type]==="Polygon",k=new RI;k.centroidDataIndex=this.centroidData.length;let L=new PI,B=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);L.height=V,L.vertexArrayOffset=this.layoutVertexArray.length,L.groundVertexArrayOffset=this.groundEffect.vertexArray.length,S&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Wo);let W=_x(n,500);for(let de=W.length-1;de>=0;de--){let _e=W[de];(_e.length===0||(K=_e[0]).every(Ie=>Ie.x<=0)||K.every(Ie=>Ie.x>=nt)||K.every(Ie=>Ie.y<=0)||K.every(Ie=>Ie.y>=nt))&&W.splice(de,1)}var K;let Y;if(S)Y=jI(W,D,u);else{Y=[];for(let de of W)Y.push({polygon:de,bounds:D})}let se=P?this.edgeRadius:0,ee=se>0&&this.zoom<17,le=(de,_e)=>{if(de.length===0)return!1;let Ie=de[de.length-1];return _e.x===Ie.x&&_e.y===Ie.y};for(let{polygon:de,bounds:_e}of Y){let Ie=0,ve=0;for(let ze of de)P&&!ze[0].equals(ze[ze.length-1])&&ze.push(ze[0]),ve+=P?ze.length-1:ze.length;let Me=this.segments.prepareSegment((P?5:4)*ve,this.layoutVertexArray,this.indexArray);L.footprintSegIdx<0&&(L.footprintSegIdx=this.footprintSegments.length),L.polygonSegIdx<0&&(L.polygonSegIdx=this.polygonSegments.length);let Se={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ce=new AI;if(Ce.vertexOffset=this.footprintVertices.length,Ce.indexOffset=3*this.footprintIndices.length,Ce.ringIndices=[],P){let ze=[],Le=[];Ie=Me.vertexLength;for(let je=0;je<de.length;je++){let Pe=de[je];Pe.length&&je!==0&&Le.push(ze.length/2);let mt=[],ct,He;ct=Pe[1].sub(Pe[0])._perp()._unit(),Ce.ringIndices.push(Pe.length-1);for(let Rt=1;Rt<Pe.length;Rt++){let bt=Pe[Rt],gt=Pe[Rt===Pe.length-1?1:Rt+1],qe=bt.clone();if(se){He=gt.sub(bt)._perp()._unit();let Dt=ct.add(He)._unit(),Jt=se*Math.min(4,1/(ct.x*Dt.x+ct.y*Dt.y));qe.x+=Jt*Dt.x,qe.y+=Jt*Dt.y,qe.x=Math.round(qe.x),qe.y=Math.round(qe.y),ct=He}!B||se!==0&&!ee||le(mt,qe)||mt.push(qe),zp(this.layoutVertexArray,qe.x,qe.y,0,0,1,1,0),Me.vertexLength++,this.footprintVertices.emplaceBack(bt.x,bt.y),ze.push(bt.x,bt.y),S&&Bp(this.layoutVertexExtArray,I.projectTilePoint(qe.x,qe.y,u),I.upVector(u,qe.x,qe.y))}B&&(se===0||ee)&&(mt.length!==0&&le(mt,mt[0])&&mt.pop(),this.groundEffect.addData(mt,_e,w))}let Ge=k_(ze,Le);for(let je=0;je<Ge.length;je+=3)this.footprintIndices.emplaceBack(Ce.vertexOffset+Ge[je+0],Ce.vertexOffset+Ge[je+1],Ce.vertexOffset+Ge[je+2]),this.indexArray.emplaceBack(Ie+Ge[je],Ie+Ge[je+2],Ie+Ge[je+1]),Me.primitiveLength++;Ce.indexCount+=Ge.length,Ce.vertexCount+=this.footprintVertices.length-Ce.vertexOffset}for(let ze=0;ze<de.length;ze++){let Le=de[ze];k.startRing(L,Le[0]);let Ge=Le.length>4&&zI(Le[Le.length-2],Le[0],Le[1]),je=se?BF(Le[Le.length-2],Le[0],Le[1],se):0,Pe=[],mt,ct,He;ct=Le[1].sub(Le[0])._perp()._unit();let Rt=!0;for(let bt=1,gt=0;bt<Le.length;bt++){let qe=Le[bt-1],Dt=Le[bt],Jt=Le[bt===Le.length-1?1:bt+1];if(k.appendEdge(L,Dt,qe),wx(Dt,qe,_e)){se&&(ct=Jt.sub(Dt)._perp()._unit(),Rt=!Rt);continue}let Bt=Dt.sub(qe)._perp(),rn=Bt.x/(Math.abs(Bt.x)+Math.abs(Bt.y)),en=Bt.y>0?1:0,un=qe.dist(Dt);if(gt+un>32768&&(gt=0),se){He=Jt.sub(Dt)._perp()._unit();let In=LI(qe,Dt,Jt,FI(ct,He),se);isNaN(In)&&(In=0);let vn=Dt.sub(qe)._unit();qe=qe.add(vn.mult(je))._round(),Dt=Dt.add(vn.mult(-In))._round(),je=In,ct=He,B&&this.zoom>=17&&(le(Pe,qe)||Pe.push(qe),le(Pe,Dt)||Pe.push(Dt))}let Lt=Me.vertexLength,Yn=Le.length>4&&zI(qe,Dt,Jt),$n=BI(gt,Ge,Rt);if(zp(this.layoutVertexArray,qe.x,qe.y,rn,en,0,0,$n),zp(this.layoutVertexArray,qe.x,qe.y,rn,en,0,1,$n),gt+=un,$n=BI(gt,Yn,!Rt),Ge=Yn,zp(this.layoutVertexArray,Dt.x,Dt.y,rn,en,0,0,$n),zp(this.layoutVertexArray,Dt.x,Dt.y,rn,en,0,1,$n),Me.vertexLength+=4,this.indexArray.emplaceBack(Lt+0,Lt+1,Lt+2),this.indexArray.emplaceBack(Lt+1,Lt+3,Lt+2),Me.primitiveLength+=2,se){let In=Ie+(bt===1?Le.length-2:bt-2),vn=bt===1?Ie:In+1;if(this.indexArray.emplaceBack(Lt+1,In,Lt+3),this.indexArray.emplaceBack(In,vn,Lt+3),Me.primitiveLength+=2,mt===void 0&&(mt=Lt),!wx(Jt,Le[bt],_e)){let Cn=bt===Le.length-1?mt:Me.vertexLength;this.indexArray.emplaceBack(Lt+2,Lt+3,Cn),this.indexArray.emplaceBack(Lt+3,Cn+1,Cn),this.indexArray.emplaceBack(Lt+3,vn,Cn+1),Me.primitiveLength+=3}Rt=!Rt}if(S){let In=this.layoutVertexExtArray,vn=I.projectTilePoint(qe.x,qe.y,u),Cn=I.projectTilePoint(Dt.x,Dt.y,u),fi=I.upVector(u,qe.x,qe.y),ri=I.upVector(u,Dt.x,Dt.y);Bp(In,vn,fi),Bp(In,vn,fi),Bp(In,Cn,ri),Bp(In,Cn,ri)}}P&&(Ie+=Le.length-1),B&&se&&this.zoom>=17&&(Pe.length!==0&&le(Pe,Pe[0])&&Pe.pop(),this.groundEffect.addData(Pe,_e,w,se>0))}this.footprintSegments.push(Ce),Se.triangleCount=this.indexArray.length-Se.triangleArrayOffset,this.polygonSegments.push(Se),++L.footprintSegLen,++L.polygonSegLen}if(L.vertexCount=this.layoutVertexArray.length-L.vertexArrayOffset,L.groundVertexCount=this.groundEffect.vertexArray.length-L.groundVertexArrayOffset,L.vertexCount!==0){if(L.centroidXY=k.borders?MI:this.encodeCentroid(k,L),this.centroidData.push(L),k.borders){this.featuresOnBorder.push(k);let de=this.featuresOnBorder.length-1;for(let _e=0;_e<k.borders.length;_e++)k.borders[_e][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[_e].push(de)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,g,u,b),this.groundEffect.addPaintPropertiesData(e,s,h,g,u,b),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){let e=[];for(let y=0;y<this.centroidData.length;y++){let b=this.centroidData[y],w=+(b.min.y+b.max.y>nt),D=2*w+(+(b.min.x+b.max.x>nt)^w);for(let I=0;I<b.polygonSegLen;I++){let S=b.polygonSegIdx+I;e.push({centroidIdx:y,subtile:D,polygonSegmentIdx:S,triangleSegmentIdx:this.polygonSegments[S].triangleSegIdx})}}let n=new ur;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let s=0,u=0,h=0;for(let y of e){if(y.triangleSegmentIdx!==s)break;h++}let g=e.length;for(;u!==e.length;){s=e[u].triangleSegmentIdx;let y=0,b=u,w=u;for(let D=b;D<h&&e[D].subtile===y;D++)w++;for(;b!==h;){let D=e[b];y=D.subtile;let I=this.centroidData[D.centroidIdx].min.clone(),S=this.centroidData[D.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let k=b;k<w;k++){let L=e[k],B=this.polygonSegments[L.polygonSegmentIdx],V=this.centroidData[L.centroidIdx].min,W=this.centroidData[L.centroidIdx].max,K=this.indexArray.uint16;for(let Y=B.triangleArrayOffset;Y<B.triangleArrayOffset+B.triangleCount;Y++)n.emplaceBack(K[3*Y],K[3*Y+1],K[3*Y+2]);P.primitiveLength+=B.triangleCount,I.x=Math.min(I.x,V.x),I.y=Math.min(I.y,V.y),S.x=Math.max(S.x,W.x),S.y=Math.max(S.y,W.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:I,max:S}),b=w;for(let k=b;k<h&&e[k].subtile===e[b].subtile;k++)w++}u=h;for(let D=u;D<g&&e[D].triangleSegmentIdx===e[u].triangleSegmentIdx;D++)h++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,s){let u=0,h=0,g=1<<e.canonical.z;if(n){let L=n.getMinMaxForTile(e);L&&(u=L.min,h=L.max)}h+=this.maxHeight;let y=e.toUnwrapped(),b,w=[y.canonical.x/g+y.wrap,y.canonical.y/g],D=[(y.canonical.x+1)/g+y.wrap,(y.canonical.y+1)/g],I=new Vi,S=(L,B,V)=>[L[0]*(1-V[0])+B[0]*V[0],L[1]*(1-V[1])+B[1]*V[1]],P=[],k=[];for(let L of this.triangleSubSegments){P[0]=L.min.x/nt,P[1]=L.min.y/nt,k[0]=L.max.x/nt,k[1]=L.max.y/nt;let B=S(w,D,P),V=S(w,D,k);if(new gi([B[0],B[1],u],[V[0],V[1],h]).intersectsPrecise(s)===0){b&&(I.segments.push(b),b=void 0);continue}let W=L.segment;b&&b.vertexOffset!==W.vertexOffset&&(I.segments.push(b),b=void 0),b?(b.vertexLength+=W.vertexLength,b.primitiveLength+=W.primitiveLength):b={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&I.segments.push(b),I}encodeCentroid(e,n){let s=e.centroid(),u=n.span(),h=Math.min(7,Math.round(u.x*this.tileToMeter/10)),g=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new tt(hn(s.x,1,nt-1)<<3|h,hn(s.y,1,nt-1)<<3|g)}encodeBorderCentroid(e){if(!e.borders)return new tt(0,0);let n=e.borders,s=Number.MAX_VALUE;if(n[0][0]!==s||n[1][0]!==s){let u=n[0][0]!==s?0:1;return new tt(6|(n[0][0]!==s?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{let u=n[2][0]!==s?2:3;return new tt((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==s?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Wl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,u=e.flags&Wl?MI:e.centroidXY,h=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||h!==u.x){for(let g=n;g<s;++g)this.centroidVertexArray.emplace(g,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(h,g){if(h.length!==g.length)return!1;for(let y=0;y<h.length;y++)if(h[y].sourceId!==g[y].sourceId||!_I(h[y],g[y]))return!1;return!0}(this.activeReplacements,s))return;if(this.activeReplacements=s,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let h of this.centroidData)h.flags&=2147483647;let u=[];for(let h of this.activeReplacements){let g=Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z);for(let y of this.centroidData)if(!(y.flags&Wl||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let b=0;b<y.footprintSegLen;b++){let w=this.footprintSegments[y.footprintSegIdx+b];if(u.length=0,VF(this.footprintVertices,w.vertexOffset,w.vertexCount,h.footprintTileId.canonical,e.canonical,u),bI(h.footprint,u,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-g)){y.flags|=Wl;break}}}for(let h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,s){let u=!1;for(let h=0;h<s.footprintSegLen;h++){let g=this.footprintSegments[s.footprintSegIdx+h],y=0;for(let b of g.ringIndices){for(let w=y,D=b+y-1;w<b+y;D=w++){let I=this.footprintVertices.int16[2*(w+g.vertexOffset)+0],S=this.footprintVertices.int16[2*(w+g.vertexOffset)+1],P=this.footprintVertices.int16[2*(D+g.vertexOffset)+1];S>n!=P>n&&e<(this.footprintVertices.int16[2*(D+g.vertexOffset)+0]-I)*(n-S)/(P-S)+I&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,n){let s=Number.NEGATIVE_INFINITY,u=!0,h=4*(e+nt)*nt+(n+nt);if(this.partLookup.hasOwnProperty(h)){let g=this.partLookup[h];return g?{height:g.height,hidden:!!(g.flags&Wl)}:void 0}for(let g of this.centroidData)e>g.max.x||g.min.x>e||n>g.max.y||g.min.y>n||this.footprintContainsPoint(e,n,g)&&g&&g.height>s&&(s=g.height,this.partLookup[h]=g,u=!!(g.flags&Wl));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.partLookup[h]=void 0}}function FI(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function BF(t,e,n,s){let u=e.sub(t)._perp()._unit(),h=n.sub(e)._perp()._unit();return LI(t,e,n,FI(u,h),s)}function LI(t,e,n,s,u){let h=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,u*h/s)}function wx(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function NI(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function zI(t,e,n){if(t.x<0||t.x>=nt||e.x<0||e.x>=nt||n.x<0||n.x>=nt)return!1;let s=n.sub(e),u=s.perp(),h=t.sub(e);return(s.x*h.x+s.y*h.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(h.x*h.x+h.y*h.y))>-.866&&u.x*h.x+u.y*h.y<0}function BI(t,e,n){let s=e?2|t:-3&t;return n?1|s:-2&s}function VI(){let t=Math.PI/32,e=Math.tan(t),n=ph;return n*Math.sqrt(1+2*e*e)-n}function jI(t,e,n){let s=1<<n.z,u=Io(n.x/s),h=Io((n.x+1)/s),g=Cr(n.y/s),y=Cr((n.y+1)/s);return function(b,w,D,I,S=0,P){let k=[];if(!b.length||!D||!I)return k;let L=(ee,le)=>{for(let de of ee)k.push({polygon:de,bounds:le})},B=Math.ceil(Math.log2(D)),V=Math.ceil(Math.log2(I)),W=B-V,K=[];for(let ee=0;ee<Math.abs(W);ee++)K.push(W>0?0:1);for(let ee=0;ee<Math.min(B,V);ee++)K.push(0),K.push(1);let Y=b;if(Y=L_(Y,w[0].y-S,w[1].y+S,1),Y=L_(Y,w[0].x-S,w[1].x+S,0),!Y.length)return k;let se=[];for(K.length?se.push({polygons:Y,bounds:w,depth:0}):L(Y,w);se.length;){let ee=se.pop(),le=ee.depth,de=K[le],_e=ee.bounds[0],Ie=ee.bounds[1],ve=de===0?_e.x:_e.y,Me=de===0?Ie.x:Ie.y,Se=P?P(de,ve,Me):.5*(ve+Me),Ce=L_(ee.polygons,ve-S,Se+S,de),ze=L_(ee.polygons,Se-S,Me+S,de);if(Ce.length){let Le=[_e,new tt(de===0?Se:Ie.x,de===1?Se:Ie.y)];K.length>le+1?se.push({polygons:Ce,bounds:Le,depth:le+1}):L(Ce,Le)}if(ze.length){let Le=[new tt(de===0?Se:_e.x,de===1?Se:_e.y),Ie];K.length>le+1?se.push({polygons:ze,bounds:Le,depth:le+1}):L(ze,Le)}}return k}(t,e,Math.ceil((h-u)/11.25),Math.ceil((g-y)/11.25),1,(b,w,D)=>{if(b===0)return .5*(w+D);{let I=Cr((n.y+w/nt)/s);return(Qa(.5*(Cr((n.y+D/nt)/s)+I))*s-n.y)*nt}})}function VF(t,e,n,s,u,h){let g=Math.pow(2,s.z-u.z);for(let y=0;y<n;y++){let b=t.int16[2*(y+e)+0],w=t.int16[2*(y+e)+1];b=(b+u.x*nt)*g-s.x*nt,w=(w+u.y*nt)*g-s.y*nt,h.push(new tt(b,w))}}ht(V_,"FillExtrusionBucket",{omit:["layers","features"]}),ht(PI,"PartData"),ht(AI,"FootprintSegment"),ht(RI,"BorderCentroidData"),ht(OI,"GroundEffect");let jF=new ge({visibility:new he(ie["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new he(ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var UF={paint:new ge({"fill-extrusion-opacity":new he(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ye(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new he(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new he(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ye(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ye(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ye(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new he(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new he(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new he(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new he(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new he(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new he(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new he(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new he(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new ye(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new ye(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new he(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new he(ie["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new he(ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new he(ie["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new he(ie["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:jF};class bh extends tt{constructor(e,n,s){super(e,n),this.z=s}}function Vp(t,e){return t.x*e.x+t.y*e.y}function UI(t,e){if(t.length===1){let n=0,s=e[n++],u;for(;!u||s.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){let h=e[n],g=t[0],y=u.sub(s),b=h.sub(s),w=g.sub(s),D=Vp(y,y),I=Vp(y,b),S=Vp(b,b),P=Vp(w,y),k=Vp(w,b),L=D*S-I*I,B=(S*P-I*k)/L,V=(D*k-I*P)/L,W=s.z*(1-B-V)+u.z*B+h.z*V;if(isFinite(W))return W}return 1/0}{let n=1/0;for(let s of e)n=Math.min(n,s.z);return n}}function GI(t,e,n,s,u,h,g,y){let b=g*u.getElevationAt(t,e,!0,!0),w=h[0]!==0,D=w?h[1]===0?g*(h[0]/7-450):g*function(I,S,P){let k=Math.floor(S[0]/8),L=Math.floor(S[1]/8),B=10*(S[0]-8*k),V=10*(S[1]-8*L),W=I.getElevationAt(k,L,!0,!0),K=I.getMeterToDEM(P),Y=Math.floor(.5*(B*K-1)),se=Math.floor(.5*(V*K-1)),ee=I.tileCoordToPixel(k,L),le=2*Y+1,de=2*se+1,_e=function(ze,Le,Ge,je,Pe){return[ze.getElevationAtPixel(Le,Ge,!0),ze.getElevationAtPixel(Le+Pe,Ge,!0),ze.getElevationAtPixel(Le,Ge+Pe,!0),ze.getElevationAtPixel(Le+je,Ge+Pe,!0)]}(I,ee.x-Y,ee.y-se,le,de),Ie=Math.abs(_e[0]-_e[1]),ve=Math.abs(_e[2]-_e[3]),Me=Math.abs(_e[0]-_e[2])+Math.abs(_e[1]-_e[3]),Se=Math.min(.25,.5*K*(Ie+ve)/le),Ce=Math.min(.25,.5*K*Me/de);return W+Math.max(Se*B,Ce*V)}(u,h,y):b;return{base:b+(n===0)?-1:n,top:w?Math.max(D+s,b+n+2):b+s}}let GF=Qt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:$F}=GF,HF=Qt([{name:"a_packed",components:4,type:"Float32"}]),{members:qF}=HF,WF=Qt([{name:"a_pattern_data",components:2,type:"Float32"}]),{members:ZF}=WF;class $I{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Hl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let s=this.getKey(e,n);return this.positions[s]}trim(){let e=this.width,n=this.height=Of(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){let u=[],h=e.length%2==1?-e[e.length-1]*s:0,g=e[0]*s,y=!0;u.push({left:h,right:g,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let w=1;w<e.length;w++){y=!y;let D=e[w];h=b*s,b+=D,g=b*s,u.push({left:h,right:g,isDash:y,zeroLength:D===0})}return u}addRoundDash(e,n,s){let u=n/2;for(let h=-s;h<=s;h++){let g=this.width*(this.nextRow+s+h),y=0,b=e[y];for(let w=0;w<this.width;w++){w/b.right>1&&(b=e[++y]);let D=Math.abs(w-b.left),I=Math.abs(w-b.right),S=Math.min(D,I),P,k=h/s*(u+1);if(b.isDash){let L=u-Math.abs(k);P=Math.sqrt(S*S+L*L)}else P=u-Math.sqrt(S*S+k*k);this.image.data[g+w]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){let w=e[b],D=e[b+1];w.zeroLength?e.splice(b,1):D&&D.isDash===w.isDash&&(D.left=w.left,e.splice(b,1))}let s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);let h=this.width*this.nextRow,g=0,y=e[g];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++g]);let w=Math.abs(b-y.left),D=Math.abs(b-y.right),I=Math.min(w,D);this.image.data[h+b]=Math.max(0,Math.min(255,(y.isDash?I:-I)+n+128))}}addDash(e,n){let s=this.getKey(e,n);if(this.positions[s])return this.positions[s];let u=n==="round",h=u?7:0,g=2*h+1;if(this.nextRow+g>this.height)return Ii("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let D=0;D<e.length;D++)e[D]<0&&(Ii("Negative value is found in line dasharray, replacing values with 0"),e[D]=0),y+=e[D];if(y!==0){let D=this.width/y,I=this.getDashRanges(e,this.width,D);u?this.addRoundDash(I,D,h):this.addRegularDash(I,n==="square"?.5*D:0)}let b=this.nextRow+h;this.nextRow+=g;let w={tl:[b,h],br:[y,0]};return this.positions[s]=w,w}}ht($I,"LineAtlas");let QF=F_.types,YF=Math.cos(Math.PI/180*37.5),XF=Math.cos(Math.PI/180*5);class Ex{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new kr,this.layoutVertexArray2=new cr,this.patternVertexArray=new yr,this.indexArray=new ur,this.programConfigurations=new Vl(e.layers,e.zoom),this.segments=new Vi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){this.hasPattern=yx("line",this.layers,n);let h=this.layers[0].layout.get("line-sort-key"),g=[];for(let{feature:D,id:I,index:S,sourceLayerIndex:P}of e){let k=this.layers[0]._featureFilter.needGeometry,L=Gl(D,k);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),L,s))continue;let B=h?h.evaluate(L,{},s):void 0,V={id:I,properties:D.properties,type:D.type,sourceLayerIndex:P,index:S,geometry:k?L.geometry:Ya(D,s,u),patterns:{},sortKey:B};g.push(V)}h&&g.sort((D,I)=>D.sortKey-I.sortKey);let{lineAtlas:y,featureIndex:b}=n,w=this.addConstantDashes(y);for(let D of g){let{geometry:I,index:S,sourceLayerIndex:P}=D;if(w&&this.addFeatureDashes(D,y),this.hasPattern){let k=vx("line",this.layers,D,this.zoom,n);this.patternFeatures.push(k)}else this.addFeature(D,I,S,s,y.positions,n.availableImages,n.brightness);b.insert(e[S].feature,I,S,P,this.index)}}addConstantDashes(e){let n=!1;for(let s of this.layers){let u=s.paint.get("line-dasharray").value,h=s.layout.get("line-cap").value;if(u.kind!=="constant"||h.kind!=="constant")n=!0;else{let g=h.value,y=u.value;if(!y)continue;e.addDash(y,g)}}return n}addFeatureDashes(e,n){let s=this.zoom;for(let u of this.layers){let h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(h.kind==="constant"&&g.kind==="constant")continue;let y,b;if(h.kind==="constant"){if(y=h.value,!y)continue}else y=h.evaluate({zoom:s},e);b=g.kind==="constant"?g.value:g.evaluate({zoom:s},e),n.addDash(y,b),e.patterns[u.id]=n.getKey(y,b)}}update(e,n,s,u,h){let g=Object.keys(e).length!==0;g&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,g?this.stateDependentLayers:this.layers,s,u,h)}addFeatures(e,n,s,u,h,g){for(let y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,u,g)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,qF)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,ZF)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$F),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,u,h,g,y){let b=this.layers[0].layout,w=b.get("line-join").evaluate(e,{}),D=b.get("line-cap").evaluate(e,{}),I=b.get("line-miter-limit"),S=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let P of n)this.addLine(P,e,w,D,I,S);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,h,g,u,y)}addLine(e,n,s,u,h,g){this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0;let y=s==="none";if(this.patternJoinNone=this.hasPattern&&y,this.segmentStart=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let W=0;W<e.length-1;W++)this.totalDistance+=e[W].dist(e[W+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let b=QF[n.type]==="Polygon",w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let D=0;for(;D<w-1&&e[D].equals(e[D+1]);)D++;if(w<(b?3:2))return;s==="bevel"&&(h=1.05);let I=this.overscaling<=16?15*nt/(512*this.overscaling):0,S=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray),P,k,L,B,V;this.e1=this.e2=-1,b&&(P=e[w-2],V=e[D].sub(P)._unit()._perp());for(let W=D;W<w;W++){if(L=W===w-1?b?e[D+1]:void 0:e[W+1],L&&e[W].equals(L))continue;V&&(B=V),P&&(k=P),P=e[W],V=L?L.sub(P)._unit()._perp():B,B=B||V;let K=k&&L,Y=K?s:b||y?"butt":u,se=B.x*V.x+B.y*V.y;if(y){let Me=function(Se){if(Se.patternJoinNone){let Ce=Se.segmentPoints.length/2,ze=Se.lineSoFar-Se.segmentStart;for(let Le=0;Le<Ce;++Le){let Ge=Se.segmentPoints[2*Le+1],je=Math.round(Se.segmentPoints[2*Le])+.5+.25*Ge;Se.patternVertexArray.emplaceBack(je,ze),Se.patternVertexArray.emplaceBack(je,ze)}Se.segmentPoints=[],Se.segmentStart=Se.lineSoFar}Se.e1=Se.e2=-1};if(K&&se<XF){this.updateDistance(k,P),this.addCurrentVertex(P,B,1,1,S),Me(this),this.addCurrentVertex(P,V,-1,-1,S);continue}if(k){if(!L){this.updateDistance(k,P),this.addCurrentVertex(P,B,1,1,S),Me(this);continue}Y="miter"}}let ee=B.add(V);ee.x===0&&ee.y===0||ee._unit();let le=ee.x*V.x+ee.y*V.y,de=le!==0?1/le:1/0,_e=2*Math.sqrt(2-2*le),Ie=le<YF&&k&&L,ve=B.x*V.y-B.y*V.x>0;if(Ie&&W>D){let Me=P.dist(k);if(Me>2*I){let Se=P.sub(P.sub(k)._mult(I/Me)._round());this.updateDistance(k,Se),this.addCurrentVertex(Se,B,0,0,S),k=Se}}if(K&&Y==="round"&&(de<g?Y="miter":de<=2&&(Y="fakeround")),Y==="miter"&&de>h&&(Y="bevel"),Y==="bevel"&&(de>2&&(Y="flipbevel"),de<h&&(Y="miter")),k&&this.updateDistance(k,P),Y==="miter")ee._mult(de),this.addCurrentVertex(P,ee,0,0,S);else if(Y==="flipbevel"){if(de>100)ee=V.mult(-1);else{let Me=de*B.add(V).mag()/B.sub(V).mag();ee._perp()._mult(Me*(ve?-1:1))}this.addCurrentVertex(P,ee,0,0,S),this.addCurrentVertex(P,ee.mult(-1),0,0,S)}else if(Y==="bevel"||Y==="fakeround"){let Me=-Math.sqrt(de*de-1),Se=ve?Me:0,Ce=ve?0:Me;if(k&&this.addCurrentVertex(P,B,Se,Ce,S),Y==="fakeround"){let ze=Math.round(180*_e/Math.PI/20);for(let Le=1;Le<ze;Le++){let Ge=Le/ze;if(Ge!==.5){let Pe=Ge-.5;Ge+=Ge*Pe*(Ge-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*Pe*Pe+(.848013+se*(.215638*se-1.06021)))}let je=V.sub(B)._mult(Ge)._add(B)._unit()._mult(ve?-1:1);this.addHalfVertex(P,je.x,je.y,!1,ve,0,S)}}L&&this.addCurrentVertex(P,V,-Se,-Ce,S)}else Y==="butt"?this.addCurrentVertex(P,ee,0,0,S):Y==="square"?(k||this.addCurrentVertex(P,ee,-1,-1,S),this.addCurrentVertex(P,ee,0,0,S),k&&this.addCurrentVertex(P,ee,1,1,S)):Y==="round"&&(k&&(this.addCurrentVertex(P,B,0,0,S),this.addCurrentVertex(P,B,1,1,S,!0)),L&&(this.addCurrentVertex(P,V,-1,-1,S,!0),this.addCurrentVertex(P,V,0,0,S)));if(Ie&&W<w-1){let Me=P.dist(L);if(Me>2*I){let Se=P.add(L.sub(P)._mult(I/Me)._round());this.updateDistance(P,Se),this.addCurrentVertex(Se,V,0,0,S),P=Se}}}}addCurrentVertex(e,n,s,u,h,g=!1){let y=n.y*u-n.x,b=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,g,!1,s,h),this.addHalfVertex(e,y,b,g,!0,-u,h),this.patternJoinNone&&this.segmentPoints.push(this.lineSoFar-this.segmentStart,s)}addHalfVertex({x:e,y:n},s,u,h,g,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(h?1:0),(n<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let w=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),b.primitiveLength++),g?this.e2=w:this.e1=w}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}ht(Ex,"LineBucket",{omit:["layers","patternFeatures"]});let KF=new ge({"line-cap":new ye(ie.layout_line["line-cap"]),"line-join":new ye(ie.layout_line["line-join"]),"line-miter-limit":new he(ie.layout_line["line-miter-limit"]),"line-round-limit":new he(ie.layout_line["line-round-limit"]),"line-sort-key":new ye(ie.layout_line["line-sort-key"]),visibility:new he(ie.layout_line.visibility)});var HI={paint:new ge({"line-opacity":new ye(ie.paint_line["line-opacity"]),"line-color":new ye(ie.paint_line["line-color"]),"line-translate":new he(ie.paint_line["line-translate"]),"line-translate-anchor":new he(ie.paint_line["line-translate-anchor"]),"line-width":new ye(ie.paint_line["line-width"]),"line-gap-width":new ye(ie.paint_line["line-gap-width"]),"line-offset":new ye(ie.paint_line["line-offset"]),"line-blur":new ye(ie.paint_line["line-blur"]),"line-dasharray":new ye(ie.paint_line["line-dasharray"]),"line-pattern":new ye(ie.paint_line["line-pattern"]),"line-gradient":new Ve(ie.paint_line["line-gradient"]),"line-trim-offset":new he(ie.paint_line["line-trim-offset"]),"line-emissive-strength":new he(ie.paint_line["line-emissive-strength"]),"line-border-width":new ye(ie.paint_line["line-border-width"]),"line-border-color":new ye(ie.paint_line["line-border-color"])}),layout:KF};function qI(t,e,n){return e*(nt/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function WI(t,e){return 1/qI(t,1,e.tileZoom)}function ZI(t,e,n,s){return t.translatePosMatrix(s||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let QI=t=>{let e=[];YI(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");let s=t.layout.get("line-join").constantOr("miter")==="none",u=!!t.paint.get("line-pattern").constantOr(1);return s&&u&&e.push("LINE_JOIN_NONE"),e};function YI(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let XI=new class extends ye{possiblyEvaluate(t,e){return e=new q(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=Eo({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(HI.paint.properties["line-width"].specification);function KI(t,e){return e>0?e+2*t:t}XI.useIntegerZoom=!0;let JF=Qt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),eL=Qt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),tL=Qt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Qt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let nL=Qt([{name:"a_z_offset",components:1,type:"Float32"}],4),iL=Qt([{name:"a_texb",components:2,type:"Uint16"}]),rL=Qt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),oL=Qt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);Qt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let JI=Qt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sL=Qt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Qt([{name:"triangle",components:3,type:"Uint16"}]),Qt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Qt([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Qt([{type:"Float32",name:"offsetX"}]),Qt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Sr=24;let Ls=128;function Tx(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new q(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:s,interpolationType:u}=n,h=0;for(;h<s.length&&s[h]<=t;)h++;h=Math.max(0,h-1);let g=h;for(;g<s.length&&s[g]<t+1;)g++;g=Math.min(s.length-1,g);let y=s[h],b=s[g];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:n.evaluate(new q(y)),maxSize:n.evaluate(new q(b)),interpolationType:u}}}function j_(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:u}){return t.kind==="source"?s/Ls:t.kind==="composite"?sn(s/Ls,u/Ls,n):e}function xh(t,e){let n=0,s=0;if(t.kind==="constant")s=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:u,minZoom:h,maxZoom:g}=t,y=u?hn(po.interpolationFactor(u,e,h,g),0,1):0;t.kind==="camera"?s=sn(t.minSize,t.maxSize,y):n=y}return{uSizeT:n,uSize:s}}var aL=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Ls,evaluateSizeForFeature:j_,evaluateSizeForZoom:xh,getSizeData:Tx});function lL(t,e,n){return t.sections.forEach(s=>{s.text=function(u,h,g){let y=h.layout.get("text-transform").evaluate(g,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),re.applyArabicShaping&&(u=re.applyArabicShaping(u)),u}(s.text,e,n)}),t}let jp={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function cL(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function uL(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}var dL={read:function(t,e,n,s,u){var h,g,y=8*u-s-1,b=(1<<y)-1,w=b>>1,D=-7,I=n?u-1:0,S=n?-1:1,P=t[e+I];for(I+=S,h=P&(1<<-D)-1,P>>=-D,D+=y;D>0;h=256*h+t[e+I],I+=S,D-=8);for(g=h&(1<<-D)-1,h>>=-D,D+=s;D>0;g=256*g+t[e+I],I+=S,D-=8);if(h===0)h=1-w;else{if(h===b)return g?NaN:1/0*(P?-1:1);g+=Math.pow(2,s),h-=w}return(P?-1:1)*g*Math.pow(2,h-s)},write:function(t,e,n,s,u,h){var g,y,b,w=8*h-u-1,D=(1<<w)-1,I=D>>1,S=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=s?0:h-1,k=s?1:-1,L=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,g=D):(g=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-g))<1&&(g--,b*=2),(e+=g+I>=1?S/b:S*Math.pow(2,1-I))*b>=2&&(g++,b/=2),g+I>=D?(y=0,g=D):g+I>=1?(y=(e*b-1)*Math.pow(2,u),g+=I):(y=e*Math.pow(2,I-1)*Math.pow(2,u),g=0));u>=8;t[n+P]=255&y,P+=k,y/=256,u-=8);for(g=g<<u|y,w+=u;w>0;t[n+P]=255&g,P+=k,g/=256,w-=8);t[n+P-k]|=128*L}},eC=_i,U_=dL;function _i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}_i.Varint=0,_i.Fixed64=1,_i.Bytes=2,_i.Fixed32=5;var Dx=4294967296,tC=1/Dx,nC=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ka(t){return t.type===_i.Bytes?t.readVarint()+t.pos:t.pos+1}function wh(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function iC(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var u=n.pos-1;u>=t;u--)n.buf[u+s]=n.buf[u]}function hL(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function fL(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function pL(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function mL(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function gL(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function _L(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function yL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function vL(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function bL(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function G_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Eh(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function rC(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}_i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),u=s>>3,h=this.pos;this.type=7&s,t(u,e,this),this.pos===h&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=G_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=rC(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=G_(this.buf,this.pos)+G_(this.buf,this.pos+4)*Dx;return this.pos+=8,t},readSFixed64:function(){var t=G_(this.buf,this.pos)+rC(this.buf,this.pos+4)*Dx;return this.pos+=8,t},readFloat:function(){var t=U_.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=U_.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(u,h,g){var y,b,w=g.buf;if(y=(112&(b=w[g.pos++]))>>4,b<128||(y|=(127&(b=w[g.pos++]))<<3,b<128)||(y|=(127&(b=w[g.pos++]))<<10,b<128)||(y|=(127&(b=w[g.pos++]))<<17,b<128)||(y|=(127&(b=w[g.pos++]))<<24,b<128)||(y|=(1&(b=w[g.pos++]))<<31,b<128))return wh(u,y,h);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&nC?function(n,s,u){return nC.decode(n.subarray(s,u))}(this.buf,e,t):function(n,s,u){for(var h="",g=s;g<u;){var y,b,w,D=n[g],I=null,S=D>239?4:D>223?3:D>191?2:1;if(g+S>u)break;S===1?D<128&&(I=D):S===2?(192&(y=n[g+1]))==128&&(I=(31&D)<<6|63&y)<=127&&(I=null):S===3?(b=n[g+2],(192&(y=n[g+1]))==128&&(192&b)==128&&((I=(15&D)<<12|(63&y)<<6|63&b)<=2047||I>=55296&&I<=57343)&&(I=null)):S===4&&(b=n[g+2],w=n[g+3],(192&(y=n[g+1]))==128&&(192&b)==128&&(192&w)==128&&((I=(15&D)<<18|(63&y)<<12|(63&b)<<6|63&w)<=65535||I>=1114112)&&(I=null)),I===null?(I=65533,S=1):I>65535&&(I-=65536,h+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),h+=String.fromCharCode(I),g+=S}return h}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==_i.Bytes)return t.push(this.readVarint(e));var n=Ka(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==_i.Bytes)return t.push(this.readSVarint());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==_i.Bytes)return t.push(this.readBoolean());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==_i.Bytes)return t.push(this.readFloat());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==_i.Bytes)return t.push(this.readDouble());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==_i.Bytes)return t.push(this.readFixed32());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==_i.Bytes)return t.push(this.readSFixed32());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==_i.Bytes)return t.push(this.readFixed64());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==_i.Bytes)return t.push(this.readSFixed64());var e=Ka(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===_i.Varint)for(;this.buf[this.pos++]>127;);else if(e===_i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===_i.Fixed32)this.pos+=4;else{if(e!==_i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Eh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Eh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Eh(this.buf,-1&t,this.pos),Eh(this.buf,Math.floor(t*tC),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Eh(this.buf,-1&t,this.pos),Eh(this.buf,Math.floor(t*tC),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,u;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(h,g,y){y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,h>>>=7,y.buf[y.pos++]=127&h|128,y.buf[y.pos]=127&(h>>>=7)}(s,0,n),function(h,g){var y=(7&h)<<4;g.buf[g.pos++]|=y|((h>>>=3)?128:0),h&&(g.buf[g.pos++]=127&h|((h>>>=7)?128:0),h&&(g.buf[g.pos++]=127&h|((h>>>=7)?128:0),h&&(g.buf[g.pos++]=127&h|((h>>>=7)?128:0),h&&(g.buf[g.pos++]=127&h|((h>>>=7)?128:0),h&&(g.buf[g.pos++]=127&h)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,u,h){for(var g,y,b=0;b<u.length;b++){if((g=u.charCodeAt(b))>55295&&g<57344){if(!y){g>56319||b+1===u.length?(s[h++]=239,s[h++]=191,s[h++]=189):y=g;continue}if(g<56320){s[h++]=239,s[h++]=191,s[h++]=189,y=g;continue}g=y-55296<<10|g-56320|65536,y=null}else y&&(s[h++]=239,s[h++]=191,s[h++]=189,y=null);g<128?s[h++]=g:(g<2048?s[h++]=g>>6|192:(g<65536?s[h++]=g>>12|224:(s[h++]=g>>18|240,s[h++]=g>>12&63|128),s[h++]=g>>6&63|128),s[h++]=63&g|128)}return h}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&iC(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),U_.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),U_.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&iC(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,_i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,hL,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,fL,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,gL,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,pL,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,mL,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,_L,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,yL,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,vL,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,bL,e)},writeBytesField:function(t,e){this.writeTag(t,_i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,_i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,_i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,_i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,_i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,_i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,_i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,_i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,_i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,_i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Th=dt(eC);let Ix=3;function xL(t,e,n){e.glyphs=[],t===1&&n.readMessage(wL,e)}function wL(t,e,n){if(t===3){let{id:s,bitmap:u,width:h,height:g,left:y,top:b,advance:w}=n.readMessage(EL,{});e.glyphs.push({id:s,bitmap:new Hl({width:h+2*Ix,height:g+2*Ix},u),metrics:{width:h,height:g,left:y,top:b,advance:w}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function EL(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let oC=Ix,Qo={horizontal:1,vertical:2,horizontalOnly:3};class Up{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let s=new Up;return s.scale=e||1,s.fontStack=n,s}static forImage(e){let n=new Up;return n.imageName=e,n}}class Dh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let s=new Dh;for(let u=0;u<e.sections.length;u++){let h=e.sections[u];h.image?s.addImageSection(h):s.addTextSection(h,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,s){let u="";for(let h=0;h<n.length;h++){let g=n.charCodeAt(h+1)||null,y=n.charCodeAt(h-1)||null;u+=!s&&(g&&x(g)&&!jp[n[h+1]]||y&&x(y)&&!jp[n[h-1]])||!jp[n[h]]?n[h]:jp[n[h]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&$_[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&$_[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let s=new Dh;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Up.forText(e.scale,e.fontStack||n));let s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Ii("Can't add FormattedSection with an empty image.");let s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCodePoint(s),this.sections.push(Up.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ii("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Cx(t,e,n,s,u,h,g,y,b,w,D,I,S,P,k){let L=Dh.fromFeature(t,u);I===Qo.vertical&&L.verticalizePunctuation(S);let B=[],V=function(ee,le,de,_e,Ie,ve){if(!ee)return[];let Me=[],Se=function(Ge,je,Pe,mt,ct,He){let Rt=0;for(let bt=0;bt<Ge.length();bt++){let gt=Ge.getSection(bt);Rt+=sC(Ge.getCodePoint(bt),gt,mt,ct,je,He)}return Rt/Math.max(1,Math.ceil(Rt/Pe))}(ee,le,de,_e,Ie,ve),Ce=ee.text.indexOf("\u200B")>=0,ze=0;for(let Ge=0;Ge<ee.length();Ge++){let je=ee.getSection(Ge),Pe=ee.getCodePoint(Ge);if($_[Pe]||(ze+=sC(Pe,je,_e,Ie,le,ve)),Ge<ee.length()-1){let mt=!((Le=Pe)<11904||!(o["Bopomofo Extended"](Le)||o.Bopomofo(Le)||o["CJK Compatibility Forms"](Le)||o["CJK Compatibility Ideographs"](Le)||o["CJK Compatibility"](Le)||o["CJK Radicals Supplement"](Le)||o["CJK Strokes"](Le)||o["CJK Symbols and Punctuation"](Le)||o["CJK Unified Ideographs Extension A"](Le)||o["CJK Unified Ideographs"](Le)||o["Enclosed CJK Letters and Months"](Le)||o["Halfwidth and Fullwidth Forms"](Le)||o.Hiragana(Le)||o["Ideographic Description Characters"](Le)||o["Kangxi Radicals"](Le)||o["Katakana Phonetic Extensions"](Le)||o.Katakana(Le)||o["Vertical Forms"](Le)||o["Yi Radicals"](Le)||o["Yi Syllables"](Le)));(TL[Pe]||mt||je.imageName)&&Me.push(lC(Ge+1,ze,Se,Me,DL(Pe,ee.getCodePoint(Ge+1),mt&&Ce),!1))}}var Le;return cC(lC(ee.length(),ze,Se,Me,0,!0))}(L,w,h,e,s,P),{processBidirectionalText:W,processStyledBidirectionalText:K}=re;if(W&&L.sections.length===1){let ee=W(L.toString(),V);for(let le of ee){let de=new Dh;de.text=le,de.sections=L.sections;for(let _e=0;_e<le.length;_e++)de.sectionIndex.push(0);B.push(de)}}else if(K){let ee=K(L.text,L.sectionIndex,V);for(let le of ee){let de=new Dh;de.text=le[0],de.sectionIndex=le[1],de.sections=L.sections,B.push(de)}}else B=function(ee,le){let de=[],_e=ee.text,Ie=0;for(let ve of le)de.push(ee.substring(Ie,ve)),Ie=ve;return Ie<_e.length&&de.push(ee.substring(Ie,_e.length)),de}(L,V);let Y=[],se={positionedLines:Y,text:L.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ee,le,de,_e,Ie,ve,Me,Se,Ce,ze,Le,Ge){let je=0,Pe=0,mt=0,ct=Se==="right"?1:Se==="left"?0:.5,He=!1;for(let Jt of Ie){let Bt=Jt.getSections();for(let rn of Bt){if(rn.imageName)continue;let en=le[rn.fontStack];if(en&&(He=en.ascender!==void 0&&en.descender!==void 0,!He))break}if(!He)break}let Rt=0;for(let Jt of Ie){Jt.trim();let Bt=Jt.getMaxScale(),rn=(Bt-1)*Sr,en={positionedGlyphs:[],lineOffset:0};ee.positionedLines[Rt]=en;let un=en.positionedGlyphs,Lt=0;if(!Jt.length()){Pe+=ve,++Rt;continue}let Yn=0,$n=0;for(let vn=0;vn<Jt.length();vn++){let Cn=Jt.getSection(vn),fi=Jt.getSectionIndex(vn),ri=Jt.getCodePoint(vn),Ci=Cn.scale,xi=null,Lr=null,Oi=null,yi=Sr,Xi=0,br=!(Ce===Qo.horizontal||!Le&&!v(ri)||Le&&($_[ri]||(bt=ri,o.Arabic(bt)||o["Arabic Supplement"](bt)||o["Arabic Extended-A"](bt)||o["Arabic Presentation Forms-A"](bt)||o["Arabic Presentation Forms-B"](bt))));if(Cn.imageName){let xr=_e[Cn.imageName];if(!xr)continue;Oi=Cn.imageName,ee.iconsInText=ee.iconsInText||!0,Lr=xr.paddedRect;let li=xr.displaySize;Ci=Ci*Sr/Ge,xi={width:li[0],height:li[1],left:0,top:-oC,advance:br?li[1]:li[0],localGlyph:!1},Xi=He?-xi.height*Ci:Bt*Sr-17-li[1]*Ci,yi=xi.advance;let no=(br?li[0]:li[1])*Ci-Sr*Bt;no>0&&no>Lt&&(Lt=no)}else{let xr=de[Cn.fontStack];if(!xr)continue;xr[ri]&&(Lr=xr[ri]);let li=le[Cn.fontStack];if(!li)continue;let no=li.glyphs[ri];if(!no)continue;if(xi=no.metrics,yi=ri!==8203?Sr:0,He){let el=li.ascender!==void 0?Math.abs(li.ascender):0,ds=li.descender!==void 0?Math.abs(li.descender):0,Us=(el+ds)*Ci;Yn<Us&&(Yn=Us,$n=(el-ds)/2*Ci),Xi=-el*Ci}else Xi=(Bt-Ci)*Sr-17}br?(ee.verticalizable=!0,un.push({glyph:ri,imageName:Oi,x:je,y:Pe+Xi,vertical:br,scale:Ci,localGlyph:xi.localGlyph,fontStack:Cn.fontStack,sectionIndex:fi,metrics:xi,rect:Lr}),je+=yi*Ci+ze):(un.push({glyph:ri,imageName:Oi,x:je,y:Pe+Xi,vertical:br,scale:Ci,localGlyph:xi.localGlyph,fontStack:Cn.fontStack,sectionIndex:fi,metrics:xi,rect:Lr}),je+=xi.advance*Ci+ze)}un.length!==0&&(mt=Math.max(je-ze,mt),He?uC(un,ct,Lt,$n,ve*Bt/2):uC(un,ct,Lt,0,ve/2)),je=0;let In=ve*Bt+Lt;en.lineOffset=Math.max(Lt,rn),Pe+=In,++Rt}var bt;let gt=Pe,{horizontalAlign:qe,verticalAlign:Dt}=Sx(Me);(function(Jt,Bt,rn,en,un,Lt){let Yn=(Bt-rn)*un,$n=-Lt*en;for(let In of Jt)for(let vn of In.positionedGlyphs)vn.x+=Yn,vn.y+=$n})(ee.positionedLines,ct,qe,Dt,mt,gt),ee.top+=-Dt*gt,ee.bottom=ee.top+gt,ee.left+=-qe*mt,ee.right=ee.left+mt,ee.hasBaseline=He}(se,e,n,s,B,g,y,b,I,w,S,k),!function(ee){for(let le of ee)if(le.positionedGlyphs.length!==0)return!1;return!0}(Y)&&se}let $_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},TL={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sC(t,e,n,s,u,h){if(e.imageName){let g=s[e.imageName];return g?g.displaySize[0]*e.scale*Sr/h+u:0}{let g=n[e.fontStack],y=g&&g.glyphs[t];return y?y.metrics.advance*e.scale+u:0}}function aC(t,e,n,s){let u=Math.pow(t-e,2);return s?t<e?u/2:2*u:u+Math.abs(n)*n}function DL(t,e,n){let s=0;return t===10&&(s-=1e4),n&&(s+=150),t!==40&&t!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function lC(t,e,n,s,u,h){let g=null,y=aC(e,n,u,h);for(let b of s){let w=aC(e-b.x,n,u,h)+b.badness;w<=y&&(g=b,y=w)}return{index:t,x:e,priorBreak:g,badness:y}}function cC(t){return t?cC(t.priorBreak).concat(t.index):[]}function Sx(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function uC(t,e,n,s,u){if(!(e||n||s||u))return;let h=t.length-1,g=t[h],y=(g.x+g.metrics.advance*g.scale)*e;for(let b=0;b<=h;b++)t[b].x-=y,t[b].y+=n+s+u}function IL(t,e,n,s){let{horizontalAlign:u,verticalAlign:h}=Sx(s),g=n[0]-t.displaySize[0]*u,y=n[1]-t.displaySize[1]*h;return{imagePrimary:t,imageSecondary:e,top:y,bottom:y+t.displaySize[1],left:g,right:g+t.displaySize[0]}}function dC(t,e,n,s,u,h){let g=t.imagePrimary,y;if(g.content){let B=g.content,V=g.pixelRatio||1;y=[B[0]/V,B[1]/V,g.displaySize[0]-B[2]/V,g.displaySize[1]-B[3]/V]}let b=e.left*h,w=e.right*h,D,I,S,P;n==="width"||n==="both"?(P=u[0]+b-s[3],I=u[0]+w+s[1]):(P=u[0]+(b+w-g.displaySize[0])/2,I=P+g.displaySize[0]);let k=e.top*h,L=e.bottom*h;return n==="height"||n==="both"?(D=u[1]+k-s[0],S=u[1]+L+s[2]):(D=u[1]+(k+L-g.displaySize[1])/2,S=D+g.displaySize[1]),{imagePrimary:g,imageSecondary:void 0,top:D,right:I,bottom:S,left:P,collisionPadding:y}}class Ja extends tt{constructor(e,n,s,u,h){super(e,n),this.angle=u,this.z=s,h!==void 0&&(this.segment=h)}clone(){return new Ja(this.x,this.y,this.z,this.angle,this.segment)}}function hC(t,e,n,s,u){if(e.segment===void 0)return!0;let h=e,g=e.segment+1,y=0;for(;y>-n/2;){if(g--,g<0)return!1;y-=t[g].dist(h),h=t[g]}y+=t[g].dist(t[g+1]),g++;let b=[],w=0;for(;y<n/2;){let D=t[g],I=t[g+1];if(!I)return!1;let S=t[g-1].angleTo(D)-D.angleTo(I);for(S=Math.abs((S+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:S}),w+=S;y-b[0].distance>s;)w-=b.shift().angleDelta;if(w>u)return!1;g++,y+=D.dist(I)}return!0}function fC(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function pC(t,e,n){return t?.6*e*n:0}function mC(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function CL(t,e,n,s,u,h){let g=pC(n,u,h),y=mC(n,s)*h,b=0,w=fC(t)/2;for(let D=0;D<t.length-1;D++){let I=t[D],S=t[D+1],P=I.dist(S);if(b+P>w){let k=(w-b)/P,L=sn(I.x,S.x,k),B=sn(I.y,S.y,k),V=new Ja(L,B,0,S.angleTo(I),D);return!g||hC(t,V,y,g,e)?V:void 0}b+=P}}function SL(t,e,n,s,u,h,g,y,b){let w=pC(s,h,g),D=mC(s,u),I=D*g,S=t[0].x===0||t[0].x===b||t[0].y===0||t[0].y===b;return e-I<e/4&&(e=I+e/4),gC(t,S?e/2*y%e:(D/2+2*h)*g*y%e,e,w,n,I,S,!1,b)}function gC(t,e,n,s,u,h,g,y,b){let w=h/2,D=fC(t),I=0,S=e-n,P=[];for(let k=0;k<t.length-1;k++){let L=t[k],B=t[k+1],V=L.dist(B),W=B.angleTo(L);for(;S+n<I+V;){S+=n;let K=(S-I)/V,Y=sn(L.x,B.x,K),se=sn(L.y,B.y,K);if(Y>=0&&Y<b&&se>=0&&se<b&&S-w>=0&&S+w<=D){let ee=new Ja(Y,se,0,W,k);s&&!hC(t,ee,h,s,u)||P.push(ee)}}I+=V}return y||P.length||g||(P=gC(t,I/2,n,s,u,h,g,!0,b)),P}function _C(t,e,n,s,u){let h=[];for(let g=0;g<t.length;g++){let y=t[g],b;for(let w=0;w<y.length-1;w++){let D=y[w],I=y[w+1];D.x<e&&I.x<e||(D.x<e?D=new tt(e,D.y+(e-D.x)/(I.x-D.x)*(I.y-D.y))._round():I.x<e&&(I=new tt(e,D.y+(e-D.x)/(I.x-D.x)*(I.y-D.y))._round()),D.y<n&&I.y<n||(D.y<n?D=new tt(D.x+(n-D.y)/(I.y-D.y)*(I.x-D.x),n)._round():I.y<n&&(I=new tt(D.x+(n-D.y)/(I.y-D.y)*(I.x-D.x),n)._round()),D.x>=s&&I.x>=s||(D.x>=s?D=new tt(s,D.y+(s-D.x)/(I.x-D.x)*(I.y-D.y))._round():I.x>=s&&(I=new tt(s,D.y+(s-D.x)/(I.x-D.x)*(I.y-D.y))._round()),D.y>=u&&I.y>=u||(D.y>=u?D=new tt(D.x+(u-D.y)/(I.y-D.y)*(I.x-D.x),u)._round():I.y>=u&&(I=new tt(D.x+(u-D.y)/(I.y-D.y)*(I.x-D.x),u)._round()),b&&D.equals(b[b.length-1])||(b=[D],h.push(b)),b.push(I)))))}}return h}function yC(t){let e=0,n=0;for(let g of t)e+=g.w*g.h,n=Math.max(n,g.w);t.sort((g,y)=>y.h-g.h);let s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],u=0,h=0;for(let g of t)for(let y=s.length-1;y>=0;y--){let b=s[y];if(!(g.w>b.w||g.h>b.h)){if(g.x=b.x,g.y=b.y,h=Math.max(h,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===b.w&&g.h===b.h){let w=s.pop();y<s.length&&(s[y]=w)}else g.h===b.h?(b.x+=g.w,b.w-=g.w):g.w===b.w?(b.y+=g.h,b.h-=g.h):(s.push({x:b.x+g.w,y:b.y,w:b.w-g.w,h:g.h}),b.y+=g.h,b.h-=g.h);break}}return{w:u,h,fill:e/(u*h)||0}}ht(Ja,"Anchor");let Co=1;class Mx{constructor(e,{pixelRatio:n,version:s,stretchX:u,stretchY:h,content:g}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=h,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+Co,this.paddedRect.y+Co]}get br(){return[this.paddedRect.x+this.paddedRect.w-Co,this.paddedRect.y+this.paddedRect.h-Co]}get displaySize(){return[(this.paddedRect.w-2*Co)/this.pixelRatio,(this.paddedRect.h-2*Co)/this.pixelRatio]}}class vC{constructor(e,n){let s={},u={};this.haveRenderCallbacks=[];let h=[];this.addImages(e,s,h),this.addImages(n,u,h);let{w:g,h:y}=yC(h),b=new Zo({width:g||1,height:y||1});for(let w in e){let D=e[w],I=s[w].paddedRect;Zo.copy(D.data,b,{x:0,y:0},{x:I.x+Co,y:I.y+Co},D.data,D.sdf)}for(let w in n){let D=n[w],I=u[w].paddedRect,S=I.x+Co,P=I.y+Co,k=D.data.width,L=D.data.height;Zo.copy(D.data,b,{x:0,y:0},{x:S,y:P},D.data),Zo.copy(D.data,b,{x:0,y:L-1},{x:S,y:P-1},{width:k,height:1}),Zo.copy(D.data,b,{x:0,y:0},{x:S,y:P+L},{width:k,height:1}),Zo.copy(D.data,b,{x:k-1,y:0},{x:S-1,y:P},{width:1,height:L}),Zo.copy(D.data,b,{x:0,y:0},{x:S+k,y:P},{width:1,height:L})}this.image=b,this.iconPositions=s,this.patternPositions=u}addImages(e,n,s){for(let u in e){let h=e[u],g={x:0,y:0,w:h.data.width+2*Co,h:h.data.height+2*Co};s.push(g),n[u]=new Mx(g,h),h.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(let u in e.getUpdatedImages(s))this.patchUpdatedImage(this.iconPositions[u],e.getImage(u,s),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u,s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;let[u,h]=e.tl,g=!!Object.keys(this.patternPositions).length;s.update(n.data,{useMipmap:g},{x:u,y:h})}}ht(Mx,"ImagePosition"),ht(vC,"ImageAtlas");let Gp=1e20;function bC(t,e,n,s,u,h,g,y,b){for(let w=e;w<e+s;w++)xC(t,n*h+w,h,u,g,y,b);for(let w=n;w<n+u;w++)xC(t,w*h+e,1,s,g,y,b)}function xC(t,e,n,s,u,h,g){h[0]=0,g[0]=-Gp,g[1]=Gp,u[0]=t[e];for(let y=1,b=0,w=0;y<s;y++){u[y]=t[e+y*n];let D=y*y;do{let I=h[b];w=(u[y]-u[I]+D-I*I)/(y-I)/2}while(w<=g[b]&&--b>-1);b++,h[b]=y,g[b]=w,g[b+1]=Gp}for(let y=0,b=0;y<s;y++){for(;g[b+1]<y;)b++;let w=h[b],D=y-w;t[e+y*n]=u[w]+D*D}}let Ns=2,Ax={none:0,ideographs:1,all:2};class Ih{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,s){let u=[],h=this.urls[n]||F.GLYPHS_URL;for(let g in e)for(let y of e[g])u.push({stack:g,id:y});kf(u,({stack:g,id:y},b)=>{let w=this.entries[g];w||(w=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let D=w.glyphs[y];if(D!==void 0)return void b(null,{stack:g,id:y,glyph:D});if(D=this._tinySDF(w,g,y),D)return w.glyphs[y]=D,void b(null,{stack:g,id:y,glyph:D});let I=Math.floor(y/256);if(256*I>65535)return void b(new Error("glyphs > 65535 not supported"));if(w.ranges[I])return void b(null,{stack:g,id:y,glyph:D});let S=w.requests[I];S||(S=w.requests[I]=[],Ih.loadGlyphRange(g,I,h,this.requestManager,(P,k)=>{if(k){w.ascender=k.ascender,w.descender=k.descender;for(let L in k.glyphs)this._doesCharSupportLocalGlyph(+L)||(w.glyphs[+L]=k.glyphs[+L]);w.ranges[I]=!0}for(let L of S)L(P,k);delete w.requests[I]})),S.push((P,k)=>{P?b(P):k&&b(null,{stack:g,id:y,glyph:k.glyphs[y]||null})})},(g,y)=>{if(g)s(g);else if(y){let b={};for(let{stack:w,id:D,glyph:I}of y)b[w]===void 0&&(b[w]={}),b[w].glyphs===void 0&&(b[w].glyphs={}),b[w].glyphs[D]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},b[w].ascender=this.entries[w].ascender,b[w].descender=this.entries[w].descender;s(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ax.none&&(this.localGlyphMode===Ax.all?!!this.localFontFamily:!!this.localFontFamily&&(o["CJK Unified Ideographs"](e)||o["Hangul Syllables"](e)||o.Hiragana(e)||o.Katakana(e)||o["CJK Symbols and Punctuation"](e)||o["CJK Unified Ideographs Extension A"](e)||o["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,s){let u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let h=e.tinySDF;if(!h){let L="400";/bold/i.test(n)?L="900":/medium/i.test(n)?L="500":/light/i.test(n)&&(L="200"),h=e.tinySDF=new Ih.TinySDF({fontFamily:u,fontWeight:L,fontSize:24*Ns,buffer:3*Ns,radius:8*Ns}),h.fontWeight=L}if(this.localGlyphs[h.fontWeight][s])return this.localGlyphs[h.fontWeight][s];let g=String.fromCodePoint(s),{data:y,width:b,height:w,glyphWidth:D,glyphHeight:I,glyphLeft:S,glyphTop:P,glyphAdvance:k}=h.draw(g);return this.localGlyphs[h.fontWeight][s]={id:s,bitmap:new Hl({width:b,height:w},y),metrics:{width:D/Ns,height:I/Ns,left:S/Ns,top:P/Ns-27,advance:k/Ns,localGlyph:!0}}}}Ih.loadGlyphRange=function(t,e,n,s,u){let h=256*e,g=h+255,y=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${h}-${g}`),Md.Glyphs);kc(y,(b,w)=>{if(b)u(b);else if(w){let D={},I=function(S){return new Th(S).readFields(xL,{})}(w);for(let S of I.glyphs)D[S.id]=S;u(null,{glyphs:D,ascender:I.ascender,descender:I.descender})}})},Ih.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:h="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;let y=this.size=t+4*e,b=this._createCanvas(y),w=this.ctx=b.getContext("2d",{willReadFrequently:!0});w.font=`${g} ${h} ${t}px ${u}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:h}=this.ctx.measureText(t),g=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(h-u))),b=Math.min(this.size-this.buffer,g+Math.ceil(s)),w=y+2*this.buffer,D=b+2*this.buffer,I=Math.max(w*D,0),S=new Uint8ClampedArray(I),P={data:S,width:w,height:D,glyphWidth:y,glyphHeight:b,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return P;let{ctx:k,buffer:L,gridInner:B,gridOuter:V}=this;k.clearRect(L,L,y,b),k.fillText(t,L,L+g);let W=k.getImageData(L,L,y,b);V.fill(Gp,0,I),B.fill(0,0,I);for(let K=0;K<b;K++)for(let Y=0;Y<y;Y++){let se=W.data[4*(K*y+Y)+3]/255;if(se===0)continue;let ee=(K+L)*w+Y+L;if(se===1)V[ee]=0,B[ee]=Gp;else{let le=.5-se;V[ee]=le>0?le*le:0,B[ee]=le<0?le*le:0}}bC(V,0,0,w,D,w,this.f,this.v,this.z),bC(B,L,L,y,b,w,this.f,this.v,this.z);for(let K=0;K<I;K++){let Y=Math.sqrt(V[K])-Math.sqrt(B[K]);S[K]=Math.round(255-255*(Y/this.radius+this.cutoff))}return P}};let Zl=Co;function wC(t,e,n,s){let u=[],h=t.imagePrimary,g=h.pixelRatio,y=h.paddedRect.w-2*Zl,b=h.paddedRect.h-2*Zl,w=t.right-t.left,D=t.bottom-t.top,I=h.stretchX||[[0,y]],S=h.stretchY||[[0,b]],P=(ve,Me)=>ve+Me[1]-Me[0],k=I.reduce(P,0),L=S.reduce(P,0),B=y-k,V=b-L,W=0,K=k,Y=0,se=L,ee=0,le=B,de=0,_e=V;if(h.content&&s){let ve=h.content;W=H_(I,0,ve[0]),Y=H_(S,0,ve[1]),K=H_(I,ve[0],ve[2]),se=H_(S,ve[1],ve[3]),ee=ve[0]-W,de=ve[1]-Y,le=ve[2]-ve[0]-K,_e=ve[3]-ve[1]-se}let Ie=(ve,Me,Se,Ce)=>{let ze=q_(ve.stretch-W,K,w,t.left),Le=W_(ve.fixed-ee,le,ve.stretch,k),Ge=q_(Me.stretch-Y,se,D,t.top),je=W_(Me.fixed-de,_e,Me.stretch,L),Pe=q_(Se.stretch-W,K,w,t.left),mt=W_(Se.fixed-ee,le,Se.stretch,k),ct=q_(Ce.stretch-Y,se,D,t.top),He=W_(Ce.fixed-de,_e,Ce.stretch,L),Rt=new tt(ze,Ge),bt=new tt(Pe,Ge),gt=new tt(Pe,ct),qe=new tt(ze,ct),Dt=new tt(Le/g,je/g),Jt=new tt(mt/g,He/g),Bt=e*Math.PI/180;if(Bt){let $n=Math.sin(Bt),In=Math.cos(Bt),vn=[In,-$n,$n,In];Rt._matMult(vn),bt._matMult(vn),qe._matMult(vn),gt._matMult(vn)}let rn=ve.stretch+ve.fixed,en=Se.stretch+Se.fixed,un=Me.stretch+Me.fixed,Lt=Ce.stretch+Ce.fixed,Yn=t.imageSecondary;return{tl:Rt,tr:bt,bl:qe,br:gt,texPrimary:{x:h.paddedRect.x+Zl+rn,y:h.paddedRect.y+Zl+un,w:en-rn,h:Lt-un},texSecondary:Yn?{x:Yn.paddedRect.x+Zl+rn,y:Yn.paddedRect.y+Zl+un,w:en-rn,h:Lt-un}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Dt,pixelOffsetBR:Jt,minFontScaleX:le/g/w,minFontScaleY:_e/g/D,isSDF:n}};if(s&&(h.stretchX||h.stretchY)){let ve=EC(I,B,k),Me=EC(S,V,L);for(let Se=0;Se<ve.length-1;Se++){let Ce=ve[Se],ze=ve[Se+1];for(let Le=0;Le<Me.length-1;Le++)u.push(Ie(Ce,Me[Le],ze,Me[Le+1]))}}else u.push(Ie({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return u}function H_(t,e,n){let s=0;for(let u of t)s+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return s}function EC(t,e,n){let s=[{fixed:-Zl,stretch:0}];for(let[u,h]of t){let g=s[s.length-1];s.push({fixed:u-g.stretch,stretch:g.stretch}),s.push({fixed:u-g.stretch,stretch:g.stretch+(h-u)})}return s.push({fixed:e+Zl,stretch:n}),s}function q_(t,e,n,s){return t/e*n+s}function W_(t,e,n,s){return t-e*n/s}function ML(t,e,n,s){let u=e+t.positionedLines[s].lineOffset;return s===0?n+u/2:n+(u+(e+t.positionedLines[s-1].lineOffset))/2}function AL(t,e=1,n=!1){let s=1/0,u=1/0,h=-1/0,g=-1/0,y=t[0];for(let P=0;P<y.length;P++){let k=y[P];(!P||k.x<s)&&(s=k.x),(!P||k.y<u)&&(u=k.y),(!P||k.x>h)&&(h=k.x),(!P||k.y>g)&&(g=k.y)}let b=Math.min(h-s,g-u),w=b/2,D=new qd([],PL);if(b===0)return new tt(s,u);for(let P=s;P<h;P+=b)for(let k=u;k<g;k+=b)D.push(new Ch(P+w,k+w,w,t));let I=function(P){let k=0,L=0,B=0,V=P[0];for(let W=0,K=V.length,Y=K-1;W<K;Y=W++){let se=V[W],ee=V[Y],le=se.x*ee.y-ee.x*se.y;L+=(se.x+ee.x)*le,B+=(se.y+ee.y)*le,k+=3*le}return new Ch(L/k,B/k,0,P)}(t),S=D.length;for(;D.length;){let P=D.pop();(P.d>I.d||!I.d)&&(I=P,n&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,S)),P.max-I.d<=e||(w=P.h/2,D.push(new Ch(P.p.x-w,P.p.y-w,w,t)),D.push(new Ch(P.p.x+w,P.p.y-w,w,t)),D.push(new Ch(P.p.x-w,P.p.y+w,w,t)),D.push(new Ch(P.p.x+w,P.p.y+w,w,t)),S+=4)}return n&&(console.log(`num probes: ${S}`),console.log(`best distance: ${I.d}`)),I.p}function PL(t,e){return e.max-t.max}class Ch{constructor(e,n,s,u){this.p=new tt(e,n),this.h=s,this.d=function(h,g){let y=!1,b=1/0;for(let w=0;w<g.length;w++){let D=g[w];for(let I=0,S=D.length,P=S-1;I<S;P=I++){let k=D[I],L=D[P];k.y>h.y!=L.y>h.y&&h.x<(L.x-k.x)*(h.y-k.y)/(L.y-k.y)+k.x&&(y=!y),b=Math.min(b,VD(h,k,L))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}let Px=Number.POSITIVE_INFINITY,RL=Math.sqrt(2);function TC(t,[e,n]){let s=0,u=0;if(n===Px){e<0&&(e=0);let h=e/RL;switch(t){case"top-right":case"top-left":u=h-7;break;case"bottom-right":case"bottom-left":u=7-h;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(t){case"top-right":case"bottom-right":s=-h;break;case"top-left":case"bottom-left":s=h;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function Rx(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function kL(t,e,n,s,u,h,g,y,b,w,D,I,S,P,k){let L=h.textMaxSize.evaluate(e,{},I);L===void 0&&(L=g);let B=t.layers[0].layout,V=B.get("icon-offset").evaluate(e,{},I),W=IC(n.horizontal)||n.vertical,K=S.name==="globe",Y=Sr,se=g/Y,ee=t.tilePixelRatio*L/Y,le=(ze=t.overscaling,t.zoom>18&&ze>2&&(ze>>=1),Math.max(nt/(512*ze),1)*B.get("symbol-spacing")),de=B.get("text-padding")*t.tilePixelRatio,_e=B.get("icon-padding")*t.tilePixelRatio,Ie=bn(B.get("text-max-angle")),ve=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Me=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Se=B.get("symbol-placement"),Ce=le/2;var ze;let Le=B.get("icon-text-fit").evaluate(e,{},I),Ge=B.get("icon-text-fit-padding").evaluate(e,{},I),je=Le!=="none",Pe;t.hasAnyIconTextFit===!1&&je&&(t.hasAnyIconTextFit=!0),s&&je&&(t.allowVerticalPlacement&&n.vertical&&(Pe=dC(s,n.vertical,Le,Ge,V,se)),W&&(s=dC(s,W,Le,Ge,V,se)));let mt=(ct,He,Rt)=>{if(He.x<0||He.x>=nt||He.y<0||He.y>=nt)return;let bt=null;if(K){let{x:gt,y:qe,z:Dt}=S.projectTilePoint(He.x,He.y,Rt);bt={anchor:new Ja(gt,qe,Dt,0,void 0),up:S.upVector(Rt,He.x,He.y)}}(function(gt,qe,Dt,Jt,Bt,rn,en,un,Lt,Yn,$n,In,vn,Cn,fi,ri,Ci,xi,Lr,Oi,yi,Xi,br,xr,li,no,el){let ds=gt.addToLineVertexArray(qe,Jt),Us,ec,tc,Du,CS,SS,MS,AS=0,PS=0,RS=0,kS=0,i1=-1,r1=-1,fa={},OS=Nc(""),Iu=Dt?Dt.anchor:qe,o1=Lt.layout.get("icon-text-fit").evaluate(yi,{},li)!=="none",s1=0,a1=0;if(Lt._unevaluatedLayout.getValue("text-radial-offset")===void 0?[s1,a1]=Lt.layout.get("text-offset").evaluate(yi,{},li).map(So=>So*Sr):(s1=Lt.layout.get("text-radial-offset").evaluate(yi,{},li)*Sr,a1=Px),gt.allowVerticalPlacement&&Bt.vertical){let So=Bt.vertical;if(fi)SS=kx(So),un&&(MS=kx(un));else{let Mo=Lt.layout.get("text-rotate").evaluate(yi,{},li)+90;tc=Z_(Yn,Iu,qe,$n,In,vn,So,Cn,Mo,ri),un&&(Du=Z_(Yn,Iu,qe,$n,In,vn,un,xi,Mo))}}if(rn){let So=Lt.layout.get("icon-rotate").evaluate(yi,{},li),Mo=wC(rn,So,br,o1),Oh=un?wC(un,So,br,o1):void 0;ec=Z_(Yn,Iu,qe,$n,In,vn,rn,xi,So),AS=4*Mo.length;let FS=gt.iconSizeData,Cu=null;FS.kind==="source"?(Cu=[Ls*Lt.layout.get("icon-size").evaluate(yi,{},li)],Cu[0]>Ql&&Ii(`${gt.layerIds[0]}: Value for "icon-size" is >= ${$p}. Reduce your "icon-size".`)):FS.kind==="composite"&&(Cu=[Ls*Xi.compositeIconSizes[0].evaluate(yi,{},li),Ls*Xi.compositeIconSizes[1].evaluate(yi,{},li)],(Cu[0]>Ql||Cu[1]>Ql)&&Ii(`${gt.layerIds[0]}: Value for "icon-size" is >= ${$p}. Reduce your "icon-size".`)),gt.addSymbols(gt.icon,Mo,Cu,Oi,Lr,yi,!1,Dt,qe,ds.lineStartIndex,ds.lineLength,-1,xr,li,no,el),i1=gt.icon.placedSymbolArray.length-1,Oh&&(PS=4*Oh.length,gt.addSymbols(gt.icon,Oh,Cu,Oi,Lr,yi,Qo.vertical,Dt,qe,ds.lineStartIndex,ds.lineLength,-1,xr,li,no,el),r1=gt.icon.placedSymbolArray.length-1)}for(let So in Bt.horizontal){let Mo=Bt.horizontal[So];Us||(OS=Nc(Mo.text),fi?CS=kx(Mo):Us=Z_(Yn,Iu,qe,$n,In,vn,Mo,Cn,Lt.layout.get("text-rotate").evaluate(yi,{},li),ri));let Oh=Mo.positionedLines.length===1;if(RS+=DC(gt,Dt,qe,Mo,en,Lt,fi,yi,ri,ds,Bt.vertical?Qo.horizontal:Qo.horizontalOnly,Oh?Object.keys(Bt.horizontal):[So],fa,i1,Xi,xr,li,no),Oh)break}Bt.vertical&&(kS+=DC(gt,Dt,qe,Bt.vertical,en,Lt,fi,yi,ri,ds,Qo.vertical,["vertical"],fa,r1,Xi,xr,li,no));let nc=-1,l1=(So,Mo)=>So?Math.max(So,Mo):Mo;nc=l1(CS,nc),nc=l1(SS,nc),nc=l1(MS,nc);let XN=nc>-1?1:0;gt.glyphOffsetArray.length>=65535&&Ii("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yi.sortKey!==void 0&&gt.addToSortKeyRanges(gt.symbolInstances.length,yi.sortKey),gt.symbolInstances.emplaceBack(qe.x,qe.y,Iu.x,Iu.y,Iu.z,fa.right>=0?fa.right:-1,fa.center>=0?fa.center:-1,fa.left>=0?fa.left:-1,fa.vertical>=0?fa.vertical:-1,i1,r1,OS,Us!==void 0?Us:gt.collisionBoxArray.length,Us!==void 0?Us+1:gt.collisionBoxArray.length,tc!==void 0?tc:gt.collisionBoxArray.length,tc!==void 0?tc+1:gt.collisionBoxArray.length,ec!==void 0?ec:gt.collisionBoxArray.length,ec!==void 0?ec+1:gt.collisionBoxArray.length,Du||gt.collisionBoxArray.length,Du?Du+1:gt.collisionBoxArray.length,$n,RS,kS,AS,PS,XN,0,s1,a1,nc,0,o1?1:0)})(t,He,bt,ct,n,s,u,Pe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,de,ve,b,0,_e,Me,V,e,h,w,D,I,P,k)};if(Se==="line")for(let ct of _C(e.geometry,0,0,nt,nt)){let He=SL(ct,le,Ie,n.vertical||W,s,Y,ee,t.overscaling,nt);for(let Rt of He)W&&OL(t,W.text,Ce,Rt)||mt(ct,Rt,I)}else if(Se==="line-center"){for(let ct of e.geometry)if(ct.length>1){let He=CL(ct,Ie,n.vertical||W,s,Y,ee);He&&mt(ct,He,I)}}else if(e.type==="Polygon")for(let ct of _x(e.geometry,0)){let He=AL(ct,16);mt(ct[0],new Ja(He.x,He.y,0,0,void 0),I)}else if(e.type==="LineString")for(let ct of e.geometry)mt(ct,new Ja(ct[0].x,ct[0].y,0,0,void 0),I);else if(e.type==="Point")for(let ct of e.geometry)for(let He of ct)mt([He],new Ja(He.x,He.y,0,0,void 0),I)}let $p=255,Ql=$p*Ls;function DC(t,e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B,V){let W=function(se,ee,le,de,_e,Ie,ve,Me){let Se=[];if(ee.positionedLines.length===0)return Se;let Ce=de.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,ze=function(mt){let ct=mt[0],He=mt[1],Rt=ct*He;return Rt>0?[ct,-He]:Rt<0?[-ct,He]:ct===0?[He,ct]:[He,-ct]}(le),Le=Math.abs(ee.top-ee.bottom);for(let mt of ee.positionedLines)Le-=mt.lineOffset;let Ge=ee.positionedLines.length,je=Le/Ge,Pe=ee.top-le[1];for(let mt=0;mt<Ge;++mt){let ct=ee.positionedLines[mt];Pe=ML(ee,je,Pe,mt);for(let He of ct.positionedGlyphs){if(!He.rect)continue;let Rt=He.rect||{},bt=oC+1,gt=!0,qe=1,Dt=0;if(He.imageName){let Oi=ve[He.imageName];if(!Oi)continue;if(Oi.sdf){Ii("SDF images are not supported in formatted text and will be ignored.");continue}gt=!1,qe=Oi.pixelRatio,bt=Co/qe}let Jt=(_e||Me)&&He.vertical,Bt=He.metrics.advance*He.scale/2,rn=He.metrics,en=He.rect;if(en===null)continue;Me&&ee.verticalizable&&(Dt=He.imageName?Bt-He.metrics.width*He.scale/2:0);let un=_e?[He.x+Bt,He.y]:[0,0],Lt=[0,0],Yn=[0,0],$n=!1;_e||(Jt?(Yn=[He.x+Bt+ze[0],He.y+ze[1]-Dt],$n=!0):Lt=[He.x+Bt+le[0],He.y+le[1]-Dt]);let In=en.w*He.scale/(qe*(He.localGlyph?Ns:1)),vn=en.h*He.scale/(qe*(He.localGlyph?Ns:1)),Cn,fi,ri,Ci;if(Jt){let Oi=He.y-Pe,yi=new tt(-Bt,Bt-Oi),Xi=-Math.PI/2,br=new tt(...Yn);Cn=new tt(-Bt+Lt[0],Lt[1]),Cn._rotateAround(Xi,yi)._add(br),Cn.x+=-Oi+Bt,Cn.y-=(rn.left-bt)*He.scale;let xr=He.imageName?rn.advance*He.scale:Sr*He.scale,li=String.fromCodePoint(He.glyph);cL(li)?Cn.x+=(1-bt)*He.scale:uL(li)?Cn.x+=xr-rn.height*He.scale+(-bt-1)*He.scale:Cn.x+=He.imageName||rn.width+2*bt===en.w&&rn.height+2*bt===en.h?(xr-vn)/2:(xr-(rn.height+2*bt)*He.scale)/2,fi=new tt(Cn.x,Cn.y-In),ri=new tt(Cn.x+vn,Cn.y),Ci=new tt(Cn.x+vn,Cn.y-In)}else{let Oi=(rn.left-bt)*He.scale-Bt+Lt[0],yi=(-rn.top-bt)*He.scale+Lt[1],Xi=Oi+In,br=yi+vn;Cn=new tt(Oi,yi),fi=new tt(Xi,yi),ri=new tt(Oi,br),Ci=new tt(Xi,br)}if(Ce){let Oi;Oi=_e?new tt(0,0):$n?new tt(ze[0],ze[1]):new tt(le[0],le[1]),Cn._rotateAround(Ce,Oi),fi._rotateAround(Ce,Oi),ri._rotateAround(Ce,Oi),Ci._rotateAround(Ce,Oi)}let xi=new tt(0,0),Lr=new tt(0,0);Se.push({tl:Cn,tr:fi,bl:ri,br:Ci,texPrimary:Rt,texSecondary:void 0,writingMode:ee.writingMode,glyphOffset:un,sectionIndex:He.sectionIndex,isSDF:gt,pixelOffsetTL:xi,pixelOffsetBR:Lr,minFontScaleX:0,minFontScaleY:0})}}return Se}(0,s,b,h,g,y,u,t.allowVerticalPlacement),K=t.textSizeData,Y=null;K.kind==="source"?(Y=[Ls*h.layout.get("text-size").evaluate(y,{},B)],Y[0]>Ql&&Ii(`${t.layerIds[0]}: Value for "text-size" is >= ${$p}. Reduce your "text-size".`)):K.kind==="composite"&&(Y=[Ls*k.compositeTextSizes[0].evaluate(y,{},B),Ls*k.compositeTextSizes[1].evaluate(y,{},B)],(Y[0]>Ql||Y[1]>Ql)&&Ii(`${t.layerIds[0]}: Value for "text-size" is >= ${$p}. Reduce your "text-size".`)),t.addSymbols(t.text,W,Y,b,g,y,D,e,n,w.lineStartIndex,w.lineLength,P,L,B,V,!1);for(let se of I)S[se]=t.text.placedSymbolArray.length-1;return 4*W.length}function IC(t){for(let e in t)return t[e];return null}function Z_(t,e,n,s,u,h,g,y,b,w){let D=g.top,I=g.bottom,S=g.left,P=g.right,k=g.collisionPadding;if(k&&(S-=k[0],D-=k[1],P+=k[2],I+=k[3]),b){let L=new tt(S,D),B=new tt(P,D),V=new tt(S,I),W=new tt(P,I),K=bn(b),Y=new tt(0,0);w&&(Y=new tt(w[0],w[1])),L._rotateAround(K,Y),B._rotateAround(K,Y),V._rotateAround(K,Y),W._rotateAround(K,Y),S=Math.min(L.x,B.x,V.x,W.x),P=Math.max(L.x,B.x,V.x,W.x),D=Math.min(L.y,B.y,V.y,W.y),I=Math.max(L.y,B.y,V.y,W.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,S,D,P,I,y,s,u,h),t.length-1}function kx(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function OL(t,e,n,s){let u=t.compareText;if(e in u){let h=u[e];for(let g=h.length-1;g>=0;g--)if(s.dist(h[g])<n)return!0}else u[e]=[];return u[e].push(s),!1}function CC(t,e){let n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),h=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),g=Math.sin(t._pitch)*h+u;return Math.min(1.01*g,u*(1/t._horizonShift))}function Hp(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),s=t.x*n,u=(t.x+1)*n,h=t.y*n,g=(t.y+1)*n,y=Io(s),b=Io(u),w=Cr(h),D=Cr(g),I=e.project(y,w),S=e.project(b,w),P=e.project(b,D),k=e.project(y,D),L=Math.min(I.x,S.x,P.x,k.x),B=Math.min(I.y,S.y,P.y,k.y),V=Math.max(I.x,S.x,P.x,k.x),W=Math.max(I.y,S.y,P.y,k.y),K=n/16;function Y(ee,le,de,_e,Ie,ve){let Me=(de+Ie)/2,Se=(_e+ve)/2,Ce=e.project(Io(Me),Cr(Se)),ze=Math.max(0,L-Ce.x,B-Ce.y,Ce.x-V,Ce.y-W);L=Math.min(L,Ce.x),V=Math.max(V,Ce.x),B=Math.min(B,Ce.y),W=Math.max(W,Ce.y),ze>K&&(Y(ee,Ce,de,_e,Me,Se),Y(Ce,le,Me,Se,Ie,ve))}Y(I,S,s,h,u,h),Y(S,P,u,h,u,g),Y(P,k,u,g,s,g),Y(k,I,s,g,s,h),L-=K,B-=K,V+=K,W+=K;let se=1/Math.max(V-L,W-B);return{scale:se,x:L*se,y:B*se,x2:V*se,y2:W*se,projection:e}}function SC(t,{x:e,y:n},s=0){return new tt(((e-s)*t.scale-t.x)*nt,(n*t.scale-t.y)*nt)}let FL=r.a9.identity(new Float32Array(16));class Yl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new En(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return to(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return CC(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,u){let h=e.horizonLineFromTop(!1),g=new tt(n,Math.max(h,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,n,s){let u=new tt(n,s);if(e.elevation)return e.elevation.pointCoordinate(u);{let h=this.pointCoordinate(e,u.x,u.y,0);return[h.x,h.y,h.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return FL}createTileMatrix(e,n,s){let u,h,g,y=s.canonical,b=r.a9.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let w=Hp(y,this);u=1,h=w.x+s.wrap*w.scale,g=w.y,r.a9.scale(b,b,[u/w.scale,u/w.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),h=(y.x+Math.pow(2,y.z)*s.wrap)*u,g=y.y*u;return r.a9.translate(b,b,[h,g,0]),r.a9.scale(b,b,[u/nt,u/nt,1]),b}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class LL extends Yl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(bn(n));this.n=(u+Math.sin(bn(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:s,c:u,r0:h}=this,g=bn(e-this.center[0]),y=bn(n),b=Math.sqrt(u-2*s*Math.sin(y))/s;return{x:b*Math.sin(g*s),y:b*Math.cos(g*s)-h,z:0}}unproject(e,n){let{n:s,c:u,r0:h}=this,g=h+n,y=Math.atan2(e,Math.abs(g))*Math.sign(g);g*s<0&&(y-=Math.PI*Math.sign(e)*Math.sign(g));let b=bn(this.center[0])*s;y=Cs(y,-Math.PI-b,Math.PI-b);let w=hn(Ur(y/s)+this.center[0],-180,180),D=Math.asin(hn((u-(e*e+g*g)*s*s)/(2*s),-1,1)),I=hn(Ur(D),-ji,ji);return new En(w,I)}}let qp=1.340264,Wp=-.081106,Zp=893e-6,Qp=.003796,Q_=Math.sqrt(3)/2;class NL extends Yl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let s=Math.asin(Q_*Math.sin(n)),u=s*s,h=u*u*u;return{x:.5*(e*Math.cos(s)/(Q_*(qp+3*Wp*u+h*(7*Zp+9*Qp*u)))/Math.PI+.5),y:1-.5*(s*(qp+Wp*u+h*(Zp+Qp*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=s*s,h=u*u*u;for(let D,I,S,P=0;P<12&&(I=s*(qp+Wp*u+h*(Zp+Qp*u))-n,S=qp+3*Wp*u+h*(7*Zp+9*Qp*u),D=I/S,s=hn(s-D,-Math.PI/3,Math.PI/3),u=s*s,h=u*u*u,!(Math.abs(D)<1e-12));++P);let g=Q_*e*(qp+3*Wp*u+h*(7*Zp+9*Qp*u))/Math.cos(s),y=Math.asin(Math.sin(s)/Q_),b=hn(180*g/Math.PI,-180,180),w=hn(180*y/Math.PI,-ji,ji);return new En(b,w)}}class zL extends Yl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let s=360*(e-.5),u=hn(360*(.5-n),-ji,ji);return new En(s,u)}}let Sh=Math.PI/2;function Y_(t){return Math.tan((Sh+t)/2)}class BL extends Yl{constructor(e){super(e),this.center=e.center||[0,30];let[n,s]=this.parallels=e.parallels||[30,30],u=bn(n),h=bn(s);this.southernCenter=u+h<0,this.southernCenter&&(u=-u,h=-h);let g=Math.cos(u),y=Y_(u);this.n=u===h?Math.sin(u):Math.log(g/Math.cos(h))/Math.log(Y_(h)/y),this.f=g*Math.pow(Y_(u),this.n)/this.n}project(e,n){n=bn(n),this.southernCenter&&(n=-n),e=bn(e-this.center[0]);let s=1e-6,{n:u,f:h}=this;h>0?n<-Sh+s&&(n=-Sh+s):n>Sh-s&&(n=Sh-s);let g=h/Math.pow(Y_(n),u),y=g*Math.sin(u*e),b=h-g*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:s,f:u}=this,h=u-n,g=Math.sign(h),y=Math.sign(s)*Math.sqrt(e*e+h*h),b=Math.atan2(e,Math.abs(h))*g;h*s<0&&(b-=Math.PI*Math.sign(e)*g);let w=hn(Ur(b/s)+this.center[0],-180,180),D=hn(Ur(2*Math.atan(Math.pow(u/y,1/s))-Sh),-ji,ji);return new En(w,this.southernCenter?-D:D)}}class MC extends Yl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ul(e),y:Qa(n),z:0}}unproject(e,n){let s=Io(e),u=Cr(n);return new En(s,u)}}let AC=bn(ji);class VL extends Yl{project(e,n){let s=(n=bn(n))*n,u=s*s;return{x:.5*((e=bn(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=25,h=0,g=s*s;do{g=s*s;let w=g*g;h=(s*(1.007226+g*(.015085+w*(.028874*g-.044475-.005916*w)))-n)/(1.007226+g*(.045255+w*(.259866*g-.311325-.005916*11*w))),s=hn(s-h,-AC,AC)}while(Math.abs(h)>1e-6&&--u>0);g=s*s;let y=hn(Ur(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),b=Ur(s);return new En(y,b)}}let PC=bn(ji);class jL extends Yl{project(e,n){n=bn(n),e=bn(e);let s=Math.cos(n),u=2/Math.PI,h=Math.acos(s*Math.cos(e/2)),g=Math.sin(h)/h,y=.5*(e*u+2*s*Math.sin(e/2)/g)||0,b=.5*(n+Math.sin(n)/g)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,h=25,g=1e-6,y=0,b=0;do{let w=Math.cos(u),D=Math.sin(u),I=2*D*w,S=D*D,P=w*w,k=Math.cos(s/2),L=Math.sin(s/2),B=2*k*L,V=L*L,W=1-P*k*k,K=W?1/W:0,Y=W?Math.acos(w*k)*Math.sqrt(1/W):0,se=.5*(2*Y*w*L+2*s/Math.PI)-e,ee=.5*(Y*D+u)-n,le=.5*K*(P*V+Y*w*k*S)+1/Math.PI,de=K*(B*I/4-Y*D*L),_e=.125*K*(I*L-Y*D*P*B),Ie=.5*K*(S*k+Y*V*w)+.5,ve=de*_e-Ie*le;y=(ee*de-se*Ie)/ve,b=(se*_e-ee*le)/ve,s=hn(s-y,-Math.PI,Math.PI),u=hn(u-b,-PC,PC)}while((Math.abs(y)>g||Math.abs(b)>g)&&--h>0);return new En(Ur(s),Ur(u))}}class RC extends Yl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(bn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:s,cosPhi:u}=this;return{x:bn(e)*u*s+.5,y:-Math.sin(bn(n))/u*s+.5,z:0}}unproject(e,n){let{scale:s,cosPhi:u}=this,h=-(n-.5)/s,g=hn(Ur((e-.5)/s)/u,-180,180),y=Math.asin(hn(h*u,-1,1)),b=hn(Ur(y),-ji,ji);return new En(g,b)}}class UL extends MC{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){let u=kp(e,n,s),h=S_(ha(s));return r.Q.transformMat4(u,u,h),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){let s=_u(n.lat,n.lng),u=r.Q.normalize([],s),h=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,g=to(1,0)*nt*h;r.Q.scaleAndAdd(s,s,u,g);let y=r.a9.identity(new Float64Array(16));return r.a9.multiply(y,e.pixelMatrix,e.globeMatrix),r.Q.transformMat4(s,s,y),new tt(s[0],s[1])}pixelsPerMeter(e,n){return to(1,0)*n}pixelSpaceConversion(e,n,s){let u=to(1,e)*n,h=sn(to(1,45)*n,u,s);return this.pixelsPerMeter(e,n)/h}createTileMatrix(e,n,s){let u=cx(ha(s.canonical));return r.a9.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){let{center:s}=e,u=S_(ha(n));return r.a9.rotateY(u,u,bn(s.lng)),r.a9.rotateX(u,u,bn(s.lat)),r.a9.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,s,u){return QD(e,n,s,!0)||new Fr(0,0)}pointCoordinate3D(e,n,s){let u=this.pointCoordinate(e,n,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!QD(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(u,h){let g=u.cameraToCenterDistance,y=u._centerAltitude*h,b=u._camera,w=u._camera.forward(),D=r.Q.add([],r.Q.scale([],w,-g),[0,0,y]),I=u.worldSize/(2*Math.PI),S=[0,0,-I],P=u.width/u.height,k=Math.tan(u.fovAboveCenter),L=r.Q.scale([],b.up(),k),B=r.Q.scale([],b.right(),k*P),V=r.Q.normalize([],r.Q.add([],r.Q.add([],w,L),B)),W=[],K;if(new rx(D,V).closestPointOnSphere(S,I,W)){let Y=r.Q.add([],W,S),se=r.Q.sub([],Y,D);K=Math.cos(u.fovAboveCenter)*r.Q.length(se)}else{let Y=r.Q.sub([],D,S),se=r.Q.sub([],S,D);r.Q.normalize(se,se);let ee=r.Q.length(Y)-I;K=Math.sqrt(ee*(ee+2*I));let le=Math.acos(K/(I+ee))-Math.acos(r.Q.dot(w,se));K*=Math.cos(le)}return 1.01*K}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=$l(e.zoom);if(s>0){let u=CC(e,to(1,e.center.lat)*e.worldSize),h=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return sn(n,u+h*(1-Math.cos(g)),Math.pow(s,10))}return n}upVector(e,n,s){return kp(n,s,e,1)}upVectorScale(e){return{metersToTile:D_(C_(ha(e)))}}}function kC(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new MC(t);case"equirectangular":return new zL(t);case"naturalEarth":return new VL(t);case"equalEarth":return new NL(t);case"winkelTripel":return new jL(t);case"albers":return n?new RC(t):new LL(t);case"lambertConformalConic":return n?new RC(t):new BL(t);case"globe":return new UL(t)}throw new Error(`Invalid projection name: ${t.name}`)}let GL=F_.types,$L=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function X_(t,e,n,s,u,h,g,y,b,w,D,I,S){let P=y?Math.min(Ql,Math.round(y[0])):0,k=y?Math.min(Ql,Math.round(y[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*u),h,g,(P<<1)+(b?1:0),k,16*w,16*D,256*I,256*S)}function K_(t,e,n){t.emplaceBack(e,n)}function J_(t,e,n,s,u,h,g){t.emplaceBack(e,n,s,u,h,g)}function ey(t,e,n,s,u){t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u)}function HL(t){for(let e of t.sections)if(A(e.text))return!0;return!1}class Ox{constructor(e){this.layoutVertexArray=new as,this.indexArray=new ur,this.programConfigurations=e,this.segments=new Vi,this.dynamicLayoutVertexArray=new cr,this.opacityVertexArray=new da,this.placedSymbolArray=new yD,this.iconTransitioningVertexArray=new Do,this.globeExtVertexArray=new ls,this.zOffsetVertexArray=new Cp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,s,u,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JF.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,tL.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,$L,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,iL.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,eL.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||h)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,nL.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ht(Ox,"SymbolBuffers");class Fx{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new Vi,this.collisionVertexArray=new Os,this.collisionVertexArrayExt=new cr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,rL.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,oL.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ht(Fx,"CollisionBuffers");class ty{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.a9.identity([]),this.placementViewportMatrix=r.a9.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Tx(this.zoom,n["text-size"]),this.iconSizeData=Tx(this.zoom,n["icon-size"]);let s=this.layers[0].layout,u=s.get("symbol-sort-key"),h=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=h!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(h==="viewport-y"||h==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>Qo[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=s.get("symbol-z-elevate")}createArrays(){this.text=new Ox(new Vl(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Ox(new Vl(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new xD,this.lineVertexArray=new wD,this.symbolInstances=new bD}calculateGlyphDependencies(e,n,s,u,h){for(let g=0;g<e.length;g++){let y=e.codePointAt(g);if(y===void 0)break;if(n[y]=!0,u&&h&&y<=65535){let b=jp[e.charAt(g)];b&&(n[b.charCodeAt(0)]=!0)}}}populate(e,n,s,u){let h=this.layers[0],g=h.layout,y=this.projection.name==="globe",b=g.get("text-font"),w=g.get("text-field"),D=g.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Er&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),S=D.value.kind!=="constant"||!!D.value.value||Object.keys(D.parameters).length>0,P=g.get("symbol-sort-key");if(this.features=[],!I&&!S)return;let k=n.iconDependencies,L=n.glyphDependencies,B=n.availableImages,V=new q(this.zoom);for(let{feature:W,id:K,index:Y,sourceLayerIndex:se}of e){let ee=h._featureFilter.needGeometry,le=Gl(W,ee);if(!h._featureFilter.filter(V,le,s))continue;if(ee||(le.geometry=Ya(W,s,u)),y&&W.type!==1&&s.z<=5){let ve=le.geometry,Me=.98078528056,Se=(Ce,ze)=>{let Le=kp(Ce.x,Ce.y,s,1),Ge=kp(ze.x,ze.y,s,1);return r.Q.dot(Le,Ge)<Me};for(let Ce=0;Ce<ve.length;Ce++)ve[Ce]=kO(ve[Ce],Se)}let de,_e;if(I){let ve=h.getValueAndResolveTokens("text-field",le,s,B),Me=Er.factory(ve);HL(Me)&&(this.hasRTLText=!0),(!this.hasRTLText||ne()==="unavailable"||this.hasRTLText&&re.isParsed())&&(de=lL(Me,h,le))}if(S){let ve=h.getValueAndResolveTokens("icon-image",le,s,B);_e=ve instanceof ho?ve:ho.fromString(ve)}if(!de&&!_e)continue;let Ie=this.sortFeaturesByKey?P.evaluate(le,{},s):void 0;if(this.features.push({id:K,text:de,icon:_e,index:Y,sourceLayerIndex:se,geometry:le.geometry,properties:W.properties,type:GL[W.type],sortKey:Ie}),_e&&(k[_e.namePrimary]=!0,_e.nameSecondary&&(k[_e.nameSecondary]=!0)),de){let ve=b.evaluate(le,{},s).join(","),Me=g.get("text-rotation-alignment")==="map"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Qo.vertical)>=0;for(let Se of de.sections)if(Se.image)k[Se.image.namePrimary]=!0;else{let Ce=l(de.toString()),ze=Se.fontStack||ve,Le=L[ze]=L[ze]||{};this.calculateGlyphDependencies(Se.text,Le,Me,this.allowVerticalPlacement,Ce)}}}g.get("symbol-placement")==="line"&&(this.features=function(W){let K={},Y={},se=[],ee=0;function le(ve){se.push(W[ve]),ee++}function de(ve,Me,Se){let Ce=Y[ve];return delete Y[ve],Y[Me]=Ce,se[Ce].geometry[0].pop(),se[Ce].geometry[0]=se[Ce].geometry[0].concat(Se[0]),Ce}function _e(ve,Me,Se){let Ce=K[Me];return delete K[Me],K[ve]=Ce,se[Ce].geometry[0].shift(),se[Ce].geometry[0]=Se[0].concat(se[Ce].geometry[0]),Ce}function Ie(ve,Me,Se){let Ce=Se?Me[0][Me[0].length-1]:Me[0][0];return`${ve}:${Ce.x}:${Ce.y}`}for(let ve=0;ve<W.length;ve++){let Me=W[ve],Se=Me.geometry,Ce=Me.text?Me.text.toString():null;if(!Ce){le(ve);continue}let ze=Ie(Ce,Se),Le=Ie(Ce,Se,!0);if(ze in Y&&Le in K&&Y[ze]!==K[Le]){let Ge=_e(ze,Le,Se),je=de(ze,Le,se[Ge].geometry);delete K[ze],delete Y[Le],Y[Ie(Ce,se[je].geometry,!0)]=je,se[Ge].geometry=null}else ze in Y?de(ze,Le,Se):Le in K?_e(ze,Le,Se):(le(ve),K[ze]=ee-1,Y[Le]=ee-1)}return se.filter(ve=>ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,K)=>W.sortKey-K.sortKey)}update(e,n,s,u,h){let g=Object.keys(e).length!==0;if(g&&!this.stateDependentLayers.length)return;let y=g?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,y,s,u,h),this.icon.programConfigurations.updatePaintArrays(e,n,y,s,u,h)}updateZOffset(){let e=(h,g,y)=>{s+=g,s>h.length&&h.resize(s);for(let b=-g;b<0;b++)h.emplace(b+s,y)},n=(h,g,y)=>{u+=g,u>h.length&&h.resize(u);for(let b=-g;b<0;b++)h.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,u=0;for(let h=0;h<this.symbolInstances.length;h++){let g=this.symbolInstances.get(h),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:w}=g,D=g.zOffset,I=w>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,D),e(this.text.zOffsetVertexArray,b,D)),I){let{placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:P}=g;S>=0&&n(this.icon.zOffsetVertexArray,w,D),P>=0&&n(this.icon.zOffsetVertexArray,g.numVerticalIconVertices,D)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=kC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let s=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:u,y:h}of n)this.lineVertexArray.emplaceBack(u,h);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,u,h,g,y,b,w,D,I,S,P,k,L,B){let V=e.indexArray,W=e.layoutVertexArray,K=e.globeExtVertexArray,Y=e.segments.prepareSegment(4*n.length,W,V,this.canOverlap?g.sortKey:void 0),se=this.glyphOffsetArray.length,ee=Y.vertexLength,le=this.allowVerticalPlacement&&y===Qo.vertical?Math.PI/2:0,de=g.text&&g.text.sections;for(let Ie=0;Ie<n.length;Ie++){let{tl:ve,tr:Me,bl:Se,br:Ce,texPrimary:ze,texSecondary:Le,pixelOffsetTL:Ge,pixelOffsetBR:je,minFontScaleX:Pe,minFontScaleY:mt,glyphOffset:ct,isSDF:He,sectionIndex:Rt}=n[Ie],bt=Y.vertexLength,gt=ct[1];if(X_(W,w.x,w.y,ve.x,gt+ve.y,ze.x,ze.y,s,He,Ge.x,Ge.y,Pe,mt),X_(W,w.x,w.y,Me.x,gt+Me.y,ze.x+ze.w,ze.y,s,He,je.x,Ge.y,Pe,mt),X_(W,w.x,w.y,Se.x,gt+Se.y,ze.x,ze.y+ze.h,s,He,Ge.x,je.y,Pe,mt),X_(W,w.x,w.y,Ce.x,gt+Ce.y,ze.x+ze.w,ze.y+ze.h,s,He,je.x,je.y,Pe,mt),b){let{x:qe,y:Dt,z:Jt}=b.anchor,[Bt,rn,en]=b.up;J_(K,qe,Dt,Jt,Bt,rn,en),J_(K,qe,Dt,Jt,Bt,rn,en),J_(K,qe,Dt,Jt,Bt,rn,en),J_(K,qe,Dt,Jt,Bt,rn,en),ey(e.dynamicLayoutVertexArray,qe,Dt,Jt,le)}else ey(e.dynamicLayoutVertexArray,w.x,w.y,w.z,le);if(B){let qe=Le||ze;K_(e.iconTransitioningVertexArray,qe.x,qe.y),K_(e.iconTransitioningVertexArray,qe.x+qe.w,qe.y),K_(e.iconTransitioningVertexArray,qe.x,qe.y+qe.h),K_(e.iconTransitioningVertexArray,qe.x+qe.w,qe.y+qe.h)}V.emplaceBack(bt,bt+1,bt+2),V.emplaceBack(bt+1,bt+2,bt+3),Y.vertexLength+=4,Y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),Ie!==n.length-1&&Rt===n[Ie+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,g,g.index,{},P,k,L,de&&de[Rt])}let _e=b?b.anchor:w;e.placedSymbolArray.emplaceBack(_e.x,_e.y,_e.z,w.x,w.y,se,this.glyphOffsetArray.length-se,ee,D,I,w.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],y,0,!1,0,S,0)}_commitLayoutVertex(e,n,s,u,h,g,y){e.emplaceBack(n,s,u,h,g,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,s,u,h,g,y){let b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),w=b.vertexLength,D=y.tileAnchorX,I=y.tileAnchorY;for(let P=0;P<4;P++)s.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(s.layoutVertexArray,u,h,g,D,I,new tt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,h,g,D,I,new tt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,h,g,D,I,new tt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,h,g,D,I,new tt(e.x1,e.y2)),b.vertexLength+=4;let S=s.indexArray;S.emplaceBack(w,w+1),S.emplaceBack(w+1,w+2),S.emplaceBack(w+2,w+3),S.emplaceBack(w+3,w),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,u,h,g){for(let y=u;y<h;y++){let b=s.get(y),w=this.getSymbolInstanceTextSize(e,g,n,y);this._addCollisionDebugVertices(b,w,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,n,s,u,h,g){for(let y=u;y<h;y++){let b=s.get(y),w=this.getSymbolInstanceIconSize(e,n,g.placedIconSymbolIndex);this._addCollisionDebugVertices(b,w,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fx(Nl,JI.members,Do),this.iconCollisionBox=new Fx(Nl,JI.members,Do);let s=xh(this.iconSizeData,e),u=xh(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let g=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(u,e,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,n,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,n,s,u){let h=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),g=j_(this.textSizeData,e,h)/Sr;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,n,s){let u=this.icon.placedSymbolArray.get(s),h=j_(this.iconSizeData,e,u);return this.tilePixelRatio*h}_commitDebugCollisionVertexUpdate(e,n,s,u){e.emplaceBack(n,-s,-s,u),e.emplaceBack(n,s,-s,u),e.emplaceBack(n,s,s,u),e.emplaceBack(n,-s,s,u)}_updateTextDebugCollisionBoxes(e,n,s,u,h,g){for(let y=u;y<h;y++){let b=s.get(y),w=this.getSymbolInstanceTextSize(e,g,n,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,b.padding,g.zOffset)}}_updateIconDebugCollisionBoxes(e,n,s,u,h,g){for(let y=u;y<h;y++){let b=s.get(y),w=this.getSymbolInstanceIconSize(e,n,g.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,b.padding,g.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let s=xh(this.iconSizeData,e),u=xh(this.textSizeData,e);for(let h=0;h<this.symbolInstances.length;h++){let g=this.symbolInstances.get(h);this._updateTextDebugCollisionBoxes(u,e,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,e,n,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,e,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,u,h,g,y,b,w){let D={};if(n<s){let{x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y,featureIndex:se}=e.get(n);D.textBox={x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y},D.textFeatureIndex=se}if(u<h){let{x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y,featureIndex:se}=e.get(u);D.verticalTextBox={x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y},D.verticalTextFeatureIndex=se}if(g<y){let{x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y,featureIndex:se}=e.get(g);D.iconBox={x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y},D.iconFeatureIndex=se}if(b<w){let{x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y,featureIndex:se}=e.get(b);D.verticalIconBox={x1:I,y1:S,x2:P,y2:k,padding:L,projectedAnchorX:B,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:K,tileAnchorY:Y},D.verticalIconFeatureIndex=se}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let s=e.placedSymbolArray.get(n),u=s.vertexStartIndex+4*s.numGlyphs;for(let h=s.vertexStartIndex;h<u;h+=4)e.indexArray.emplaceBack(h,h+1,h+2),e.indexArray.emplaceBack(h+1,h+2,h+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),s=Math.cos(e),u=[],h=[],g=[];for(let y=0;y<this.symbolInstances.length;++y){g.push(y);let b=this.symbolInstances.get(y);u.push(0|Math.round(n*b.tileAnchorX+s*b.tileAnchorY)),h.push(b.featureIndex)}return g.sort((y,b)=>u[y]-u[b]||h[b]-h[y]),g}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);let{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:h,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:w}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ht(ty,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ty.addDynamicAttributes=ey;let qL=new ge({"symbol-placement":new he(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new he(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new he(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ye(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new he(ie.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new he(ie.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new he(ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new he(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new he(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new he(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new ye(ie.layout_symbol["icon-size"]),"icon-text-fit":new ye(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ye(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new ye(ie.layout_symbol["icon-image"]),"icon-rotate":new ye(ie.layout_symbol["icon-rotate"]),"icon-padding":new he(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new he(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new ye(ie.layout_symbol["icon-offset"]),"icon-anchor":new ye(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new he(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new he(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new he(ie.layout_symbol["text-rotation-alignment"]),"text-field":new ye(ie.layout_symbol["text-field"]),"text-font":new ye(ie.layout_symbol["text-font"]),"text-size":new ye(ie.layout_symbol["text-size"]),"text-max-width":new ye(ie.layout_symbol["text-max-width"]),"text-line-height":new ye(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new ye(ie.layout_symbol["text-letter-spacing"]),"text-justify":new ye(ie.layout_symbol["text-justify"]),"text-radial-offset":new ye(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new he(ie.layout_symbol["text-variable-anchor"]),"text-anchor":new ye(ie.layout_symbol["text-anchor"]),"text-max-angle":new he(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new he(ie.layout_symbol["text-writing-mode"]),"text-rotate":new ye(ie.layout_symbol["text-rotate"]),"text-padding":new he(ie.layout_symbol["text-padding"]),"text-keep-upright":new he(ie.layout_symbol["text-keep-upright"]),"text-transform":new ye(ie.layout_symbol["text-transform"]),"text-offset":new ye(ie.layout_symbol["text-offset"]),"text-allow-overlap":new he(ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new he(ie.layout_symbol["text-ignore-placement"]),"text-optional":new he(ie.layout_symbol["text-optional"]),visibility:new he(ie.layout_symbol.visibility)});var Lx={paint:new ge({"icon-opacity":new ye(ie.paint_symbol["icon-opacity"]),"icon-emissive-strength":new ye(ie.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new ye(ie.paint_symbol["text-emissive-strength"]),"icon-color":new ye(ie.paint_symbol["icon-color"]),"icon-halo-color":new ye(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new ye(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ye(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new he(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new he(ie.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ye(ie.paint_symbol["icon-image-cross-fade"]),"text-opacity":new ye(ie.paint_symbol["text-opacity"]),"text-color":new ye(ie.paint_symbol["text-color"],{runtimeType:uo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ye(ie.paint_symbol["text-halo-color"]),"text-halo-width":new ye(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new ye(ie.paint_symbol["text-halo-blur"]),"text-translate":new he(ie.paint_symbol["text-translate"]),"text-translate-anchor":new he(ie.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new he(ie.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new he(ie.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new he(ie.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new he(ie.paint_symbol["icon-color-brightness-max"])}),layout:qL};class OC{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ln,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ht(OC,"FormatSectionOverride",{omit:["defaultValue"]});class ny extends on{constructor(e,n,s){super(e,Lx,n,s),this._colorAdjustmentMatrix=r.a9.identity([])}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let s=this.layout.get("text-writing-mode");if(s){let u=[];for(let h of s)u.indexOf(h)<0&&u.push(h);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,s,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===s&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(h,g,y,b){h=Cg(h),g=jo(g);let w=r.a9.create(),D=h/3,I=1-2*D,S=[I,D,D,0,D,I,D,0,D,D,I,0,0,0,0,1],P=.5-.5*g,k=b-y;return r.a9.multiply(w,[k,0,0,0,0,k,0,0,0,0,k,0,y,y,y,1],[g,0,0,0,0,g,0,0,0,0,g,0,P,P,P,1]),r.a9.multiply(w,w,S),w}(e,n,s,u),this._saturation=e,this._contrast=n,this._brightnessMin=s,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,s,u){let h=this.layout.get(e).evaluate(n,{},s,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||lh(g.value)||!h?h:function(y,b){return b.replace(/{([^{}]+)}/g,(w,D)=>D in y?String(y[D]):"")}(n.properties,h)}createBucket(e){return new ty(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of Lx.paint.overridableProperties){if(!ny.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),s=new OC(n),u=new ah(s,n.property.specification,this.scope,this.options),h=null;h=n.value.kind==="constant"||n.value.kind==="source"?new au("source",u):new lu("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new be(n.property,h,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&ny.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let s=e.get("text-field"),u=Lx.paint.properties[n],h=!1,g=y=>{for(let b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(h=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Er)g(s.value.value.sections);else if(s.value.kind==="source"){let y=w=>{h||(w instanceof rs&&Qi(w.value)===El?g(w.value.sections):w instanceof Hc?g(w.sections):w.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return h}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,s=[];return e&&s.push("symbolIcon"),n&&s.push("symbolSDF"),s}getDefaultProgramParams(e,n){return{config:new gu(this,n),overrideFog:!1}}}let WL=new ge({visibility:new he(ie.layout_background.visibility)});var ZL={paint:new ge({"background-color":new he(ie.paint_background["background-color"]),"background-pattern":new he(ie.paint_background["background-pattern"]),"background-opacity":new he(ie.paint_background["background-opacity"]),"background-emissive-strength":new he(ie.paint_background["background-emissive-strength"])}),layout:WL};let QL=new ge({visibility:new he(ie.layout_raster.visibility)});var YL={paint:new ge({"raster-opacity":new he(ie.paint_raster["raster-opacity"]),"raster-color":new Ve(ie.paint_raster["raster-color"]),"raster-color-mix":new he(ie.paint_raster["raster-color-mix"]),"raster-color-range":new he(ie.paint_raster["raster-color-range"]),"raster-hue-rotate":new he(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new he(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new he(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new he(ie.paint_raster["raster-saturation"]),"raster-contrast":new he(ie.paint_raster["raster-contrast"]),"raster-resampling":new he(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new he(ie.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new he(ie.paint_raster["raster-emissive-strength"]),"raster-array-band":new he(ie.paint_raster["raster-array-band"]),"raster-elevation":new he(ie.paint_raster["raster-elevation"])}),layout:QL},Nx=Qt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class zx{constructor(e,n,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,s){let{width:u,height:h}=e,{context:g}=this,{gl:y}=g;if(y.bindTexture(y.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!n||n.premultiply!==!1)),s||this.size&&this.size[0]===u&&this.size[1]===h){let{x:b,y:w}=s||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,w,y.RGBA,y.UNSIGNED_BYTE,e);else{let D=this.format,I=y.UNSIGNED_BYTE;this.format===y.R32F&&(D=y.RED,I=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,w,u,h,D,I,e.data)}}else if(this.size=[u,h],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,e)}else{let b=this.format,w=this.format,D=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,D=y.UNSIGNED_SHORT),this.format===y.R8&&(w=y.RED),this.format===y.R32F&&(D=y.FLOAT,w=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,u,h,0,w,D,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,n,s=!1){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,s,u){let{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),n!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),this.wrapS=s),u!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class iy{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}function ry(t,e,n,s,u,h,g,y){let b=[t,e,1,n,s,1,u,h,1],w=[g,y,1],D=r.ct.adjoint([],b),[I,S,P]=r.Q.transformMat3(w,w,D);return r.ct.multiply(b,b,[I,0,0,0,S,0,0,0,P])}function FC(t,e,n,s,u,h,g,y){let b=function(w,D,I,S,P,k,L,B){let V=ry(0,0,1,0,1,1,0,1),W=ry(w,D,I,S,P,k,L,B),K=r.ct.adjoint([],V);return r.ct.multiply(W,W,K)}(t,e,n,s,u,h,g,y);return[b[2]/b[8]/nt,b[5]/b[8]/nt]}function oy(t){return[t[0],Math.min(Math.max(t[1],-ji),ji)]}class LC extends La{constructor(e,n,s,u){super(),this.id=e,this.dispatcher=s,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new ia("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Gf(this.map._requestManager.transformRequest(this.url,Md.Image),(s,u)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new zd(s)):u&&(this.image=u instanceof HTMLImageElement?ns.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new iy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ia("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof iy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],s=e[0][1];for(let h of e)h[1]>s&&(s=h[1]),h[1]<n&&(n=h[1]);let u=(s+n)/2;if(u>ji?this.onNorthPole=!0:u<-ji&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let h=e.map(Fr.fromLngLat);this.tileID=function(g){let y=1/0,b=1/0,w=-1/0,D=-1/0;for(let L of g)y=Math.min(y,L.x),b=Math.min(b,L.y),w=Math.max(w,L.x),D=Math.max(D,L.y);let I=Math.max(w-y,D-b),S=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),P=Math.pow(2,S),k=Math.floor((y+w)/2*P);return k>1&&(k-=1),new yu(S,k,Math.floor((b+D)/2*P))}(h),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ia("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let V in this.tiles){let W=this.tiles[V];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=Hp(new yu(0,0,0),this.map.transform.projection),s=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){let W=V[1].x-V[0].x,K=V[1].y-V[0].y,Y=V[2].x-V[1].x,se=V[2].y-V[1].y,ee=V[3].x-V[2].x,le=V[3].y-V[2].y,de=V[0].x-V[3].x,_e=V[0].y-V[3].y,Ie=W*se-Y*K,ve=Y*le-ee*se,Me=ee*_e-de*le,Se=de*K-W*_e;return Ie>0&&ve>0&&Me>0&&Se>0||Ie<0&&ve<0&&Me<0&&Se<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let u=Hp(this.tileID,this.map.transform.projection),[h,g,y,b]=this.coordinates.map(V=>{let W=u.projection.project(V[0],V[1]);return SC(u,W)._round()});this.perspectiveTransform=FC(h.x,h.y,g.x,g.y,y.x,y.y,b.x,b.y);let w=this._boundsArray=new Ir;w.emplaceBack(h.x,h.y,0,0),w.emplaceBack(g.x,g.y,nt,0),w.emplaceBack(b.x,b.y,0,nt),w.emplaceBack(y.x,y.y,nt,nt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(w,Nx.members),this.boundsSegments=Vi.simpleSegment(0,0,4,2);let D=[],I=[oy((S=this.coordinates)[0]),oy(S[1]),oy(S[2]),oy(S[3])];var S;let[P,k,L,B]=function(V){let W=V[0][0],K=W,Y=V[0][1],se=Y;for(let ee=1;ee<V.length;ee++)V[ee][0]<W?W=V[ee][0]:V[ee][0]>K&&(K=V[ee][0]),V[ee][1]<Y?Y=V[ee][1]:V[ee][1]>se&&(se=V[ee][1]);return[W,Y,K-W,se-Y]}(I);{let V=new Ir,[W,K,Y,se]=function(Ge){let je=Ge[0].x,Pe=je,mt=Ge[0].y,ct=mt;for(let He=1;He<Ge.length;He++)Ge[He].x<je?je=Ge[He].x:Ge[He].x>Pe&&(Pe=Ge[He].x),Ge[He].y<mt?mt=Ge[He].y:Ge[He].y>ct&&(ct=Ge[He].y);return[je,mt,Pe-je,ct-mt]}(s),ee=Ge=>[(Ge.x-W)/Y,(Ge.y-K)/se],[le,de,_e,Ie]=s.map(ee),ve=function(Ge,je,Pe,mt,ct,He,Rt,bt){let gt=ry(0,0,1,0,1,1,0,1),qe=ry(Ge,je,Pe,mt,ct,He,Rt,bt),Dt=r.ct.adjoint([],qe);return r.ct.multiply(gt,gt,Dt)}(le[0],le[1],de[0],de[1],_e[0],_e[1],Ie[0],Ie[1]);this.elevatedGlobePerspectiveTransform=FC(le[0],le[1],de[0],de[1],_e[0],_e[1],Ie[0],Ie[1]);let Me=(Ge,je)=>{D.push(Ge.lng);let Pe=Math.round((Ge.lng-P)/L*nt),mt=Math.round((Ge.lat-k)/B*nt),ct=ee(je),He=r.Q.transformMat3([],[ct[0],ct[1],1],ve),Rt=Math.round(He[0]/He[2]*nt),bt=Math.round(He[1]/He[2]*nt);V.emplaceBack(Pe,mt,Rt,bt)},Se=s[3].x-s[0].x,Ce=s[3].y-s[0].y,ze=s[2].x-s[1].x,Le=s[2].y-s[1].y;for(let Ge=0;Ge<65;Ge++){let je=Ge/64,Pe=[s[0].x+je*Se,s[0].y+je*Ce],mt=[s[1].x+je*ze,s[1].y+je*Le],ct=mt[0]-Pe[0],He=mt[1]-Pe[1];for(let Rt=0;Rt<65;Rt++){let bt=Rt/64,gt={x:Pe[0]+ct*bt,y:Pe[1]+He*bt,z:0};Me(n.projection.unproject(gt.x,gt.y),gt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,Nx.members)}{this.maxLongitudeTriangleSize=0;let V=[],W=new ur,K=(Y,se,ee)=>{W.emplaceBack(Y,se,ee);let le=D[Y],de=D[se],_e=D[ee],Ie=Math.min(Math.min(le,de),_e),ve=Math.max(Math.max(le,de),_e)-Ie;ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ve),V.push(Ie+ve/2)};for(let Y=0;Y<64;Y++)for(let se=0;se<64;se++){let ee=65*Y+se,le=ee+1,de=ee+65,_e=de+1;K(ee,de,le),K(le,de,_e)}[V,W]=function(Y,se){let ee=Array.from({length:Y.length},(_e,Ie)=>Ie);ee.sort((_e,Ie)=>Y[_e]-Y[Ie]);let le=[],de=new ur;for(let _e=0;_e<ee.length;_e++){let Ie=ee[_e];le.push(Y[Ie]);let ve=3*Ie,Me=ve+1;de.emplaceBack(se.uint16[ve],se.uint16[Me],se.uint16[Me+1])}return[le,de]}(V,W),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=Vi.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,L/nt,0,B/nt,0,0,k,P,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,s=n.gl;!this._dirty||this.texture instanceof iy||(this.texture?this.texture.update(this.image):(this.texture=new zx(n,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let s=this.elevatedGlobeTrianglesCenterLongitudes,u=((D,I)=>D+360*Math.round((I-D)/360))(e+180,s[0]),h=new Vi,g=(D,I)=>{h.segments.push({vertexOffset:0,primitiveOffset:D,vertexLength:n.segments[0].vertexLength,primitiveLength:I,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-u)<=y){let D=zf(s,0,s.length,u+y);return D===s.length||g(D,Oa(s,D+1,s.length,u+360-y)-D),h}u<s[0]&&(u+=360);let b=Oa(s,0,s.length,u-y);if(b===s.length)return g(0,s.length),h;g(0,b-0);let w=zf(s,b+1,s.length,u+y);return w!==s.length&&g(w,s.length-w),h}}let XL=(Math.pow(256,2)-1)/16907520;class NC extends on{constructor(e,n,s){super(e,YL,n,s),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof LC&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;let n=this._transitionablePaint._values["raster-color"].value.expression,[s,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(u)||s===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Op({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,u])}}let KL=new ge({visibility:new he(ie["layout_raster-particle"].visibility)});var JL={paint:new ge({"raster-particle-array-band":new he(ie["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new he(ie["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ve(ie["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new he(ie["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new he(ie["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new he(ie["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new he(ie["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:KL};class zC extends on{constructor(e,n,s){super(e,JL,n,s),this._updateColorRamp(),this.lastInvalidatedAt=ns.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;let e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Op({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ns.now()}}class eN extends on{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let tN=new ge({visibility:new he(ie.layout_sky.visibility)});var nN={paint:new ge({"sky-type":new he(ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new he(ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new he(ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new he(ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new he(ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ve(ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new he(ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new he(ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new he(ie.paint_sky["sky-opacity"])}),layout:tN};function Bx(t,e,n){let s=[0,0,1],u=r.bl.identity([]);return r.bl.rotateY(u,u,n?-bn(t)+Math.PI:bn(t)),r.bl.rotateX(u,u,-bn(e)),r.Q.transformQuat(s,s,u),r.Q.normalize(s,s)}var iN={paint:new ge({})};function BC(t,e){let n=sy(t.projection,t.zoom,t.width,t.height),s=function(h,g,y,b,w){let D=new En(y.lng-180*Xl,y.lat),I=new En(y.lng+180*Xl,y.lat),S=h.project(D.lng,D.lat),P=h.project(I.lng,I.lat),k=-Math.atan2(P.y-S.y,P.x-S.x),L=Fr.fromLngLat(y);L.y=hn(L.y,-1+Xl,1-Xl);let B=L.toLngLat(),V=h.project(B.lng,B.lat),W=Fr.fromLngLat(B);W.x+=Xl;let K=W.toLngLat(),Y=h.project(K.lng,K.lat),se=UC(Y.x-V.x,Y.y-V.y,k),ee=Fr.fromLngLat(B);ee.y+=Xl;let le=ee.toLngLat(),de=h.project(le.lng,le.lat),_e=UC(de.x-V.x,de.y-V.y,k),Ie=Math.abs(se.x)/Math.abs(_e.y),ve=r.a9.identity([]);r.a9.rotateZ(ve,ve,-k*(1-(w?0:b)));let Me=r.a9.identity([]);return r.a9.scale(Me,Me,[1,1-(1-Ie)*b,1]),Me[4]=-_e.x/_e.y*b,r.a9.rotateZ(Me,Me,k),r.a9.multiply(Me,ve,Me),Me}(t.projection,0,t.center,n,e),u=VC(t);return r.a9.scale(s,s,[u,u,1]),s}function VC(t){let e=t.projection,n=sy(t.projection,t.zoom,t.width,t.height),s=jC(e,t.center),u=jC(e,En.convert(e.center));return Math.pow(2,s*n+(1-n)*u)}function sy(t,e,n,s,u=1/0){let h=t.range;if(!h)return 0;let g=Math.min(u,Math.max(n,s)),y=Math.log(g/1024)/Math.LN2;return Ic(h[0]+y,h[1]+y,e)}let Xl=1/4e4;function jC(t,e){let n=hn(e.lat,-ji,ji),s=new En(e.lng-180*Xl,n),u=new En(e.lng+180*Xl,n),h=t.project(s.lng,n),g=t.project(u.lng,n),y=Fr.fromLngLat(s),b=Fr.fromLngLat(u),w=g.x-h.x,D=g.y-h.y,I=b.x-y.x,S=b.y-y.y,P=Math.sqrt((I*I+S*S)/(w*w+D*D));return Math.log(P)/Math.LN2}function UC(t,e,n){let s=Math.cos(n),u=Math.sin(n);return{x:t*s-e*u,y:t*u+e*s}}function GC(t,e,n){r.a9.identity(t),r.a9.rotateZ(t,t,bn(e[2])),r.a9.rotateX(t,t,bn(e[0])),r.a9.rotateY(t,t,bn(e[1])),r.a9.scale(t,t,n),r.a9.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ay(t,e,n,s,u,h,g,y){let b=[n[0]-e[0],n[1]-e[1],0],w=[s[0]-e[0],s[1]-e[1],0];if(r.Q.length(b)<1e-12||r.Q.length(w)<1e-12)return r.bl.identity(t);let D=r.Q.cross([],b,w);r.Q.normalize(D,D),r.Q.subtract(w,s,e),b[2]=(h-u)*y,w[2]=(g-u)*y;let I=b;return r.Q.cross(I,b,w),r.Q.normalize(I,I),r.bl.rotationTo(t,D,I)}function Vx(t,e,n=!1){let s=$l(e.zoom),u=function(h,g,y){let b=g.worldSize,w=[h[12],h[13],h[14]],D=Cr(w[1]/b),I=Io(w[0]/b),S=r.a9.identity([]),P=to(1,D)*b,k=to(1,0)*b*vu(D,g.zoom),L=1/ux(b),B=k*L;if(y){let Y=sy(g.projection,g.zoom,g.width,g.height,1024);B=L*g.projection.pixelSpaceConversion(g.center.lat,b,Y)}let V=_u(D,I);r.Q.add(V,V,r.Q.scale([],r.Q.normalize([],V),P*B*w[2]));let W=function(Y){let se=[Y[0],Y[1],Y[2]],ee=[0,1,0],le=r.Q.cross([],ee,se);return r.Q.cross(ee,se,le),r.Q.squaredLength(ee)===0&&(ee=[0,1,0],r.Q.cross(le,se,ee)),r.Q.normalize(le,le),r.Q.normalize(ee,ee),r.Q.normalize(se,se),[le[0],le[1],le[2],0,ee[0],ee[1],ee[2],0,se[0],se[1],se[2],0,Y[0],Y[1],Y[2],1]}(V);r.a9.scale(S,S,[B,B,B*P]),r.a9.translate(S,S,[-w[0],-w[1],-w[2]]);let K=r.a9.multiply([],g.globeMatrix,W);return r.a9.multiply(K,K,S),r.a9.multiply(K,K,h),K}(t,e,n);if(s>0){let h=function(g,y){let b=y.worldSize,w=to(1,0)*b*vu(y.center.lat,y.zoom)/ux(b),D=to(1,y.center.lat)*b,I=r.a9.identity([]);return r.a9.rotateY(I,I,bn(y.center.lng)),r.a9.rotateX(I,I,bn(y.center.lat)),r.a9.translate(I,I,[0,0,eo]),r.a9.scale(I,I,[w,w,w*D]),r.a9.translate(I,I,[y.point.x-.5*b,y.point.y-.5*b,0]),r.a9.multiply(I,I,g),r.a9.multiply(I,y.globeMatrix,I)}(t,e);return function(g,y,b){let w=(k,L,B)=>{let V=r.Q.length(k),W=r.Q.length(L),K=Xa(k,L,B);return r.Q.scale(K,K,1/r.Q.length(K)*sn(V,W,B))},D=w([g[0],g[1],g[2]],[y[0],y[1],y[2]],b),I=w([g[4],g[5],g[6]],[y[4],y[5],y[6]],b),S=w([g[8],g[9],g[10]],[y[8],y[9],y[10]],b),P=Xa([g[12],g[13],g[14]],[y[12],y[13],y[14]],b);return[D[0],D[1],D[2],0,I[0],I[1],I[2],0,S[0],S[1],S[2],0,P[0],P[1],P[2],1]}(u,h,s)}return u}function $C(t,e,n,s){let u=gi.projectAabbCorners(s,n),h=Number.MAX_VALUE,g=-1;for(let w=0;w<u.length;++w){let D=u[w];D[0]=(.5*D[0]+.5)*e.width,D[1]=(.5-.5*D[1])*e.height,D[2]<h&&(g=w,h=D[2])}let y=w=>new tt(u[w][0],u[w][1]),b;switch(g){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(ex(t,b))return h}let rN=Qt([{name:"a_pos_3f",components:3,type:"Float32"}]),oN=Qt([{name:"a_color_3f",components:3,type:"Float32"}]),sN=Qt([{name:"a_color_4f",components:4,type:"Float32"}]),aN=Qt([{name:"a_uv_2f",components:2,type:"Float32"}]),lN=Qt([{name:"a_normal_3f",components:3,type:"Float32"}]),cN=Qt([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),uN=Qt([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class ly{constructor(e,n,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function HC(t,e){let n=t.indexOf("://")===-1;try{return new URL(t,n&&e?"http://example.com":void 0),!0}catch{return!1}}class qC{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WC{constructor(){this.instancedDataArray=new Bb,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class jx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1}populate(e,n,s,u){this.tileToMeter=b_(s);let h=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:g,id:y,index:b,sourceLayerIndex:w}of e){let D=y??(g.properties&&g.properties.hasOwnProperty("id")?g.properties.id:void 0),I=Gl(g,h);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),I,s))continue;let S={id:D,sourceLayerIndex:w,index:b,geometry:h?I.geometry:Ya(g,s,u),properties:g.properties,type:g.type,patterns:{}},P=this.addFeature(S,S.geometry,I);P&&n.featureIndex.insert(g,S.geometry,b,w,this.index,this.instancesPerModel[P].instancedDataArray.length,nt/32)}this.lookup=null}update(e,n,s,u){for(let h in this.instancesPerModel){let g=this.instancesPerModel[h];for(let y in e)g.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(g.features[g.idToFeaturesIndex[y]],e[y],g,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let s=this.instancesPerModel[n];for(let u of s.features){let h=this.layers[0],g=u.feature,y=this.canonical,b=h.paint.get("model-rotation").evaluate(g,{},y),w=h.paint.get("model-scale").evaluate(g,{},y),D=h.paint.get("model-translation").evaluate(g,{},y);r.Q.exactEquals(u.rotation,b)&&r.Q.exactEquals(u.scale,w)&&r.Q.exactEquals(u.translation,D)||(this.evaluate(u,u.featureStates,s,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let s=this.instancesPerModel[n];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,cN.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let n in this.instancesPerModel){let s=this.instancesPerModel[n];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}let e=this.layers[0].modelManager;if(e&&this.modelUris)for(let n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,s){let u=this.layers[0],h=u.layout.get("model-id").evaluate(s,{},this.canonical);if(!h)return Ii(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),h;HC(h,!1)&&(this.modelUris.includes(h)||this.modelUris.push(h)),this.instancesPerModel[h]||(this.instancesPerModel[h]=new WC);let g=this.instancesPerModel[h],y=g.instancedDataArray,b=new qC(s,y.length);for(let w of n)for(let D of w){if(D.x<0||D.x>=nt||D.y<0||D.y>=nt)continue;let I=(this.lookupDim-1)/nt,S=this.lookupDim*(D.y*I|0)+D.x*I|0;if(this.lookup){if(this.lookup[S]!==0)continue;this.lookup[S]=1}this.instanceCount++;let P=y.length;y.resize(P+1),g.instancesEvaluatedElevation.push(0),y.float32[16*P]=D.x,y.float32[16*P+1]=D.y}return b.instancedDataCount=g.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(g.idToFeaturesIndex[e.id]=g.features.length),g.features.push(b),this.evaluate(b,{},g,!1)),h}getModelUris(){return this.modelUris}evaluate(e,n,s,u){let h=this.layers[0],g=e.feature,y=this.canonical,b=e.rotation=h.paint.get("model-rotation").evaluate(g,n,y),w=e.scale=h.paint.get("model-scale").evaluate(g,n,y),D=e.translation=h.paint.get("model-translation").evaluate(g,n,y),I=h.paint.get("model-color").evaluate(g,n,y);I.a=h.paint.get("model-color-mix-intensity").evaluate(g,n,y);let S=[];this.maxVerticalOffset<D[2]&&(this.maxVerticalOffset=D[2]),this.maxScale=Math.max(Math.max(this.maxScale,w[0]),Math.max(w[1],w[2])),GC(S,b,w);let P=Math.round(100*I.a)+I.b/1.05;for(let k=0;k<e.instancedDataCount;++k){let L=e.instancedDataOffset+k,B=16*L,V=s.instancedDataArray.float32,W=0;u&&(W=V[B+6]-s.instancesEvaluatedElevation[L]);let K=0|V[B+1];V[B]=(0|V[B])+I.r/1.05,V[B+1]=K+I.g/1.05,V[B+2]=P,V[B+3]=1/(y.z>10?this.tileToMeter:b_(y,K)),V[B+4]=D[0],V[B+5]=D[1],V[B+6]=D[2]+W,V[B+7]=S[0],V[B+8]=S[1],V[B+9]=S[2],V[B+10]=S[4],V[B+11]=S[5],V[B+12]=S[6],V[B+13]=S[8],V[B+14]=S[9],V[B+15]=S[10],s.instancesEvaluatedElevation[L]=D[2]}}}ht(jx,"ModelBucket",{omit:["layers"]}),ht(WC,"PerModelAttributes"),ht(qC,"ModelFeature");let dN=new ge({visibility:new he(ie.layout_model.visibility),"model-id":new ye(ie.layout_model["model-id"])});var hN={paint:new ge({"model-opacity":new he(ie.paint_model["model-opacity"]),"model-rotation":new ye(ie.paint_model["model-rotation"]),"model-scale":new ye(ie.paint_model["model-scale"]),"model-translation":new ye(ie.paint_model["model-translation"]),"model-color":new ye(ie.paint_model["model-color"]),"model-color-mix-intensity":new ye(ie.paint_model["model-color-mix-intensity"]),"model-type":new he(ie.paint_model["model-type"]),"model-cast-shadows":new he(ie.paint_model["model-cast-shadows"]),"model-receive-shadows":new he(ie.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new he(ie.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new ye(ie.paint_model["model-emissive-strength"]),"model-roughness":new ye(ie.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new ye(ie.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new he(ie.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new he(ie.paint_model["model-front-cutoff"])}),layout:dN};let wu=64,Mh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function ZC(t,e,n,s,u,h,g,y,b,w=!1){let D=n.zoom,I=n.project(s),S=vu(s.lat,D),P=1/S;r.a9.identity(t),r.a9.translate(t,t,[I.x+g[0]*P,I.y+g[1]*P,g[2]]);let k=1,L=1,B=n.worldSize;if(w){if(n.projection.name==="mercator"){let Y=0;n.elevation&&(Y=n.elevation.getAtPointOrZero(new Fr(I.x/B,I.y/B),0));let se=r.aa.transformMat4([],[I.x,I.y,Y,1],n.projMatrix)[3]/n.cameraToCenterDistance;k=se,L=se*vu(n.center.lat,D)}else if(n.projection.name==="globe"){let Y=Vx(t,n),se=r.a9.multiply([],n.projMatrix,Y),ee=[0,0,0,1];r.aa.transformMat4(ee,ee,se);let le=ee[3]/n.cameraToCenterDistance,de=$l(D),_e=n.projection.pixelsPerMeter(s.lat,B)*vu(s.lat,D),Ie=n.projection.pixelsPerMeter(n.center.lat,B)*vu(n.center.lat,D);k=le/sn(_e,FD(n.center.lat),de),L=le*S/_e,k*=Ie,L*=Ie}}else k=P;r.a9.scale(t,t,[k,k,L]);let V=[...t],W=e.orientation,K=[];if(GC(K,[W[0]+u[0],W[1]+u[1],W[2]+u[2]],h),r.a9.multiply(t,V,K),y&&n.elevation){let Y=0,se=[];if(b&&n.elevation){Y=function(de,_e,Ie,ve,Me){let Se=_e.elevation;if(!Se)return 0;let Ce=gi.projectAabbCorners(Ie,ve),ze=to(1,Me.lat)*_e.worldSize,Le=function(Dt,Jt){let Bt=[0,0,1],rn=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let en of rn){let un=Dt[en.corners[0]],Lt=Dt[en.corners[1]],Yn=Dt[en.corners[2]],$n=[Lt[0]-un[0],Lt[1]-un[1],Jt*(Lt[2]-un[2])],In=r.Q.cross($n,$n,[Yn[0]-un[0],Yn[1]-un[1],Jt*(Yn[2]-un[2])]);r.Q.normalize(In,In),en.dotProductWithUp=r.Q.dot(In,Bt)}return rn.sort((en,un)=>en.dotProductWithUp-un.dotProductWithUp),rn[0].corners}(Ce,ze),Ge=Ce[Le[0]],je=Ce[Le[1]],Pe=Ce[Le[2]],mt=Ce[Le[3]],ct=Se.getAtPointOrZero(new Fr(Ge[0]/_e.worldSize,Ge[1]/_e.worldSize),0),He=Se.getAtPointOrZero(new Fr(je[0]/_e.worldSize,je[1]/_e.worldSize),0),Rt=Se.getAtPointOrZero(new Fr(Pe[0]/_e.worldSize,Pe[1]/_e.worldSize),0),bt=Se.getAtPointOrZero(new Fr(mt[0]/_e.worldSize,mt[1]/_e.worldSize),0),gt=(ct+bt)/2,qe=(He+Rt)/2;return gt>qe?He<Rt?ay(de,je,mt,Ge,He,bt,ct,ze):ay(de,Pe,Ge,mt,Rt,ct,bt,ze):ct<bt?ay(de,Ge,je,Pe,ct,He,Rt,ze):ay(de,mt,Pe,je,bt,Rt,He,ze),Math.max(gt,qe)}(se,n,e.aabb,t,s);let ee=r.a9.fromQuat([],se),le=r.a9.multiply([],ee,K);r.a9.multiply(t,V,le)}else Y=n.elevation.getAtPointOrZero(new Fr(I.x/B,I.y/B),0);Y!==0&&(t[14]+=Y)}}function Yp(t,e,n=!1){t.uploaded||(t.gfxTexture=new zx(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function fN(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,rN.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,lN.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,aN.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?oN:sN).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,uN.members,!0)),t.segments=Vi.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let s=t.material;s.pbrMetallicRoughness.baseColorTexture&&Yp(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Yp(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Yp(s.normalTexture,e),s.occlusionTexture&&Yp(s.occlusionTexture,e,n),s.emissionTexture&&Yp(s.emissionTexture,e)}function Ux(t,e,n){if(t.meshes)for(let s of t.meshes)fN(s,e,n);if(t.children)for(let s of t.children)Ux(s,e,n)}function cy(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)cy(e)}function Gx(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)Gx(n)}class pN{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class mN{constructor(){this.tasks={},this.taskQueue=[],Ff(["process"],this),this.invoker=new pN(this.process),this.nextId=0}add(e,n){let s=this.nextId++,u=function({type:h,isSymbolTile:g,zoom:y}){return y=y||0,h==="message"?0:h!=="maybePrepare"||g?h!=="parseTile"||g?h==="parseTile"&&g?300-y:h==="maybePrepare"&&g?400-y:500:200-y:100-y}(n);if(u===0){Ms();try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:n,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Ms();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){let h=this.tasks[this.taskQueue[u]];h.priority<n&&(n=h.priority,e=u)}if(e===null)return null;let s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class QC{constructor(e,n,s){this.target=e,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Ff(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new mN}send(e,n,s,u,h=!1,g){let y=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[y]=s);let b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!s,targetMapId:u,mustQueue:h,sourceMapId:this.mapId,data:uu(n,b)},b),{cancel:()=>{s&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){let n=e.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u.cancel()}else if(n.mustQueue||Ms()){let u=this.callbacks[s],h=this.scheduler.add(()=>this.processTask(s,n),u&&u.metadata||{type:"message"});h&&(this.cancelCallbacks[s]=h)}else this.processTask(s,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let s=this.callbacks[e];delete this.callbacks[e],s&&(n.error?s(f(n.error)):s(null,f(n.data)))}else{let s=new Set,u=n.hasCallback?(g,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:g?uu(g):null,data:uu(y,s)},s)}:g=>{},h=f(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,h,u);else if(this.parent.getWorkerSource){let g=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,g[0],h.source,h.scope)[g[1]](h,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let $x=(()=>{class t{constructor(n,s){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Sn();let u=this.workerPool.acquire(this.id);for(let h=0;h<u.length;h++){let g=new t.Actor(u[h],s,this.id);g.name=`Worker ${h}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,s,u){kf(this.actors,(h,g)=>{h.send(n,s,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=QC,t})();var Xp={workerUrl:"",workerClass:null,workerParams:void 0};function gN(){return Xp.workerClass!=null?new Xp.workerClass:new self.Worker(Xp.workerUrl,Xp.workerParams)}let Hx="mapboxgl_preloaded_worker_pool";class Kp{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Kp.workerCount;)this.workers.push(new gN);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Hx]}numActive(){return Object.keys(this.active).length}}let Jp;function uy(){return Jp||(Jp=new Kp),Jp}Kp.workerCount=2;let dy,qx,zs,Ah,Wx,Ph=null;function YC(){return Ms()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:qx||F.DRACO_URL}function XC(){if(Ms()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Ah)return Ah;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Ah=WebAssembly.validate(t)?F.MESHOPT_SIMD_URL:F.MESHOPT_URL,Ah}let hy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},_N={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},em={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function KC(t,e,n){let s=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=s,n.json.bufferViews[s]={buffer:u,byteLength:t.byteLength},n.buffers[u]=t}let Zx="KHR_draco_mesh_compression";function yN(t,e){let n=t.extensions&&t.extensions[Zx];if(!n)return;let s=new zs.Decoder,u=nS(e,n.bufferView),h=new zs.Mesh;if(!s.DecodeArrayToMesh(u,u.byteLength,h))throw new Error("Failed to decode Draco mesh");let g=e.json.accessors[t.indices],y=hy[g.componentType],b=g.count*y.BYTES_PER_ELEMENT,w=zs._malloc(b);y===Uint16Array?s.GetTrianglesUInt16Array(h,b,w):s.GetTrianglesUInt32Array(h,b,w),KC(zs.memory.buffer.slice(w,w+b),g,e),zs._free(w);for(let D of Object.keys(n.attributes)){let I=s.GetAttributeByUniqueId(h,n.attributes[D]),S=e.json.accessors[t.attributes[D]],P=_N[S.componentType],k=S.count*em[S.type]*hy[S.componentType].BYTES_PER_ELEMENT,L=zs._malloc(k);s.GetAttributeDataArrayForAllPoints(h,I,zs[P],k,L),KC(zs.memory.buffer.slice(L,L+k),S,e),zs._free(L)}s.destroy(),h.destroy(),delete t.extensions[Zx]}let fy="EXT_meshopt_compression";function vN(t,e){if(!t.extensions||!t.extensions[fy])return;let n=t.extensions[fy],s=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);Wx.decodeGltfBuffer(u,n.count,n.byteStride,s,n.mode,n.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=u.buffer,delete t.extensions[fy]}let JC=1179937895,eS=new TextDecoder("utf8");function tS(t,e){return new URL(t,e).href}function bN(t,e,n,s){return fetch(tS(t.uri,s)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function nS(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function xN(t,e,n,s){if(t.uri){let u=tS(t.uri,s);return fetch(u).then(h=>h.blob()).then(h=>createImageBitmap(h)).then(h=>{e.images[n]=h})}if(t.bufferView!==void 0){let u=nS(e,t.bufferView),h=new Blob([u],{type:t.mimeType});return createImageBitmap(h).then(g=>{e.images[n]=g})}}function iS(t,e=0,n){let s={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===JC){let D=new Uint32Array(t,e),I=2,S=(D[I++]>>2)-3,P=D[I++]>>2;if(I++,s.json=JSON.parse(eS.decode(D.subarray(I,I+P))),I+=P,I<S){let k=D[I++];I++;let L=e+(I<<2);s.buffers[0]=t.slice(L,L+k)}}else s.json=JSON.parse(eS.decode(new Uint8Array(t,e)));let{buffers:u,images:h,meshes:g,extensionsUsed:y,bufferViews:b}=s.json,w=Promise.resolve();if(u){let D=[];for(let I=0;I<u.length;I++){let S=u[I];S.uri?D.push(bN(S,s,I,n)):s.buffers[I]||(s.buffers[I]=null)}w=Promise.all(D)}return w.then(()=>{let D=[],I=y&&y.includes(Zx),S=y&&y.includes(fy);if(I&&D.push(function(){if(!zs)return dy||(dy=function(P){let k,L=null;function B(){k=new Uint8Array(L.buffer)}function V(){throw new Error("Unexpected Draco error.")}let W={a:{a:V,d:function(K,Y,se){return k.copyWithin(K,Y,Y+se)},c:function(K){let Y=k.length,se=Math.max(K>>>0,Math.ceil(1.2*Y)),ee=Math.ceil((se-Y)/65536);try{return L.grow(ee),B(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,W):P.then(K=>K.arrayBuffer()).then(K=>WebAssembly.instantiate(K,W))).then(K=>{let{Rb:Y,Qb:se,P:ee,T:le,X:de,Ja:_e,La:Ie,Qa:ve,Va:Me,Wa:Se,eb:Ce,jb:ze,f:Le,e:Ge,yb:je,zb:Pe,Ab:mt,Bb:ct,Db:He,Gb:Rt}=K.instance.exports;L=Ge;let bt=(()=>{let gt=0,qe=0,Dt=0,Jt=0;return Bt=>{Dt&&(Y(Jt),Y(gt),qe+=Dt,Dt=gt=0),gt||(qe+=128,gt=se(qe));let rn=Bt.length+7&-8,en=gt;rn>=qe&&(Dt=rn,en=Jt=se(rn));for(let un=0;un<Bt.length;un++)k[en+un]=Bt[un];return en}})();return B(),Le(),{memory:Ge,_free:Y,_malloc:se,Mesh:class{constructor(){this.ptr=ee()}destroy(){le(this.ptr)}},Decoder:class{constructor(){this.ptr=_e()}destroy(){ze(this.ptr)}DecodeArrayToMesh(gt,qe,Dt){let Jt=bt(gt),Bt=Ie(this.ptr,Jt,qe,Dt.ptr);return!!de(Bt)}GetAttributeByUniqueId(gt,qe){return{ptr:ve(this.ptr,gt.ptr,qe)}}GetTrianglesUInt16Array(gt,qe,Dt){Me(this.ptr,gt.ptr,qe,Dt)}GetTrianglesUInt32Array(gt,qe,Dt){Se(this.ptr,gt.ptr,qe,Dt)}GetAttributeDataArrayForAllPoints(gt,qe,Dt,Jt,Bt){Ce(this.ptr,gt.ptr,qe.ptr,Dt,Jt,Bt)}},DT_INT8:je(),DT_UINT8:Pe(),DT_INT16:mt(),DT_UINT16:ct(),DT_UINT32:He(),DT_FLOAT32:Rt()}})}(fetch(YC())),dy.then(P=>{zs=P,dy=void 0}))}()),S&&D.push(function(){if(Wx)return;let P=function(k){let L,B=WebAssembly.instantiateStreaming(k,{}).then(K=>{L=K.instance,L.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:B,supported:!0,decodeGltfBuffer(K,Y,se,ee,le,de){(function(_e,Ie,ve,Me,Se,Ce,ze){let Le=_e.exports.sbrk,Ge=Me+3&-4,je=Le(Ge*Se),Pe=Le(Ce.length),mt=new Uint8Array(_e.exports.memory.buffer);mt.set(Ce,Pe);let ct=Ie(je,Me,Se,Pe,Ce.length);if(ct===0&&ze&&ze(je,Ge,Se),ve.set(mt.subarray(je,je+Me*Se)),Le(je-Le(0)),ct!==0)throw new Error(`Malformed buffer data: ${ct}`)})(L,L.exports[W[le]],K,Y,se,ee,L.exports[V[de]])}}}(fetch(XC()));return P.ready.then(()=>{Wx=P})}()),h)for(let P=0;P<h.length;P++)D.push(xN(h[P],s,P,n));return(D.length?Promise.all(D):Promise.resolve()).then(()=>{if(I&&g)for(let{primitives:P}of g)for(let k of P)yN(k,s);if(S&&g&&b)for(let P of b)vN(P,s);return s})})}class rS{constructor(e,n,s,u){if(this.triangleCount=n.length/3,this.min=new tt(0,0),this.max=new tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;let[h,g]=[e[0].clone(),e[0].clone()];for(let I=1;I<e.length;++I){let S=e[I];h.x=Math.min(h.x,S.x),h.y=Math.min(h.y,S.y),g.x=Math.max(g.x,S.x),g.y=Math.max(g.y,S.y)}if(u){let I=Math.ceil(Math.max(g.x-h.x,g.y-h.y)/u);s=Math.max(s,I)}if(s===0)return;this.min=h,this.max=g;let y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);let b=Math.max(y.x,y.y)/s;this.cellsX=Math.max(1,Math.ceil(y.x/b)),this.cellsY=Math.max(1,Math.ceil(y.y/b)),this.xScale=1/b,this.yScale=1/b;let w=[];for(let I=0;I<this.triangleCount;I++){let S=e[n[3*I+0]].sub(this.min),P=e[n[3*I+1]].sub(this.min),k=e[n[3*I+2]].sub(this.min),L=Kl(Math.floor(Math.min(S.x,P.x,k.x)),this.xScale,this.cellsX),B=Kl(Math.floor(Math.max(S.x,P.x,k.x)),this.xScale,this.cellsX),V=Kl(Math.floor(Math.min(S.y,P.y,k.y)),this.yScale,this.cellsY),W=Kl(Math.floor(Math.max(S.y,P.y,k.y)),this.yScale,this.cellsY),K=new tt(0,0),Y=new tt(0,0),se=new tt(0,0),ee=new tt(0,0);for(let le=V;le<=W;++le){K.y=Y.y=le*b,se.y=ee.y=(le+1)*b;for(let de=L;de<=B;++de)K.x=se.x=de*b,Y.x=ee.x=(de+1)*b,(ix(S,P,k,K,Y,ee)||ix(S,P,k,K,ee,se))&&w.push({cellIdx:le*this.cellsX+de,triIdx:I})}}if(w.length===0)return;w.sort((I,S)=>I.cellIdx-S.cellIdx||I.triIdx-S.triIdx);let D=0;for(;D<w.length;){let I=w[D].cellIdx,S={start:this.payload.length,len:0};for(;D<w.length&&w[D].cellIdx===I;)++S.len,this.payload.push(w[D++].triIdx);this.cells[I]=S}}query(e,n,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;let u=Kl(e.x-this.min.x,this.xScale,this.cellsX),h=Kl(n.x-this.min.x,this.xScale,this.cellsX),g=Kl(e.y-this.min.y,this.yScale,this.cellsY),y=Kl(n.y-this.min.y,this.yScale,this.cellsY);for(let b=g;b<=y;b++)for(let w=u;w<=h;w++){let D=this.cells[b*this.cellsX+w];if(D)for(let I=0;I<D.len;I++){let S=this.payload[D.start+I],P=Math.floor(S/8),k=1<<S%8;if(!(this.lookup[P]&k)&&(this.lookup[P]|=k,s.push(S),s.length===this.triangleCount))return}}}}function Kl(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function Eu(t,e){let n=t.json.bufferViews[e.bufferView],s=hy[e.componentType];return new s(t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==em[e.type]*s.BYTES_PER_ELEMENT?n.byteStride/s.BYTES_PER_ELEMENT:em[e.type]))}function Qx(t,e,n,s){let u=hy[e.componentType],h=function(D){switch(D){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),g=t.json.bufferViews[e.bufferView],y=g.byteStride?g.byteStride/u.BYTES_PER_ELEMENT:em[e.type],b=n.float32,w=b.length/n.capacity;for(let D=0,I=0;D<e.count*y;D+=y,I+=w)for(let S=0;S<w;S++)b[I+S]=s[D+S]*h;n._trim()}function wN(t,e,n){let s=t.indices,u=t.attributes,h={};h.indexArray=new ur;let g=e.json.accessors[s],y=g.count/3;h.indexArray.reserve(y);let b=Eu(e,g);for(let S=0;S<y;S++)h.indexArray.emplaceBack(b[3*S],b[3*S+1],b[3*S+2]);h.indexArray._trim(),h.vertexArray=new mu;let w=e.json.accessors[u.POSITION];h.vertexArray.reserve(w.count);let D=Eu(e,w);for(let S=0;S<w.count;S++)h.vertexArray.emplaceBack(D[3*S],D[3*S+1],D[3*S+2]);if(h.vertexArray._trim(),h.aabb=new gi(w.min,w.max),h.centroid=function(S,P){let k=[0,0,0],L=S.length;if(L>0){for(let B=0;B<L;B++){let V=3*S[B];k[0]+=P[V],k[1]+=P[V+1],k[2]+=P[V+2]}k[0]/=L,k[1]/=L,k[2]/=L}return k}(b,D),u.COLOR_0!==void 0){let S=e.json.accessors[u.COLOR_0],P=em[S.type],k=Eu(e,S);h.colorArray=P===3?new mu:new cr,h.colorArray.resize(S.count),Qx(e,S,h.colorArray,k)}if(u.NORMAL!==void 0){h.normalArray=new mu;let S=e.json.accessors[u.NORMAL];h.normalArray.resize(S.count);let P=Eu(e,S);Qx(e,S,h.normalArray,P)}if(u.TEXCOORD_0!==void 0&&n.length>0){h.texcoordArray=new yr;let S=e.json.accessors[u.TEXCOORD_0];h.texcoordArray.resize(S.count);let P=Eu(e,S);Qx(e,S,h.texcoordArray,P)}if(u._FEATURE_ID_RGBA4444!==void 0){let S=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(h.featureData=Eu(e,S))}u._FEATURE_RGBA4444!==void 0&&(h.featureData=new Uint32Array(Eu(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));let I=t.material;return h.material=function(S,P){let{emissiveFactor:k=[0,0,0],alphaMode:L="OPAQUE",alphaCutoff:B=.5,normalTexture:V,occlusionTexture:W,emissiveTexture:K,doubleSided:Y}=S,{baseColorFactor:se=[1,1,1,1],metallicFactor:ee=1,roughnessFactor:le=1,baseColorTexture:de,metallicRoughnessTexture:_e}=S.pbrMetallicRoughness||{},Ie=W?P[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&Ie){let ve=W.extensions.KHR_texture_transform;Ie.offsetScale=[ve.offset[0],ve.offset[1],ve.scale[0],ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Bn(...se),metallicFactor:ee,roughnessFactor:le,baseColorTexture:de?P[de.index]:void 0,metallicRoughnessTexture:_e?P[_e.index]:void 0},doubleSided:Y,emissiveFactor:k,alphaMode:L,alphaCutoff:B,normalTexture:V?P[V.index]:void 0,occlusionTexture:Ie,emissionTexture:K?P[K.index]:void 0,defined:S.defined===void 0}}(I!==void 0?e.json.materials[I]:{defined:!1},n),h}function oS(t,e,n){let{matrix:s,rotation:u,translation:h,scale:g,mesh:y,extras:b,children:w}=t,D={};if(D.matrix=s||r.a9.fromRotationTranslationScale([],u||[0,0,0,1],h||[0,0,0],g||[1,1,1]),y!==void 0){D.meshes=n[y];let I=D.anchor=[0,0];for(let S of D.meshes){let{min:P,max:k}=S.aabb;I[0]+=P[0]+k[0],I[1]+=P[1]+k[1]}I[0]=Math.floor(I[0]/D.meshes.length/2),I[1]=Math.floor(I[1]/D.meshes.length/2)}if(b&&(b.id&&(D.id=b.id),b.lights&&(D.lights=function(I){if(!I.length)return[];let S=function(V){let W=atob(V),K=new Uint8Array(W.length);for(let Y=0;Y<W.length;Y++)K[Y]=W.codePointAt(Y);return K}(I),P=[],k=S.length/24,L=new Uint16Array(S.buffer),B=new Float32Array(S.buffer);for(let V=0;V<k;V++){let W=L[2*V*6]/30,K=L[2*V*6+1]/30,Y=L[2*V*6+10]/100,se=B[6*V+1],ee=B[6*V+2],le=B[6*V+3],de=B[6*V+4],_e=le-se,Ie=de-ee,ve=Math.hypot(_e,Ie);P.push({pos:[se+.5*_e,ee+.5*Ie,K],normal:[Ie/ve,-_e/ve,0],width:ve,height:W,depth:Y,points:[se,ee,le,de]})}return P}(b.lights))),w){let I=[];for(let S of w)I.push(oS(e.json.nodes[S],e,n));D.children=I}return D}function EN(t){if(t.vertices.length===0||t.indices.length===0)return null;let e=new rS(t.vertices,t.indices,8,256),[n,s]=[e.min.clone(),e.max.clone()];return{vertices:t.vertices,indices:t.indices,grid:e,min:n,max:s}}function TN(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let s=[];for(let g of n){if(!Array.isArray(g)||g.length!==2)continue;let y=g[0],b=g[1];typeof y=="number"&&typeof b=="number"&&s.push(new tt(y,b))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let u=0;for(let g=0;g<s.length;g++){let y=s[g],b=s[(g+1)%s.length],w=s[(g+2)%s.length];u+=(y.x-b.x)*(w.y-b.y)-(w.x-b.x)*(y.y-b.y)}u>0&&s.reverse();let h=k_(s.flatMap(g=>[g.x,g.y]),[]);return h.length===0?null:{vertices:s,indices:h}}function DN(t,e){let n=[],s=[],u=0,h=[];for(let g of t){u=n.length;let y=g.vertexArray.float32,b=g.indexArray.uint16;for(let w=0;w<g.vertexArray.length;w++)h[0]=y[3*w+0],h[1]=y[3*w+1],h[2]=y[3*w+2],r.Q.transformMat4(h,h,e),n.push(new tt(h[0],h[1]));for(let w=0;w<3*g.indexArray.length;w++)s.push(b[w]+u)}if(s.length%3!=0)return null;for(let g=0;g<s.length;g+=3){let y=n[s[g+0]],b=n[s[g+1]],w=n[s[g+2]];(y.x-b.x)*(w.y-b.y)-(w.x-b.x)*(y.y-b.y)>0&&([s[g+1],s[g+2]]=[s[g+2],s[g+1]])}return{vertices:n,indices:s}}function sS(t){let e=function(b,w){let D=[],I=WebGL2RenderingContext;if(b.json.textures)for(let S of b.json.textures){let P={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};S.sampler!==void 0&&Object.assign(P,b.json.samplers[S.sampler]),D.push({image:w[S.source],sampler:P,uploaded:!1})}return D}(t,t.images),n=function(b,w){let D=[];for(let I of b.json.meshes){let S=[];for(let P of I.primitives)S.push(wN(P,b,w));D.push(S)}return D}(t,e),{scenes:s,scene:u,nodes:h}=t.json,g=s?s[u||0].nodes:h,y=[];for(let b of g)y.push(oS(h[b],t,n));return function(b,w,D){let I={},S=new Set;for(let P=0;P<b.length;P++){let k=D[w[P]];if(!k.extras)continue;let L=k.extras["mapbox:footprint:version"],B=k.extras["mapbox:footprint:id"];(L||B)&&S.add(P),L==="1.0.0"&&B&&(I[B]=P)}for(let P=0;P<b.length;P++){if(S.has(P))continue;let k=b[P],L=D[w[P]];if(!L.extras)continue;let B=null;k.id in I&&(B=DN(b[I[k.id]].meshes,k.matrix)),B||(B=TN(L)),B&&(k.footprint=EN(B))}if(S.size>0){let P=Array.from(S.values()).sort((k,L)=>k-L);for(let k=P.length-1;k>=0;k--)b.splice(P[k],1)}}(y,g,t.json.nodes),y}function IN(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,s=t.aabb.min[1]-1,u=wu/(t.aabb.max[0]-n+2),h=wu/(t.aabb.max[1]-s+2);for(let g=0;g<e.length;g+=3){let y=e[g+2],b=(e[g+0]-n)*u|0,w=(e[g+1]-s)*h|0;y>t.heightmap[w*wu+b]&&(t.heightmap[w*wu+b]=y)}}function CN(t,e){let n={};n.indexArray=new ur,n.indexArray.reserve(4*t.length),n.vertexArray=new mu,n.vertexArray.reserve(10*t.length),n.colorArray=new cr,n.vertexArray.reserve(10*t.length);let s=0;for(let g of t){let y=Math.min(10,Math.max(4,1.3*g.height))*e,b=[-g.normal[1],g.normal[0],0],w=Math.min(.29,.1*g.width/g.depth),D=g.width-2*g.depth*e*(w+.01),I=r.Q.scaleAndAdd([],g.pos,b,D/2),S=r.Q.scaleAndAdd([],g.pos,b,-D/2),P=[I[0],I[1],I[2]+g.height],k=[S[0],S[1],S[2]+g.height],L=r.Q.scaleAndAdd([],g.normal,b,w);r.Q.scale(L,L,y);let B=r.Q.scaleAndAdd([],g.normal,b,-w);r.Q.scale(B,B,y),r.Q.add(L,I,L),r.Q.add(B,S,B),I[2]+=.1,S[2]+=.1,n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(I[0],I[1],I[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(L[0],L[1],L[2]),n.vertexArray.emplaceBack(B[0],B[1],B[2]);let V=D/y/2;n.colorArray.emplaceBack(-V-w,-1,V,.8),n.colorArray.emplaceBack(V+w,-1,V,.8),n.colorArray.emplaceBack(-V,0,V,1.3),n.colorArray.emplaceBack(V,0,V,1.3),n.colorArray.emplaceBack(V+w,-.8,V,.7),n.colorArray.emplaceBack(V+w,-.8,V,.7),n.colorArray.emplaceBack(0,0,V,1.3),n.colorArray.emplaceBack(0,0,V,1.3),n.colorArray.emplaceBack(V+w,-1.2,V,.8),n.colorArray.emplaceBack(V+w,-1.2,V,.8),n.indexArray.emplaceBack(6+s,4+s,8+s),n.indexArray.emplaceBack(7+s,9+s,5+s),n.indexArray.emplaceBack(0+s,1+s,2+s),n.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}let u={defined:!0,emissiveFactor:[0,0,0]},h={};return h.baseColorFactor=Bn.white,u.pbrMetallicRoughness=h,n.material=u,n.aabb=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}ht(rS,"TriangleGridIndex");class aS{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}let SN=["tile","layer","source","sourceLayer","state"];class lS{constructor(e,n,s,u,h){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=u,this.properties=e.properties,this.id=h}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of SN)this[n]!==void 0&&(e[n]=this[n]);return e}}class cS{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ll(nt,16,0),this.featureIndexArray=new TD,this.promoteId=n,this.is3DTile=!1}insert(e,n,s,u,h,g=0,y=0){let b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,h,g);let w=this.grid;for(let D=0;D<n.length;D++){let I=n[D],S=[1/0,1/0,-1/0,-1/0];for(let P=0;P<I.length;P++){let k=I[P];S[0]=Math.min(S[0],k.x),S[1]=Math.min(S[1],k.y),S[2]=Math.max(S[2],k.x),S[3]=Math.max(S[3],k.y)}y!==0&&(S[0]-=y,S[1]-=y,S[2]+=y,S[3]+=y),S[0]<nt&&S[1]<nt&&S[2]>=0&&S[3]>=0&&w.insert(b,S[0],S[1],S[2],S[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new xx(new Th(this.rawTileData)).layers,this.sourceLayerCoder=new aS(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,u){this.loadVTLayers();let h=e.params||{},g=ot(h.filter),y=e.tileResult,b=e.transform,w=y.bufferedTilespaceBounds,D=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(k,L,B,V)=>UD(y.bufferedTilespaceGeometry,k,L,B,V));D.sort(MN);let I=null;b.elevation&&D.length>0&&(I=vh.create(b.elevation,this.tileID));let S={},P;for(let k=0;k<D.length;k++){let L=D[k];if(L===P)continue;P=L;let B=this.featureIndexArray.get(L),V=null;if(this.is3DTile){let W=this.bucketLayerIDs[0][0],K=n[W];if(K.type!=="model")continue;let{queryFeature:Y,intersectionZ:se}=K.queryIntersectsMatchingFeature(y,B.featureIndex,g,b);Y&&this.appendToResult(S,W,B.featureIndex,Y,se)}else this.loadMatchingFeature(S,B,g,h.layers,h.availableImages,n,s,u,(W,K,Y,se=0)=>(V||(V=Ya(W,this.tileID.canonical,e.tileTransform)),K.queryIntersectsFeature(y,W,Y,V,this.z,e.transform,e.pixelPosMatrix,I,se)))}return S}loadMatchingFeature(e,n,s,u,h,g,y,b,w){let{featureIndex:D,bucketIndex:I,sourceLayerIndex:S,layoutVertexArrayOffset:P}=n,k=this.bucketLayerIDs[I];if(u&&!function(W,K){for(let Y=0;Y<W.length;Y++)if(K.indexOf(W[Y])>=0)return!0;return!1}(u,k))return;let L=this.sourceLayerCoder.decode(S),B=this.vtLayers[L].feature(D);if(s.needGeometry){let W=Gl(B,!0);if(!s.filter(new q(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!s.filter(new q(this.tileID.overscaledZ),B))return;let V=this.getId(B,L);for(let W=0;W<k.length;W++){let K=k[W];if(u&&u.indexOf(K)<0)continue;let Y=g[K];if(!Y)continue;let se={};V!==void 0&&b&&(se=b.getState(Y.sourceLayer||"_geojsonTileLayer",V));let ee=!w||w(B,Y,se,P);if(!ee)continue;let le=new lS(B,this.z,this.x,this.y,V),de=Eo({},y[K]);de.paint=uS(de.paint,Y.paint,B,se,h),de.layout=uS(de.layout,Y.layout,B,se,h),le.layer=de,this.appendToResult(e,K,D,le,ee)}}appendToResult(e,n,s,u,h){let g=e[n];g===void 0&&(g=e[n]=[]),g.push({featureIndex:s,feature:u,intersectionZ:h})}lookupSymbolFeatures(e,n,s,u,h,g,y,b){let w={};this.loadVTLayers();let D=ot(h);for(let I of e)this.loadMatchingFeature(w,{bucketIndex:s,sourceLayerIndex:u,featureIndex:I,layoutVertexArrayOffset:0},D,g,y,b,n);return w}loadFeature(e){let{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();let u=this.sourceLayerCoder.decode(s),h=this.vtFeatures[u];if(h[n])return h[n];let g=this.vtLayers[u].feature(n);return h[n]=g,g}hasLayer(e){for(let n of this.bucketLayerIDs)for(let s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){let u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];u!=null&&(s=e.properties[u]),typeof s=="boolean"&&(s=Number(s))}return s}}function uS(t,e,n,s,u){return pl(t,(h,g)=>{let y=e instanceof De?e.get(g):null;return y&&y.evaluate?y.evaluate(n,s,u):y})}function MN(t,e){return e-t}ht(cS,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let Yx=new Float32Array(262144),Tu=new Uint8Array(262144);function dS(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,dS(n));return e}function hS(t,e,n){if(t.meshes)for(let s of t.meshes)s.aabb.min[0]!==1/0&&n.insert(e,s.aabb.min[0],s.aabb.min[1],s.aabb.max[0],s.aabb.max[1]);if(t.children)for(let s of t.children)hS(s,e,n)}let fS=["","wall","door","roof","window","lamp","logo"];class pS{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:dS(e)}}}getLocalBounds(){if(!this.node.meshes)return new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0,n=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(let s of this.node.meshes)this.node.lightMeshIndex!==e&&n.encapsulate(s.aabb),e++;this.aabb=gi.applyTransform(n,this.node.matrix)}return this.aabb}}class py{constructor(e,n,s,u,h,g){this.id=n,this.modelTraits|=Mh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,s&&(this.modelTraits|=Mh.HasMapboxMeshFeatures),u&&(this.modelTraits|=Mh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(let y of e)this.nodesInfo.push(new pS(y)),hS(y,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let s of n){let u=s.node;this.uploaded?this.updatePbrBuffer(u):Ux(u,e,!0)}for(let s of n)cy(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),n=!0);return n}needsReEvaluation(e,n,s){let u=e.transform.projectionOptions,h=e.style.getBrightness(),g=this.brightness!==h;return!!(!this.uploaded||this.dirty||u.name!==this.projection.name||tm(s.paint.get("model-color").value,g)||tm(s.paint.get("model-color-mix-intensity").value,g)||tm(s.paint.get("model-roughness").value,g)||tm(s.paint.get("model-emissive-strength").value,g)||tm(s.paint.get("model-height-based-emissive-strength-multiplier").value,g))&&(this.projection=u,this.brightness=h,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let s=this.getNodesInfo(),u=this.id.canonical;for(let h of s){let g=h.feature;h.evaluatedScale=n.paint.get("model-scale").evaluate(g,{},u)}}evaluate(e){let n=this.getNodesInfo();for(let s of n){if(!s.node.meshes)continue;let u=s.feature,h=s.node.meshes&&s.node.meshes[0].featureData,g=s.evaluatedColor[2],y=s.evaluatedRMEA[2],b=this.id.canonical;if(s.hasTranslucentParts=!1,h){for(let w=0;w<fS.length;w++){let D=fS[w];D.length&&(u.properties.part=D);let I=e.paint.get("model-color").evaluate(u,{},b),S=e.paint.get("model-color-mix-intensity").evaluate(u,{},b);s.evaluatedColor[w]=[I.r,I.g,I.b,S],s.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(u,{},b),s.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b),s.evaluatedRMEA[w][3]=I.a,s.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,{},b),!s.hasTranslucentParts&&I.a<1&&(s.hasTranslucentParts=!0)}delete u.properties.part,PN(s,g!==s.evaluatedColor[2]||y!==s.evaluatedRMEA[2],this.modelTraits)}else s.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,{},b);s.evaluatedScale=e.paint.get("model-scale").evaluate(u,{},b),this.updatePbrBuffer(s.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,s,u){let h=e.findDEMTileFor(s);if(h&&(h.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(h.dem&&h.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=h.tileID.overscaledZ;let g=vh.create(e,s,h);if(!g)return;this.modelTraits&Mh.HasMapboxMeshFeatures&&this.updateDEM(e,g,s,u);for(let y of this.getNodesInfo()){let b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;let w=b.footprint.vertices,D=g.getElevationAt(w[0].x,w[0].y,!0,!0);for(let I=1;I<w.length;I++)D=Math.min(D,g.getElevationAt(w[I].x,w[I].y,!0,!0));b.elevation=D}}this.terrainTile=h.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,s,u){let h=n._dem._modifiedForSources[u];if(h===void 0&&(n._dem._modifiedForSources[u]=[],h=n._dem._modifiedForSources[u]),h.includes(s.canonical))return;let g=n._dem.dim;h.push(s.canonical);let y=!1;for(let b of this.getNodesInfo()){let w=b.node;if(!w.footprint||!w.footprint.grid)continue;let D=w.footprint.grid,I=n.tileCoordToPixel(D.min.x,D.min.y),S=n.tileCoordToPixel(D.max.x,D.max.y),P=Math.min(Math.min(g-S.y,I.x),Math.min(I.y,g-S.x));if(P<0)continue;let k=hn(P,2,5),L=Math.max(0,I.x-k),B=Math.max(0,I.y-k),V=Math.min(S.x+k,g-1),W=Math.min(S.y+k,g-1);for(let ee=B;ee<=W;++ee)for(let le=L;le<=V;++le)Tu[ee*g+le]=255;let K=0,Y=0;for(let ee=0;ee<D.cellsY;++ee)for(let le=0;le<D.cellsX;++le){if(!D.cells[ee*D.cellsX+le])continue;let de=n.tileCoordToPixel(D.min.x+le/D.xScale,D.min.y+ee/D.yScale),_e=n.tileCoordToPixel(D.min.x+(le+1)/D.xScale,D.min.y+(ee+1)/D.yScale);for(let Ie=de.y;Ie<=Math.min(_e.y+1,g-1);++Ie)for(let ve=de.x;ve<=Math.min(_e.x+1,g-1);++ve)Tu[Ie*g+ve]===255&&(Tu[Ie*g+ve]=0,K+=n.getElevationAtPixel(ve,Ie),Y++)}let se=K/Y;L=Math.max(1,I.x-k),B=Math.max(1,I.y-k),V=Math.min(S.x+k,g-2),W=Math.min(S.y+k,g-2),y=!0;for(let ee=B;ee<=W;++ee)for(let le=L;le<=V;++le)Tu[ee*g+le]===0&&(Yx[ee*g+le]=n._dem.set(le,ee,se));for(let ee=1;ee<k;++ee){L=Math.max(1,I.x-ee),B=Math.max(1,I.y-ee),V=Math.min(S.x+ee,g-2),W=Math.min(S.y+ee,g-2);for(let le=B;le<=W;++le)for(let de=L;de<=V;++de){let _e=le*g+de;if(Tu[_e]===255){let Ie=0,ve=0,Me=-1,Se=-1;for(let Ce=-1;Ce<=1;++Ce)for(let ze=-1;ze<=1;++ze){let Le=(le+Ce)*g+de+ze;if(Tu[Le]>=ee)continue;let Ge=Yx[Le],je=Math.abs(Ge);je>ve&&(Ie=Ge,ve=je,Me=ze,Se=Ce)}if(ve>.1){let Ce=1-(ee+.5*Math.abs(Me*Se))/k,ze=n._dem.get(de,le)+Ie*Ce,Le=n._dem.get(de+Me,le+Se),Ge=n._dem.get(de-Me,le-Se,!0);(ze-Le)*(ze-Ge)>0&&(ze=(Le+Ge)/2),Yx[_e]=n._dem.set(de,le,ze),Tu[_e]=ee}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=ns.now())}getNodesInfo(){return this.nodesInfo}destroy(){let e=this.getNodesInfo();for(let n of e)cy(n.node),Gx(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let s=n.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let h=0;h<this.nodesInfo.length;h++){let g=u[h].node;u[h].hiddenByReplacement=!!g.footprint&&!s.find(y=>y.footprint===g.footprint)}}getHeightAtTileCoord(e,n){let s=this.getNodesInfo(),u=[],h=[0,0,0];for(let g=0;g<this.nodesInfo.length;g++){let y=s[g],b=y.node.meshes[0],w=gi.applyTransform(b.aabb,y.node.matrix);if(e<w.min[0]||n<w.min[1]||e>w.max[0]||n>w.max[1])continue;let D=(e-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*wu|0,I=Math.min(63,(n-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*wu|0)*wu+Math.min(63,D);if(h[2]=b.heightmap[I],r.Q.transformMat4(h,h,y.node.matrix),!(b.heightmap[I]<0&&y.node.footprint))return y.hiddenByReplacement?void 0:{height:h[2],maxHeight:y.feature.properties.height,hidden:!1,verticalScale:y.evaluatedScale[2]};if(y.node.footprint.grid.query(new tt(e,n),new tt(e,n),u),u.length>0)return{height:void 0,maxHeight:y.feature.properties.height,hidden:y.hiddenByReplacement,verticalScale:y.evaluatedScale[2]}}}}function tm(t,e){return!t.isLightConstant&&e}function AN(t,e,n,s,u,h,g,y){let b=(61440&e|(61440&e)>>4)>>8,w=(3840&e|(3840&e)>>4)>>4,D=240&e|(240&e)>>4;n[3]>0&&(b=sn(b,255*n[0],n[3]),w=sn(w,255*n[1],n[3]),D=sn(D,255*n[2],n[3]));let I=b<<8|w,S=D<<8|Math.floor(255*s[3]),P=function(ee){let le=hn(ee,0,2);return Math.min(Math.round(.5*le*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],k=hn(u[0],0,1),L=hn(u[1],0,1),B=hn(u[2],0,1),V=hn(u[3],0,1),W,K,Y,se;if(k!==L&&g!==h&&L!==k){let ee=g-h;K=1/(ee*(L-k)),Y=-(h+ee*k)/(ee*(L-k));let le=hn(u[4],-1,1);se=Math.pow(10,le),W=255*B<<8|255*V}else W=65535,K=0,Y=1,se=1;if(t.emplaceBack(I,S,P,W,K,Y,se),y){let ee=y.length;y.clear();for(let le=0;le<ee;le++)y.emplaceBack(I,S,P,W,K,Y,se)}}function PN(t,e,n){let s=t.node,u=0,h=n&Mh.HasMeshoptCompression;for(let g of s.meshes){if(s.lights&&s.lightMeshIndex===u||!g.featureData)continue;g.featureArray=new __,g.featureArray.reserve(g.featureData.length);let y=e;for(let b of g.featureData){let w=h?65535&b:b>>16&65535,D=h?b>>16&65535:65535&b,I=(15&D)<8?15&D:0,S=t.evaluatedRMEA[I],P=t.evaluatedColor[I],k=t.emissionHeightBasedParams[I],L;if(y&&I===2&&s.lights&&(L=new __,L.resize(10*s.lights.length)),AN(g.featureArray,w,P,S,k,g.aabb.min[2],g.aabb.max[2],L),L&&y){y=!1;let B=s.meshes[s.lightMeshIndex];B.featureArray=L,B.featureArray._trim()}}g.featureArray._trim(),u++}}function mS(t,e,n,s){let u=1<<t.z;e.lat=Cr((s/nt+t.y)/u),e.lng=Io((n/nt+t.x)/u)}ht(py,"Tiled3dModelBucket",{omit:["layers"]}),ht(pS,"Tiled3dModelFeature");let RN={circle:class extends on{constructor(t,e,n){super(t,VO,e,n)}createBucket(t){return new Jb(t)}queryRadius(t){let e=t;return gh("circle-radius",this,e)+gh("circle-stroke-width",this,e)+E_(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,u,h,g,y){let b=$D(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),w=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return rI(t,s,h,g,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,w)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=iI(this);return{config:new gu(this,e),defines:n,overrideFog:!1}}},heatmap:class extends on{createBucket(t){return new sI(t)}constructor(t,e,n){super(t,KO,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Op({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return gh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,u,h,g,y){let b=this.paint.get("heatmap-radius").evaluate(e,n);return rI(t,s,h,g,y,!0,!0,new tt(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new gu(this,e),overrideFog:!1}:{}}},hillshade:class extends on{constructor(t,e,n){super(t,eF,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends on{constructor(t,e,n){super(t,pF,e,n)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new gu(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new bx(t)}queryRadius(){return E_(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,u,h){return!t.queryGeometry.isAboveHorizon&&BD(GD(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends on{constructor(t,e,n){super(t,UF,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new V_(t)}queryRadius(){return E_(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,s,u,h,g,y,b){let w=$D(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),D=this.paint.get("fill-extrusion-height").evaluate(e,n),I=this.paint.get("fill-extrusion-base").evaluate(e,n),S=[0,0],P=y&&h.elevation,k=h.elevation?h.elevation.exaggeration():1,L=t.tile.getBucket(this);if(P&&L instanceof V_){let Y=L.centroidVertexArray,se=b+1;se<Y.length&&(S[0]=Y.geta_centroid_pos0(se),S[1]=Y.geta_centroid_pos1(se))}if(S[0]===0&&S[1]===1)return!1;h.projection.name==="globe"&&(s=jI([s],[new tt(0,0),new tt(nt,nt)],t.tileID.canonical).map(Y=>Y.polygon).flat());let B=P?y:null,[V,W]=function(Y,se,ee,le,de,_e,Ie,ve,Me,Se,Ce){return Y.projection.name==="globe"?function(ze,Le,Ge,je,Pe,mt,ct,He,Rt,bt,gt){let qe=[],Dt=[],Jt=ze.projection.upVectorScale(gt,ze.center.lat,ze.worldSize).metersToTile,Bt=[0,0,0,1],rn=[0,0,0,1],en=(Lt,Yn,$n,In)=>{Lt[0]=Yn,Lt[1]=$n,Lt[2]=In,Lt[3]=1},un=VI();Ge>0&&(Ge+=un),je+=un;for(let Lt of Le){let Yn=[],$n=[];for(let In of Lt){let vn=In.x+Pe.x,Cn=In.y+Pe.y,fi=ze.projection.projectTilePoint(vn,Cn,gt),ri=ze.projection.upVector(gt,In.x,In.y),Ci=Ge,xi=je;if(ct){let Lr=GI(vn,Cn,Ge,je,ct,He,Rt,bt);Ci+=Lr.base,xi+=Lr.top}Ge!==0?en(Bt,fi.x+ri[0]*Jt*Ci,fi.y+ri[1]*Jt*Ci,fi.z+ri[2]*Jt*Ci):en(Bt,fi.x,fi.y,fi.z),en(rn,fi.x+ri[0]*Jt*xi,fi.y+ri[1]*Jt*xi,fi.z+ri[2]*Jt*xi),r.Q.transformMat4(Bt,Bt,mt),r.Q.transformMat4(rn,rn,mt),Yn.push(new bh(Bt[0],Bt[1],Bt[2])),$n.push(new bh(rn[0],rn[1],rn[2]))}qe.push(Yn),Dt.push($n)}return[qe,Dt]}(Y,se,ee,le,de,_e,Ie,ve,Me,Se,Ce):Ie?function(ze,Le,Ge,je,Pe,mt,ct,He,Rt){let bt=[],gt=[],qe=[0,0,0,1];for(let Dt of ze){let Jt=[],Bt=[];for(let rn of Dt){let en=rn.x+je.x,un=rn.y+je.y,Lt=GI(en,un,Le,Ge,mt,ct,He,Rt);qe[0]=en,qe[1]=un,qe[2]=Lt.base,qe[3]=1,r.aa.transformMat4(qe,qe,Pe),qe[3]=Math.max(qe[3],1e-5);let Yn=new bh(qe[0]/qe[3],qe[1]/qe[3],qe[2]/qe[3]);qe[0]=en,qe[1]=un,qe[2]=Lt.top,qe[3]=1,r.aa.transformMat4(qe,qe,Pe),qe[3]=Math.max(qe[3],1e-5);let $n=new bh(qe[0]/qe[3],qe[1]/qe[3],qe[2]/qe[3]);Jt.push(Yn),Bt.push($n)}bt.push(Jt),gt.push(Bt)}return[bt,gt]}(se,ee,le,de,_e,Ie,ve,Me,Se):function(ze,Le,Ge,je,Pe){let mt=[],ct=[],He=Pe[8]*Le,Rt=Pe[9]*Le,bt=Pe[10]*Le,gt=Pe[11]*Le,qe=Pe[8]*Ge,Dt=Pe[9]*Ge,Jt=Pe[10]*Ge,Bt=Pe[11]*Ge;for(let rn of ze){let en=[],un=[];for(let Lt of rn){let Yn=Lt.x+je.x,$n=Lt.y+je.y,In=Pe[0]*Yn+Pe[4]*$n+Pe[12],vn=Pe[1]*Yn+Pe[5]*$n+Pe[13],Cn=Pe[2]*Yn+Pe[6]*$n+Pe[14],fi=Pe[3]*Yn+Pe[7]*$n+Pe[15],ri=In+He,Ci=vn+Rt,xi=Cn+bt,Lr=Math.max(fi+gt,1e-5),Oi=In+qe,yi=vn+Dt,Xi=Cn+Jt,br=Math.max(fi+Bt,1e-5);en.push(new bh(ri/Lr,Ci/Lr,xi/Lr)),un.push(new bh(Oi/br,yi/br,Xi/br))}mt.push(en),ct.push(un)}return[mt,ct]}(se,ee,le,de,_e)}(h,s,I,D,w,g,B,S,k,h.center.lat,t.tileID.canonical),K=t.queryGeometry;return function(Y,se,ee){let le=1/0;BD(ee,se)&&(le=UI(ee,se[0]));for(let de=0;de<se.length;de++){let _e=se[de],Ie=Y[de];for(let ve=0;ve<_e.length-1;ve++){let Me=_e[ve],Se=[Me,_e[ve+1],Ie[ve+1],Ie[ve],Me];ex(ee,Se)&&(le=Math.min(le,UI(ee,Se)))}}return le!==1/0&&le}(V,W,K.isPointQuery()?K.screenBounds:K.screenGeometry)}},line:class extends on{constructor(t,e,n){super(t,HI,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof tu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=XI.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Ex(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=QI(this);return{config:new gu(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=KI(gh("line-width",this,e),gh("line-gap-width",this,e)),s=gh("line-offset",this,e);return n/2+Math.abs(s)+E_(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,u,h){if(t.queryGeometry.isAboveHorizon)return!1;let g=GD(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),h.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*KI(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(s=function(w,D){let I=[],S=new tt(0,0);for(let P=0;P<w.length;P++){let k=w[P],L=[];for(let B=0;B<k.length;B++){let V=k[B],W=k[B+1],K=B===0?S:V.sub(k[B-1])._unit()._perp(),Y=B===k.length-1?S:W.sub(V)._unit()._perp(),se=K._add(Y)._unit();se._mult(1/(se.x*Y.x+se.y*Y.y)),L.push(se._mult(D)._add(V))}I.push(L)}return I}(s,b*t.pixelToTileUnitsFactor)),function(w,D,I){for(let S=0;S<D.length;S++){let P=D[S];if(w.length>=3){for(let k=0;k<P.length;k++)if(bu(w,P[k]))return!0}if(LO(w,P,I))return!0}return!1}(g,s,y)}isTileClipped(){return!0}},symbol:ny,background:class extends on{constructor(t,e,n){super(t,ZL,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:NC,"raster-particle":zC,sky:class extends on{constructor(t,e,n){super(t,nN,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Op({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let s=this.paint.get("sky-atmosphere-sun"),u=!s,h=t.style.light,g=h.properties.get("position");return u&&h.properties.get("anchor")==="viewport"&&Ii("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Bx(g.azimuthal,90-g.polar,e):Bx(s[0],90-s[1],e)}let n=this.paint.get("sky-gradient-center");return Bx(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends on{constructor(t,e,n){super(t,iN,e)}},model:class extends on{constructor(t,e,n){super(t,hN,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new jx(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof py?nt-1:0}queryIntersectsFeature(t,e,n,s,u,h){if(!this.modelManager)return!1;let g=this.modelManager,y=t.tile.getBucket(this);if(!(y&&y instanceof jx))return!1;let b=y;for(let w in b.instancesPerModel){let D=b.instancesPerModel[w],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(D.idToFeaturesIndex.hasOwnProperty(I)){let S=D.features[D.idToFeaturesIndex[I]],P=g.getModel(w,this.scope);if(!P)return!1;let k=r.a9.create(),L=new En(0,0),B=b.canonical,V=Number.MAX_VALUE;for(let W=0;W<S.instancedDataCount;++W){let K=16*(S.instancedDataOffset+W),Y=D.instancedDataArray.float32,se=[Y[K+4],Y[K+5],Y[K+6]];mS(B,L,Y[K],0|Y[K+1]),ZC(k,P,h,L,S.rotation,S.scale,se,!1,!1,!1),h.projection.name==="globe"&&(k=Vx(k,h));let ee=r.a9.multiply([],h.projMatrix,k),le=t.queryGeometry,de=$C(le.isPointQuery()?le.screenBounds:le.screenGeometry,h,ee,P.aabb);de!=null&&(V=Math.min(de,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof lu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,n,s){let u=t.tile,h=u.getBucket(this),g=null,y=Number.MAX_VALUE;if(!(h&&h instanceof py))return{queryFeature:g,intersectionZ:y};let b=h.getNodesInfo()[e];if(b.hiddenByReplacement||!b.node.meshes||!n.filter(new q(u.tileID.overscaledZ),b.feature,u.tileID.canonical))return{queryFeature:g,intersectionZ:y};let w=b.node,D=s.calculatePosMatrix(u.tileID.toUnwrapped(),s.worldSize),I=b.evaluatedScale,S=0;s.elevation&&w.elevation&&(S=w.elevation*s.elevation.exaggeration()),r.a9.translate(D,D,[(w.anchor?w.anchor[0]:0)*(I[0]-1),(w.anchor?w.anchor[1]:0)*(I[1]-1),S]),r.a9.scale(D,D,I),r.a9.multiply(D,D,w.matrix);let P=t.queryGeometry,k=P.isPointQuery()?P.screenBounds:P.screenGeometry,L=function(V){let W=r.a9.multiply([],D,V.matrix),K=r.a9.multiply(W,s.expandedFarZProjMatrix,W);for(let Y=0;Y<V.meshes.length;++Y){let se=V.meshes[Y];if(Y===V.lightMeshIndex)continue;let ee=$C(k,s,K,se.aabb);ee!=null&&(y=Math.min(ee,y))}if(V.children)for(let Y of V.children)L(Y)};if(L(w),y===Number.MAX_VALUE)return{queryFeature:g,intersectionZ:y};let B=new En(0,0);return mS(u.tileID.canonical,B,b.node.anchor[0],b.node.anchor[1]),g={type:"Feature",geometry:{type:"Point",coordinates:[B.lng,B.lat]},properties:b.feature.properties,id:b.feature.id,state:{},layer:this.serialize()},{queryFeature:g,intersectionZ:y}}}},Zt={read:function(t,e){return t.readFields(Zt._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,n){t===1?e.header_length=n.readFixed32():t===2?e.x=n.readVarint():t===3?e.y=n.readVarint():t===4?e.z=n.readVarint():t===5&&e.layers.push(Zt.Layer.read(n,n.readVarint()+n.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};Zt.Filter.read=function(t,e){return t.readFields(Zt.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},Zt.Filter._readField=function(t,e,n){t===1?(e.delta_filter=Zt.Filter.Delta.read(n,n.readVarint()+n.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=Zt.Filter.Zigzag.read(n,n.readVarint()+n.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=Zt.Filter.BitShuffle.read(n,n.readVarint()+n.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=Zt.Filter.ByteShuffle.read(n,n.readVarint()+n.pos),e.filter="byteshuffle_filter")},Zt.Filter.Delta={},Zt.Filter.Delta.read=function(t,e){return t.readFields(Zt.Filter.Delta._readField,{block_size:0},e)},Zt.Filter.Delta._readField=function(t,e,n){t===1&&(e.block_size=n.readVarint())},Zt.Filter.Zigzag={},Zt.Filter.Zigzag.read=function(t,e){return t.readFields(Zt.Filter.Zigzag._readField,{},e)},Zt.Filter.Zigzag._readField=function(t,e,n){},Zt.Filter.BitShuffle={},Zt.Filter.BitShuffle.read=function(t,e){return t.readFields(Zt.Filter.BitShuffle._readField,{},e)},Zt.Filter.BitShuffle._readField=function(t,e,n){},Zt.Filter.ByteShuffle={},Zt.Filter.ByteShuffle.read=function(t,e){return t.readFields(Zt.Filter.ByteShuffle._readField,{},e)},Zt.Filter.ByteShuffle._readField=function(t,e,n){},Zt.Codec={},Zt.Codec.read=function(t,e){return t.readFields(Zt.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},Zt.Codec._readField=function(t,e,n){t===1?(e.gzip_data=Zt.Codec.GzipData.read(n,n.readVarint()+n.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=Zt.Codec.JpegImage.read(n,n.readVarint()+n.pos),e.codec="jpeg_image"):t===3?(e.webp_image=Zt.Codec.WebpImage.read(n,n.readVarint()+n.pos),e.codec="webp_image"):t===4&&(e.png_image=Zt.Codec.PngImage.read(n,n.readVarint()+n.pos),e.codec="png_image")},Zt.Codec.GzipData={},Zt.Codec.GzipData.read=function(t,e){return t.readFields(Zt.Codec.GzipData._readField,{},e)},Zt.Codec.GzipData._readField=function(t,e,n){},Zt.Codec.JpegImage={},Zt.Codec.JpegImage.read=function(t,e){return t.readFields(Zt.Codec.JpegImage._readField,{},e)},Zt.Codec.JpegImage._readField=function(t,e,n){},Zt.Codec.WebpImage={},Zt.Codec.WebpImage.read=function(t,e){return t.readFields(Zt.Codec.WebpImage._readField,{},e)},Zt.Codec.WebpImage._readField=function(t,e,n){},Zt.Codec.PngImage={},Zt.Codec.PngImage.read=function(t,e){return t.readFields(Zt.Codec.PngImage._readField,{},e)},Zt.Codec.PngImage._readField=function(t,e,n){},Zt.DataIndexEntry={},Zt.DataIndexEntry.read=function(t,e){return t.readFields(Zt.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},Zt.DataIndexEntry._readField=function(t,e,n){t===1?e.first_byte=n.readFixed64():t===2?e.last_byte=n.readFixed64():t===3?e.filters.push(Zt.Filter.read(n,n.readVarint()+n.pos)):t===4?e.codec=Zt.Codec.read(n,n.readVarint()+n.pos):t===5?e.offset=n.readFloat():t===6?e.scale=n.readFloat():t===7&&e.bands.push(n.readString())},Zt.Layer={},Zt.Layer.read=function(t,e){return t.readFields(Zt.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},Zt.Layer._readField=function(t,e,n){t===1?e.version=n.readVarint():t===2?e.name=n.readString():t===3?e.units=n.readString():t===4?e.tilesize=n.readVarint():t===5?e.buffer=n.readVarint():t===6?e.pixel_format=n.readVarint():t===7&&e.data_index.push(Zt.DataIndexEntry.read(n,n.readVarint()+n.pos))};let Bs={read:function(t,e){return t.readFields(Bs._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,n){t===2?(e.uint32_values=Bs.Uint32Values.read(n,n.readVarint()+n.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=Bs.Fixed32Values.read(n,n.readVarint()+n.pos),e.values="fixed32_values")},Uint32Values:{}};Bs.Uint32Values.read=function(t,e){return t.readFields(Bs.Uint32Values._readField,{values:[]},e)},Bs.Uint32Values._readField=function(t,e,n){t===1&&(e.readValuesInto=function(s){if(s.type!==2)throw new Error(`Unsupported pbf type "${s.type}"`);let u=function(g){return g.type===2?g.readVarint()+g.pos:g.pos+1}(s),h=s.pos;return s.pos=u,function(g){s.pos=h;let y=0;for(;s.pos<u;){let b=s.readVarint();g[y++]=b}return g}}(n))},Bs.Fixed32Values={},Bs.Fixed32Values.read=function(t,e){return t.readFields(Bs.Fixed32Values._readField,{values:[]},e)},Bs.Fixed32Values._readField=function(t,e,n){throw new Error("Not implemented")};class kN{constructor(e=0,n=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=s,this.size=0,this.ttl=n}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){let n=this.items[e];delete this.items[e],this.size--,n.prev!==null&&(n.prev.next=n.next),n.next!==null&&(n.next.prev=n.prev),this.first===n&&(this.first=n.next),this.last===n&&(this.last=n.prev)}return this}entries(e=this.keys()){return e.map(n=>[n,this.get(n)])}evict(e=!1){if(e||this.size>0){let n=this.first;delete this.items[n.key],--this.size==0?(this.first=null,this.last=null):(this.first=n.next,this.first.prev=null)}return this}expiresAt(e){let n;return this.has(e)&&(n=this.items[e].expiry),n}get(e){let n;if(this.has(e)){let s=this.items[e];this.ttl>0&&s.expiry<=Date.now()?this.delete(e):(n=s.value,this.set(e,n,!0))}return n}has(e){return e in this.items}keys(){let e=[],n=this.first;for(;n!==null;)e.push(n.key),n=n.next;return e}set(e,n,s=!1,u=this.resetTtl){let h;if(s||this.has(e)){if(h=this.items[e],h.value=n,s===!1&&u&&(h.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==h){let g=this.last,y=h.next,b=h.prev;this.first===h&&(this.first=h.next),h.next=null,h.prev=this.last,g.next=h,b!==null&&(b.next=y),y!==null&&(y.prev=b)}}else this.max>0&&this.size===this.max&&this.evict(!0),h=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:n},++this.size==1?this.first=h:this.last.next=h;return this.last=h,this}values(e=this.keys()){return e.map(n=>this.get(n))}}function ON(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let s=2;s>=1;s--){let u=s===1?1:0,h=s===2?1:0;for(let g=0;g<e[0];g++){let y=e[1]*g;for(let b=u;b<e[1];b++){let w=e[2]*(b+y);for(let D=h;D<e[2];D++){let I=e[3]*(D+w);for(let S=0;S<e[3];S++){let P=I+S;t[P]+=t[P-n]}}}}n*=e[s]}return t}function FN(t){for(let e=0,n=t.length;e<n;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function LN(t,e){switch(e){case"uint32":return t;case"uint16":for(let n=0;n<t.length;n+=2){let s=t[n],u=t[n+1];t[n]=(240&s)>>4|(61440&s)>>8|(240&u)<<4|61440&u,t[n+1]=15&s|(3840&s)>>4|(15&u)<<8|(3840&u)<<4}return t;case"uint8":for(let n=0;n<t.length;n+=4){let s=t[n],u=t[n+1],h=t[n+2],g=t[n+3];t[n+0]=(192&s)>>6|(192&u)>>4|(192&h)>>2|192&g,t[n+1]=(48&s)>>4|(48&u)>>2|48&h|(48&g)<<2,t[n+2]=(12&s)>>2|12&u|(12&h)<<2|(12&g)<<4,t[n+3]=3&s|(3&u)<<2|(3&h)<<4|(3&g)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class Jl extends Error{constructor(e){super(e),this.name="MRTError"}}var Yo=Uint8Array,Rh=Uint16Array,NN=Int32Array,gS=new Yo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),_S=new Yo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),zN=new Yo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yS=function(t,e){for(var n=new Rh(31),s=0;s<31;++s)n[s]=e+=1<<t[s-1];var u=new NN(n[30]);for(s=1;s<30;++s)for(var h=n[s];h<n[s+1];++h)u[h]=h-n[s]<<5|s;return{b:n,r:u}},vS=yS(gS,2),bS=vS.b,BN=vS.r;bS[28]=258,BN[258]=28;for(var VN=yS(_S,0).b,Xx=new Rh(32768),Hi=0;Hi<32768;++Hi){var kh=(43690&Hi)>>1|(21845&Hi)<<1;Xx[Hi]=((65280&(kh=(61680&(kh=(52428&kh)>>2|(13107&kh)<<2))>>4|(3855&kh)<<4))>>8|(255&kh)<<8)>>1}var nm=function(t,e,n){for(var s=t.length,u=0,h=new Rh(e);u<s;++u)t[u]&&++h[t[u]-1];var g,y=new Rh(e);for(u=1;u<e;++u)y[u]=y[u-1]+h[u-1]<<1;if(n){g=new Rh(1<<e);var b=15-e;for(u=0;u<s;++u)if(t[u])for(var w=u<<4|t[u],D=e-t[u],I=y[t[u]-1]++<<D,S=I|(1<<D)-1;I<=S;++I)g[Xx[I]>>b]=w}else for(g=new Rh(s),u=0;u<s;++u)t[u]&&(g[u]=Xx[y[t[u]-1]++]>>15-t[u]);return g},im=new Yo(288);for(Hi=0;Hi<144;++Hi)im[Hi]=8;for(Hi=144;Hi<256;++Hi)im[Hi]=9;for(Hi=256;Hi<280;++Hi)im[Hi]=7;for(Hi=280;Hi<288;++Hi)im[Hi]=8;var xS=new Yo(32);for(Hi=0;Hi<32;++Hi)xS[Hi]=5;var jN=nm(im,9,1),UN=nm(xS,5,1),Kx=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},Vs=function(t,e,n){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&n},Jx=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},GN=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],js=function(t,e,n){var s=new Error(e||GN[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,js),!n)throw s;return s},$N=new Yo(0),HN=typeof TextDecoder<"u"&&new TextDecoder;try{HN.decode($N,{stream:!0})}catch{}let qN={gzip_data:"gzip"},WN={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ZN={uint32:1,uint16:2,uint8:4},QN={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class wS{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){let n=new Uint8Array(e),s=new DataView(e);if(n[0]!==13)throw new Jl("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){let n=new Uint8Array(e),s=this.getHeaderLength(e);if(n.length<s)throw new Jl(`Expected header with length >= ${s} but got buffer of length ${n.length}`);let u=new Th(n.subarray(0,s)),h=Zt.read(u);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Jl(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(let g of h.layers)this.layers[g.name]=new YN(g,{cacheSize:this._cacheSize});return this}createDecodingTask(e){let n=[],s=this.getLayer(e.layerName);for(let u=0;u<s.dataIndex.length;u++){let h=s.dataIndex[u],g=h.first_byte-e.firstByte,y=h.last_byte+1-e.firstByte;if(u<e.firstBlock||u>e.lastBlock||s._blocksInProgress.has(u))continue;let b={layerName:s.name,firstByte:g,lastByte:y,pixelFormat:s.pixelFormat,blockIndex:u,blockShape:[h.bands.length].concat(s.bandShape),buffer:s.buffer,codec:h.codec.codec,filters:h.filters.map(w=>w.filter)};s._blocksInProgress.add(u),n.push(b)}return new ES(n,()=>{n.forEach(u=>s._blocksInProgress.delete(u.blockIndex))},(u,h)=>{if(n.forEach(g=>s._blocksInProgress.delete(g.blockIndex)),u)throw u;h.forEach(g=>{this.getLayer(g.layerName).processDecodedData(g)})})}}class YN{constructor({version:e,name:n,units:s,tilesize:u,pixel_format:h,buffer:g,data_index:y},b){if(this.version=e,this.version!==1)throw new Jl(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=s,this.tileSize=u,this.buffer=g,this.pixelFormat=WN[h],this.dataIndex=y,this.bandShape=[u+2*g,u+2*g,ZN[this.pixelFormat]],this._decodedBlocks=function(w=1e3,D=0,I=!1){if(isNaN(w)||w<0)throw new TypeError("Invalid max value");if(isNaN(D)||D<0)throw new TypeError("Invalid ttl value");if(typeof I!="boolean")throw new TypeError("Invalid resetTtl value");return new kN(w,D,I)}(b?b.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){let n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.set(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(let[s,u]of this.dataIndex.entries()){for(let[h,g]of u.bands.entries())if(g===e)return{bandIndex:n+h,blockIndex:s,blockBandIndex:h};n+=u.bands.length}break;case"number":for(let[s,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new Jl(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Jl(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,s=-1/0,u=1/0,h=-1/0;for(let g of e){let{blockIndex:y}=this.getBlockForBand(g);if(y<0)throw new Jl(`Invalid band: ${JSON.stringify(g)}`);let b=this.dataIndex[y];u=Math.min(u,y),h=Math.max(h,y),n=Math.min(n,b.first_byte),s=Math.max(s,b.last_byte)}return{layerName:this.name,firstByte:n,lastByte:s,firstBlock:u,lastBlock:h}}hasBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){let{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){let{blockIndex:n,blockBandIndex:s}=this.getBlockForBand(e),u=this._decodedBlocks.get(n.toString());if(!u)throw new Jl(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);let h=this.dataIndex[n],g=this.bandShape.reduce((w,D)=>w*D,1),y=s*g,b=u.subarray(y,y+g);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:h.offset,scale:h.scale}}}class ES{constructor(e,n,s){this.tasks=e,this._onCancel=n,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}wS.performDecoding=function(t,e){return Promise.all(e.tasks.map(n=>{let{layerName:s,firstByte:u,lastByte:h,pixelFormat:g,blockShape:y,blockIndex:b,filters:w,codec:D}=n,I=new Uint8Array(t).subarray(u,h+1),S=new Uint32Array(y[0]*y[1]*y[2]),P;if(D!=="gzip_data")throw new Error(`Unhandled codec: ${D}`);return P=function(k,L){if(!globalThis.DecompressionStream&&L==="gzip_data")return Promise.resolve(((K=function(ee){ee[0]==31&&ee[1]==139&&ee[2]==8||js(6,"invalid gzip data");var le=ee[3],de=10;4&le&&(de+=2+(ee[10]|ee[11]<<8));for(var _e=(le>>3&1)+(le>>4&1);_e>0;_e-=!ee[de++]);return de+(2&le)}(W=k))+8>W.length&&js(6,"invalid gzip data"),function(ee,le,de,_e){var Ie=ee.length;if(!Ie||le.f&&!le.l)return de||new Yo(0);var ve=!de,Me=ve||le.i!=2,Se=le.i;ve&&(de=new Yo(3*Ie));var Ce,ze,Le=function(ec){var tc=de.length;if(ec>tc){var Du=new Yo(Math.max(2*tc,ec));Du.set(de),de=Du}},Ge=le.f||0,je=le.p||0,Pe=le.b||0,mt=le.l,ct=le.d,He=le.m,Rt=le.n,bt=8*Ie;do{if(!mt){Ge=Vs(ee,je,1);var gt=Vs(ee,je+1,3);if(je+=3,!gt){var qe=ee[(vn=4+((je+7)/8|0))-4]|ee[vn-3]<<8,Dt=vn+qe;if(Dt>Ie){Se&&js(0);break}Me&&Le(Pe+qe),de.set(ee.subarray(vn,Dt),Pe),le.b=Pe+=qe,le.p=je=8*Dt,le.f=Ge;continue}if(gt==1)mt=jN,ct=UN,He=9,Rt=5;else if(gt==2){var Jt=Vs(ee,je,31)+257,Bt=Vs(ee,je+10,15)+4,rn=Jt+Vs(ee,je+5,31)+1;je+=14;for(var en=new Yo(rn),un=new Yo(19),Lt=0;Lt<Bt;++Lt)un[zN[Lt]]=Vs(ee,je+3*Lt,7);je+=3*Bt;var Yn=Kx(un),$n=(1<<Yn)-1,In=nm(un,Yn,1);for(Lt=0;Lt<rn;){var vn,Cn=In[Vs(ee,je,$n)];if(je+=15&Cn,(vn=Cn>>4)<16)en[Lt++]=vn;else{var fi=0,ri=0;for(vn==16?(ri=3+Vs(ee,je,3),je+=2,fi=en[Lt-1]):vn==17?(ri=3+Vs(ee,je,7),je+=3):vn==18&&(ri=11+Vs(ee,je,127),je+=7);ri--;)en[Lt++]=fi}}var Ci=en.subarray(0,Jt),xi=en.subarray(Jt);He=Kx(Ci),Rt=Kx(xi),mt=nm(Ci,He,1),ct=nm(xi,Rt,1)}else js(1);if(je>bt){Se&&js(0);break}}Me&&Le(Pe+131072);for(var Lr=(1<<He)-1,Oi=(1<<Rt)-1,yi=je;;yi=je){var Xi=(fi=mt[Jx(ee,je)&Lr])>>4;if((je+=15&fi)>bt){Se&&js(0);break}if(fi||js(2),Xi<256)de[Pe++]=Xi;else{if(Xi==256){yi=je,mt=null;break}var br=Xi-254;Xi>264&&(br=Vs(ee,je,(1<<(no=gS[Lt=Xi-257]))-1)+bS[Lt],je+=no);var xr=ct[Jx(ee,je)&Oi],li=xr>>4;if(xr||js(3),je+=15&xr,xi=VN[li],li>3){var no=_S[li];xi+=Jx(ee,je)&(1<<no)-1,je+=no}if(je>bt){Se&&js(0);break}Me&&Le(Pe+131072);var el=Pe+br;if(Pe<xi){var ds=0-xi,Us=Math.min(xi,el);for(ds+Pe<0&&js(3);Pe<Us;++Pe)de[Pe]=(void 0)[ds+Pe]}for(;Pe<el;++Pe)de[Pe]=de[Pe-xi]}}le.l=mt,le.p=yi,le.b=Pe,le.f=Ge,mt&&(Ge=1,le.m=He,le.d=ct,le.n=Rt)}while(!Ge);return Pe!=de.length&&ve?(Ce=de,((ze=Pe)==null||ze>Ce.length)&&(ze=Ce.length),new Yo(Ce.subarray(0,ze))):de.subarray(0,Pe)}(W.subarray(K,-8),{i:2},new Yo(((B=W)[(V=B.length)-4]|B[V-3]<<8|B[V-2]<<16|B[V-1]<<24)>>>0))));var B,V,W,K;let Y=qN[L];if(!Y)throw new Error(`Unhandled codec: ${L}`);let se=new globalThis.DecompressionStream(Y);return new Response(new Blob([k]).stream().pipeThrough(se)).arrayBuffer().then(ee=>new Uint8Array(ee))}(I,D).then(k=>{let L=Bs.read(new Th(k));if(L.values==="uint32_values")return L.uint32_values.readValuesInto(S),new QN[g](S.buffer);throw new Error(`Unhandled numeric data "${L.values}"`)}),P.then(k=>{for(let L=w.length-1;L>=0;L--)switch(w[L]){case"delta_filter":ON(k,y);break;case"zigzag_filter":FN(k);break;case"bitshuffle_filter":LN(k,g);break;default:throw new Error(`Unhandled filter "${w[L]}"`)}return{layerName:s,blockIndex:b,data:k}}).catch(k=>{throw k})}))},ht(ES,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let TS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class e1{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,s]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);let h=TS[15&s];if(!h)throw new Error("Unrecognized array type.");let[g]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new e1(y,g,h,e)}constructor(e,n=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let h=TS.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(h<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return t1(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:h,coords:g,nodeSize:y}=this,b=[0,h.length-1,0],w=[];for(;b.length;){let D=b.pop()||0,I=b.pop()||0,S=b.pop()||0;if(I-S<=y){for(let B=S;B<=I;B++){let V=g[2*B],W=g[2*B+1];V>=e&&V<=s&&W>=n&&W<=u&&w.push(h[B])}continue}let P=S+I>>1,k=g[2*P],L=g[2*P+1];k>=e&&k<=s&&L>=n&&L<=u&&w.push(h[P]),(D===0?e<=k:n<=L)&&(b.push(S),b.push(P-1),b.push(1-D)),(D===0?s>=k:u>=L)&&(b.push(P+1),b.push(I),b.push(1-D))}return w}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:h,nodeSize:g}=this,y=[0,u.length-1,0],b=[],w=s*s;for(;y.length;){let D=y.pop()||0,I=y.pop()||0,S=y.pop()||0;if(I-S<=g){for(let B=S;B<=I;B++)IS(h[2*B],h[2*B+1],e,n)<=w&&b.push(u[B]);continue}let P=S+I>>1,k=h[2*P],L=h[2*P+1];IS(k,L,e,n)<=w&&b.push(u[P]),(D===0?e-s<=k:n-s<=L)&&(y.push(S),y.push(P-1),y.push(1-D)),(D===0?e+s>=k:n+s>=L)&&(y.push(P+1),y.push(I),y.push(1-D))}return b}}function t1(t,e,n,s,u,h){if(u-s<=n)return;let g=s+u>>1;DS(t,e,g,s,u,h),t1(t,e,n,s,g-1,1-h),t1(t,e,n,g+1,u,1-h)}function DS(t,e,n,s,u,h){for(;u>s;){if(u-s>600){let w=u-s+1,D=n-s+1,I=Math.log(w),S=.5*Math.exp(2*I/3),P=.5*Math.sqrt(I*S*(w-S)/w)*(D-w/2<0?-1:1);DS(t,e,n,Math.max(s,Math.floor(n-D*S/w+P)),Math.min(u,Math.floor(n+(w-D)*S/w+P)),h)}let g=e[2*n+h],y=s,b=u;for(rm(t,e,s,n),e[2*u+h]>g&&rm(t,e,s,u);y<b;){for(rm(t,e,y,b),y++,b--;e[2*y+h]<g;)y++;for(;e[2*b+h]>g;)b--}e[2*s+h]===g?rm(t,e,s,b):(b++,rm(t,e,b,u)),b<=n&&(s=b+1),n<=b&&(u=b-1)}}function rm(t,e,n,s){n1(t,n,s),n1(e,2*n,2*s),n1(e,2*n+1,2*s+1)}function n1(t,e,n){let s=t[e];t[e]=t[n],t[n]=s}function IS(t,e,n,s){let u=t-n,h=e-s;return u*u+h*h}r.$=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,s]){let u=Mc([1,n,s]);return{x:u.x,y:u.y,z:u.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:sn(t.x,e.x,n),y:sn(t.y,e.y,n),z:sn(t.z,e.z,n)}}},r.A=Re,r.B=Dp,r.C=Kr,r.D=c_,r.E=La,r.F=function(t){let e=t.value,n=[];if(!e)return n;let s=oa(e);return s!=="string"?(n=n.concat([new ly(t.key,e,`string expected, "${s}" found`)]),n):(HC(e,!0)||(n=n.concat([new ly(t.key,e,`invalid url "${e}"`)])),n)},r.G=ie,r.H=ge,r.I=Mx,r.J=he,r.K=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Mc(t.expression.evaluate(e))}interpolate(t,e,n){return{x:sn(t.x,e.x,n),y:sn(t.y,e.y,n),z:sn(t.z,e.z,n),azimuthal:sn(t.azimuthal,e.azimuthal,n),polar:sn(t.polar,e.polar,n)}}},r.L=ae,r.M=class{constructor(t,e,n,s){this.id=t,this.position=e!=null?new En(e[0],e[1]):new En(0,0),this.orientation=n??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new gi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.a9.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let s=gi.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(s)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.a9.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,n,s,u,h,g=!1){ZC(this.matrix,this,t.transform,this.position,e,n,s,u,h,g)}upload(t){if(!this.uploaded){for(let e of this.nodes)Ux(e,t);for(let e of this.nodes)cy(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)Gx(t)}},r.N=q,r.O=Fr,r.P=tt,r.R=Md,r.S=Ic,r.T=zx,r.U=De,r.V=ly,r.W=$l,r.X=sn,r.Y=nt,r.Z=lu,r._=Vc,r.a=zd,r.a$=Ff,r.a0=function(t,e,n=0,s=!0){let u=new tt(n,n),h=t.sub(u),g=e.add(u),y=[h,new tt(g.x,h.y),g,new tt(h.x,g.y)];return s&&y.push(h.clone()),y},r.a1=function(t,e){let n=[];for(let s=0;s<t.length;s++){let u=Cs(s-1,-1,t.length-1),h=Cs(s+1,-1,t.length-1),g=t[s],y=t[h],b=t[u].sub(g).unit(),w=y.sub(g).unit(),D=w.angleWithSep(b.x,b.y),I=b.add(w).unit().mult(-1*e/Math.sin(D/2));n.push(g.add(I))}return n},r.a2=SC,r.a3=UD,r.a4=function(t,e,n=0){return r.Q.fromValues(((e.x-n)*t.scale-t.x)*nt,(e.y*t.scale-t.y)*nt,OD(e.z,e.y))},r.a5=rx,r.a6=qI,r.a7=function(t){let e=1/0,n=1/0,s=-1/0,u=-1/0;for(let h of t)e=Math.min(e,h.x),n=Math.min(n,h.y),s=Math.max(s,h.x),u=Math.max(u,h.y);return{min:new tt(e,n),max:new tt(s,u)}},r.a8=Ul,r.aA=Bn,r.aB=Qt,r.aC=r_,r.aD=Vb,r.aE=Vi,r.aF=Sn,r.aG=gD,r.aH=ty,r.aI=function(){re.isLoading()||re.isLoaded()||ne()!=="deferred"||te()},r.aJ=ot,r.aK=Gl,r.aL=lS,r.aM=co,r.aN=Ex,r.aO=bx,r.aP=Ya,r.aQ=Dr,r.aR=zb,r.aS=ZD,r.aT=k_,r.aU=Nx,r.aV=function(t,e){let n=$l(e.zoom);if(n===0)return ha(t);let s=I_(t),u=lx(s),h=Ul(s.getWest())*e.worldSize,g=Ul(s.getEast())*e.worldSize,y=Qa(s.getNorth())*e.worldSize,b=Qa(s.getSouth())*e.worldSize,w=[h,y,0],D=[g,y,0],I=[h,b,0],S=[g,b,0],P=r.a9.invert([],e.globeMatrix);return r.Q.transformMat4(w,w,P),r.Q.transformMat4(D,D,P),r.Q.transformMat4(I,I,P),r.Q.transformMat4(S,S,P),u[0]=Xa(u[0],I,n),u[1]=Xa(u[1],S,n),u[2]=Xa(u[2],D,n),u[3]=Xa(u[3],w,n),gi.fromPoints(u)},r.aW=S_,r.aX=kp,r.aY=Xa,r.aZ=lr,r.a_=UO,r.ab=bu,r.ac=ND,r.ad=hn,r.ae=eo,r.af=function(t,e){let n={};for(let s=0;s<e.length;s++){let u=e[s];u in t&&(n[u]=t[u])}return n},r.ag=jl,r.ah=Qa,r.ai=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,s){let u=this.entries[t]=this.entries[t]||{callbacks:[]};if(u.result){let[h,g]=u.result;return this.scheduler?this.scheduler.add(()=>{s(h,g)},e):s(h,g),()=>{}}return u.callbacks.push(s),u.cancel||(u.cancel=n((h,g)=>{u.result=[h,g];for(let y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(h,g)},e):y(h,g);setTimeout(()=>delete this.entries[t],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(h=>h!==s),u.callbacks.length||(u.cancel(),delete this.entries[t]))}}},r.aj=ni,r.ak=function(t,e,n){let s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{let h=kc(t.request,(g,y,b,w)=>{g?u(g):y&&u(null,{vectorTile:n?void 0:new xx(new Th(y)),rawData:y,cacheControl:b,expires:w})});return()=>{h.cancel(),u()}},e)},r.al=function(t){Vf++,Vf>Sg&&(t.getActor().send("enforceCacheSizeLimit",Cd),Vf=0)},r.am=Yr,r.an=Td,r.ao=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.ap=Or,r.aq=NC,r.ar=zC,r.as=LC,r.at=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){let u=document.createElement("source");Uf(t[s])||(n.crossOrigin="Anonymous"),u.src=t[s],n.appendChild(u)}return{cancel:()=>{}}},r.au=iy,r.av=Hp,r.aw=Io,r.ax=Cr,r.ay=Ir,r.az=ur,r.b=ia,r.b$=Ih,r.b0=wS,r.b1=kc,r.b2=function(t){let e=[];for(let n in t)e.push(t[n]);return e},r.b3=function(t,e){let n=[];for(let s in t)s in e||n.push(s);return n},r.b4=kf,r.b5=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.b6=function(t,e){let{x:n,y:s}=t.point,u=eI(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.a9.multiply(u,u,cx(ha(e)))},r.b8=xh,r.b9=Qo,r.bA=PD,r.bB=function(t){let e=r.a9.identity(new Float64Array(16));r.a9.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,cs,0],s=[0,us,0];return r.Q.transformMat4(n,n,e),r.Q.transformMat4(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!dx(t,new En(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!dx(t,new En(t.center.lat,-90))]},r.bC=function(t,e){let{scale:n}=t.tileTransform,s=n*nt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.b7.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},r.bD=sy,r.bE=BC,r.bF=function(t){let e=BC(t,!0);return r.b7.invert([],[e[0],e[1],e[4],e[5]])},r.bG=ox,r.bH=function(t){let{x:e,y:n}=t.point,{lng:s,lat:u}=t._center;return eI(e,n,t.worldSize,s,u)},r.bI=Ur,r.bJ=qb,r.bK=function(t){let e=Math.round((t+45+360)%360/90)%4;return Eg[e]},r.bL=45,r.bM=Qb,r.bN=Mp,r.bO=zl,r.bP=Gb,r.bQ=Jr,r.bR=v_,r.bS=SD,r.bT=function(t,e,n){let s=Math.sqrt(t*t+e*e+n*n),u=s>0?Math.acos(n/s)*Rf:0,h=t!==0||e!==0?Math.atan2(-e,-t)*Rf+90:0;return h<0&&(h+=360),[s,h,u]},r.bU=b_,r.bV=gi,r.bW=Mc,r.bX=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.bY=function(t){return t({pluginStatus:U,pluginURL:j}),Z.on("pluginStateChange",t),t},r.bZ=$x,r.b_=uy,r.ba=j_,r.bb=function(t,e,n,s,u){let h=5*e+2;t.float32[h+0]=n,t.float32[h+1]=s,t.float32[h+2]=u},r.bc=ey,r.bd=_C,r.be=ex,r.bf=Sr,r.bg=Rx,r.bh=TC,r.bi=Sx,r.bj=e1,r.bk=Cs,r.bm=bn,r.bn=ka,r.bo=to,r.bp=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.bq=En,r.br=kC,r.bs=kD,r.bt=sx,r.bu=VC,r.bv=yu,r.bw=XD,r.bx=function(t,e,n,s,u,h,g,y,b){if(b.name==="globe")return XD(t,e,new yu(n,s,u),!1);let w=Hp({z:n,x:s,y:u},b);return new gi([(h+w.x/w.scale)*e,e*(w.y/w.scale),g],[(h+w.x2/w.scale)*e,e*(w.y2/w.scale),y])},r.by=function(t,e,n){let s=0;for(let u=0;u<2;++u)t[u]>0&&(s+=(t[u]-0)*(t[u]-0)),e[u]<0&&(s+=(0-e[u])*(0-e[u]));return s},r.bz=ji,r.c=sS,r.c$=[1,1,1],r.c0=Ax,r.c1=vl,r.c2=G,r.c3=Q,r.c4=Id,r.c5=Nc,r.c6=Ss,r.c7=function(t,e,n){return t.type==="custom"?new eN(t,e):new RN[t.type](t,e,n)},r.c8=function(t){let e=t.indexOf(Bi);return e>=0?t.slice(0,e):t},r.c9=function(t){return t.indexOf(Bi)>=0},r.cA=t=>({u_matrix:new Mp(t),u_pixels_to_tile_units:new $b(t),u_device_pixel_ratio:new Jr(t),u_units_to_pixels:new zl(t),u_dash_image:new v_(t),u_gradient_image:new v_(t),u_image_height:new Jr(t),u_texsize:new zl(t),u_tile_units_to_pixels:new Jr(t),u_alpha_discard_threshold:new Jr(t),u_trim_offset:new zl(t),u_emissive_strength:new Jr(t)}),r.cB=t=>({u_matrix:new Mp(t),u_texsize:new zl(t),u_pixels_to_tile_units:new $b(t),u_device_pixel_ratio:new Jr(t),u_image:new v_(t),u_units_to_pixels:new zl(t),u_tile_units_to_pixels:new Jr(t),u_alpha_discard_threshold:new Jr(t),u_trim_offset:new zl(t)}),r.cC=hu,r.cD=sL,r.cE=aL,r.cF=iI,r.cG=(t,e,n,s,u,h)=>{let g=t.transform,y=g.projection.name==="globe",b;if(h.paint.get("circle-pitch-alignment")==="map")if(y){let D=JD(g.zoom,e.canonical)*g._pixelsPerMercatorPixel;b=Float32Array.from([D,0,0,D])}else b=g.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([g.pixelsToGLUnits[0],0,0,g.pixelsToGLUnits[1]]);let w={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(g.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ns.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:WO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:h.paint.get("circle-emissive-strength")};if(y){w.u_inv_rot_matrix=s,w.u_merc_center=u,w.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],w.u_zoom_transition=$l(g.zoom);let D=u[0]*nt,I=u[1]*nt;w.u_up_dir=g.projection.upVector(new yu(0,0,0),D,I)}return w},r.cH=QI,r.cI=(t,e,n,s,u,h)=>{let g=t.transform;return{u_matrix:ZI(t,e,n,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:g.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:WI(e,g),u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:h}},r.cJ=(t,e,n,s,u,h,g)=>{let y=t.transform,b=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:ZI(t,e,n,s),u_pixels_to_tile_units:b,u_device_pixel_ratio:h,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:YI(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:WI(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:g,u_emissive_strength:n.paint.get("line-emissive-strength")}},r.cK=Of,r.cL=Op,r.cM=VI,r.cN=AO,r.cO=V_,r.cP=Wl,r.cQ=450,r.cR=7,r.cS=XL,r.cT=256,r.cU=cx,r.cV=mu,r.cW=pu,r.cX=Lb,r.cY=function(t,e,n,s,u){return hn((t-e)/(n-e)*(u-s)+s,s,u)},r.cZ=vu,r.c_=Vx,r.ca=function(t){let e=t.indexOf(Bi);return e>=0?t.slice(e+1):""},r.cb=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cc=Cc,r.cd=Z,r.ce=Rc,r.cf=MD,r.cg=class extends Wa{constructor(t){super(t),this.current=wO}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.ch=yd,r.ci=function(t,e,n){let s=$l(n.zoom),u=t.style.map._antialias,h=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return s===0&&!u&&!h},r.cj=function(t){let e=t.pixelsPerMeter,n=e/to(1,t.center.lat),s=r.a9.identity(new Float64Array(16));return r.a9.translate(s,s,[t.point.x,t.point.y,0]),r.a9.scale(s,s,[n,n,e]),Float32Array.from(s)},r.ck=I_,r.cl=function(t){let e=ji-5;t=hn(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(bn(t))),3);return Math.round(n*(Wb.length-1))},r.cm=function(t,e,n,s){let u=e.getNorth(),h=e.getSouth(),g=e.getWest(),y=e.getEast(),b=1<<t.z,w=y-g,D=u-h,I=w/hh,S=-D/Wb[n],P=[0,I,0,S,0,0,u,g,0];if(t.z>0){let k=180/s;r.ct.multiply(P,P,[k/w+1,0,0,0,k/D+1,0,-.5*k/I,.5*k/S,1])}return P[2]=b,P[5]=t.x,P[8]=t.y,P},r.cn=ha,r.co=function(t,e,n){let s=r.a9.identity(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return r.a9.rotateY(s,n.globeMatrix,u),Float32Array.from(s)},r.cp=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,s=1<<n,u=Math.floor(t.x),h=Math.floor((t.x-u)*s),g=Math.floor(t.y*s),y=this.findDEMTileFor(new Or(n,u,n,h,g));return!(!y||!y.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let s=this._source();if(!s||t.y<0||t.y>1)return e;let u=s.getSource().maxzoom,h=1<<u,g=Math.floor(t.x),y=t.x-g,b=new Or(u,g,u,Math.floor(y*h),Math.floor(t.y*h)),w=this.findDEMTileFor(b);if(!w||!w.dem)return e;let D=w.dem,I=1<<w.tileID.canonical.z,S=(y*I-w.tileID.canonical.x)*D.dim,P=(t.y*I-w.tileID.canonical.y)*D.dim,k=Math.floor(S),L=Math.floor(P);return(n?this.exaggeration():1)*sn(sn(D.get(k,L),D.get(k,L+1),P-L),sn(D.get(k+1,L),D.get(k+1,L+1),P-L),S-k)}getAtTileOffset(t,e,n){let s=1<<t.canonical.z;return this.getAtPointOrZero(new Fr(t.wrap+(t.canonical.x+e/nt)/s,(t.canonical.y+n/nt)/s))}getAtTileOffsetFunc(t,e,n,s){return u=>{let h=this.getAtTileOffset(t,u.x,u.y),g=s.upVector(t.canonical,u.x,u.y),y=s.upVectorScale(t.canonical,e,n).metersToTile;return r.Q.scale(g,g,h*y),g}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;let u=vh.create(this,t,s);return!!u&&(e.forEach(h=>{h[2]=this.exaggeration()*u.getElevationAt(h[0],h[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,s=e.tileID,u=1<<t.canonical.z-s.canonical.z,h=t.canonical.x/u-s.canonical.x,g=t.canonical.y/u-s.canonical.y,y=0;for(let b=0;b<t.canonical.z-s.canonical.z&&!n.leaves[y];b++){h*=2,g*=2;let w=2*Math.floor(g)+Math.floor(h);y=n.childOffsets[y]+w,h%=1,g%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,s=Number.MIN_VALUE;for(let u of t){let h=this.getMinMaxForTile(u.tileID);h&&(n=Math.min(n,h.min),s=Math.max(s,h.max),e=!0)}return e?{min:n,max:s}:null}},r.cq=D_,r.cr=cI,r.cs=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.cu=JD,r.cv=Cg,r.cw=jo,r.cx=256,r.cy=function(t,e){let n=[0,0,0],s=S_(ha(e.canonical));return r.Q.transformMat4(n,n,s),r.Q.transformMat4(n,n,t),n},r.cz=t=>({u_camera_to_center_distance:new Jr(t),u_extrude_scale:new $b(t),u_device_pixel_ratio:new Jr(t),u_matrix:new Mp(t),u_inv_rot_matrix:new Mp(t),u_merc_center:new zl(t),u_tile_id:new Gb(t),u_zoom_transition:new Jr(t),u_up_dir:new Gb(t),u_emissive_strength:new Jr(t)}),r.d=Gf,r.d$=QC,r.d0=vh,r.d1=Mh,r.d2=Do,r.d3=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=vI(new tt(0,0),new tt(nt,nt),t),n=[];for(let s of this._activeRegions){if(s.hiddenByOverlap||!yI(e,s))continue;let u=SF(s.min,s.max,t);n.push({min:u.min,max:u.max,sourceId:this._sourceIds[s.priority],footprint:s.footprint,footprintTileId:s.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let s of e.cache.getVisibleCoordinates()){let u=e.cache.getTile(s).buckets[e.layer];if(u)for(let h of u.getNodesInfo()){let g=h.node;g.footprint&&n.push({footprint:g.footprint,id:s.toUnwrapped()})}}return n}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let n of e){if(!n.footprint)continue;let s=vI(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:s.min,max:s.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||N_(e.min,n.min)||N_(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){let s=this._activeRegions[e],u=this._prevRegions[n];t=s.priority!==u.priority||!_I(s,u),++e,++n}}if(t){++this._updateTime;let e=n=>{let s=this._activeRegions;if(n>=s.length)return n;let u=s[n].priority;for(;n<s.length&&s[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,s=e(n);for(;n!==s;){let u=n,h=n;for(;u!==s;){let g=this._activeRegions[u];g.hiddenByOverlap=!1;for(let y=0;y<h;y++){let b=this._activeRegions[y];if(!b.hiddenByOverlap&&yI(g,b)&&(g.hiddenByOverlap=xI(g.footprint,g.tileId,b.footprint,b.tileId),g.hiddenByOverlap))break}++u}n=s,s=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.d4=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new Dr,s=new ur,u=[],h=t+1+2,g=e[0]+1,y=e[0]+1+(1+e.length),b=(w,D,I)=>{let S=w===h-1?w-2:w===0?w:w-1;return S+=I?24575:0,[S,D]};for(let w=0;w<h;++w)n.emplaceBack(...b(w,0,!0));for(let w=0;w<g;++w)for(let D=0;D<h;++D)n.emplaceBack(...b(D,w,(D===0||D===h-1)&&!0));for(let w=0;w<e.length;++w){let D=e[w];for(let I=0;I<h;++I)n.emplaceBack(...b(I,D,!0))}for(let w=0;w<e.length;++w){let D=s.length,I=e[w]+1+2,S=new ur;for(let L=0;L<I-1;L++){let B=L===I-2,V=B?h*(y-e.length+w-L):h;for(let W=0;W<h-1;W++){let K=L*h+W;L===0||B||W===0||W===h-2?(S.emplaceBack(K+1,K,K+V),S.emplaceBack(K+V,K+V+1,K+1)):(s.emplaceBack(K+1,K,K+V),s.emplaceBack(K+V,K+V+1,K+1))}}let P=Vi.simpleSegment(0,D,n.length,s.length-D);for(let L=0;L<S.uint16.length;L+=3)s.emplaceBack(S.uint16[L],S.uint16[L+1],S.uint16[L+2]);let k=Vi.simpleSegment(0,D,n.length,s.length-D);u.push({withoutSkirts:P,withSkirts:k})}return{vertices:n,indices:s,segments:u}}_createGrid(t){let e=this._fillGridMeshWithLods(hh,Wb);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,ZD.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new ur;for(let g=0;g<=hh;g++)e.emplaceBack(0,g+1,g+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new pu,s=new pu,u=new pu,h=new pu;this._poleSegments=[];for(let g=0,y=0;g<qb;g++){let b=360/(1<<g);n.emplaceBack(0,-eo,0,.5,0),s.emplaceBack(0,-eo,0,.5,1),u.emplaceBack(0,-eo,0,.5,.5),h.emplaceBack(0,-eo,0,.5,.5);for(let w=0;w<=hh;w++){let D=w/hh,I=0,S=sn(0,b,D),[P,k,L]=fh(HO,qO,S,eo);n.emplaceBack(P,k,L,D,I),s.emplaceBack(P,k,L,D,1-I);let B=bn(S);D=.5+.5*Math.sin(B),I=.5+.5*Math.cos(B),u.emplaceBack(P,k,L,D,I),h.emplaceBack(P,k,L,D,1-I)}this._poleSegments.push(Vi.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,T_,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,T_,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(u,T_,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(h,T_,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.d5=function(t){return Ld.has(t)},r.d6=Tg,r.d7=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.d8=Vo,r.d9=LD,r.dA=Kp,r.dB=function(t){let e=Bf();if(!e)return;let n=e.delete(gl);t&&n.catch(t).then(()=>t())},r.dC=Xp,r.dD=YC,r.dE=function(t){qx=ns.resolveURL(t),Ph||(Ph=new $x(uy(),new La)),Ph.broadcast("setDracoUrl",qx)},r.dF=XC,r.dG=function(t){Ah=ns.resolveURL(t),Ph||(Ph=new $x(uy(),new La)),Ph.broadcast("setMeshoptUrl",Ah)},r.dH=ht,r.dI=Hl,r.dJ=Ns,r.dK=aS,r.dL=cS,r.dM=$I,r.dN=pl,r.dO=vC,r.dP=function(t,e,n,s,u,h,g,y,b,w,D){t.createArrays(),t.tilePixelRatio=nt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let I=t.layers[0].layout,S=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){let{minZoom:V,maxZoom:W}=t.textSizeData;P.compositeTextSizes=[S["text-size"].possiblyEvaluate(new q(V),y),S["text-size"].possiblyEvaluate(new q(W),y)]}if(t.iconSizeData.kind==="composite"){let{minZoom:V,maxZoom:W}=t.iconSizeData;P.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new q(V),y),S["icon-size"].possiblyEvaluate(new q(W),y)]}P.layoutTextSize=S["text-size"].possiblyEvaluate(new q(b+1),y),P.layoutIconSize=S["icon-size"].possiblyEvaluate(new q(b+1),y),P.textMaxSize=S["text-size"].possiblyEvaluate(new q(18),y);let k=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-size"),B=!1;for(let V of t.features)if(V.icon&&V.icon.nameSecondary){B=!0;break}for(let V of t.features){let W=I.get("text-font").evaluate(V,{},y).join(","),K=L.evaluate(V,{},y),Y=P.layoutTextSize.evaluate(V,{},y),se=(P.layoutIconSize.evaluate(V,{},y),{horizontal:{},vertical:void 0}),ee=V.text,le,de=[0,0];if(ee){let ve=ee.toString(),Me=I.get("text-letter-spacing").evaluate(V,{},y)*Sr,Se=I.get("text-line-height").evaluate(V,{},y)*Sr,Ce=p(ve)?Me:0,ze=I.get("text-anchor").evaluate(V,{},y),Le=I.get("text-variable-anchor");if(!Le){let ct=I.get("text-radial-offset").evaluate(V,{},y);de=ct?TC(ze,[ct*Sr,Px]):I.get("text-offset").evaluate(V,{},y).map(He=>He*Sr)}let Ge=k?"center":I.get("text-justify").evaluate(V,{},y),je=I.get("symbol-placement")==="point",Pe=je?I.get("text-max-width").evaluate(V,{},y)*Sr:1/0,mt=ct=>{t.allowVerticalPlacement&&l(ve)&&(se.vertical=Cx(ee,e,n,u,W,Pe,Se,ze,ct,Ce,de,Qo.vertical,!0,Y,K))};if(!k&&Le){let ct=Ge==="auto"?Le.map(Rt=>Rx(Rt)):[Ge],He=!1;for(let Rt=0;Rt<ct.length;Rt++){let bt=ct[Rt];if(!se.horizontal[bt])if(He)se.horizontal[bt]=se.horizontal[0];else{let gt=Cx(ee,e,n,u,W,Pe,Se,"center",bt,Ce,de,Qo.horizontal,!1,Y,K);gt&&(se.horizontal[bt]=gt,He=gt.positionedLines.length===1)}}mt("left")}else{if(Ge==="auto"&&(Ge=Rx(ze)),je||I.get("text-writing-mode").indexOf("horizontal")>=0||!l(ve)){let ct=Cx(ee,e,n,u,W,Pe,Se,ze,Ge,Ce,de,Qo.horizontal,!1,Y,K);ct&&(se.horizontal[Ge]=ct)}mt(je?"left":Ge)}}let _e=!1;if(V.icon&&V.icon.namePrimary){let ve=s[V.icon.namePrimary];ve&&(le=IL(u[V.icon.namePrimary],V.icon.nameSecondary?u[V.icon.nameSecondary]:void 0,I.get("icon-offset").evaluate(V,{},y),I.get("icon-anchor").evaluate(V,{},y)),_e=ve.sdf,t.sdfIcons===void 0?t.sdfIcons=ve.sdf:t.sdfIcons!==ve.sdf&&Ii("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ve.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let Ie=IC(se.horizontal)||se.vertical;t.iconsInText||(t.iconsInText=!!Ie&&Ie.iconsInText),(Ie||le)&&kL(t,V,se,le,s,P,Y,0,de,_e,g,y,w,D,B)}h&&t.generateCollisionDebugBuffers(b,t.collisionBoxArray)},r.dQ=xx,r.dR=Th,r.dS=z_,r.dT=F_,r.dU=O_,r.dV=_d,r.dW=eC,r.dX=dt,r.dY=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==JC){let n=new Uint32Array(t,0,7),[,,s,u,h,g]=n;e=n.byteLength+u+h+g+h,(s!==t.byteLength||e>=t.byteLength)&&Ii("Invalid b3dm header information.")}return iS(t,e)},r.dZ=function(t,e){let n=sS(t);for(let s of n){for(let u of s.meshes)IN(u);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(CN(s.lights,e)))}return n},r.d_=py,r.da=_u,r.db=function([t,e,n]){let s=Math.hypot(t,e,n),u=Math.atan2(t,n),h=.5*Math.PI-Math.acos(-e/s);return new En(Ur(u),Ur(h))},r.dc=ph,r.dd=F,r.de=dx,r.df=tI,r.dg=function(t){let e=[0,0,0],n=r.a9.identity(new Float64Array(16));return r.a9.multiply(n,t.pixelMatrix,t.globeMatrix),r.Q.transformMat4(e,e,n),new tt(e[0],e[1])},r.dh=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(Ed==null){let s=n.navigator?n.navigator.userAgent:null;Ed=!!n.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ed}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.di=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Fc,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Q(t))return t;let n=Uo(t);return n.params.push(`sdk=js-${T}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Q(t))return t;let n=Uo(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Q(t))return t;let n=Uo(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!Q(t))return t;let u=Uo(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){let u=Uo(t);return Q(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${n}`,bl(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Q(t))return t;let s=Uo(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&s.authority!=="raster"&&n===512?"@2x":""}${Fa.supported?".webp":"$1"}`),s.authority==="raster"?s.path=`/${F.RASTER_URL_PREFIX}${s.path}`:s.authority==="rasterarrays"?s.path=`/${F.RASTERARRAYS_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${F.TILE_URL_VERSION}${s.path}`);let u=this._customAccessToken||function(h){for(let g of h){let y=g.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(t,e){let n=Uo(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:n.path.match(/^\/rasterarrays\/v1\//)?s+=`rasterarrays/${n.path.replace(`/${F.RASTERARRAYS_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(h=>!h.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(t,e){let n=!!e&&Q(e),s=[];for(let u of t.tiles||[])$(u)?s.push(this.canonicalizeTileURL(u,n)):s.push(u);return s}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Uo(F.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,t.protocol==="http"){let u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(s.path!=="/"&&(t.path=`${s.path}${t.path}`),!F.REQUIRE_ACCESS_TOKEN)return bl(t);if(e=e||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),bl(t)}},r.dj=function(t,e){e?Ld.add(t):Ld.delete(t)},r.dk=Fa,r.dl=Od,r.dm=qf,r.dn=Rd,r.dp=Xr,r.dq=_b,r.dr=function(t){Ld.delete(t)},r.ds=Fd,r.dt=na,r.du=T,r.dv=function(t,e){Cd=t,Sg=e},r.dw=function(t,e,n=!1){if(U===R||U===O||U===N)throw new Error("setRTLTextPlugin cannot be called multiple times.");j=ns.resolveURL(t),U=R,z=e,H(),n||te()},r.dx=ne,r.dy=function(){uy().acquire(Hx)},r.dz=function(){let t=Jp;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(Hx),Jp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.e=Eo,r.e0=re,r.e1=function(t){_l(),As&&As.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},r.f=ns,r.g=function(t,e){return Rc(Eo(t,{type:"json"}),e)},r.h=Zo,r.i=class extends ly{},r.j=oa,r.k=jd,r.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>iS(e,0,t))},r.m=sh,r.n=u_,r.o=lh,r.p=yC,r.q=Te,r.r=f_,r.s=Ol,r.t=Fl,r.u=we,r.v=Kc,r.w=Ii,r.x=eu,r.y=la}),c(["./shared"],function(r){"use strict";function T(We){let J=We?We.url.toString():void 0;return J?performance.getEntriesByName(J):[]}function M(We){if(typeof We=="number"||typeof We=="boolean"||typeof We=="string"||We==null)return JSON.stringify(We);if(Array.isArray(We)){let oe="[";for(let me of We)oe+=`${M(me)},`;return`${oe}]`}let J="{";for(let oe of Object.keys(We).sort())J+=`${oe}:${M(We[oe])},`;return`${J}}`}function F(We){let J="";for(let oe of r.b5)J+=`/${M(We[oe])}`;return J}class ${constructor(J){this.keyCache={},this._layers={},this._layerConfigs={},J&&this.replace(J)}replace(J,oe){this._layerConfigs={},this._layers={},this.update(J,[],oe)}update(J,oe,me){this._options=me;for(let Ue of J)this._layerConfigs[Ue.id]=Ue,(this._layers[Ue.id]=r.c7(Ue,this.scope,this._options)).compileFilter(),this.keyCache[Ue.id]&&delete this.keyCache[Ue.id];for(let Ue of oe)delete this.keyCache[Ue],delete this._layerConfigs[Ue],delete this._layers[Ue];this.familiesBySource={};let Be=function(Ue,Ye){let vt={};for(let ft=0;ft<Ue.length;ft++){let _t=Ye&&Ye[Ue[ft].id]||F(Ue[ft]);Ye&&(Ye[Ue[ft].id]=_t);let Et=vt[_t];Et||(Et=vt[_t]=[]),Et.push(Ue[ft])}let Ne=[];for(let ft in vt)Ne.push(vt[ft]);return Ne}(r.b2(this._layerConfigs),this.keyCache);for(let Ue of Be){let Ye=Ue.map(at=>this._layers[at.id]),vt=Ye[0];if(vt.visibility==="none")continue;let Ne=vt.source||"",ft=this.familiesBySource[Ne];ft||(ft=this.familiesBySource[Ne]={});let _t=vt.sourceLayer||"_geojsonTileLayer",Et=ft[_t];Et||(Et=ft[_t]=[]),Et.push(Ye)}}}let Q=1*r.dJ;class ue{constructor(J){let oe={},me=[];for(let vt in J){let Ne=J[vt],ft=oe[vt]={};for(let _t in Ne.glyphs){let Et=Ne.glyphs[+_t];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;let at=Et.metrics.localGlyph?Q:1,Kn={x:0,y:0,w:Et.bitmap.width+2*at,h:Et.bitmap.height+2*at};me.push(Kn),ft[_t]=Kn}}let{w:Be,h:Ue}=r.p(me),Ye=new r.dI({width:Be||1,height:Ue||1});for(let vt in J){let Ne=J[vt];for(let ft in Ne.glyphs){let _t=Ne.glyphs[+ft];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;let Et=oe[vt][ft],at=_t.metrics.localGlyph?Q:1;r.dI.copy(_t.bitmap,Ye,{x:0,y:0},{x:Et.x+at,y:Et.y+at},_t.bitmap)}}this.image=Ye,this.positions=oe}}r.dH(ue,"GlyphAtlas");class Ae{constructor(J){this.tileID=new r.ap(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.scope=J.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=J.showCollisionBoxes,this.collectResourceTiming=!!J.collectResourceTiming,this.promoteId=J.promoteId,this.isSymbolTile=J.isSymbolTile,this.tileTransform=r.av(J.tileID.canonical,J.projection),this.projection=J.projection,this.brightness=J.brightness,this.extraShadowCaster=!!J.extraShadowCaster}parse(J,oe,me,Be,Ue){this.status="parsing",this.data=J,this.collisionBoxArray=new r.aG;let Ye=new r.dK(Object.keys(J.layers).sort()),vt=new r.dL(this.tileID,this.promoteId);vt.bucketLayerIDs=[];let Ne={},ft=new r.dM(256,256),_t={featureIndex:vt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:ft,availableImages:me,brightness:this.brightness},Et=oe.familiesBySource[this.source];for(let Jn in Et){let bi=J.layers[Jn];if(!bi)continue;let pr=!1,pi=!1,Br=!1;for(let Zi of Et[Jn])Zi[0].type==="symbol"?pr=!0:pi=!0,Zi[0].is3D()&&Zi[0].type!=="model"&&(Br=!0);if(this.extraShadowCaster&&!Br||this.isSymbolTile===!0&&!pr||this.isSymbolTile===!1&&!pi)continue;bi.version===1&&r.w(`Vector tile source "${this.source}" layer "${Jn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let Rr=Ye.encode(Jn),No=[];for(let Zi=0;Zi<bi.length;Zi++){let Ei=bi.feature(Zi),Oe=vt.getId(Ei,Jn);No.push({feature:Ei,id:Oe,index:Zi,sourceLayerIndex:Rr})}for(let Zi of Et[Jn]){let Ei=Zi[0];(!this.extraShadowCaster||Ei.is3D()&&Ei.type!=="model")&&(this.isSymbolTile!==void 0&&Ei.type==="symbol"!==this.isSymbolTile||Ei.minzoom&&this.zoom<Math.floor(Ei.minzoom)||Ei.maxzoom&&this.zoom>=Ei.maxzoom||Ei.visibility!=="none"&&(xe(Zi,this.zoom,_t.brightness,me),(Ne[Ei.id]=Ei.createBucket({index:vt.bucketLayerIDs.length,layers:Zi,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Rr,sourceID:this.source,projection:this.projection.spec})).populate(No,_t,this.tileID.canonical,this.tileTransform),vt.bucketLayerIDs.push(Zi.map(Oe=>Oe.id))))}}let at,Kn,Rn,Qn;ft.trim();let kn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},On=()=>{if(at)return this.status="done",Ue(at);if(this.extraShadowCaster)this.status="done",Ue(null,{buckets:r.b2(Ne).filter(Jn=>!Jn.isEmpty()),featureIndex:vt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_t.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Kn&&Rn&&Qn){let Jn=new ue(Kn),bi=new r.dO(Rn,Qn);for(let pr in Ne){let pi=Ne[pr];pi instanceof r.aH?(xe(pi.layers,this.zoom,_t.brightness,me),r.dP(pi,Kn,Jn.positions,Rn,bi.iconPositions,this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):pi.hasPattern&&(pi instanceof r.aN||pi instanceof r.aO||pi instanceof r.cO)&&(xe(pi.layers,this.zoom,_t.brightness,me),pi.addFeatures(_t,this.tileID.canonical,bi.patternPositions,me,this.tileTransform,this.brightness))}this.status="done",Ue(null,{buckets:r.b2(Ne).filter(pr=>!pr.isEmpty()),featureIndex:vt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Jn.image,lineAtlas:ft,imageAtlas:bi,brightness:_t.brightness})}};if(!this.extraShadowCaster){let Jn=r.dN(_t.glyphDependencies,pi=>Object.keys(pi).map(Number));Object.keys(Jn).length?Be.send("getGlyphs",{uid:this.uid,stacks:Jn,scope:this.scope},(pi,Br)=>{at||(at=pi,Kn=Br,On())},void 0,!1,kn):Kn={};let bi=Object.keys(_t.iconDependencies);bi.length?Be.send("getImages",{icons:bi,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(pi,Br)=>{at||(at=pi,Rn=Br,On())},void 0,!1,kn):Rn={};let pr=Object.keys(_t.patternDependencies);pr.length?Be.send("getImages",{icons:pr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(pi,Br)=>{at||(at=pi,Qn=Br,On())},void 0,!1,kn):Qn={}}On()}}function xe(We,J,oe,me){let Be=new r.N(J,{brightness:oe});for(let Ue of We)Ue.recalculate(Be,me)}class ke extends r.E{constructor(J,oe,me,Be,Ue,Ye){super(),this.actor=J,this.layerIndex=oe,this.availableImages=me,this.loadVectorData=Ue||r.ak,this.loading={},this.loaded={},this.deduped=new r.ai(J.scheduler),this.isSpriteLoaded=Be,this.scheduler=J.scheduler,this.brightness=Ye}loadTile(J,oe){let me=J.uid,Be=J&&J.request,Ue=Be&&Be.collectResourceTiming,Ye=this.loading[me]=new Ae(J);Ye.abort=this.loadVectorData(J,(vt,Ne)=>{let ft=!this.loading[me];if(delete this.loading[me],ft||vt||!Ne)return Ye.status="done",ft||(this.loaded[me]=Ye),oe(vt);let _t=Ne.rawData,Et={};Ne.expires&&(Et.expires=Ne.expires),Ne.cacheControl&&(Et.cacheControl=Ne.cacheControl),Ye.vectorTile=Ne.vectorTile||new r.dQ(new r.dR(_t));let at=()=>{Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.actor,(Kn,Rn)=>{if(Kn||!Rn)return oe(Kn);let Qn={};if(Ue){let kn=T(Be);kn.length>0&&(Qn.resourceTiming=JSON.parse(JSON.stringify(kn)))}oe(null,r.e({rawTileData:_t.slice(0)},Rn,Et,Qn))})};this.isSpriteLoaded?at():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(at,{type:"parseTile",isSymbolTile:J.isSymbolTile,zoom:J.tileZoom}):at()}),this.loaded=this.loaded||{},this.loaded[me]=Ye})}reloadTile(J,oe){let me=this.loaded,Be=J.uid,Ue=this;if(me&&me[Be]){let Ye=me[Be];Ye.showCollisionBoxes=J.showCollisionBoxes,Ye.projection=J.projection,Ye.brightness=J.brightness,Ye.tileTransform=r.av(J.tileID.canonical,J.projection),Ye.extraShadowCaster=J.extraShadowCaster;let vt=(Ne,ft)=>{let _t=Ye.reloadCallback;_t&&(delete Ye.reloadCallback,Ye.parse(Ye.vectorTile,Ue.layerIndex,this.availableImages,Ue.actor,_t)),oe(Ne,ft)};Ye.status==="parsing"?Ye.reloadCallback=vt:Ye.status==="done"&&(Ye.vectorTile?Ye.parse(Ye.vectorTile,this.layerIndex,this.availableImages,this.actor,vt):vt())}else oe(null,void 0)}abortTile(J,oe){let me=J.uid,Be=this.loading[me];Be&&(Be.abort&&Be.abort(),delete this.loading[me]),oe()}removeTile(J,oe){let me=this.loaded,Be=J.uid;me&&me[Be]&&delete me[Be],oe()}}class Qe{loadTile(J,oe){let{uid:me,encoding:Be,rawImageData:Ue,padding:Ye}=J,vt=ImageBitmap&&Ue instanceof ImageBitmap?this.getImageData(Ue,Ye):Ue;oe(null,new r.dS(me,vt,Be,Ye<1))}getImageData(J,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(J.width,J.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=J.width,this.offscreenCanvas.height=J.height,this.offscreenCanvasContext.drawImage(J,0,0,J.width,J.height);let me=this.offscreenCanvasContext.getImageData(-oe,-oe,J.width+2*oe,J.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}class dt{decodeRasterArray({task:J,buffer:oe},me){r.b0.performDecoding(oe,J).then(Be=>{me(null,Be)},Be=>{me(Be)})}}let st=r.dT.prototype.toGeoJSON,Nt=class{constructor(We){this._feature=We,this.extent=r.Y,this.type=We.type,this.properties=We.tags,"id"in We&&!isNaN(We.id)&&(this.id=parseInt(We.id,10))}loadGeometry(){if(this._feature.type===1){let We=[];for(let J of this._feature.geometry)We.push([new r.P(J[0],J[1])]);return We}{let We=[];for(let J of this._feature.geometry){let oe=[];for(let me of J)oe.push(new r.P(me[0],me[1]));We.push(oe)}return We}}toGeoJSON(We,J,oe){return st.call(this,We,J,oe)}},gn=class{constructor(We){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.Y,this.length=We.length,this._features=We}feature(We){return new Nt(this._features[We])}};var Xt={exports:{}},Ni=r.dV,Xn=r.dU.VectorTileFeature,Gt=vi;function vi(We,J){this.options=J||{},this.features=We,this.length=We.length}function $i(We,J){this.id=typeof We.id=="number"?We.id:void 0,this.type=We.type,this.rawGeometry=We.type===1?[We.geometry]:We.geometry,this.properties=We.tags,this.extent=J||4096}vi.prototype.feature=function(We){return new $i(this.features[We],this.options.extent)},$i.prototype.loadGeometry=function(){var We=this.rawGeometry;this.geometry=[];for(var J=0;J<We.length;J++){for(var oe=We[J],me=[],Be=0;Be<oe.length;Be++)me.push(new Ni(oe[Be][0],oe[Be][1]));this.geometry.push(me)}return this.geometry},$i.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var We=this.geometry,J=1/0,oe=-1/0,me=1/0,Be=-1/0,Ue=0;Ue<We.length;Ue++)for(var Ye=We[Ue],vt=0;vt<Ye.length;vt++){var Ne=Ye[vt];J=Math.min(J,Ne.x),oe=Math.max(oe,Ne.x),me=Math.min(me,Ne.y),Be=Math.max(Be,Ne.y)}return[J,me,oe,Be]},$i.prototype.toGeoJSON=Xn.prototype.toGeoJSON;var oo=r.dW,Js=Gt;function Pi(We){var J=new oo;return function(oe,me){for(var Be in oe.layers)me.writeMessage(3,Wn,oe.layers[Be])}(We,J),J.finish()}function Wn(We,J){var oe;J.writeVarintField(15,We.version||1),J.writeStringField(1,We.name||""),J.writeVarintField(5,We.extent||4096);var me={keys:[],values:[],keycache:{},valuecache:{}};for(oe=0;oe<We.length;oe++)me.feature=We.feature(oe),J.writeMessage(2,Ts,me);var Be=me.keys;for(oe=0;oe<Be.length;oe++)J.writeStringField(3,Be[oe]);var Ue=me.values;for(oe=0;oe<Ue.length;oe++)J.writeMessage(4,Mt,Ue[oe])}function Ts(We,J){var oe=We.feature;oe.id!==void 0&&J.writeVarintField(1,oe.id),J.writeMessage(2,Ar,We),J.writeVarintField(3,oe.type),J.writeMessage(4,Kt,oe)}function Ar(We,J){var oe=We.feature,me=We.keys,Be=We.values,Ue=We.keycache,Ye=We.valuecache;for(var vt in oe.properties){var Ne=oe.properties[vt],ft=Ue[vt];if(Ne!==null){ft===void 0&&(me.push(vt),Ue[vt]=ft=me.length-1),J.writeVarint(ft);var _t=typeof Ne;_t!=="string"&&_t!=="boolean"&&_t!=="number"&&(Ne=JSON.stringify(Ne));var Et=_t+":"+Ne,at=Ye[Et];at===void 0&&(Be.push(Ne),Ye[Et]=at=Be.length-1),J.writeVarint(at)}}}function St(We,J){return(J<<3)+(7&We)}function Ht(We){return We<<1^We>>31}function Kt(We,J){for(var oe=We.loadGeometry(),me=We.type,Be=0,Ue=0,Ye=oe.length,vt=0;vt<Ye;vt++){var Ne=oe[vt],ft=1;me===1&&(ft=Ne.length),J.writeVarint(St(1,ft));for(var _t=me===3?Ne.length-1:Ne.length,Et=0;Et<_t;Et++){Et===1&&me!==1&&J.writeVarint(St(2,_t-1));var at=Ne[Et].x-Be,Kn=Ne[Et].y-Ue;J.writeVarint(Ht(at)),J.writeVarint(Ht(Kn)),Be+=at,Ue+=Kn}me===3&&J.writeVarint(St(7,1))}}function Mt(We,J){var oe=typeof We;oe==="string"?J.writeStringField(1,We):oe==="boolean"?J.writeBooleanField(7,We):oe==="number"&&(We%1!=0?J.writeDoubleField(3,We):We<0?J.writeSVarintField(6,We):J.writeVarintField(5,We))}Xt.exports=Pi,Xt.exports.fromVectorTileJs=Pi,Xt.exports.fromGeojsonVt=function(We,J){J=J||{};var oe={};for(var me in We)oe[me]=new Js(We[me].features,J),oe[me].name=me,oe[me].version=J.version,oe[me].extent=J.extent;return Pi({layers:oe})},Xt.exports.GeoJSONWrapper=Js;var Ri=r.dX(Xt.exports);let wi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:We=>We},sr=Math.fround||(Pr=new Float32Array(1),We=>(Pr[0]=+We,Pr[0]));var Pr;let Zn=3,At=5,Ds=6;class mn{constructor(J){this.options=Object.assign(Object.create(wi),J),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(J){let{log:oe,minZoom:me,maxZoom:Be}=this.options;oe&&console.time("total time");let Ue=`prepare ${J.length} points`;oe&&console.time(Ue),this.points=J;let Ye=[];for(let Ne=0;Ne<J.length;Ne++){let ft=J[Ne];if(!ft.geometry)continue;let[_t,Et]=ft.geometry.coordinates,at=sr(ao(_t)),Kn=sr(xo(Et));Ye.push(at,Kn,1/0,Ne,-1,1),this.options.reduce&&Ye.push(0)}let vt=this.trees[Be+1]=this._createTree(Ye);oe&&console.timeEnd(Ue);for(let Ne=Be;Ne>=me;Ne--){let ft=+Date.now();vt=this.trees[Ne]=this._createTree(this._cluster(vt,Ne)),oe&&console.log("z%d: %d clusters in %dms",Ne,vt.numItems,+Date.now()-ft)}return oe&&console.timeEnd("total time"),this}getClusters(J,oe){let me=((J[0]+180)%360+360)%360-180,Be=Math.max(-90,Math.min(90,J[1])),Ue=J[2]===180?180:((J[2]+180)%360+360)%360-180,Ye=Math.max(-90,Math.min(90,J[3]));if(J[2]-J[0]>=360)me=-180,Ue=180;else if(me>Ue){let Et=this.getClusters([me,Be,180,Ye],oe),at=this.getClusters([-180,Be,Ue,Ye],oe);return Et.concat(at)}let vt=this.trees[this._limitZoom(oe)],Ne=vt.range(ao(me),xo(Ye),ao(Ue),xo(Be)),ft=vt.data,_t=[];for(let Et of Ne){let at=this.stride*Et;_t.push(ft[at+At]>1?so(ft,at,this.clusterProps):this.points[ft[at+Zn]])}return _t}getChildren(J){let oe=this._getOriginId(J),me=this._getOriginZoom(J),Be="No cluster with the specified id.",Ue=this.trees[me];if(!Ue)throw new Error(Be);let Ye=Ue.data;if(oe*this.stride>=Ye.length)throw new Error(Be);let vt=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Ne=Ue.within(Ye[oe*this.stride],Ye[oe*this.stride+1],vt),ft=[];for(let _t of Ne){let Et=_t*this.stride;Ye[Et+4]===J&&ft.push(Ye[Et+At]>1?so(Ye,Et,this.clusterProps):this.points[Ye[Et+Zn]])}if(ft.length===0)throw new Error(Be);return ft}getLeaves(J,oe,me){let Be=[];return this._appendLeaves(Be,J,oe=oe||10,me=me||0,0),Be}getTile(J,oe,me){let Be=this.trees[this._limitZoom(J)],Ue=Math.pow(2,J),{extent:Ye,radius:vt}=this.options,Ne=vt/Ye,ft=(me-Ne)/Ue,_t=(me+1+Ne)/Ue,Et={features:[]};return this._addTileFeatures(Be.range((oe-Ne)/Ue,ft,(oe+1+Ne)/Ue,_t),Be.data,oe,me,Ue,Et),oe===0&&this._addTileFeatures(Be.range(1-Ne/Ue,ft,1,_t),Be.data,Ue,me,Ue,Et),oe===Ue-1&&this._addTileFeatures(Be.range(0,ft,Ne/Ue,_t),Be.data,-1,me,Ue,Et),Et.features.length?Et:null}getClusterExpansionZoom(J){let oe=this._getOriginZoom(J)-1;for(;oe<=this.options.maxZoom;){let me=this.getChildren(J);if(oe++,me.length!==1)break;J=me[0].properties.cluster_id}return oe}_appendLeaves(J,oe,me,Be,Ue){let Ye=this.getChildren(oe);for(let vt of Ye){let Ne=vt.properties;if(Ne&&Ne.cluster?Ue+Ne.point_count<=Be?Ue+=Ne.point_count:Ue=this._appendLeaves(J,Ne.cluster_id,me,Be,Ue):Ue<Be?Ue++:J.push(vt),J.length===me)break}return Ue}_createTree(J){let oe=new r.bj(J.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<J.length;me+=this.stride)oe.add(J[me],J[me+1]);return oe.finish(),oe.data=J,oe}_addTileFeatures(J,oe,me,Be,Ue,Ye){for(let vt of J){let Ne=vt*this.stride,ft=oe[Ne+At]>1,_t,Et,at;if(ft)_t=fr(oe,Ne,this.clusterProps),Et=oe[Ne],at=oe[Ne+1];else{let Qn=this.points[oe[Ne+Zn]];_t=Qn.properties;let[kn,On]=Qn.geometry.coordinates;Et=ao(kn),at=xo(On)}let Kn={type:1,geometry:[[Math.round(this.options.extent*(Et*Ue-me)),Math.round(this.options.extent*(at*Ue-Be))]],tags:_t},Rn;Rn=ft||this.options.generateId?oe[Ne+Zn]:this.points[oe[Ne+Zn]].id,Rn!==void 0&&(Kn.id=Rn),Ye.features.push(Kn)}}_limitZoom(J){return Math.max(this.options.minZoom,Math.min(Math.floor(+J),this.options.maxZoom+1))}_cluster(J,oe){let{radius:me,extent:Be,reduce:Ue,minPoints:Ye}=this.options,vt=me/(Be*Math.pow(2,oe)),Ne=J.data,ft=[],_t=this.stride;for(let Et=0;Et<Ne.length;Et+=_t){if(Ne[Et+2]<=oe)continue;Ne[Et+2]=oe;let at=Ne[Et],Kn=Ne[Et+1],Rn=J.within(Ne[Et],Ne[Et+1],vt),Qn=Ne[Et+At],kn=Qn;for(let On of Rn){let Jn=On*_t;Ne[Jn+2]>oe&&(kn+=Ne[Jn+At])}if(kn>Qn&&kn>=Ye){let On,Jn=at*Qn,bi=Kn*Qn,pr=-1,pi=(Et/_t<<5)+(oe+1)+this.points.length;for(let Br of Rn){let Rr=Br*_t;if(Ne[Rr+2]<=oe)continue;Ne[Rr+2]=oe;let No=Ne[Rr+At];Jn+=Ne[Rr]*No,bi+=Ne[Rr+1]*No,Ne[Rr+4]=pi,Ue&&(On||(On=this._map(Ne,Et,!0),pr=this.clusterProps.length,this.clusterProps.push(On)),Ue(On,this._map(Ne,Rr)))}Ne[Et+4]=pi,ft.push(Jn/kn,bi/kn,1/0,pi,-1,kn),Ue&&ft.push(pr)}else{for(let On=0;On<_t;On++)ft.push(Ne[Et+On]);if(kn>1)for(let On of Rn){let Jn=On*_t;if(!(Ne[Jn+2]<=oe)){Ne[Jn+2]=oe;for(let bi=0;bi<_t;bi++)ft.push(Ne[Jn+bi])}}}}return ft}_getOriginId(J){return J-this.points.length>>5}_getOriginZoom(J){return(J-this.points.length)%32}_map(J,oe,me){if(J[oe+At]>1){let Ye=this.clusterProps[J[oe+Ds]];return me?Object.assign({},Ye):Ye}let Be=this.points[J[oe+Zn]].properties,Ue=this.options.map(Be);return me&&Ue===Be?Object.assign({},Ue):Ue}}function so(We,J,oe){return{type:"Feature",id:We[J+Zn],properties:fr(We,J,oe),geometry:{type:"Point",coordinates:[(me=We[J],360*(me-.5)),Ec(We[J+1])]}};var me}function fr(We,J,oe){let me=We[J+At],Be=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Ue=We[J+Ds],Ye=Ue===-1?{}:Object.assign({},oe[Ue]);return Object.assign(Ye,{cluster:!0,cluster_id:We[J+Zn],point_count:me,point_count_abbreviated:Be})}function ao(We){return We/360+.5}function xo(We){let J=Math.sin(We*Math.PI/180),oe=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return oe<0?0:oe>1?1:oe}function Ec(We){let J=(180-360*We)*Math.PI/180;return 360*Math.atan(Math.exp(J))/Math.PI-90}var fl={exports:{}};fl.exports=function(){function We(Oe,Fe,$e,Ke){for(var Xe,it=Ke,rt=$e-Fe>>1,Je=$e-Fe,lt=Oe[Fe],et=Oe[Fe+1],Ut=Oe[$e],_n=Oe[$e+1],xt=Fe+3;xt<$e;xt+=3){var ei=J(Oe[xt],Oe[xt+1],lt,et,Ut,_n);if(ei>it)Xe=xt,it=ei;else if(ei===it){var Ti=Math.abs(xt-rt);Ti<Je&&(Xe=xt,Je=Ti)}}it>Ke&&(Xe-Fe>3&&We(Oe,Fe,Xe,Ke),Oe[Xe+2]=it,$e-Xe>3&&We(Oe,Xe,$e,Ke))}function J(Oe,Fe,$e,Ke,Xe,it){var rt=Xe-$e,Je=it-Ke;if(rt!==0||Je!==0){var lt=((Oe-$e)*rt+(Fe-Ke)*Je)/(rt*rt+Je*Je);lt>1?($e=Xe,Ke=it):lt>0&&($e+=rt*lt,Ke+=Je*lt)}return(rt=Oe-$e)*rt+(Je=Fe-Ke)*Je}function oe(Oe,Fe,$e,Ke){var Xe={id:Oe===void 0?null:Oe,type:Fe,geometry:$e,tags:Ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var rt=it.geometry,Je=it.type;if(Je==="Point"||Je==="MultiPoint"||Je==="LineString")me(it,rt);else if(Je==="Polygon"||Je==="MultiLineString")for(var lt=0;lt<rt.length;lt++)me(it,rt[lt]);else if(Je==="MultiPolygon")for(lt=0;lt<rt.length;lt++)for(var et=0;et<rt[lt].length;et++)me(it,rt[lt][et])}(Xe),Xe}function me(Oe,Fe){for(var $e=0;$e<Fe.length;$e+=3)Oe.minX=Math.min(Oe.minX,Fe[$e]),Oe.minY=Math.min(Oe.minY,Fe[$e+1]),Oe.maxX=Math.max(Oe.maxX,Fe[$e]),Oe.maxY=Math.max(Oe.maxY,Fe[$e+1])}function Be(Oe,Fe,$e,Ke){if(Fe.geometry){var Xe=Fe.geometry.coordinates,it=Fe.geometry.type,rt=Math.pow($e.tolerance/((1<<$e.maxZoom)*$e.extent),2),Je=[],lt=Fe.id;if($e.promoteId?lt=Fe.properties[$e.promoteId]:$e.generateId&&(lt=Ke||0),it==="Point")Ue(Xe,Je);else if(it==="MultiPoint")for(var et=0;et<Xe.length;et++)Ue(Xe[et],Je);else if(it==="LineString")Ye(Xe,Je,rt,!1);else if(it==="MultiLineString"){if($e.lineMetrics){for(et=0;et<Xe.length;et++)Ye(Xe[et],Je=[],rt,!1),Oe.push(oe(lt,"LineString",Je,Fe.properties));return}vt(Xe,Je,rt,!1)}else if(it==="Polygon")vt(Xe,Je,rt,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(et=0;et<Fe.geometry.geometries.length;et++)Be(Oe,{id:lt,geometry:Fe.geometry.geometries[et],properties:Fe.properties},$e,Ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(et=0;et<Xe.length;et++){var Ut=[];vt(Xe[et],Ut,rt,!0),Je.push(Ut)}}Oe.push(oe(lt,it,Je,Fe.properties))}}function Ue(Oe,Fe){Fe.push(Ne(Oe[0])),Fe.push(ft(Oe[1])),Fe.push(0)}function Ye(Oe,Fe,$e,Ke){for(var Xe,it,rt=0,Je=0;Je<Oe.length;Je++){var lt=Ne(Oe[Je][0]),et=ft(Oe[Je][1]);Fe.push(lt),Fe.push(et),Fe.push(0),Je>0&&(rt+=Ke?(Xe*et-lt*it)/2:Math.sqrt(Math.pow(lt-Xe,2)+Math.pow(et-it,2))),Xe=lt,it=et}var Ut=Fe.length-3;Fe[2]=1,We(Fe,0,Ut,$e),Fe[Ut+2]=1,Fe.size=Math.abs(rt),Fe.start=0,Fe.end=Fe.size}function vt(Oe,Fe,$e,Ke){for(var Xe=0;Xe<Oe.length;Xe++){var it=[];Ye(Oe[Xe],it,$e,Ke),Fe.push(it)}}function Ne(Oe){return Oe/360+.5}function ft(Oe){var Fe=Math.sin(Oe*Math.PI/180),$e=.5-.25*Math.log((1+Fe)/(1-Fe))/Math.PI;return $e<0?0:$e>1?1:$e}function _t(Oe,Fe,$e,Ke,Xe,it,rt,Je){if(Ke/=Fe,it>=($e/=Fe)&&rt<Ke)return Oe;if(rt<$e||it>=Ke)return null;for(var lt=[],et=0;et<Oe.length;et++){var Ut=Oe[et],_n=Ut.geometry,xt=Ut.type,ei=Xe===0?Ut.minX:Ut.minY,Ti=Xe===0?Ut.maxX:Ut.maxY;if(ei>=$e&&Ti<Ke)lt.push(Ut);else if(!(Ti<$e||ei>=Ke)){var Di=[];if(xt==="Point"||xt==="MultiPoint")Et(_n,Di,$e,Ke,Xe);else if(xt==="LineString")at(_n,Di,$e,Ke,Xe,!1,Je.lineMetrics);else if(xt==="MultiLineString")Rn(_n,Di,$e,Ke,Xe,!1);else if(xt==="Polygon")Rn(_n,Di,$e,Ke,Xe,!0);else if(xt==="MultiPolygon")for(var zi=0;zi<_n.length;zi++){var Si=[];Rn(_n[zi],Si,$e,Ke,Xe,!0),Si.length&&Di.push(Si)}if(Di.length){if(Je.lineMetrics&&xt==="LineString"){for(zi=0;zi<Di.length;zi++)lt.push(oe(Ut.id,xt,Di[zi],Ut.tags));continue}xt!=="LineString"&&xt!=="MultiLineString"||(Di.length===1?(xt="LineString",Di=Di[0]):xt="MultiLineString"),xt!=="Point"&&xt!=="MultiPoint"||(xt=Di.length===3?"Point":"MultiPoint"),lt.push(oe(Ut.id,xt,Di,Ut.tags))}}}return lt.length?lt:null}function Et(Oe,Fe,$e,Ke,Xe){for(var it=0;it<Oe.length;it+=3){var rt=Oe[it+Xe];rt>=$e&&rt<=Ke&&(Fe.push(Oe[it]),Fe.push(Oe[it+1]),Fe.push(Oe[it+2]))}}function at(Oe,Fe,$e,Ke,Xe,it,rt){for(var Je,lt,et=Kn(Oe),Ut=Xe===0?kn:On,_n=Oe.start,xt=0;xt<Oe.length-3;xt+=3){var ei=Oe[xt],Ti=Oe[xt+1],Di=Oe[xt+2],zi=Oe[xt+3],Si=Oe[xt+4],wn=Xe===0?ei:Ti,lo=Xe===0?zi:Si,zo=!1;rt&&(Je=Math.sqrt(Math.pow(ei-zi,2)+Math.pow(Ti-Si,2))),wn<$e?lo>$e&&(lt=Ut(et,ei,Ti,zi,Si,$e),rt&&(et.start=_n+Je*lt)):wn>Ke?lo<Ke&&(lt=Ut(et,ei,Ti,zi,Si,Ke),rt&&(et.start=_n+Je*lt)):Qn(et,ei,Ti,Di),lo<$e&&wn>=$e&&(lt=Ut(et,ei,Ti,zi,Si,$e),zo=!0),lo>Ke&&wn<=Ke&&(lt=Ut(et,ei,Ti,zi,Si,Ke),zo=!0),!it&&zo&&(rt&&(et.end=_n+Je*lt),Fe.push(et),et=Kn(Oe)),rt&&(_n+=Je)}var _r=Oe.length-3;ei=Oe[_r],Ti=Oe[_r+1],Di=Oe[_r+2],(wn=Xe===0?ei:Ti)>=$e&&wn<=Ke&&Qn(et,ei,Ti,Di),_r=et.length-3,it&&_r>=3&&(et[_r]!==et[0]||et[_r+1]!==et[1])&&Qn(et,et[0],et[1],et[2]),et.length&&Fe.push(et)}function Kn(Oe){var Fe=[];return Fe.size=Oe.size,Fe.start=Oe.start,Fe.end=Oe.end,Fe}function Rn(Oe,Fe,$e,Ke,Xe,it){for(var rt=0;rt<Oe.length;rt++)at(Oe[rt],Fe,$e,Ke,Xe,it,!1)}function Qn(Oe,Fe,$e,Ke){Oe.push(Fe),Oe.push($e),Oe.push(Ke)}function kn(Oe,Fe,$e,Ke,Xe,it){var rt=(it-Fe)/(Ke-Fe);return Oe.push(it),Oe.push($e+(Xe-$e)*rt),Oe.push(1),rt}function On(Oe,Fe,$e,Ke,Xe,it){var rt=(it-$e)/(Xe-$e);return Oe.push(Fe+(Ke-Fe)*rt),Oe.push(it),Oe.push(1),rt}function Jn(Oe,Fe){for(var $e=[],Ke=0;Ke<Oe.length;Ke++){var Xe,it=Oe[Ke],rt=it.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Xe=bi(it.geometry,Fe);else if(rt==="MultiLineString"||rt==="Polygon"){Xe=[];for(var Je=0;Je<it.geometry.length;Je++)Xe.push(bi(it.geometry[Je],Fe))}else if(rt==="MultiPolygon")for(Xe=[],Je=0;Je<it.geometry.length;Je++){for(var lt=[],et=0;et<it.geometry[Je].length;et++)lt.push(bi(it.geometry[Je][et],Fe));Xe.push(lt)}$e.push(oe(it.id,rt,Xe,it.tags))}return $e}function bi(Oe,Fe){var $e=[];$e.size=Oe.size,Oe.start!==void 0&&($e.start=Oe.start,$e.end=Oe.end);for(var Ke=0;Ke<Oe.length;Ke+=3)$e.push(Oe[Ke]+Fe,Oe[Ke+1],Oe[Ke+2]);return $e}function pr(Oe,Fe){if(Oe.transformed)return Oe;var $e,Ke,Xe,it=1<<Oe.z,rt=Oe.x,Je=Oe.y;for($e=0;$e<Oe.features.length;$e++){var lt=Oe.features[$e],et=lt.geometry,Ut=lt.type;if(lt.geometry=[],Ut===1)for(Ke=0;Ke<et.length;Ke+=2)lt.geometry.push(pi(et[Ke],et[Ke+1],Fe,it,rt,Je));else for(Ke=0;Ke<et.length;Ke++){var _n=[];for(Xe=0;Xe<et[Ke].length;Xe+=2)_n.push(pi(et[Ke][Xe],et[Ke][Xe+1],Fe,it,rt,Je));lt.geometry.push(_n)}}return Oe.transformed=!0,Oe}function pi(Oe,Fe,$e,Ke,Xe,it){return[Math.round($e*(Oe*Ke-Xe)),Math.round($e*(Fe*Ke-it))]}function Br(Oe,Fe,$e,Ke,Xe){for(var it=Fe===Xe.maxZoom?0:Xe.tolerance/((1<<Fe)*Xe.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$e,y:Ke,z:Fe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Je=0;Je<Oe.length;Je++){rt.numFeatures++,Rr(rt,Oe[Je],it,Xe);var lt=Oe[Je].minX,et=Oe[Je].minY,Ut=Oe[Je].maxX,_n=Oe[Je].maxY;lt<rt.minX&&(rt.minX=lt),et<rt.minY&&(rt.minY=et),Ut>rt.maxX&&(rt.maxX=Ut),_n>rt.maxY&&(rt.maxY=_n)}return rt}function Rr(Oe,Fe,$e,Ke){var Xe=Fe.geometry,it=Fe.type,rt=[];if(it==="Point"||it==="MultiPoint")for(var Je=0;Je<Xe.length;Je+=3)rt.push(Xe[Je]),rt.push(Xe[Je+1]),Oe.numPoints++,Oe.numSimplified++;else if(it==="LineString")No(rt,Xe,Oe,$e,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(Je=0;Je<Xe.length;Je++)No(rt,Xe[Je],Oe,$e,it==="Polygon",Je===0);else if(it==="MultiPolygon")for(var lt=0;lt<Xe.length;lt++){var et=Xe[lt];for(Je=0;Je<et.length;Je++)No(rt,et[Je],Oe,$e,!0,Je===0)}if(rt.length){var Ut=Fe.tags||null;if(it==="LineString"&&Ke.lineMetrics){for(var _n in Ut={},Fe.tags)Ut[_n]=Fe.tags[_n];Ut.mapbox_clip_start=Xe.start/Xe.size,Ut.mapbox_clip_end=Xe.end/Xe.size}var xt={geometry:rt,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:Ut};Fe.id!==null&&(xt.id=Fe.id),Oe.features.push(xt)}}function No(Oe,Fe,$e,Ke,Xe,it){var rt=Ke*Ke;if(Ke>0&&Fe.size<(Xe?rt:Ke))$e.numPoints+=Fe.length/3;else{for(var Je=[],lt=0;lt<Fe.length;lt+=3)(Ke===0||Fe[lt+2]>rt)&&($e.numSimplified++,Je.push(Fe[lt]),Je.push(Fe[lt+1])),$e.numPoints++;Xe&&function(et,Ut){for(var _n=0,xt=0,ei=et.length,Ti=ei-2;xt<ei;Ti=xt,xt+=2)_n+=(et[xt]-et[Ti])*(et[xt+1]+et[Ti+1]);if(_n>0===Ut)for(xt=0,ei=et.length;xt<ei/2;xt+=2){var Di=et[xt],zi=et[xt+1];et[xt]=et[ei-2-xt],et[xt+1]=et[ei-1-xt],et[ei-2-xt]=Di,et[ei-1-xt]=zi}}(Je,it),Oe.push(Je)}}function Zi(Oe,Fe){var $e=(Fe=this.options=function(Xe,it){for(var rt in it)Xe[rt]=it[rt];return Xe}(Object.create(this.options),Fe)).debug;if($e&&console.time("preprocess data"),Fe.maxZoom<0||Fe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Fe.promoteId&&Fe.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ke=function(Xe,it){var rt=[];if(Xe.type==="FeatureCollection")for(var Je=0;Je<Xe.features.length;Je++)Be(rt,Xe.features[Je],it,Je);else Be(rt,Xe.type==="Feature"?Xe:{geometry:Xe},it);return rt}(Oe,Fe);this.tiles={},this.tileCoords=[],$e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Fe.indexMaxZoom,Fe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ke=function(Xe,it){var rt=it.buffer/it.extent,Je=Xe,lt=_t(Xe,1,-1-rt,rt,0,-1,2,it),et=_t(Xe,1,1-rt,2+rt,0,-1,2,it);return(lt||et)&&(Je=_t(Xe,1,-rt,1+rt,0,-1,2,it)||[],lt&&(Je=Jn(lt,1).concat(Je)),et&&(Je=Je.concat(Jn(et,-1)))),Je}(Ke,Fe)).length&&this.splitTile(Ke,0,0,0),$e&&(Ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ei(Oe,Fe,$e){return 32*((1<<Oe)*$e+Fe)+Oe}return Zi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Zi.prototype.splitTile=function(Oe,Fe,$e,Ke,Xe,it,rt){for(var Je=[Oe,Fe,$e,Ke],lt=this.options,et=lt.debug;Je.length;){Ke=Je.pop(),$e=Je.pop(),Fe=Je.pop(),Oe=Je.pop();var Ut=1<<Fe,_n=Ei(Fe,$e,Ke),xt=this.tiles[_n];if(!xt&&(et>1&&console.time("creation"),xt=this.tiles[_n]=Br(Oe,Fe,$e,Ke,lt),this.tileCoords.push({z:Fe,x:$e,y:Ke}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Fe,$e,Ke,xt.numFeatures,xt.numPoints,xt.numSimplified),console.timeEnd("creation"));var ei="z"+Fe;this.stats[ei]=(this.stats[ei]||0)+1,this.total++}if(xt.source=Oe,Xe){if(Fe===lt.maxZoom||Fe===Xe)continue;var Ti=1<<Xe-Fe;if($e!==Math.floor(it/Ti)||Ke!==Math.floor(rt/Ti))continue}else if(Fe===lt.indexMaxZoom||xt.numPoints<=lt.indexMaxPoints)continue;if(xt.source=null,Oe.length!==0){et>1&&console.time("clipping");var Di,zi,Si,wn,lo,zo,_r=.5*lt.buffer/lt.extent,Ma=.5-_r,Dc=.5+_r,Vr=1+_r;Di=zi=Si=wn=null,lo=_t(Oe,Ut,$e-_r,$e+Dc,0,xt.minX,xt.maxX,lt),zo=_t(Oe,Ut,$e+Ma,$e+Vr,0,xt.minX,xt.maxX,lt),Oe=null,lo&&(Di=_t(lo,Ut,Ke-_r,Ke+Dc,1,xt.minY,xt.maxY,lt),zi=_t(lo,Ut,Ke+Ma,Ke+Vr,1,xt.minY,xt.maxY,lt),lo=null),zo&&(Si=_t(zo,Ut,Ke-_r,Ke+Dc,1,xt.minY,xt.maxY,lt),wn=_t(zo,Ut,Ke+Ma,Ke+Vr,1,xt.minY,xt.maxY,lt),zo=null),et>1&&console.timeEnd("clipping"),Je.push(Di||[],Fe+1,2*$e,2*Ke),Je.push(zi||[],Fe+1,2*$e,2*Ke+1),Je.push(Si||[],Fe+1,2*$e+1,2*Ke),Je.push(wn||[],Fe+1,2*$e+1,2*Ke+1)}}},Zi.prototype.getTile=function(Oe,Fe,$e){var Ke=this.options,Xe=Ke.extent,it=Ke.debug;if(Oe<0||Oe>24)return null;var rt=1<<Oe,Je=Ei(Oe,Fe=(Fe%rt+rt)%rt,$e);if(this.tiles[Je])return pr(this.tiles[Je],Xe);it>1&&console.log("drilling down to z%d-%d-%d",Oe,Fe,$e);for(var lt,et=Oe,Ut=Fe,_n=$e;!lt&&et>0;)et--,Ut=Math.floor(Ut/2),_n=Math.floor(_n/2),lt=this.tiles[Ei(et,Ut,_n)];return lt&&lt.source?(it>1&&console.log("found parent tile z%d-%d-%d",et,Ut,_n),it>1&&console.time("drilling down"),this.splitTile(lt.source,et,Ut,_n,Oe,Fe,$e),it>1&&console.timeEnd("drilling down"),this.tiles[Je]?pr(this.tiles[Je],Xe):null):null},function(Oe,Fe){return new Zi(Oe,Fe)}}();var Wi=r.dX(fl.exports);function hd(We,J){let oe=We.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);let me=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!me)return J(null,null);let Be=new gn(me.features),Ue=Ri(Be);Ue.byteOffset===0&&Ue.byteLength===Ue.buffer.byteLength||(Ue=new Uint8Array(Ue)),J(null,{vectorTile:Be,rawData:Ue.buffer})}class jt extends ke{constructor(J,oe,me,Be,Ue,Ye){super(J,oe,me,Be,hd,Ye),Ue&&(this.loadGeoJSON=Ue),this._featureMap=new Map}loadData(J,oe){let me=J&&J.request,Be=me&&me.collectResourceTiming;this.loadGeoJSON(J,(Ue,Ye)=>{if(Ue||!Ye)return oe(Ue);if(typeof Ye!="object")return oe(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));{try{if(J.filter){let Ne=r.t(J.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ne.result==="error")throw new Error(Ne.value.map(ft=>`${ft.key}: ${ft.message}`).join(", "));Ye.features=Ye.features.filter(ft=>Ne.value.evaluate({zoom:0},ft))}if(J.dynamic){Ye.type==="Feature"&&(Ye={type:"FeatureCollection",features:[Ye]}),J.append||this._featureMap.clear();for(let Ne of Ye.features||[]){let ft=Ne.id;ft!==void 0&&(Ne.geometry?this._featureMap.set(ft,Ne):this._featureMap.delete(ft))}Ye.features=[...this._featureMap.values()]}this._geoJSONIndex=J.cluster?new mn(function({superclusterOptions:Ne,clusterProperties:ft}){if(!ft||!Ne)return Ne;let _t={},Et={},at={accumulated:null,zoom:0},Kn={properties:null},Rn=Object.keys(ft);for(let Qn of Rn){let[kn,On]=ft[Qn],Jn=r.t(On),bi=r.t(typeof kn=="string"?[kn,["accumulated"],["get",Qn]]:kn);_t[Qn]=Jn.value,Et[Qn]=bi.value}return Ne.map=Qn=>{Kn.properties=Qn;let kn={};for(let On of Rn)kn[On]=_t[On].evaluate(at,Kn);return kn},Ne.reduce=(Qn,kn)=>{Kn.properties=kn;for(let On of Rn)at.accumulated=Qn[On],Qn[On]=Et[On].evaluate(at,Kn)},Ne}(J)).load(Ye.features):Wi(Ye,J.geojsonVtOptions)}catch(Ne){return oe(Ne)}this.loaded={};let vt={};if(Be){let Ne=T(me);Ne&&(vt.resourceTiming={},vt.resourceTiming[J.source]=JSON.parse(JSON.stringify(Ne)))}oe(null,vt)}})}reloadTile(J,oe){let me=this.loaded;return me&&me[J.uid]?super.reloadTile(J,oe):this.loadTile(J,oe)}loadGeoJSON(J,oe){if(J.request)r.g(J.request,oe);else{if(typeof J.data!="string")return oe(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`));try{return oe(null,JSON.parse(J.data))}catch{return oe(new Error(`Input data given to '${J.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(J,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(J.clusterId))}catch(me){oe(me)}}getClusterChildren(J,oe){try{oe(null,this._geoJSONIndex.getChildren(J.clusterId))}catch(me){oe(me)}}getClusterLeaves(J,oe){try{oe(null,this._geoJSONIndex.getLeaves(J.clusterId,J.limit,J.offset))}catch(me){oe(me)}}}class zt{constructor(J,oe){this.tileID=new r.ap(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),this.tileZoom=J.tileZoom,this.uid=J.uid,this.zoom=J.zoom,this.canonical=J.tileID.canonical,this.pixelRatio=J.pixelRatio,this.tileSize=J.tileSize,this.source=J.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=J.projection,this.brightness=oe}parse(J,oe,me,Be){this.status="parsing";let Ue=new r.ap(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Ye={},vt=oe.familiesBySource[me.source],Ne=new r.dL(Ue,me.promoteId);return Ne.bucketLayerIDs=[],Ne.is3DTile=!0,r.dY(J).then(ft=>{if(!ft)return Be(new Error("Could not parse tile"));let _t=r.dZ(ft,1/r.bU(me.tileID.canonical)),Et=ft.json.extensionsUsed&&ft.json.extensionsUsed.includes("MAPBOX_mesh_features")||ft.json.asset.extras&&ft.json.asset.extras.MAPBOX_mesh_features,at=ft.json.extensionsUsed&&ft.json.extensionsUsed.includes("EXT_meshopt_compression"),Kn=new r.N(this.zoom,{brightness:this.brightness});for(let Rn in vt)for(let Qn of vt[Rn]){let kn=Qn[0];Ne.bucketLayerIDs.push(Qn.map(Jn=>Jn.id)),kn.recalculate(Kn,[]);let On=new r.d_(_t,Ue,Et,at,this.brightness,Ne);Et||(On.needsUpload=!0),Ye[kn.fqid]=On,On.evaluate(kn)}this.status="done",Be(null,{buckets:Ye,featureIndex:Ne})}).catch(ft=>Be(new Error(ft.message)))}}class Tc{constructor(J,oe,me,Be,Ue,Ye){this.actor=J,this.layerIndex=oe,this.brightness=Ye,this.loading={},this.loaded={}}loadTile(J,oe){let me=J.uid,Be=this.loading[me]=new zt(J,this.brightness);r.b1(J.request,(Ue,Ye)=>{let vt=!this.loading[me];return delete this.loading[me],vt||Ue?(Be.status="done",vt||(this.loaded[me]=Be),oe(Ue)):Ye&&Ye.byteLength!==0?void Be.parse(Ye,this.layerIndex,J,(Ne,ft)=>{Be.status="done",this.loaded=this.loaded||{},this.loaded[me]=Be,Ne||!ft?oe(Ne):oe(null,ft)}):(Be.status="done",this.loaded[me]=Be,oe())})}reloadTile(J,oe){let me=this.loaded,Be=J.uid;if(me&&me[Be]){let Ue=me[Be];Ue.projection=J.projection,Ue.brightness=J.brightness;let Ye=(vt,Ne)=>{Ue.reloadCallback&&(delete Ue.reloadCallback,this.loadTile(J,oe)),oe(vt,Ne)};Ue.status==="parsing"?Ue.reloadCallback=Ye:Ue.status==="done"&&this.loadTile(J,oe)}}abortTile(J,oe){let me=J.uid;this.loading[me]&&delete this.loading[me],oe()}removeTile(J,oe){let me=this.loaded,Be=J.uid;me&&me[Be]&&delete me[Be],oe()}}class wo{constructor(J){this.self=J,this.actor=new r.d$(J,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.br({name:"mercator"}),this.workerSourceTypes={vector:ke,geojson:jt,"batched-model":Tc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(oe,me)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=me},this.self.registerRTLTextPlugin=oe=>{if(r.e0.isParsed())throw new Error("RTL text plugin already registered.");r.e0.applyArabicShaping=oe.applyArabicShaping,r.e0.processBidirectionalText=oe.processBidirectionalText,r.e0.processStyledBidirectionalText=oe.processStyledBidirectionalText}}clearCaches(J,oe,me){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],delete this.rasterArrayWorkerSource,me()}checkIfReady(J,oe,me){me()}setReferrer(J,oe){this.referrer=oe}spriteLoaded(J,{scope:oe,isLoaded:me}){if(this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),this.isSpriteLoaded[J][oe]=me,this.workerSources[J]&&this.workerSources[J][oe])for(let Be in this.workerSources[J][oe]){let Ue=this.workerSources[J][oe][Be];for(let Ye in Ue)Ue[Ye]instanceof ke&&(Ue[Ye].isSpriteLoaded=me,Ue[Ye].fire(new r.b("isSpriteLoaded")))}}setImages(J,{scope:oe,images:me},Be){if(this.availableImages[J]||(this.availableImages[J]={}),this.availableImages[J][oe]=me,this.workerSources[J]&&this.workerSources[J][oe]){for(let Ue in this.workerSources[J][oe]){let Ye=this.workerSources[J][oe][Ue];for(let vt in Ye)Ye[vt].availableImages=me}Be()}else Be()}setProjection(J,oe){this.projections[J]=r.br(oe)}setBrightness(J,oe,me){this.brightness=oe,me()}setLayers(J,oe,me){this.getLayerIndex(J,oe.scope).replace(oe.layers,oe.options),me()}updateLayers(J,oe,me){this.getLayerIndex(J,oe.scope).update(oe.layers,oe.removedIds,oe.options),me()}loadTile(J,oe,me){oe.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,oe.type,oe.source,oe.scope).loadTile(oe,me)}loadDEMTile(J,oe,me){this.getDEMWorkerSource(J,oe.source,oe.scope).loadTile(oe,me)}decodeRasterArray(J,oe,me){this.getRasterArrayWorkerSource().decodeRasterArray(oe,me)}reloadTile(J,oe,me){oe.projection=this.projections[J]||this.defaultProjection,this.getWorkerSource(J,oe.type,oe.source,oe.scope).reloadTile(oe,me)}abortTile(J,oe,me){this.getWorkerSource(J,oe.type,oe.source,oe.scope).abortTile(oe,me)}removeTile(J,oe,me){this.getWorkerSource(J,oe.type,oe.source,oe.scope).removeTile(oe,me)}removeSource(J,oe,me){if(!(this.workerSources[J]&&this.workerSources[J][oe.scope]&&this.workerSources[J][oe.scope][oe.type]&&this.workerSources[J][oe.scope][oe.type][oe.source]))return;let Be=this.workerSources[J][oe.scope][oe.type][oe.source];delete this.workerSources[J][oe.scope][oe.type][oe.source],Be.removeSource!==void 0?Be.removeSource(oe,me):me()}loadWorkerSource(J,oe,me){try{this.self.importScripts(oe.url),me()}catch(Be){me(Be.toString())}}syncRTLPluginState(J,oe,me){try{r.e0.setState(oe);let Be=r.e0.getPluginURL();if(r.e0.isLoaded()&&!r.e0.isParsed()&&Be!=null){this.self.importScripts(Be);let Ue=r.e0.isParsed();me(Ue?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Be}`),Ue)}}catch(Be){me(Be.toString())}}setDracoUrl(J,oe){this.dracoUrl=oe}getAvailableImages(J,oe){this.availableImages[J]||(this.availableImages[J]={});let me=this.availableImages[J][oe];return me||(me=[]),me}getLayerIndex(J,oe){this.layerIndexes[J]||(this.layerIndexes[J]={});let me=this.layerIndexes[J][oe];return me||(me=this.layerIndexes[J][oe]=new $,me.scope=oe),me}getWorkerSource(J,oe,me,Be){if(this.workerSources[J]||(this.workerSources[J]={}),this.workerSources[J][Be]||(this.workerSources[J][Be]={}),this.workerSources[J][Be][oe]||(this.workerSources[J][Be][oe]={}),this.isSpriteLoaded[J]||(this.isSpriteLoaded[J]={}),!this.workerSources[J][Be][oe][me]){let Ue={send:(Ye,vt,Ne,ft,_t,Et)=>{this.actor.send(Ye,vt,Ne,J,_t,Et)},scheduler:this.actor.scheduler};this.workerSources[J][Be][oe][me]=new this.workerSourceTypes[oe](Ue,this.getLayerIndex(J,Be),this.getAvailableImages(J,Be),this.isSpriteLoaded[J][Be],void 0,this.brightness)}return this.workerSources[J][Be][oe][me]}getDEMWorkerSource(J,oe,me){return this.demWorkerSources[J]||(this.demWorkerSources[J]={}),this.demWorkerSources[J][me]||(this.demWorkerSources[J][me]={}),this.demWorkerSources[J][me][oe]||(this.demWorkerSources[J][me][oe]=new Qe),this.demWorkerSources[J][me][oe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new dt),this.rasterArrayWorkerSource}enforceCacheSizeLimit(J,oe){r.e1(oe)}getWorkerPerformanceMetrics(J,oe,me){me(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new wo(self)),wo}),c(["./shared"],function(r){"use strict";function T(f,o){if(Array.isArray(f)){if(!Array.isArray(o)||f.length!==o.length)return!1;for(let l=0;l<f.length;l++)if(!T(f[l],o[l]))return!1;return!0}if(typeof f=="object"&&f!==null&&o!==null){if(typeof o!="object"||Object.keys(f).length!==Object.keys(o).length)return!1;for(let l in f)if(!T(f[l],o[l]))return!1;return!0}return f===o}var M=F;function F(f){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,v=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(v);try{_=new Worker(x),p=!0}catch{p=!1}return _&&_.terminate(),URL.revokeObjectURL(x),p}()?function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var v=_.getImageData(0,0,1,1);return v&&v.width===p.width}()?($[l=o&&o.failIfMajorPerformanceCaveat]===void 0&&($[l]=function(p){var _,v=function(x){var E=document.createElement("canvas"),C=Object.create(F.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=x,E.getContext("webgl2",C)}(p);if(!v)return!1;try{_=v.createShader(v.VERTEX_SHADER)}catch{return!1}return!(!_||v.isContextLost())&&(v.shaderSource(_,"void main() {}"),v.compileShader(_),v.getShaderParameter(_,v.COMPILE_STATUS)===!0)}(l)),$[l]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var l}(f)}var $={};function Q(f,o,l){let p=document.createElement(f);return o!=null&&(p.className=o),l&&l.appendChild(p),p}function ue(f,o,l){let p=document.createElementNS("http://www.w3.org/2000/svg",f);for(let _ of Object.keys(o))p.setAttributeNS(null,_,String(o[_]));return l&&l.appendChild(p),p}F.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Ae=typeof document<"u"?document.documentElement&&document.documentElement.style:null,xe=Ae&&Ae.userSelect!==void 0?"userSelect":"WebkitUserSelect",ke;function Qe(){Ae&&xe&&(ke=Ae[xe],Ae[xe]="none")}function dt(){Ae&&xe&&(Ae[xe]=ke)}function st(f){f.preventDefault(),f.stopPropagation(),window.removeEventListener("click",st,!0)}function Nt(){window.addEventListener("click",st,!0),window.setTimeout(()=>{window.removeEventListener("click",st,!0)},0)}function gn(f,o){let l=f.getBoundingClientRect();return Xn(f,l,o)}function Xt(f,o){let l=f.getBoundingClientRect(),p=[];for(let _=0;_<o.length;_++)p.push(Xn(f,l,o[_]));return p}function Ni(f){return window.InstallTrigger!==void 0&&f.button===2&&f.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button}function Xn(f,o,l){let p=f.offsetWidth===o.width?1:f.offsetWidth/o.width;return new r.P((l.clientX-o.left)*p,(l.clientY-o.top)*p)}class Gt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,l){this._updatedSourceCaches[o]=l,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let l=o.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(o.id),this.setDirty()}removeLayer(o){let l=o.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][o.id]=o,this._updatedLayers[l].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let l in this._updatedLayers)o[l]=o[l]||{},o[l].updatedIds=Array.from(this._updatedLayers[l].values());for(let l in this._removedLayers)o[l]=o[l]||{},o[l].removedIds=Object.keys(this._removedLayers[l]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(o),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class vi extends r.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.numModelsLoading={}}loadModel(o,l){return r.l(this.requestManager.transformRequest(l,r.R.Model).url).then(p=>{if(!p)return;let _=r.c(p),v=new r.M(o,void 0,void 0,_);return v.computeBoundsAndApplyParent(),v}).catch(p=>{if(p&&p.status===404)return null;this.fire(new r.a(new Error(`Could not load model ${o} from ${l}: ${p.message}`)))})}load(o,l){this.models[l]||(this.models[l]={});let p=Object.keys(o);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+p.length;let _=[];for(let v of p)_.push(this.loadModel(v,o[v]));Promise.allSettled(_).then(v=>{for(let x=0;x<v.length;x++){let{status:E,value:C}=v[x];E==="fulfilled"&&C&&(this.models[l][p[x]]={model:C,numReferences:1})}this.numModelsLoading[l]-=p.length,this.fire(new r.b("data",{dataType:"style"}))}).catch(v=>{this.fire(new r.a(new Error(`Could not load models: ${v.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,l){return!!this.getModel(o,l)}getModel(o,l){return this.models[l]||(this.models[l]={}),this.models[l][o]?this.models[l][o].model:void 0}addModel(o,l,p){this.models[p]||(this.models[p]={}),this.hasModel(o,p)&&this.models[p][o].numReferences++,this.load({[o]:this.requestManager.normalizeModelURL(l)},p)}addModels(o,l){this.models[l]||(this.models[l]={});let p={};for(let _ in o)this.models[l][_]={},p[_]=this.requestManager.normalizeModelURL(o[_]);this.load(p,l)}addModelsFromBucket(o,l){this.models[l]||(this.models[l]={});let p={};for(let _ of o)this.hasModel(_,l)?this.models[l][_].numReferences++:p[_]=this.requestManager.normalizeModelURL(_);this.load(p,l)}removeModel(o,l){if(this.models[l]&&this.models[l][o]&&(this.models[l][o].numReferences--,this.models[l][o].numReferences===0)){let p=this.models[l][o].model;delete this.models[l][o],p.destroy()}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,l){this.models[l]||(this.models[l]={});for(let p in this.models[l])this.models[l][p].model&&this.models[l][p].model.upload(o.context)}}class $i{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,l,p){let _=String(l);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][_]=this.stateChanges[o][_]||{},r.e(this.stateChanges[o][_],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(let v in this.state[o])v!==_&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][_]===null){this.deletedStates[o][_]={};for(let v in this.state[o][_])p[v]||(this.deletedStates[o][_][v]=null)}else for(let v in p)this.deletedStates[o]&&this.deletedStates[o][_]&&this.deletedStates[o][_][v]===null&&delete this.deletedStates[o][_][v]}removeFeatureState(o,l,p){if(this.deletedStates[o]===null)return;let _=String(l);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&l!==void 0)this.deletedStates[o][_]!==null&&(this.deletedStates[o][_]=this.deletedStates[o][_]||{},this.deletedStates[o][_][p]=null);else if(l!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][_])for(p in this.deletedStates[o][_]={},this.stateChanges[o][_])this.deletedStates[o][_][p]=null;else this.deletedStates[o][_]=null;else this.deletedStates[o]=null}getState(o,l){let p=String(l),_=r.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){let v=this.deletedStates[o][l];if(v===null)return{};for(let x in v)delete _[x]}return _}initializeTileState(o,l){o.setFeatureState(this.state,l)}coalesceChanges(o,l){let p={};for(let _ in this.stateChanges){this.state[_]=this.state[_]||{};let v={};for(let x in this.stateChanges[_])this.state[_][x]||(this.state[_][x]={}),r.e(this.state[_][x],this.stateChanges[_][x]),v[x]=this.state[_][x];p[_]=v}for(let _ in this.deletedStates){this.state[_]=this.state[_]||{};let v={};if(this.deletedStates[_]===null)for(let x in this.state[_])v[x]={},this.state[_][x]={};else for(let x in this.deletedStates[_]){if(this.deletedStates[_][x]===null)this.state[_][x]={};else if(this.state[_][x])for(let E of Object.keys(this.deletedStates[_][x]))delete this.state[_][x][E];v[x]=this.state[_][x]}p[_]=p[_]||{},r.e(p[_],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(let _ in o)o[_].setFeatureState(p,l)}}function oo(f){let{userImage:o}=f;return!!(o&&o.render&&o.render())&&(f.data.replace(new Uint8Array(o.data.buffer)),!0)}class Js extends r.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(o){this.images[o]={},this.loaded[o]=!1,this.updatedImages[o]={},this.patterns[o]={},this.callbackDispatchedThisFrame[o]={},this.atlasImage[o]=new r.h({width:1,height:1})}isLoaded(){for(let o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,l){if(this.loaded[l]!==o&&(this.loaded[l]=o,o)){for(let{ids:p,callback:_}of this.requestors)this._notify(p,l,_);this.requestors=[]}}hasImage(o,l){return!!this.getImage(o,l)}getImage(o,l){return this.images[l][o]}addImage(o,l,p){this._validate(o,p)&&(this.images[l][o]=p)}_validate(o,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new r.a(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new r.a(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new r.a(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,l){if(!o)return!0;let p=0;for(let _ of o){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(o,l){return!(o&&(o.length!==4||o[0]<0||l.data.width<o[0]||o[1]<0||l.data.height<o[1]||o[2]<0||l.data.width<o[2]||o[3]<0||l.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,l,p){p.version=this.images[l][o].version+1,this.images[l][o]=p,this.updatedImages[l][o]=!0}removeImage(o,l){let p=this.images[l][o];delete this.images[l][o],delete this.patterns[l][o],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(o){return Object.keys(this.images[o])}getImages(o,l,p){let _=!0,v=!!this.loaded[l];if(!v)for(let x of o)this.images[l][x]||(_=!1);v||_?this._notify(o,l,p):this.requestors.push({ids:o,scope:l,callback:p})}getUpdatedImages(o){return this.updatedImages[o]}_notify(o,l,p){let _={};for(let v of o){this.images[l][v]||this.fire(new r.b("styleimagemissing",{id:v}));let x=this.images[l][v];x?_[v]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:r.w(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}p(null,_)}getPixelSize(o){let{width:l,height:p}=this.atlasImage[o];return{width:l,height:p}}getPattern(o,l){let p=this.patterns[l][o],_=this.getImage(o,l);if(!_)return null;if(p&&p.position.version===_.version)return p.position;if(p)p.position.version=_.version;else{let v={w:_.data.width+2,h:_.data.height+2,x:0,y:0},x=new r.I(v,_);this.patterns[l][o]={bin:v,position:x}}return this._updatePatternAtlas(l),this.patterns[l][o].position}bind(o,l){let p=o.gl,_=this.atlasTexture[l];_?this.dirty&&(_.update(this.atlasImage[l]),this.dirty=!1):(_=new r.T(o,this.atlasImage[l],p.RGBA),this.atlasTexture[l]=_),_.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(o){let l=[];for(let x in this.patterns[o])l.push(this.patterns[o][x].bin);let{w:p,h:_}=r.p(l),v=this.atlasImage[o];v.resize({width:p||1,height:_||1});for(let x in this.patterns[o]){let{bin:E}=this.patterns[o][x],C=E.x+1,A=E.y+1,R=this.images[o][x].data,O=R.width,N=R.height;r.h.copy(R,v,{x:0,y:0},{x:C,y:A},{width:O,height:N}),r.h.copy(R,v,{x:0,y:N-1},{x:C,y:A-1},{width:O,height:1}),r.h.copy(R,v,{x:0,y:0},{x:C,y:A+N},{width:O,height:1}),r.h.copy(R,v,{x:O-1,y:0},{x:C-1,y:A},{width:1,height:N}),r.h.copy(R,v,{x:0,y:0},{x:C+O,y:A},{width:1,height:N})}this.dirty=!0}beginFrame(){for(let o in this.images)this.callbackDispatchedThisFrame[o]={}}dispatchRenderCallbacks(o,l){for(let p of o){if(this.callbackDispatchedThisFrame[l][p])continue;this.callbackDispatchedThisFrame[l][p]=!0;let _=this.images[l][p];oo(_)&&this.updateImage(p,l,_)}}}function Pi(f){let o=f.key,l=f.value,p=f.valueSpec||{},_=f.objectElementValidators||{},v=f.style,x=f.styleSpec,E=[],C=r.j(l);if(C!=="object")return[new r.V(o,l,`object expected, ${C} found`)];for(let A in l){let R=A.split(".")[0],O;_[R]?O=_[R]:p[R]?O=Wi:_["*"]?O=_["*"]:p["*"]&&(O=Wi),O?E=E.concat(O({key:(o&&`${o}.`)+A,value:l[A],valueSpec:p[R]||p["*"],style:v,styleSpec:x,object:l,objectKey:A},l)):E.push(new r.i(o,l[A],`unknown property "${A}"`))}for(let A in p)_[A]||p[A].required&&p[A].default===void 0&&l[A]===void 0&&E.push(new r.V(o,l,`missing required property "${A}"`));return E}function Wn(f){let o=f.value,l=f.valueSpec,p=f.style,_=f.styleSpec,v=f.key,x=f.arrayElementValidator||Wi;if(r.j(o)!=="array")return[new r.V(v,o,`array expected, ${r.j(o)} found`)];if(l.length&&o.length!==l.length)return[new r.V(v,o,`array length ${l.length} expected, length ${o.length} found`)];if(l["min-length"]&&o.length<l["min-length"])return[new r.V(v,o,`array length at least ${l["min-length"]} expected, length ${o.length} found`)];let E={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};_.$version<7&&(E.function=l.function),r.j(l.value)==="object"&&(E=l.value);let C=[];for(let A=0;A<o.length;A++)C=C.concat(x({array:o,arrayIndex:A,value:o[A],valueSpec:E,style:p,styleSpec:_,key:`${v}[${A}]`},!0));return C}function Ts(f){let o=f.key,l=f.value,p=f.valueSpec,_=r.j(l);if(_==="number"&&l!=l&&(_="NaN"),_!=="number")return[new r.V(o,l,`number expected, ${_} found`)];if("minimum"in p){let v=p.minimum;if(r.j(p.minimum)==="array"&&(v=p.minimum[f.arrayIndex]),l<v)return[new r.V(o,l,`${l} is less than the minimum value ${v}`)]}if("maximum"in p){let v=p.maximum;if(r.j(p.maximum)==="array"&&(v=p.maximum[f.arrayIndex]),l>v)return[new r.V(o,l,`${l} is greater than the maximum value ${v}`)]}return[]}function Ar(f){let o=f.valueSpec,l=r.u(f.value.type),p,_,v,x={},E=l!=="categorical"&&f.value.property===void 0,C=!E,A=r.j(f.value.stops)==="array"&&r.j(f.value.stops[0])==="array"&&r.j(f.value.stops[0][0])==="object",R=Pi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(z){if(l==="identity")return[new r.V(z.key,z.value,'identity function may not have a "stops" property')];let U=[],j=z.value;return U=U.concat(Wn({key:z.key,value:j,valueSpec:z.valueSpec,style:z.style,styleSpec:z.styleSpec,arrayElementValidator:O})),r.j(j)==="array"&&j.length===0&&U.push(new r.V(z.key,j,"array must have at least one stop")),U},default:function(z){return Wi({key:z.key,value:z.value,valueSpec:o,style:z.style,styleSpec:z.styleSpec})}}});return l==="identity"&&E&&R.push(new r.V(f.key,f.value,'missing required property "property"')),l==="identity"||f.value.stops||R.push(new r.V(f.key,f.value,'missing required property "stops"')),l==="exponential"&&f.valueSpec.expression&&!r.s(f.valueSpec)&&R.push(new r.V(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(C&&!r.m(f.valueSpec)?R.push(new r.V(f.key,f.value,"property functions not supported")):E&&!r.n(f.valueSpec)&&R.push(new r.V(f.key,f.value,"zoom functions not supported"))),l!=="categorical"&&!A||f.value.property!==void 0||R.push(new r.V(f.key,f.value,'"property" property is required')),R;function O(z){let U=[],j=z.value,G=z.key;if(r.j(j)!=="array")return[new r.V(G,j,`array expected, ${r.j(j)} found`)];if(j.length!==2)return[new r.V(G,j,`array length 2 expected, length ${j.length} found`)];if(A){if(r.j(j[0])!=="object")return[new r.V(G,j,`object expected, ${r.j(j[0])} found`)];if(j[0].zoom===void 0)return[new r.V(G,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new r.V(G,j,"object stop key must have value")];let H=r.u(j[0].zoom);if(typeof H!="number")return[new r.V(G,j[0].zoom,"stop zoom values must be numbers")];if(v&&v>H)return[new r.V(G,j[0].zoom,"stop zoom values must appear in ascending order")];H!==v&&(v=H,_=void 0,x={}),U=U.concat(Pi({key:`${G}[0]`,value:j[0],valueSpec:{zoom:{}},style:z.style,styleSpec:z.styleSpec,objectElementValidators:{zoom:Ts,value:N}}))}else U=U.concat(N({key:`${G}[0]`,value:j[0],valueSpec:{},style:z.style,styleSpec:z.styleSpec},j));return r.o(r.q(j[1]))?U.concat([new r.V(`${G}[1]`,j[1],"expressions are not allowed in function stops.")]):U.concat(Wi({key:`${G}[1]`,value:j[1],valueSpec:o,style:z.style,styleSpec:z.styleSpec}))}function N(z,U){let j=r.j(z.value),G=r.u(z.value),H=z.value!==null?z.value:U;if(p){if(j!==p)return[new r.V(z.key,H,`${j} stop domain type must match previous stop domain type ${p}`)]}else p=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof G!="number"&&typeof G!="string"&&typeof G!="boolean")return[new r.V(z.key,H,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&l!=="categorical"){let Z=`number expected, ${j} found`;return r.m(o)&&l===void 0&&(Z+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new r.V(z.key,H,Z)]}return l!=="categorical"||j!=="number"||typeof G=="number"&&isFinite(G)&&Math.floor(G)===G?l!=="categorical"&&j==="number"&&typeof G=="number"&&typeof _=="number"&&_!==void 0&&G<_?[new r.V(z.key,H,"stop domain values must appear in ascending order")]:(_=G,l==="categorical"&&G in x?[new r.V(z.key,H,"stop domain values must be unique")]:(x[G]=!0,[])):[new r.V(z.key,H,`integer expected, found ${String(G)}`)]}}function St(f){let o=(f.expressionContext==="property"?r.r:r.t)(r.q(f.value),f.valueSpec);if(o.result==="error")return o.value.map(p=>new r.V(`${f.key}${p.key}`,f.value,p.message));let l=o.value.expression||o.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!l.outputDefined())return[new r.V(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!r.v(l))return[new r.V(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter")return Ht(l,f);if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!r.x(l,["zoom","feature-state"]))return[new r.V(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!r.y(l))return[new r.V(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ht(f,o){let l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(let _ of o.valueSpec.expression.parameters)l.delete(_);if(l.size===0)return[];let p=[];return f instanceof r.C&&l.has(f.name)?[new r.V(o.key,o.value,`["${f.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(f.eachChild(_=>{p.push(...Ht(_,o))}),p)}function Kt(f){let o=f.key,l=f.value,p=f.valueSpec,_=[];return Array.isArray(p.values)?p.values.indexOf(r.u(l))===-1&&_.push(new r.V(o,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(r.u(l))===-1&&_.push(new r.V(o,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),_}function Mt(f){return r.A(r.q(f.value))?St(r.k({},f,{expressionContext:"filter",valueSpec:f.styleSpec[`filter_${f.layerType||"fill"}`]})):Ri(f)}function Ri(f){let o=f.value,l=f.key;if(r.j(o)!=="array")return[new r.V(l,o,`array expected, ${r.j(o)} found`)];let p=f.styleSpec,_,v=[];if(o.length<1)return[new r.V(l,o,"filter array must have at least 1 element")];switch(v=v.concat(Kt({key:`${l}[0]`,value:o[0],valueSpec:p.filter_operator,style:f.style,styleSpec:f.styleSpec})),r.u(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&r.u(o[1])==="$type"&&v.push(new r.V(l,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&v.push(new r.V(l,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(_=r.j(o[1]),_!=="string"&&v.push(new r.V(`${l}[1]`,o[1],`string expected, ${_} found`)));for(let x=2;x<o.length;x++)_=r.j(o[x]),r.u(o[1])==="$type"?v=v.concat(Kt({key:`${l}[${x}]`,value:o[x],valueSpec:p.geometry_type,style:f.style,styleSpec:f.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&v.push(new r.V(`${l}[${x}]`,o[x],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let x=1;x<o.length;x++)v=v.concat(Ri({key:`${l}[${x}]`,value:o[x],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":_=r.j(o[1]),o.length!==2?v.push(new r.V(l,o,`filter array for "${o[0]}" operator must have 2 elements`)):_!=="string"&&v.push(new r.V(`${l}[1]`,o[1],`string expected, ${_} found`))}return v}function wi(f,o){let l=f.key,p=f.style,_=f.layer,v=f.styleSpec,x=f.value,E=f.objectKey,C=v[`${o}_${f.layerType}`];if(!C)return[];let A=E.match(/^(.*)-transition$/);if(o==="paint"&&A&&C[A[1]]&&C[A[1]].transition)return Wi({key:l,value:x,valueSpec:v.transition,style:p,styleSpec:v});let R=f.valueSpec||C[E];if(!R)return[new r.i(l,x,`unknown property "${E}"`)];let O;if(r.j(x)==="string"&&r.m(R)&&!R.tokens&&(O=/^{([^}]+)}$/.exec(x))){let z=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new r.V(l,x,`"${E}" does not support interpolation syntax
Use an identity property function instead: ${z}.`)]}let N=[];if(f.layerType==="symbol")E!=="text-field"||!p||p.glyphs||p.imports||N.push(new r.V(l,x,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&r.B(r.q(x))&&r.u(x.type)==="identity"&&N.push(new r.V(l,x,'"text-font" does not support identity functions'));else if(f.layerType==="model"&&o==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&r.m(R)&&(r.D(R)||r.n(R))){let z=r.r(r.q(x),R),U=z.value.expression||z.value._styleExpression.expression;U&&!r.x(U,["measure-light"])&&(E==="model-emissive-strength"&&r.y(U)&&r.v(U)||N.push(new r.V(l,x,`${E} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(Wi({key:f.key,value:x,valueSpec:R,style:p,styleSpec:v,expressionContext:"property",propertyType:o,propertyKey:E}))}function sr(f){return wi(f,"paint")}function Pr(f){return wi(f,"layout")}function Zn(f){let o=[],l=f.value,p=f.key,_=f.style,v=f.styleSpec;l.type||l.ref||o.push(new r.V(p,l,'either "type" or "ref" is required'));let x=r.u(l.type),E=r.u(l.ref);if(l.id){let C=r.u(l.id);for(let A=0;A<f.arrayIndex;A++){let R=_.layers[A];r.u(R.id)===C&&o.push(new r.V(p,l.id,`duplicate layer id "${l.id}", previously used at line ${R.id.__line__}`))}}if("ref"in l){let C;["type","source","source-layer","filter","layout"].forEach(A=>{A in l&&o.push(new r.V(p,l[A],`"${A}" is prohibited for ref layers`))}),_.layers.forEach(A=>{r.u(A.id)===E&&(C=A)}),C?C.ref?o.push(new r.V(p,l.ref,"ref cannot reference another ref layer")):x=r.u(C.type):typeof E=="string"&&o.push(new r.V(p,l.ref,`ref layer "${E}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(l.source){let C=_.sources&&_.sources[l.source],A=C&&r.u(C.type);C?A==="vector"&&x==="raster"?o.push(new r.V(p,l.source,`layer "${l.id}" requires a raster source`)):A==="raster"&&x!=="raster"?o.push(new r.V(p,l.source,`layer "${l.id}" requires a vector source`)):A!=="vector"||l["source-layer"]?A==="raster-dem"&&x!=="hillshade"?o.push(new r.V(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):A!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||A==="geojson"&&C.lineMetrics?x==="raster-particle"&&A!=="raster-array"&&o.push(new r.V(p,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):o.push(new r.V(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new r.V(p,l.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new r.V(p,l,`layer "${l.id}" must specify a "source-layer"`)):o.push(new r.V(p,l.source,`source "${l.source}" not found`))}else o.push(new r.V(p,l,'missing required property "source"'));return o=o.concat(Pi({key:p,value:l,valueSpec:v.layer,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Wi({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:f.style,styleSpec:f.styleSpec,object:l,objectKey:"type"}),filter:C=>Mt(r.k({layerType:x},C)),layout:C=>Pi({layer:l,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":A=>Pr(r.k({layerType:x},A))}}),paint:C=>Pi({layer:l,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":A=>sr(r.k({layerType:x,layer:l},A))}})}})),o}function At(f){let o=f.value,l=f.key,p=r.j(o);return p!=="string"?[new r.V(l,o,`string expected, ${p} found`)]:[]}let Ds={promoteId:function({key:f,value:o}){if(r.j(o)==="string")return At({key:f,value:o});{let l=[];for(let p in o)l.push(...At({key:`${f}.${p}`,value:o[p]}));return l}}};function mn(f){let o=f.value,l=f.key,p=f.styleSpec,_=f.style;if(!o.type)return[new r.V(l,o,'"type" is required')];let v=r.u(o.type),x=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(o.url||o.tiles||x.push(new r.i(l,o,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Pi({key:l,value:o,valueSpec:p[`source_${v.replace("-","_")}`],style:f.style,styleSpec:p,objectElementValidators:Ds})),x;case"geojson":if(x=Pi({key:l,value:o,valueSpec:p.source_geojson,style:_,styleSpec:p,objectElementValidators:Ds}),o.cluster)for(let E in o.clusterProperties){let[C,A]=o.clusterProperties[E],R=typeof C=="string"?[C,["accumulated"],["get",E]]:C;x.push(...St({key:`${l}.${E}.map`,value:A,expressionContext:"cluster-map"})),x.push(...St({key:`${l}.${E}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return x;case"video":return Pi({key:l,value:o,valueSpec:p.source_video,style:_,styleSpec:p});case"image":return Pi({key:l,value:o,valueSpec:p.source_image,style:_,styleSpec:p});case"canvas":return[new r.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kt({key:`${l}.type`,value:o.type,valueSpec:{values:so(p)},style:_,styleSpec:p})}}function so(f){return f.source.reduce((o,l)=>{let p=f[l];return p.type.type==="enum"&&(o=o.concat(Object.keys(p.type.values))),o},[])}function fr(f){let o=f.value,l=f.styleSpec,p=l.light,_=f.style,v=[],x=r.j(o);if(o===void 0)return v;if(x!=="object")return v=v.concat([new r.V("light",o,`object expected, ${x} found`)]),v;for(let E in o){let C=E.match(/^(.*)-transition$/);v=v.concat(C&&p[C[1]]&&p[C[1]].transition?Wi({key:E,value:o[E],valueSpec:l.transition,style:_,styleSpec:l}):p[E]?Wi({key:E,value:o[E],valueSpec:p[E],style:_,styleSpec:l}):[new r.V(E,o[E],`unknown property "${E}"`)])}return v}function ao(f){let o=f.value,l=[];if(!o)return l;let p=r.j(o);if(p!=="object")return l=l.concat([new r.V("light-3d",o,`object expected, ${p} found`)]),l;let _=f.styleSpec,v=_["light-3d"],x=f.key,E=f.style,C=f.style.lights;for(let O of["type","id"])if(!(O in o))return l=l.concat([new r.V("light-3d",o,`missing property ${O} on light`)]),l;if(o.type&&C)for(let O=0;O<f.arrayIndex;O++){let N=r.u(o.type),z=C[O];r.u(z.type)===N&&l.push(new r.V(x,o.id,`duplicate light type "${o.type}", previously defined at line ${z.id.__line__}`))}let A=`properties_light_${o.type}`;if(!(A in _))return l=l.concat([new r.V("light-3d",o,`Invalid light type ${o.type}`)]),l;let R=_[A];for(let O in o)if(O==="properties"){let N=o[O],z=r.j(N);if(z!=="object")return l=l.concat([new r.V("properties",N,`object expected, ${z} found`)]),l;for(let U in N)l=l.concat(R[U]?Wi({key:U,value:N[U],valueSpec:R[U],style:E,styleSpec:_}):[new r.i(f.key,N[U],`unknown property "${U}"`)])}else{let N=O.match(/^(.*)-transition$/);l=l.concat(N&&v[N[1]]&&v[N[1]].transition?Wi({key:O,value:o[O],valueSpec:_.transition,style:E,styleSpec:_}):v[O]?Wi({key:O,value:o[O],valueSpec:v[O],style:E,styleSpec:_}):[new r.i(O,o[O],`unknown property "${O}"`)])}return l}function xo(f){let o=f.value,l=f.key,p=f.style,_=f.styleSpec,v=_.terrain,x=[],E=r.j(o);if(o===void 0||E==="null")return x;if(E!=="object")return x=x.concat([new r.V("terrain",o,`object expected, ${E} found`)]),x;for(let C in o){let A=C.match(/^(.*)-transition$/);x=x.concat(A&&v[A[1]]&&v[A[1]].transition?Wi({key:C,value:o[C],valueSpec:_.transition,style:p,styleSpec:_}):v[C]?Wi({key:C,value:o[C],valueSpec:v[C],style:p,styleSpec:_}):[new r.i(C,o[C],`unknown property "${C}"`)])}if(o.source){let C=p.sources&&p.sources[o.source],A=C&&r.u(C.type);C?A!=="raster-dem"&&x.push(new r.V(l,o.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):x.push(new r.V(l,o.source,`source "${o.source}" not found`))}else x.push(new r.V(l,o,'terrain is missing required property "source"'));return x}function Ec(f){let o=f.value,l=f.style,p=f.styleSpec,_=p.fog,v=[],x=r.j(o);if(o===void 0)return v;if(x!=="object")return v=v.concat([new r.V("fog",o,`object expected, ${x} found`)]),v;for(let E in o){let C=E.match(/^(.*)-transition$/);v=v.concat(C&&_[C[1]]&&_[C[1]].transition?Wi({key:E,value:o[E],valueSpec:p.transition,style:l,styleSpec:p}):_[E]?Wi({key:E,value:o[E],valueSpec:_[E],style:l,styleSpec:p}):[new r.i(E,o[E],`unknown property "${E}"`)])}return v}let fl={"*":()=>[],array:Wn,boolean:function(f){let o=f.value,l=f.key,p=r.j(o);return p!=="boolean"?[new r.V(l,o,`boolean expected, ${p} found`)]:[]},number:Ts,color:function(f){let o=f.key,l=f.value,p=r.j(l);return p!=="string"?[new r.V(o,l,`color expected, ${p} found`)]:r.z(l)===null?[new r.V(o,l,`color expected, "${l}" found`)]:[]},enum:Kt,filter:Mt,function:Ar,layer:Zn,object:Pi,source:mn,model:r.F,light:fr,"light-3d":ao,terrain:xo,fog:Ec,string:At,formatted:function(f){return At(f).length===0?[]:St(f)},resolvedImage:function(f){return At(f).length===0?[]:St(f)},projection:function(f){let o=f.value,l=f.styleSpec,p=l.projection,_=f.style,v=[],x=r.j(o);if(x==="object")for(let E in o)v=v.concat(Wi({key:E,value:o[E],valueSpec:p[E],style:_,styleSpec:l}));else x!=="string"&&(v=v.concat([new r.V("projection",o,`object or string expected, ${x} found`)]));return v},import:function(f){let{value:o,styleSpec:l}=f,x=o,{data:p}=x,_=om(x,["data"]);Object.defineProperty(_,"__line__",{value:o.__line__,enumerable:!1});let v=Pi(r.k({},f,{value:_,valueSpec:l.import}));return r.u(_.id)===""&&v.push(new r.V(`${f.key}.id`,_,"import id can't be an empty string")),p&&(v=v.concat(jt(p,l,{key:`${f.key}.data`}))),v}};function Wi(f,o=!1){let l=f.value,p=f.valueSpec,_=f.styleSpec;if(p.expression&&r.B(r.u(l)))return Ar(f);if(p.expression&&r.o(r.q(l)))return St(f);if(p.type&&fl[p.type]){let v=fl[p.type](f);return o===!0&&v.length>0&&r.j(f.value)==="array"?St(f):v}return Pi(r.k({},f,{valueSpec:p.type?_[p.type]:p}))}function hd(f){let o=f.value,l=f.key,p=At(f);return p.length||(o.indexOf("{fontstack}")===-1&&p.push(new r.V(l,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&p.push(new r.V(l,o,'"glyphs" url must include a "{range}" token'))),p}function jt(f,o=r.G,l={}){return Wi({key:l.key||"",value:f,valueSpec:o.$root,styleSpec:o,style:f,objectElementValidators:{glyphs:hd,"*":()=>[]}})}function zt(f,o=r.G){return Ne(jt(f,o))}let Tc=f=>Ne(mn(f)),wo=f=>Ne(fr(f)),We=f=>Ne(ao(f)),J=f=>Ne(xo(f)),oe=f=>Ne(Ec(f)),me=f=>Ne(Zn(f)),Be=f=>Ne(Mt(f)),Ue=f=>Ne(sr(f)),Ye=f=>Ne(Pr(f)),vt=f=>Ne(r.F(f));function Ne(f){return f.slice().sort((o,l)=>o.line&&l.line?o.line-l.line:0)}function ft(f,o){let l=!1;if(o&&o.length)for(let p of o)p instanceof r.i?r.w(p.message):(f.fire(new r.a(new Error(p.message))),l=!0);return l}let _t=new r.H({anchor:new r.J(r.G.light.anchor),position:new r.K(r.G.light.position),color:new r.J(r.G.light.color),intensity:new r.J(r.G.light.intensity)});class Et extends r.E{constructor(o,l="flat"){super(),this._transitionable=new r.L(_t),this.setLight(o,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,l,p={}){this._validate(wo,o,p)||(this._transitionable.setTransitionOrValue(o),this.id=l)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,l,p){return(!p||p.validate!==!1)&&ft(this,o.call(zt,r.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}let at=new r.H({source:new r.J(r.G.terrain.source),exaggeration:new r.J(r.G.terrain.exaggeration)}),Kn=class extends r.E{constructor(f,o,l,p){super(),this.scope=l,this._transitionable=new r.L(at,l,p),this._transitionable.setTransitionOrValue(f,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(f,o){this._transitionable.setTransitionOrValue(f,o)}updateTransitions(f){this._transitioning=this._transitionable.transitioned(f,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(f){this.properties=this._transitioning.possiblyEvaluate(f)}getExaggeration(f){return this._transitioning.possiblyEvaluate(new r.N(f)).get("exaggeration")}isZoomDependent(){let f=this._transitionable._values.exaggeration;return f!=null&&f.value!=null&&f.value.expression!=null&&f.value.expression instanceof r.Z}},Rn=45,Qn=65,kn=.05;function On(f,o,l,p){let _=r.S(Rn,Qn,l),[v,x]=Jn(f,p),E=1-Math.min(1,Math.exp((o-v)/(x-v)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*_*f.alpha}function Jn(f,o){let l=.5/Math.tan(.5*o);return[f.range[0]+l,f.range[1]+l]}function bi(f,o,l,p,_){let v=r.Q.transformMat4([],[o,l,p],_.mercatorFogMatrix);return On(f,r.Q.length(v),_.pitch,_._fov)}function pr(f,o,l,p,_,v,x){let E=[[l,p,0],[_,p,0],[_,v,0],[l,v,0]],C=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let R of E){let O=r.Q.transformMat4([],R,o),N=r.Q.length(O);C=Math.min(C,N),A=Math.max(A,N)}return[On(f,C,x.pitch,x._fov),On(f,A,x.pitch,x._fov)]}let pi=new r.H({range:new r.J(r.G.fog.range),color:new r.J(r.G.fog.color),"high-color":new r.J(r.G.fog["high-color"]),"space-color":new r.J(r.G.fog["space-color"]),"horizon-blend":new r.J(r.G.fog["horizon-blend"]),"star-intensity":new r.J(r.G.fog["star-intensity"]),"vertical-range":new r.J(r.G.fog["vertical-range"])});class Br extends r.E{constructor(o,l,p,_){super(),this._transitionable=new r.L(pi,p,new Map(_)),this.set(o,_),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new r.U(pi)}get state(){let o=this._transform,l=o.projection.name==="globe",p=r.W(o.zoom),_=this.properties.get("range"),v=[.5,3];return{range:l?[r.X(v[0],_[0],p),r.X(v[1],_[1],p)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,l,p={}){if(this._validate(oe,o,p))return;let _=r.e({},o);for(let v of Object.keys(r.G.fog))_[v]===void 0&&(_[v]=r.G.fog[v].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.S(Rn,Qn,o))*l.a}getOpacityAtLatLng(o,l){return this._transform.projection.supportsFog?function(p,_,v){let x=r.O.fromLngLat(_),E=v.elevation?v.elevation.getAtPointOrZero(x):0;return bi(p,x.x,x.y,E,v)}(this.state,o,l):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let l=this._transform.calculateFogTileMatrix(o.toUnwrapped());return pr(this.state,l,0,0,r.Y,r.Y,this._transform)}getOpacityForBounds(o,l,p,_,v){return this._transform.projection.supportsFog?pr(this.state,o,l,p,_,v,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?Jn(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let l=[4,5,6,7];for(let p of l){let _=o.points[p],v;if(_[2]>=0)v=_;else{let x=o.points[p-4];v=r._(x,_,x[2]/(x[2]-_[2]))}if(bi(this.state,v[0],v[1],0,this._transform)>=kn)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,l,p){return(!p||p.validate!==!1)&&ft(this,o.call(zt,r.e({value:l,style:{glyphs:!0,sprite:!0},styleSpec:r.G})))}}class Rr extends r.E{constructor(o,l,p,_){super(),this.scope=p,this._options=o,this.properties=new r.U(l),this._transitionable=new r.L(l,p,new Map(_)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,l){this._options=o,this._transitionable.setTransitionOrValue(o.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let No=new r.H({color:new r.J(r.G.properties_light_ambient.color),intensity:new r.J(r.G.properties_light_ambient.intensity)}),Zi=new r.H({direction:new r.$(r.G.properties_light_directional.direction),color:new r.J(r.G.properties_light_directional.color),intensity:new r.J(r.G.properties_light_directional.intensity),"cast-shadows":new r.J(r.G.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.J(r.G.properties_light_directional["shadow-intensity"])});class Ei{constructor(o,l,p,_){this.screenBounds=o,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(o,l){let p,_;if(o instanceof r.P||typeof o[0]=="number"){let v=r.P.convert(o);p=[v],_=l.isPointAboveHorizon(v)}else{let v=r.P.convert(o[0]),x=r.P.convert(o[1]);p=[v,x],_=r.a0(v,x).every(E=>l.isPointAboveHorizon(E))}return new Ei(p,l.getCameraPoint(),_,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.a0(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.a0(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),r.a1(_,o)}bufferedCameraGeometryGlobe(o){let l=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],_=r.a0(l,p,o),v=this.cameraPoint.clone();switch(3*((v.y>l.y)+(v.y>p.y))+((v.x>l.x)+(v.x>p.x))){case 0:_[0]=v,_[4]=v.clone();break;case 1:_.splice(1,0,v);break;case 2:_[1]=v;break;case 3:_.splice(4,0,v);break;case 5:_.splice(2,0,v);break;case 6:_[3]=v;break;case 7:_.splice(3,0,v);break;case 8:_[2]=v}return _}containsTile(o,l,p,_=0){let v=o.queryPadding/l._pixelsPerMercatorPixel+1,x=p?this._bufferedCameraMercator(v,l):this._bufferedScreenMercator(v,l),E=o.tileID.wrap+(x.unwrapped?_:0),C=x.polygon.map(G=>r.a2(o.tileTransform,G,E));if(!r.a3(C,0,0,r.Y,r.Y))return;E=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);let A=this.screenGeometryMercator.polygon.map(G=>r.a4(o.tileTransform,G,E)),R=A.map(G=>new r.P(G[0],G[1])),O=l.getFreeCameraOptions().position||new r.O(0,0,0),N=r.a4(o.tileTransform,O,E),z=A.map(G=>{let H=r.Q.sub(G,G,N);return r.Q.normalize(H,H),new r.a5(N,H)}),U=r.a6(o,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:R,tilespaceRays:z,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(j=r.a7(C),j.min.x=r.ad(j.min.x,0,r.Y),j.min.y=r.ad(j.min.y,0,r.Y),j.max.x=r.ad(j.max.x,0,r.Y),j.max.y=r.ad(j.max.y,0,r.Y),j),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:U};var j}_bufferedScreenMercator(o,l){let p=$e(o);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),l):{polygon:this.bufferedScreenGeometry(o).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(o,l){let p=$e(o);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let _;return _=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),l):{polygon:this.bufferedCameraGeometry(o).map(v=>l.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[p]=_,_}}_projectAndResample(o,l){let p=function(v,x){let E=r.a9.multiply([],x.pixelMatrix,x.globeMatrix),C=[0,-r.ae,0,1],A=[0,r.ae,0,1],R=[0,0,0,1];r.aa.transformMat4(C,C,E),r.aa.transformMat4(A,A,E),r.aa.transformMat4(R,R,E);let O=new r.P(C[0]/C[3],C[1]/C[3]),N=new r.P(A[0]/A[3],A[1]/A[3]),z=r.ab(v,O)&&C[3]<R[3],U=r.ab(v,N)&&A[3]<R[3];if(!z&&!U)return null;let j=function(X,ce,ae){for(let pe=1;pe<X.length;pe++){let Ee=Fe(ce.pointCoordinate3D(X[pe-1]).x),fe=Fe(ce.pointCoordinate3D(X[pe]).x);if(ae<0){if(Ee<fe)return{idx:pe,t:-Ee/(fe-1-Ee)}}else if(fe<Ee)return{idx:pe,t:(1-Ee)/(fe+1-Ee)}}return null}(v,x,z?-1:1);if(!j)return null;let{idx:G,t:H}=j,Z=G>1?Oe(v.slice(0,G),x):[],ne=G<v.length?Oe(v.slice(G),x):[];Z=Z.map(X=>new r.P(Fe(X.x),X.y)),ne=ne.map(X=>new r.P(Fe(X.x),X.y));let te=[...Z];te.length===0&&te.push(ne[ne.length-1]);let re=r.X(te[te.length-1].y,(ne.length===0?Z[0]:ne[0]).y,H),q;return q=z?[new r.P(0,re),new r.P(0,0),new r.P(1,0),new r.P(1,re)]:[new r.P(1,re),new r.P(1,1),new r.P(0,1),new r.P(0,re)],te.push(...q),ne.length===0?te.push(Z[0]):te.push(...ne),{polygon:te.map(X=>new r.O(X.x,X.y)),unwrapped:!1}}(o,l);if(p)return p;let _=function(v,x){let E=!1,C=-1/0,A=0;for(let O=0;O<v.length-1;O++)v[O].x>C&&(C=v[O].x,A=O);for(let O=0;O<v.length-1;O++){let N=(A+O)%(v.length-1),z=v[N],U=v[N+1];Math.abs(z.x-U.x)>.5&&(z.x<U.x?(z.x+=1,N===0&&(v[v.length-1].x+=1)):(U.x+=1,N+1===v.length-1&&(v[0].x+=1)),E=!0)}let R=r.a8(x.center.lng);return E&&R<Math.abs(R-1)&&v.forEach(O=>{O.x-=1}),{polygon:v,unwrapped:E}}(Oe(o,l).map(v=>new r.P(Fe(v.x),v.y)),l);return{polygon:_.polygon.map(v=>new r.O(v.x,v.y)),unwrapped:_.unwrapped}}}function Oe(f,o){return r.ac(f,l=>{let p=o.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function Fe(f){return f<0?1+f%1:f%1}function $e(f){return 100*f|0}function Ke(f,o,l,p,_){let v=function(x,E){if(x)return _(x);if(E){f.url&&E.tiles&&f.tiles&&delete f.tiles;let C=r.af(r.e(E,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);E.vector_layers&&(C.vectorLayers=E.vector_layers,C.vectorLayerIds=C.vectorLayers.map(A=>A.id)),E.raster_layers&&(C.rasterLayers=E.raster_layers,C.rasterLayerIds=C.rasterLayers.map(A=>A.id)),C.tiles=o.canonicalizeTileset(C,f.url),_(null,C)}};return f.url?r.g(o.transformRequest(o.normalizeSourceURL(f.url,null,l,p),r.R.Source),v):r.f.frame(()=>v(null,f))}class Xe{constructor(o,l,p){this.bounds=r.ag.convert(this.validateBounds(o)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let l=Math.pow(2,o.z),p=Math.floor(r.a8(this.bounds.getWest())*l),_=Math.floor(r.ah(this.bounds.getNorth())*l),v=Math.ceil(r.a8(this.bounds.getEast())*l),x=Math.ceil(r.ah(this.bounds.getSouth())*l);return o.x>=p&&o.x<v&&o.y>=_&&o.y<x}}class it extends r.E{constructor(o,l,p,_){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.e(this,r.af(l,["url","scheme","tileSize","promoteId"])),this._options=r.e({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new r.ai}load(o){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=Ke(this._options,this.map._requestManager,l,p,(_,v)=>{this._tileJSONRequest=null,this._loaded=!0,_?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&p.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new r.a(_))):v&&(r.e(this,v),v.bounds&&(this.tileBounds=new Xe(v.bounds,this.minzoom,this.maxzoom)),r.am(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),o&&o(_)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}loadTile(o,l){let p=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(p,r.R.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster};if(_.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=l:o.request=o.actor.send("reloadTile",_,v.bind(this));else if(o.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",_,v.bind(this),void 0,!0);else{let x=r.ak.call({deduped:this._deduped},_,(E,C)=>{E||!C?v.call(this,E):(_.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},o.actor&&o.actor.send("loadTile",_,v.bind(this),void 0,!0))},!0);o.request={cancel:x}}function v(x,E){return delete o.request,o.aborted?l(null):x&&x.status!==404?l(x):(E&&E.resourceTiming&&(o.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&E&&o.setExpiryData(E),o.loadVectorData(E,this.map.painter),r.al(this.dispatcher),l(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class rt extends r.E{constructor(o,l,p,_){super(),this.id=o,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.e({type:"raster"},l),r.e(this,r.af(l,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._tileJSONRequest=Ke(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new r.a(l)):p&&(r.e(this,p),p.bounds&&(this.tileBounds=new Xe(p.bounds,this.minzoom,this.maxzoom)),r.am(p.tiles),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),o&&o(l)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.aj(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,l){let p=r.f.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);o.request=r.d(this.map._requestManager.transformRequest(_,r.R.Tile),(v,x,E,C)=>(delete o.request,o.aborted?(o.state="unloaded",l(null)):v?(o.state="errored",l(v)):x?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:E,expires:C}),o.setTexture(x,this.map.painter),o.state="loaded",r.al(this.dispatcher),void l(null)):l(null)))}abortTile(o,l){o.request&&(o.request.cancel(),delete o.request),l()}unloadTile(o,l){o.texture&&o.texture instanceof r.T?(o.destroy(!0),o.texture&&o.texture instanceof r.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Je extends rt{constructor(o,l,p,_){super(o,l,p,_),this.type="raster-array",this.maxzoom=22,this._options=r.e({type:"raster-array"},l)}triggerRepaint(o){let l=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);l&&l.enabled&&p&&l._clearRenderCacheForTile(p.id,o.tileID),this.map.triggerRepaint()}loadTile(o,l){let p=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(p,r.R.Tile);o.requestParams=_,o.actor||(o.actor=this.dispatcher.getActor()),o.request=o.fetchHeader(void 0,(v,x,E,C)=>{if(delete o.request,o.aborted)return o.state="unloaded",l(null);if(v)return v.code===20?void 0:(o.state="errored",l(v));this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:E,expires:C}),o.state="empty",l(null)})}unloadTile(o){let l=o.texture;l&&l instanceof r.T?(o.destroy(!0),this.map.painter.saveTileTexture(l)):(o.destroy(),o.flushQueues(),o._isHeaderLoaded=!1,delete o._mrt,delete o.textureDescriptor),o.fbo&&(o.fbo.destroy(),delete o.fbo),delete o.request,delete o.requestParams,delete o.neighboringTiles,o.state="unloaded"}prepareTile(o,l,p){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBand(l,p,(_,v)=>{if(_)return o.state="errored",this.fire(new r.a(_)),void this.triggerRepaint(o);v&&(o.setTexture(v,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;let l=this.rasterLayers.find(({id:v})=>v===o),p=l&&l.fields,_=p&&p.bands&&p.bands;return _?_[0]:0}getTextureDescriptor(o,l,p){if(!o)return;let _=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let v=null;l instanceof r.aq?v=l.paint.get("raster-array-band"):l instanceof r.ar&&(v=l.paint.get("raster-particle-array-band"));let x=v||this.getInitialBand(_);if(x!=null)if(o.textureDescriptor){if(!o.updateNeeded(_,x)||p)return Object.assign({},o.textureDescriptor,{texture:o.texture})}else this.prepareTile(o,_,x)}}let lt=32,et=33,Ut=new Uint16Array(8184);for(let f=0;f<2046;f++){let o=f+2,l=0,p=0,_=0,v=0,x=0,E=0;for(1&o?_=v=x=lt:l=p=E=lt;(o>>=1)>1;){let A=l+_>>1,R=p+v>>1;1&o?(_=l,v=p,l=x,p=E):(l=_,p=v,_=x,v=E),x=A,E=R}let C=4*f;Ut[C+0]=l,Ut[C+1]=p,Ut[C+2]=_,Ut[C+3]=v}let _n=new Uint16Array(2178),xt=new Uint8Array(1089),ei=new Uint16Array(1089);function Ti(f){return f===0?-.03125:f===32?.03125:0}let Di=(()=>{class f{constructor(l,p,_,v){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++,this.context=l;let x=l.gl;this.buffer=x.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),x.bufferData(x.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||v||p.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){this.id=f.uniqueIdxCounter,f.uniqueIdxCounter++;let p=this.context.gl;this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return f.uniqueIdxCounter=0,f})(),zi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Si{constructor(o,l,p,_,v,x){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.instanceCount=x,this.context=o;let E=o.gl;this.buffer=E.createBuffer(),o.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||v||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,l){for(let p=0;p<this.attributes.length;p++){let _=l.attributes[this.attributes[p].name];_!==void 0&&o.enableVertexAttribArray(_)}}setVertexAttribPointers(o,l,p){for(let _=0;_<this.attributes.length;_++){let v=this.attributes[_],x=l.attributes[v.name];x!==void 0&&o.vertexAttribPointer(x,v.components,o[zi[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(o,l,p){for(let _=0;_<this.attributes.length;_++){let v=l.attributes[this.attributes[_].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(v,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class wn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lo extends wn{getDefault(){return r.aA.transparent}set(o){let l=this.current;(o.r!==l.r||o.g!==l.g||o.b!==l.b||o.a!==l.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class zo extends wn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class _r extends wn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Ma extends wn{getDefault(){return[!0,!0,!0,!0]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Dc extends wn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Vr extends wn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class db extends wn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let l=this.current;(o.func!==l.func||o.ref!==l.ref||o.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class dn extends wn{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Df extends wn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=o,this.dirty=!1}}class jr extends wn{getDefault(){return[0,1]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Is extends wn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=o,this.dirty=!1}}class ag extends wn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class lg extends wn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.BLEND):l.disable(l.BLEND),this.current=o,this.dirty=!1}}class If extends wn{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class cg extends wn{getDefault(){return r.aA.transparent}set(o){let l=this.current;(o.r!==l.r||o.g!==l.g||o.b!==l.b||o.a!==l.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ug extends wn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class dg extends wn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;o?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=o,this.dirty=!1}}class hg extends wn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class fg extends wn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let fd=class extends wn{getDefault(){return null}set(f){(f!==this.current||this.dirty)&&(this.gl.useProgram(f),this.current=f,this.dirty=!1)}};class tn extends wn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Cf extends wn{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let l=this.current;(o[0]!==l[0]||o[1]!==l[1]||o[2]!==l[2]||o[3]!==l[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Aa extends wn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class pg extends wn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class mg extends wn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindTexture(l.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class gg extends wn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class _g extends wn{getDefault(){return null}set(o){let l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class yg extends wn{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class vg extends wn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class bg extends wn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class xg extends wn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class pd extends wn{constructor(o,l){super(o),this.context=o,this.parent=l}getDefault(){return null}}class hb extends pd{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class md extends pd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class fb extends pd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class pb extends md{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class mb{constructor(o,l,p,_,v){this.context=o,this.width=l,this.height=p;let x=this.framebuffer=o.gl.createFramebuffer();_&&(this.colorAttachment=new hb(o,x)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new md(o,x):new fb(o,x))}destroy(){let o=this.context.gl;if(this.colorAttachment){let l=this.colorAttachment.get();l&&o.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let l=this.depthAttachment.get();l&&o.deleteRenderbuffer(l)}else{let l=this.depthAttachment.get();l&&o.deleteTexture(l)}o.deleteFramebuffer(this.framebuffer)}}class Ct{constructor(o,l,p){this.func=o,this.mask=l,this.range=p}}Ct.ReadOnly=!1,Ct.ReadWrite=!0,Ct.disabled=new Ct(519,Ct.ReadOnly,[0,1]);let Sf=7680;class qt{constructor(o,l,p,_,v,x){this.test=o,this.ref=l,this.mask=p,this.fail=_,this.depthFail=v,this.pass=x}}qt.disabled=new qt({func:519,mask:0},0,0,Sf,Sf,Sf);let gd=771;class an{constructor(o,l,p,_){this.blendFunction=o,this.blendColor=l,this.mask=p,this.blendEquation=_}}an.Replace=[1,0,1,0],an.disabled=new an(an.Replace,r.aA.transparent,[!1,!1,!1,!1]),an.unblended=new an(an.Replace,r.aA.transparent,[!0,!0,!0,!0]),an.alphaBlended=new an([1,gd,1,gd],r.aA.transparent,[!0,!0,!0,!0]),an.multiply=new an([774,0,774,0],r.aA.transparent,[!0,!0,!0,!0]);let Mf=1029,Af=2305;class Vt{constructor(o,l,p){this.enable=o,this.mode=l,this.frontFace=p}}Vt.disabled=new Vt(!1,Mf,Af),Vt.backCCW=new Vt(!0,Mf,Af),Vt.backCW=new Vt(!0,Mf,2304),Vt.frontCW=new Vt(!0,1028,2304),Vt.frontCCW=new Vt(!0,1028,Af);class ts{constructor(o,l){this.gl=o,this.clearColor=new lo(this),this.clearDepth=new zo(this),this.clearStencil=new _r(this),this.colorMask=new Ma(this),this.depthMask=new Dc(this),this.stencilMask=new Vr(this),this.stencilFunc=new db(this),this.stencilOp=new dn(this),this.stencilTest=new Df(this),this.depthRange=new jr(this),this.depthTest=new Is(this),this.depthFunc=new ag(this),this.blend=new lg(this),this.blendFunc=new If(this),this.blendColor=new cg(this),this.blendEquation=new ug(this),this.cullFace=new dg(this),this.cullFaceSide=new hg(this),this.frontFace=new fg(this),this.program=new fd(this),this.activeTexture=new tn(this),this.viewport=new Cf(this),this.bindFramebuffer=new Aa(this),this.bindRenderbuffer=new pg(this),this.bindTexture=new mg(this),this.bindVertexBuffer=new gg(this),this.bindElementBuffer=new _g(this),this.bindVertexArrayOES=new yg(this),this.pixelStoreUnpack=new vg(this),this.pixelStoreUnpackPremultiplyAlpha=new bg(this),this.pixelStoreUnpackFlipY=new xg(this),this.options=l?Yt({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.maxPointSize=o.getParameter(o.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,l,p){return new Di(this,o,l,p)}createVertexBuffer(o,l,p,_,v){return new Si(this,o,l,p,_,v)}createRenderbuffer(o,l,p){let _=this.gl,v=_.createRenderbuffer();return this.bindRenderbuffer.set(v),_.renderbufferStorage(_.RENDERBUFFER,o,l,p),this.bindRenderbuffer.set(null),v}createFramebuffer(o,l,p,_){return new mb(this,o,l,p,_)}clear({color:o,depth:l,stencil:p,colorMask:_}){let v=this.gl,x=0;o&&(x|=v.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(_||[!0,!0,!0,!0])),l!==void 0&&(x|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),p!==void 0&&(x|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),v.clear(x)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){T(o.blendFunction,an.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var gb=r.aB([{name:"a_index",type:"Int16",components:1}]);let Pa=.15000000000000002;class wg{constructor(o,l,p,_){let v={width:p[0],height:p[1],data:null},x=o.gl;this.targetColorTexture=new r.T(o,v,x.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new r.T(o,v,x.RGBA,{useMipmap:!1}),this.context=o,this.setParticleTextureDimension(l,_),this.lastInvalidatedAt=0}setParticleTextureDimension(o,l){if(this.particleTextureDimension===l)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());let p=this.context.gl,_=l*l,v=new Uint8Array(4*_),x=.7692307692307692,E=r.aC(o.key);for(let R=0;R<v.length;R+=4){let O=x*(E()+Pa),N=x*(E()+Pa),z=255*O%1,U=255*N%1,j=z,G=N-U/255,H=U;v[R+0]=Math.floor(255*(O-z/255)),v[R+1]=Math.floor(255*j),v[R+2]=Math.floor(255*G),v[R+3]=Math.floor(255*H)}let C=new r.h({width:l,height:l},v);this.particleTexture0=new r.T(this.context,C,p.RGBA,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new r.T(this.context,C,p.RGBA,{premultiply:!1,useMipmap:!1});let A=new r.aD;A.reserve(_);for(let R=0;R<_;R++)A.emplaceBack(R);this.particleIndexBuffer=this.context.createVertexBuffer(A,gb.members,!0),this.particleSegment=r.aE.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=r.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}let _d={type:2,extent:r.Y,loadGeometry:()=>[[new r.P(0,0),new r.P(r.Y+1,0),new r.P(r.Y+1,r.Y+1),new r.P(0,r.Y+1),new r.P(0,0)]]};class Bo{constructor(o,l,p,_,v){this.tileID=o,this.uid=r.aF(),this.uses=0,this.tileSize=l,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection)}registerFadeDuration(o){let l=o+this.timeAdded;l<r.f.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=r.av(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,l,p){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(_,v){let x={};if(!v)return x;for(let E of _){let C=E.layerIds.map(A=>v.getLayer(A)).filter(Boolean);if(C.length!==0){E.layers=C,E.stateDependentLayerIds&&(E.stateDependentLayers=E.stateDependentLayerIds.map(A=>C.filter(R=>R.id===A)[0]));for(let A of C)x[A.fqid]=E}}return x}(o.buckets,l.style),this.hasSymbolBuckets=!1;for(let _ in this.buckets){let v=this.buckets[_];if(v instanceof r.aH){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let _ in this.buckets){let v=this.buckets[_];if(v instanceof r.aH&&v.hasRTLText){this.hasRTLText=!0,r.aI();break}}this.queryPadding=0;for(let _ in this.buckets){let v=this.buckets[_],x=l.style.getOwnLayer(_);if(!x)continue;let E=x.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,E)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new r.aG}unloadVectorData(){if(this.hasData()){for(let o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(o){return this.buckets[o.fqid]}upload(o){for(let _ in this.buckets){let v=this.buckets[_];v.uploadPending()&&v.upload(o)}let l=o.gl,p=this.imageAtlas;if(p&&!p.uploaded){let _=!!Object.keys(p.patternPositions).length;this.imageAtlasTexture=new r.T(o,p.image,l.RGBA,{useMipmap:_}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new r.T(o,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new r.T(o,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(o,l,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,p),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let _=l.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this._lastUpdatedBrightness=_,this.updateBuckets(void 0,l)))}queryRenderedFeatures(o,l,p,_,v,x,E,C){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:_,pixelPosMatrix:E,transform:x,params:v,tileTransform:this.tileTransform},o,l,p):{}}querySourceFeatures(o,l){let p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;let _=p.loadVTLayers(),v=l?l.sourceLayer:"",x=_._geojsonTileLayer||_[v];if(!x)return;let E=r.aJ(l&&l.filter),{z:C,x:A,y:R}=this.tileID.canonical,O={z:C,x:A,y:R};for(let N=0;N<x.length;N++){let z=x.feature(N);if(E.needGeometry){let G=r.aK(z,!0);if(!E.filter(new r.N(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!E.filter(new r.N(this.tileID.overscaledZ),z))continue;let U=p.getId(z,v),j=new r.aL(z,C,A,R,U);j.tile=O,o.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let o in this.buckets)if(this.buckets[o].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){let l=this.expirationTime;if(o.cacheControl){let p=r.aM(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){let p=Date.now(),_=!1;if(this.expirationTime>p)_=!1;else if(l)if(this.expirationTime<l)_=!0;else{let v=this.expirationTime-l;v?this.expirationTime=p+Math.max(v,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,l){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0&&l&&this.updateBuckets(o,l)}updateBuckets(o,l){if(!this.latestFeatureIndex)return;let p=this.latestFeatureIndex.loadVTLayers(),_=l.style.listImages(),v=l.style.getBrightness();for(let x in this.buckets){if(!l.style.hasLayer(x))continue;let E=this.buckets[x],C=E.layers[0].sourceLayer||"_geojsonTileLayer",A=p[C],R={};if(o&&(R=o[C],!A||!R||Object.keys(R).length===0))continue;if(E.update(R,A,_,this.imageAtlas&&this.imageAtlas.patternPositions||{},v),E instanceof r.aN||E instanceof r.aO){let N=l.style.getOwnSourceCache(E.layers[0].source);l._terrain&&l._terrain.enabled&&N&&E.programConfigurations.needsUpload&&l._terrain._clearRenderCacheForTile(N.id,this.tileID)}let O=l&&l.style&&l.style.getOwnLayer(x);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(E)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<r.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=r.f.now()+o}setTexture(o,l){let p=l.context,_=p.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o,{useMipmap:!0}):(this.texture=new r.T(p,o,_.RGBA,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(o,l){let p={};for(let _ of l)p[_]=!0;this.dependencies[o]=p}hasDependency(o,l){for(let p of o){let _=this.dependencies[p];if(_){for(let v of l)if(_[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;let p=r.aP(_d,this.tileID.canonical,this.tileTransform)[0],_=new r.aQ,v=new r.aR;for(let x=0;x<p.length;x++){let{x:E,y:C}=p[x];_.emplaceBack(E,C),v.emplaceBack(x)}v.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(v),this._tileDebugBuffer=o.createVertexBuffer(_,r.aS.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,_.length,v.length)}_makeTileBoundsBuffers(o,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;let p=r.aP(_d,this.tileID.canonical,this.tileTransform)[0],_,v;if(this.isRaster){let x=function(E,C){let A=r.av(E,C),R=Math.pow(2,E.z);for(let G=0;G<et;G++)for(let H=0;H<et;H++){let Z=r.aw((E.x+(H+Ti(H))/lt)/R),ne=r.ax((E.y+(G+Ti(G))/lt)/R),te=C.project(Z,ne),re=G*et+H;_n[2*re+0]=Math.round((te.x*A.scale-A.x)*r.Y),_n[2*re+1]=Math.round((te.y*A.scale-A.y)*r.Y)}xt.fill(0),ei.fill(0);for(let G=2045;G>=0;G--){let H=4*G,Z=Ut[H+0],ne=Ut[H+1],te=Ut[H+2],re=Ut[H+3],q=Z+te>>1,X=ne+re>>1,ce=q+X-ne,ae=X+Z-q,pe=ne*et+Z,Ee=re*et+te,fe=X*et+q,be=Math.hypot((_n[2*pe+0]+_n[2*Ee+0])/2-_n[2*fe+0],(_n[2*pe+1]+_n[2*Ee+1])/2-_n[2*fe+1])>=16;xt[fe]=xt[fe]||(be?1:0),G<1022&&(xt[fe]=xt[fe]||xt[(ne+ae>>1)*et+(Z+ce>>1)]||xt[(re+ae>>1)*et+(te+ce>>1)])}let O=new r.ay,N=new r.az,z=0;function U(G,H){let Z=H*et+G;return ei[Z]===0&&(O.emplaceBack(_n[2*Z+0],_n[2*Z+1],G*r.Y/lt,H*r.Y/lt),ei[Z]=++z),ei[Z]-1}function j(G,H,Z,ne,te,re){let q=G+Z>>1,X=H+ne>>1;if(Math.abs(G-te)+Math.abs(H-re)>1&&xt[X*et+q])j(te,re,G,H,q,X),j(Z,ne,te,re,q,X);else{let ce=U(G,H),ae=U(Z,ne),pe=U(te,re);N.emplaceBack(ce,ae,pe)}}return j(0,0,lt,lt,lt,0),j(lt,lt,0,0,0,lt),{vertices:O,indices:N}}(this.tileID.canonical,l);_=x.vertices,v=x.indices}else{_=new r.ay,v=new r.az;for(let{x:E,y:C}of p)_.emplaceBack(E,C,0,0);let x=r.aT(_.int16,void 0,4);for(let E=0;E<x.length;E+=3)v.emplaceBack(x[E],x[E+1],x[E+2])}this._tileBoundsBuffer=o.createVertexBuffer(_,r.aU.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(v),this._tileBoundsSegments=r.aE.simpleSegment(0,0,_.length,v.length)}_makeGlobeTileDebugBuffers(o,l){let p=l.projection;if(!p||p.name!=="globe"||l.freezeTileCoverage)return;let _=this.tileID.canonical,v=r.aV(_,l),x=r.aW(v),E=r.W(l.zoom),C;E>0&&(C=r.a9.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,_,l,x,C,E),this._makeGlobeTileDebugTextBuffer(o,_,l,x,C,E)}_globePoint(o,l,p,_,v,x,E){let C=r.aX(o,l,p);if(x){let A=1<<p.z,R=r.a8(_.center.lng),O=r.ah(_.center.lat),N=(p.x+.5)/A-R,z=0;N>.5?z=-1:N<-.5&&(z=1);let U=(o/r.Y+p.x)/A+z,j=(l/r.Y+p.y)/A;U=(U-R)*_._pixelsPerMercatorPixel+R,j=(j-O)*_._pixelsPerMercatorPixel+O;let G=[U*_.worldSize,j*_.worldSize,0];r.Q.transformMat4(G,G,x),C=r.aY(C,G,E)}return r.Q.transformMat4(C,C,v)}_makeGlobeTileDebugBorderBuffer(o,l,p,_,v,x){let E=new r.aQ,C=new r.aR,A=new r.aZ,R=(N,z,U,j,G)=>{let H=(U-N)/(G-1),Z=(j-z)/(G-1),ne=E.length;for(let te=0;te<G;te++){let re=N+te*H,q=z+te*Z;E.emplaceBack(re,q);let X=this._globePoint(re,q,l,p,_,v,x);A.emplaceBack(X[0],X[1],X[2]),C.emplaceBack(ne+te)}},O=r.Y;R(0,0,O,0,16),R(O,0,O,O,16),R(O,O,0,O,16),R(0,O,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(C),this._tileDebugBuffer=o.createVertexBuffer(E,r.aS.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(A,r.a_.members),this._tileDebugSegments=r.aE.simpleSegment(0,0,E.length,C.length)}_makeGlobeTileDebugTextBuffer(o,l,p,_,v,x){let E=r.Y/4,C=new r.aQ,A=new r.az,R=new r.aZ,O=25;A.reserve(32),C.reserve(O),R.reserve(O);let N=(z,U)=>O*z+U;for(let z=0;z<O;z++){let U=z*E;for(let j=0;j<O;j++){let G=j*E;C.emplaceBack(G,U);let H=this._globePoint(G,U,l,p,_,v,x);R.emplaceBack(H[0],H[1],H[2])}}for(let z=0;z<4;z++)for(let U=0;U<4;U++){let j=N(z,U),G=N(z,U+1),H=N(z+1,U),Z=N(z+1,U+1);A.emplaceBack(j,G,H),A.emplaceBack(H,G,Z)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(A),this._tileDebugTextBuffer=o.createVertexBuffer(C,r.aS.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(R,r.a_.members),this._tileDebugTextSegments=r.aE.simpleSegment(0,0,O,32)}destroy(o=!1){for(let l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!o&&this.texture&&this.texture instanceof r.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}let tt={vector:it,raster:rt,"raster-dem":class extends rt{constructor(f,o,l,p){super(f,o,l,p),this.type="raster-dem",this.maxzoom=22,this._options=r.e({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(f,o){let l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,v){_&&(f.state="errored",o(_)),v&&(f.dem=v,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",o(null))}f.request=r.d(this.map._requestManager.transformRequest(l,r.R.Tile),(function(_,v,x,E){if(delete f.request,f.aborted)f.state="unloaded",o(null);else if(_)f.state="errored",o(_);else if(v){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:x,expires:E});let C=ImageBitmap&&v instanceof ImageBitmap&&r.an(),A=1-(v.width-r.ao(v.width))/2;A<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));let R=C?v:r.f.getImageData(v,A),O={uid:f.uid,coord:f.tileID,source:this.id,scope:this.scope,rawImageData:R,encoding:this.encoding,padding:A};f.actor&&f.state!=="expired"||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",O,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(f){let o=f.canonical,l=Math.pow(2,o.z),p=(o.x-1+l)%l,_=o.x===0?f.wrap-1:f.wrap,v=(o.x+1+l)%l,x=o.x+1===l?f.wrap+1:f.wrap,E={};return E[new r.ap(f.overscaledZ,_,o.z,p,o.y).key]={backfilled:!1},E[new r.ap(f.overscaledZ,x,o.z,v,o.y).key]={backfilled:!1},o.y>0&&(E[new r.ap(f.overscaledZ,_,o.z,p,o.y-1).key]={backfilled:!1},E[new r.ap(f.overscaledZ,f.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},E[new r.ap(f.overscaledZ,x,o.z,v,o.y-1).key]={backfilled:!1}),o.y+1<l&&(E[new r.ap(f.overscaledZ,_,o.z,p,o.y+1).key]={backfilled:!1},E[new r.ap(f.overscaledZ,f.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},E[new r.ap(f.overscaledZ,x,o.z,v,o.y+1).key]={backfilled:!1}),E}},"raster-array":Je,geojson:class extends r.E{constructor(f,o,l,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=o.data,this._options=r.e({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let _=r.Y/this.tileSize;this.workerOptions=r.e({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*_,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*_,extent:r.Y,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.Y,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*_,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}updateData(f){return this._options.dynamic?(this._data=f,this._updateWorkerData(!0),this):this.fire(new r.a(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")))}getClusterExpansionZoom(f,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterChildren(f,o){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id,scope:this.scope},o),this}getClusterLeaves(f,o,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:f,limit:o,offset:l},p),this}_updateWorkerData(f=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.b("dataloading",{dataType:"source"})),this._loaded=!1;let o=r.e({append:f},this.workerOptions);o.scope=this.scope;let l=this._data;typeof l=="string"?(o.request=this.map._requestManager.transformRequest(r.f.resolveURL(l),r.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(p,_)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new r.a(p));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(v.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.b("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(f),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,o){let l=f.actor?"reloadTile":"loadTile";f.actor=this.actor;let p={type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};f.request=this.actor.send(l,p,(_,v)=>(delete f.request,f.destroy(),f.aborted?o(null):_?o(_):(f.loadVectorData(v,this.map.painter,l==="reloadTile"),o(null))),void 0,l==="loadTile")}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id,scope:this.scope}),f.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.as{constructor(f,o,l,p){super(f,o,l,p),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let f=this.options;this.urls=[];for(let o of f.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.R.Source).url);r.at(this.urls,(o,l)=>{this._loaded=!0,o?this.fire(new r.a(o)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){let o=this.video.seekable;f<o.start(0)||f>o.end(0)?this.fire(new r.a(new r.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let f=this.map.painter.context,o=f.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.T(f,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(f)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.as,model:class extends r.E{constructor(f,o,l,p){super(),this.id=f,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){let f=[];for(let o in this._options.models){let l=this._options.models[o],p=r.l(this.map._requestManager.transformRequest(l.uri,r.R.Model).url).then(_=>{if(!_)return;let v=r.c(_),x=new r.M(o,l.position,l.orientation,v);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(_=>{this.fire(new r.a(new Error(`Could not load model ${o} from ${l.uri}: ${_.message}`)))});f.push(p)}return Promise.allSettled(f).then(()=>{this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new r.a(new Error(`Could not load models: ${o.message}`)))})}onAdd(f){this.map=f,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(f,o){}serialize(){return{type:"model"}}},"batched-model":class extends r.E{constructor(f,o,l,p){super(),this.type="batched-model",this.id=f,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(f){this.map=f,this.load()}load(f){this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map._worldview;this._tileJSONRequest=Ke(this._options,this.map._requestManager,o,l,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new r.a(p))):_&&(r.e(this,_),_.bounds&&(this.tileBounds=new Xe(_.bounds,this.minzoom,this.maxzoom)),r.am(_.tiles,this.map._requestManager._customAccessToken),this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))),f&&f(p)})}hasTransition(){return!1}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}loaded(){return this._loaded}loadTile(f,o){let l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,r.R.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:f.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(f.actor&&f.state!=="expired")if(f.state==="loading")f.reloadCallback=o;else{if(f.buckets){let v=Object.values(f.buckets);for(let x of v)x.dirty=!0;return void(f.state="loaded")}f.request=f.actor.send("reloadTile",p,_.bind(this))}else f.actor=this.dispatcher.getActor(),f.request=f.actor.send("loadTile",p,_.bind(this),void 0,!0);function _(v,x){return f.aborted?o(null):v&&v.status!==404?o(v):(x&&(x.resourceTiming&&(f.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&f.setExpiryData(x),f.buckets=Yt(Yt({},f.buckets),x.buckets),x.featureIndex&&(f.latestFeatureIndex=x.featureIndex)),f.state="loaded",void o(null))}}serialize(){return r.e({},this._options)}},canvas:class extends r.as{constructor(f,o,l,p){super(f,o,l,p),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(v=>typeof v!="number"))||this.fire(new r.a(new r.V(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a(new r.V(`sources.${f}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.a(new r.V(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new r.a(new r.V(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a(new r.V(`sources.${f}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!f&&!this._playing||this.texture instanceof r.au||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.T(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}},custom:class extends r.E{constructor(f,o,l,p){super(),this.id=f,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=o,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Xe(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),r.e(this,r.af(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.af(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(f){this._map=f,this._loaded=!1,this.fire(new r.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(f),this.load()}onRemove(f){this._implementation.onRemove&&this._implementation.onRemove(f)}hasTile(f){if(this._implementation.hasTile){let{x:o,y:l,z:p}=f.canonical;return this._implementation.hasTile({x:o,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(f.canonical)}loadTile(f,o){let{x:l,y:p,z:_}=f.tileID.canonical,v=new AbortController;f.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:_},{signal:v.signal})).then((function(x){return delete f.request,f.aborted?(f.state="unloaded",o(null)):x===void 0?(f.state="errored",o(null)):x===null?(this.loadTileData(f,{width:this.tileSize,height:this.tileSize,data:null}),f.state="loaded",o(null)):function(E){return E instanceof ImageData||E instanceof HTMLCanvasElement||E instanceof ImageBitmap||E instanceof HTMLImageElement}(x)?(this.loadTileData(f,x),f.state="loaded",void o(null)):(f.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.code!==20&&(f.state="errored",o(x))}),f.request.cancel=()=>v.abort()}loadTileData(f,o){f.setTexture(o,this._map.painter)}unloadTile(f,o){if(f.texture&&f.texture instanceof r.T?(f.destroy(!0),f.texture&&f.texture instanceof r.T&&this._map.painter.saveTileTexture(f.texture)):f.destroy(),this._implementation.unloadTile){let{x:l,y:p,z:_}=f.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:_})}o()}abortTile(f,o){f.request&&f.request.cancel&&(f.request.cancel(),delete f.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(f=>({x:f.canonical.x,y:f.canonical.y,z:f.canonical.z}))}_clearTiles(){let f=r.aj(this.id,this.scope);this._map.style.clearSource(f)}_update(){this.fire(new r.b("data",{dataType:"source",sourceDataType:"content"}))}}},Pf=function(f,o,l,p){let _=new tt[o.type](f,o,l,p);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return r.a$(["load","abort","unload","serialize","prepare"],_),_};function Rf(f,o){let l=r.a9.identity([]);return r.a9.scale(l,l,[.5*f.width,.5*-f.height,1]),r.a9.translate(l,l,[1,-1,0]),r.a9.multiply(l,l,f.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(l)}function bn(f,o,l,p,_,v,x,E=!1){let C=f.tilesIn(p,x,E);C.sort(Eg);let A=[];for(let O of C)A.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,l,f._state,O,_,v,Rf(f.transform,O.tile.tileID),E)});let R=function(O){let N={},z={};for(let U of O){let j=U.queryResults,G=U.wrappedTileID,H=z[G]=z[G]||{};for(let Z in j){let ne=j[Z],te=H[Z]=H[Z]||{},re=N[Z]=N[Z]||[];for(let q of ne)te[q.featureIndex]||(te[q.featureIndex]=!0,re.push(q))}}return N}(A);for(let O in R)R[O].forEach(N=>{let z=N.feature,U=z.layer;U&&U.type!=="background"&&U.type!=="sky"&&U.type!=="slot"&&(z.source=U.source,U["source-layer"]&&(z.sourceLayer=U["source-layer"]),z.state=z.id!==void 0?f.getFeatureState(U["source-layer"],z.id):{})});return R}function Ur(f,o){let l=f.getRenderableIds().map(v=>f.getTileByID(v)),p=[],_={};for(let v=0;v<l.length;v++){let x=l[v],E=x.tileID.canonical.key;_[E]||(_[E]=!0,x.querySourceFeatures(p,o))}return p}function Eg(f,o){let l=f.tileID,p=o.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}class yd extends Bo{constructor(o,l,p,_,v){super(o,l,p,_,v),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(o,l){let p=l.context,_=p.gl;this.texture=this.texture||l.getTileTexture(o.width),this.texture&&this.texture instanceof r.T?this.texture.update(o,{useMipmap:!1,premultiply:!1}):this.texture=new r.T(p,o,_.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(o=16384,l){let p=this._mrt=new r.b0(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=r.b1(_,(v,x,E,C)=>{if(v)l(v);else try{let A=p.getHeaderLength(x);if(A>o)return void(this.request=this.fetchHeader(A,l));p.parseHeader(x),this._isHeaderLoaded=!0;let R=0;for(let O of Object.values(p.layers))R=Math.max(R,O.dataIndex[O.dataIndex.length-1].last_byte);x.byteLength>=R&&(this.entireBuffer=x),l(null,this.entireBuffer||x,E,C)}catch(A){l(A)}}),this.request}fetchBand(o,l,p){let _=this._mrt;if(!this._isHeaderLoaded||!_)return void p(new Error("Tile header is not ready"));let v=this.actor;if(!v)return void p(new Error("Can't fetch tile band without an actor"));let x,E=(O,N)=>{x.complete(O,N),O?p(O):(this.updateTextureDescriptor(o,l),p(null,this.textureDescriptor&&this.textureDescriptor.img))},C=(O,N)=>{if(O)return p(O);let z=v.send("decodeRasterArray",{buffer:N,task:x},E,void 0,!0);this._workQueue.push(()=>{z&&z.cancel(),x.cancel()})},A=_.getLayer(o);if(!A)return void p(new Error(`Unknown sourceLayer "${o}"`));if(A.hasDataForBand(l))return this.updateTextureDescriptor(o,l),void p(null,this.textureDescriptor?this.textureDescriptor.img:null);let R=A.getDataRange([l]);if(x=_.createDecodingTask(R),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)C(null,this.entireBuffer.slice(R.firstByte,R.lastByte+1));else{let O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${R.firstByte}-${R.lastByte}`}}),N=r.b1(O,C);this._fetchQueue.push(()=>{N.cancel(),x.cancel()})}else p(null)}updateNeeded(o,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==o)&&this.state!=="errored"}updateTextureDescriptor(o,l){if(!this._mrt)return;let p=this._mrt.getLayer(o);if(!p||!p.hasBand(l)||!p.hasDataForBand(l))return;let{bytes:_,tileSize:v,buffer:x,offset:E,scale:C}=p.getBandView(l),A=v+2*x,R={data:_,width:A,height:A},O=this.texture;O&&O instanceof r.T&&O.update(R,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:o,band:l,img:R,buffer:x,offset:E,tileSize:v,format:p.pixelFormat,mix:[C,256*C,65536*C,16777216*C]}}}class Tg{constructor(o,l){this.max=o,this.onRemove=l,this.reset()}reset(){for(let o in this.data)for(let l of this.data[o])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(o,l,p){let _=o.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);let v={value:l,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},p)),this.data[_].push(v),this.order.push(_),this.order.length>this.max){let x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){let l=this.data[o].shift();return l.timeout&&clearTimeout(l.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),l.value}getByKey(o){let l=this.data[o];return l?l[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,l){if(!this.has(o))return this;let p=o.wrapped().key,_=l===void 0?0:this.data[p].indexOf(l),v=this.data[p][_];return this.data[p].splice(_,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(o){let l=[];for(let p in this.data)for(let _ of this.data[p])o(_.value)||l.push(_);for(let p of l)this.remove(p.value.tileID,p)}}class Vo extends r.E{constructor(o,l,p){super(),this.id=o,this._onlySymbols=p,l.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Tg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new $i,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let o in this._tiles){let l=this._tiles[o];if(l.state!=="errored"&&(l.state!=="loaded"||!l.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,l){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,l)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o,()=>{})}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o,()=>{})}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let l in this._tiles){let p=this._tiles[l];p.upload(o),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return r.b2(this._tiles).map(o=>o.tileID).sort(hn).map(o=>o.key)}getRenderableIds(o,l){let p=[];for(let _ in this._tiles)this._isIdRenderable(+_,o,l)&&p.push(this._tiles[_]);return o?p.sort((_,v)=>{let x=_.tileID,E=v.tileID,C=new r.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),A=new r.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-E.overscaledZ||A.y-C.y||A.x-C.x}).map(_=>_.tileID.key):p.map(_=>_.tileID).sort(hn).map(_=>_.key)}hasRenderableParent(o){let l=this.findLoadedParent(o,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(o,l,p){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(l||!this._tiles[o].holdingForFade())&&(p||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,l){let p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=l),this._loadTile(p,this._tileLoaded.bind(this,p,o,l)))}_tileLoaded(o,l,p,_){if(_)if(o.state="errored",_.status!==404)this._source.fire(new r.a(_,{tile:o}));else{if(!(o.tileID.key in this._loadedParentTiles))return void this._source.fire(new r.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else o.timeAdded=r.f.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(l,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new r.b("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id}))}_backfillDEM(o){let l=this.getRenderableIds();for(let _=0;_<l.length;_++){let v=l[_];if(o.neighboringTiles&&o.neighboringTiles[v]){let x=this.getTileByID(v);p(o,x),p(x,o)}}function p(_,v){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let x=v.tileID.canonical.x-_.tileID.canonical.x,E=v.tileID.canonical.y-_.tileID.canonical.y,C=Math.pow(2,_.tileID.canonical.z),A=v.tileID.key;x===0&&E===0||Math.abs(E)>1||(Math.abs(x)>1&&(Math.abs(x+C)===1?x+=C:Math.abs(x-C)===1&&(x-=C)),v.dem&&_.dem&&(_.dem.backfillBorder(v.dem,x,E),_.neighboringTiles&&_.neighboringTiles[A]&&(_.neighboringTiles[A].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,l,p,_){for(let v in this._tiles){let x=this._tiles[v];if(_[v]||!x.hasData()||x.tileID.overscaledZ<=l||x.tileID.overscaledZ>p)continue;let E=x.tileID;for(;x&&x.tileID.overscaledZ>l+1;){let A=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[A.key],x&&x.hasData()&&(E=A)}let C=E;for(;C.overscaledZ>l;)if(C=C.scaledTo(C.overscaledZ-1),o[C.key]){_[E.key]=E;break}}}findLoadedParent(o,l){if(o.key in this._loadedParentTiles){let p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=l?p:null}for(let p=o.overscaledZ-1;p>=l;p--){let _=o.scaledTo(p),v=this._getLoadedTile(_);if(v)return v}}_getLoadedTile(o){let l=this._tiles[o.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,l){l=l||this._source.tileSize;let p=Math.ceil(o.width/l)+1,_=Math.ceil(o.height/l)+1,v=Math.floor(p*_*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(E)}handleWrapJump(o){let l=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,l){let p={};for(let _ in this._tiles){let v=this._tiles[_];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),p[v.tileID.key]=v}this._tiles=p;for(let _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(let _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(o,l,p,_){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;let v;if(this.updateCacheSize(o,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)v=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(C=>new r.ap(C.canonical.z,C.wrap,C.canonical.z,C.canonical.x,C.canonical.y));else if(this.tileCoverLift!==0){let C=o.clone();C.tileCoverLift=this.tileCoverLift,v=C.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&o.projection.name==="globe"&&(v.push(new r.ap(1,0,1,0,0)),v.push(new r.ap(1,0,1,1,0)),v.push(new r.ap(1,0,1,0,1)),v.push(new r.ap(1,0,1,1,1)))}else v=o.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(v=v.filter(C=>this._source.hasTile(C)));else v=[];if(v.length>0&&this.castsShadows&&_&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ic(this._source.type)){let C=o.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),A=Math.min(C,this._source.maxzoom),R=o.extendTileCoverForShadows(v,_,A);for(let O of R)this._shadowCasterTiles[O.key]=!0,v.push(O)}let x=this._updateRetainedTiles(v);if(Ic(this._source.type)&&v.length!==0){let C={},A={},R=Object.keys(x);for(let N of R){let z=x[N],U=this._tiles[N];if(!U||U.fadeEndTime&&U.fadeEndTime<=r.f.now())continue;let j=this.findLoadedParent(z,Math.max(z.overscaledZ-Vo.maxOverzooming,this._source.minzoom));j&&(this._addTile(j.tileID),C[j.tileID.key]=j.tileID),A[N]=z}let O=v[v.length-1].overscaledZ;for(let N in this._tiles){let z=this._tiles[N];if(x[N]||!z.hasData())continue;let U=z.tileID;for(;U.overscaledZ>O;){U=U.scaledTo(U.overscaledZ-1);let j=this._tiles[U.key];if(j&&j.hasData()&&A[U.key]){x[N]=z.tileID;break}}}for(let N in C)x[N]||(this._coveredTiles[N]=!0,x[N]=C[N])}for(let C in x)this._tiles[C].clearFadeHold();let E=r.b3(this._tiles,x);for(let C of E){let A=this._tiles[C];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(+C)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){let l={};if(o.length===0)return l;let p={},_=o.reduce((A,R)=>Math.min(A,R.overscaledZ),1/0),v=o[0].overscaledZ,x=Math.max(v-Vo.maxOverzooming,this._source.minzoom),E=Math.max(v+Vo.maxUnderzooming,this._source.minzoom),C={};for(let A of o){let R=this._addTile(A);l[A.key]=A,R.hasData()||_<this._source.maxzoom&&(C[A.key]=A)}this._retainLoadedChildren(C,_,E,l);for(let A of o){let R=this._tiles[A.key];if(R.hasData())continue;if(A.canonical.z>=this._source.maxzoom){let N=A.children(this._source.maxzoom)[0],z=this.getTile(N);if(z&&z.hasData()){l[N.key]=N;continue}}else{let N=A.children(this._source.maxzoom);if(l[N[0].key]&&l[N[1].key]&&l[N[2].key]&&l[N[3].key])continue}let O=R.wasRequested();for(let N=A.overscaledZ-1;N>=x;--N){let z=A.scaledTo(N);if(p[z.key]||(p[z.key]=!0,R=this.getTile(z),!R&&O&&(R=this._addTile(z)),R&&(l[z.key]=z,O=R.wasRequested(),R.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let o in this._tiles){let l=[],p,_=this._tiles[o].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){p=this._loadedParentTiles[_.key];break}l.push(_.key);let v=_.scaledTo(_.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;_=v}for(let v of l)this._loadedParentTiles[v]=p}}_addTile(o){let l=this._tiles[o.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),l;l=this._cache.getAndRemove(o),l&&(this._setTileReloadTimer(o.key,l),l.tileID=o,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,l)));let p=!!l;if(!p){let _=this.map?this.map.painter:null,v=this._source.tileSize*o.overscaleFactor();l=this._source.type==="raster-array"?new yd(o,v,this.transform.tileZoom,_,this._isRaster):new Bo(o,v,this.transform.tileZoom,_,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,o.key,l.state))}return l?(l.uses++,this._tiles[o.key]=l,p||this._source.fire(new r.b("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(o,l){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);let p=l.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){let l=this._tiles[o];l&&(l.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,l,p){let _=[],v=this.transform;if(!v)return _;let x=v.projection.name==="globe",E=r.a8(v.center.lng);for(let C in this._tiles){let A=this._tiles[C];if(p&&A.clearQueryDebugViz(),A.holdingForFade())continue;let R;if(x){let O=A.tileID.canonical;if(O.z===0){let N=[Math.abs(r.ad(E,...Cs(O,-1))-E),Math.abs(r.ad(E,...Cs(O,1))-E)];R=[0,2*N.indexOf(Math.min(...N))-1]}else{let N=[Math.abs(r.ad(E,...Cs(O,-1))-E),Math.abs(r.ad(E,...Cs(O,0))-E),Math.abs(r.ad(E,...Cs(O,1))-E)];R=[N.indexOf(Math.min(...N))-1]}}else R=[0];for(let O of R){let N=o.containsTile(A,v,l,O);N&&_.push(N)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,l){let p=this.getRenderableIds(o,l).map(v=>this._tiles[v].tileID),_=this.transform.projection.name==="globe";for(let v of p)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=_?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return p}sortCoordinatesByDistance(o){let l=o.slice(),p=this.transform._camera.position,_=this.transform._camera.forward(),v={};for(let x of l){let E=1/(1<<x.canonical.z);v[x.key]=((x.canonical.x+.5)*E+x.wrap-p[0])*_[0]+((x.canonical.y+.5)*E-p[1])*_[1]-p[2]*_[2]}return l.sort((x,E)=>v[x.key]-v[E.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Ic(this._source.type))for(let o in this._tiles){let l=this._tiles[o];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=r.f.now())return!0}return!1}setFeatureState(o,l,p){this._state.updateState(o=o||"_geojsonTileLayer",l,p)}removeFeatureState(o,l,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",l,p)}getFeatureState(o,l){return this._state.getState(o=o||"_geojsonTileLayer",l)}setDependencies(o,l,p){let _=this._tiles[o];_&&_.setDependencies(l,p)}reloadTilesForDependencies(o,l){for(let p in this._tiles)this._tiles[p].hasDependency(o,l)&&this._reloadTile(+p,"reloading");this._cache.filter(p=>!p.hasDependency(o,l))}_preloadTiles(o,l){if(!this._sourceLoaded){let C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(o,l))};return void this._source.on("data",C)}let p=new Map,_=Array.isArray(o)?o:[o],v=this.map.painter.terrain,x=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(let C of _){let A=C.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let R of A)p.set(R.key,R);this.usedForTerrain&&C.updateElevation(!1)}let E=Array.from(p.values());r.b4(E,(C,A)=>{let R=new Bo(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,O=>{this._source.type==="raster-dem"&&R.dem&&this._backfillDEM(R),A(O,R)})},l)}}function hn(f,o){let l=Math.abs(2*f.wrap)-+(f.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return f.overscaledZ-o.overscaledZ||p-l||o.canonical.y-f.canonical.y||o.canonical.x-f.canonical.x}function Ic(f){return f==="raster"||f==="image"||f==="video"||f==="custom"}function Cs(f,o){let l=1<<f.z;return[f.x/l+o,(f.x+1)/l+o]}Vo.maxOverzooming=10,Vo.maxUnderzooming=3;class kf{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];let o=!1,l=!1;for(let p in this.style._mergedLayers){let _=this.style._mergedLayers[p];if(_.type==="fill-extrusion")this.layers.push({layer:_,visible:o,visibilityChanged:l});else if(_.type==="model"){let v=this.style.getLayerSource(_);v&&v.type==="batched-model"&&this.layers.push({layer:_,visible:o,visibilityChanged:l})}}}onNewFrame(o){this.layersGotHidden=!1;for(let l of this.layers){let p=l.layer,_=!1;p.type==="fill-extrusion"?_=!p.isHidden(o)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="model"&&(_=!p.isHidden(o)&&p.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!_&&l.visible,l.visible=_}}updateZOffset(o,l){this.currentBuildingBuckets=[];for(let _ of this.layers){let v=_.layer,x=this.style.getLayerSourceCache(v),E=1;v.type==="fill-extrusion"&&(E=_.visible?v.paint.get("fill-extrusion-vertical-scale"):0);let C=x?x.getTile(l):null;if(!C&&x&&l.canonical.z>x.getSource().minzoom){let A=l.scaledTo(Math.min(x.getSource().maxzoom,l.overscaledZ-1));for(;A.overscaledZ>=x.getSource().minzoom&&(C=x.getTile(A),!C&&A.overscaledZ!==0);)A=A.scaledTo(A.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(v):null,tileID:C?C.tileID:l,verticalScale:E})}o.hasAnyZOffset=!1;let p=!1;for(let _=0;_<o.symbolInstances.length;_++){let v=o.symbolInstances.get(_),x=v.zOffset,E=this._getHeightAtTileOffset(l,v.tileAnchorX,v.tileAnchorY);v.zOffset=E!==Number.NEGATIVE_INFINITY?E:x,p||x===v.zOffset||(p=!0),o.hasAnyZOffset||v.zOffset===0||(o.hasAnyZOffset=!0)}p&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,l,p,_){let v=l,x=p;if(o.canonical.z!==_.canonical.z){let E=_.canonical,C=1/(1<<o.canonical.z-E.z);v=(l+o.canonical.x*r.Y)*C-E.x*r.Y|0,x=(p+o.canonical.y*r.Y)*C-E.y*r.Y|0}return{tileX:v,tileY:x}}_getHeightAtTileOffset(o,l,p){let _,v;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;let{bucket:E,tileID:C,verticalScale:A}=this.currentBuildingBuckets[x];if(!E)continue;let{tileX:R,tileY:O}=this._mapCoordToOverlappingTile(o,l,p,C),N=E.getHeightAtTileCoord(R,O);N&&N.height!==void 0&&(N.hidden?_=N.height:v=Math.max(N.height*A,v||0))}if(v!==void 0)return v;for(let x=0;x<this.layers.length;++x){let E=this.layers[x];if(E.layer.type!=="model"||!E.visible)continue;let{bucket:C,tileID:A}=this.currentBuildingBuckets[x];if(!C)continue;let{tileX:R,tileY:O}=this._mapCoordToOverlappingTile(o,l,p,A),N=C.getHeightAtTileCoord(R,O);if(N&&!N.hidden)return N.height===void 0&&_!==void 0?Math.min(N.maxHeight,_)*N.verticalScale:N.height?N.height*N.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Eo(f,o){let l={};for(let p in f)p!=="ref"&&(l[p]=f[p]);return r.b5.forEach(p=>{p in o&&(l[p]=o[p])}),l}function Dg(f){f=f.slice();let o=Object.create(null);for(let l=0;l<f.length;l++)o[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=Eo(f[l],o[f[l].ref]));return f}let Sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function vd(f,o,l){l.push({command:Sn.addSource,args:[f,o[f]]})}function Of(f,o,l){o.push({command:Sn.removeSource,args:[f]}),l[f]=!0}function Ig(f,o,l,p){Of(f,l,p),vd(f,o,l)}function Ff(f,o,l){let p;for(p in f[l])if(f[l].hasOwnProperty(p)&&p!=="data"&&!T(f[l][p],o[l][p]))return!1;for(p in o[l])if(o[l].hasOwnProperty(p)&&p!=="data"&&!T(f[l][p],o[l][p]))return!1;return!0}function Ra(f,o,l,p,_,v){let x;for(x in o=o||{},f=f||{})f.hasOwnProperty(x)&&(T(f[x],o[x])||l.push({command:v,args:[p,x,o[x],_]}));for(x in o)o.hasOwnProperty(x)&&!f.hasOwnProperty(x)&&(T(f[x],o[x])||l.push({command:v,args:[p,x,o[x],_]}))}function pl(f){return f.id}function Cc(f,o){return f[o.id]=o,f}class Ss{constructor(o,l){this.reset(o,l)}reset(o,l){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.ad(o,0,1);let l=1,p=this._distances[l],_=o*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];let v=l-1,x=this._distances[v],E=p-x,C=E>0?(_-x)/E:0;return this.points[v].mult(1-C).add(this.points[l].mult(C))}}class Lf{constructor(o,l,p){let _=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(l/p);for(let x=0;x<this.xCellCount*this.yCellCount;x++)_.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=l,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,l,p,_,v){this._forEachCell(l,p,_,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(v)}insertCircle(o,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(o,l,p,_,v,x){this.boxCells[v].push(x)}_insertCircleCell(o,l,p,_,v,x){this.circleCells[v].push(x)}_query(o,l,p,_,v,x){if(p<0||o>this.width||_<0||l>this.height)return!v&&[];let E=[];if(o<=0&&l<=0&&this.width<=p&&this.height<=_){if(v)return!0;for(let C=0;C<this.boxKeys.length;C++)E.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){let A=this.circles[3*C],R=this.circles[3*C+1],O=this.circles[3*C+2];E.push({key:this.circleKeys[C],x1:A-O,y1:R-O,x2:A+O,y2:R+O})}return x?E.filter(x):E}return this._forEachCell(o,l,p,_,this._queryCell,E,{hitTest:v,seenUids:{box:{},circle:{}}},x),v?E.length>0:E}_queryCircle(o,l,p,_,v){let x=o-p,E=o+p,C=l-p,A=l+p;if(E<0||x>this.width||A<0||C>this.height)return!_&&[];let R=[];return this._forEachCell(x,C,E,A,this._queryCellCircle,R,{hitTest:_,circle:{x:o,y:l,radius:p},seenUids:{box:{},circle:{}}},v),_?R.length>0:R}query(o,l,p,_,v){return this._query(o,l,p,_,!1,v)}hitTest(o,l,p,_,v){return this._query(o,l,p,_,!0,v)}hitTestCircle(o,l,p,_){return this._queryCircle(o,l,p,!0,_)}_queryCell(o,l,p,_,v,x,E,C){let A=E.seenUids,R=this.boxCells[v];if(R!==null){let N=this.bboxes;for(let z of R)if(!A.box[z]){A.box[z]=!0;let U=4*z;if(o<=N[U+2]&&l<=N[U+3]&&p>=N[U+0]&&_>=N[U+1]&&(!C||C(this.boxKeys[z]))){if(E.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[z],x1:N[U],y1:N[U+1],x2:N[U+2],y2:N[U+3]})}}}let O=this.circleCells[v];if(O!==null){let N=this.circles;for(let z of O)if(!A.circle[z]){A.circle[z]=!0;let U=3*z;if(this._circleAndRectCollide(N[U],N[U+1],N[U+2],o,l,p,_)&&(!C||C(this.circleKeys[z]))){if(E.hitTest)return x.push(!0),!0;{let j=N[U],G=N[U+1],H=N[U+2];x.push({key:this.circleKeys[z],x1:j-H,y1:G-H,x2:j+H,y2:G+H})}}}}}_queryCellCircle(o,l,p,_,v,x,E,C){let A=E.circle,R=E.seenUids,O=this.boxCells[v];if(O!==null){let z=this.bboxes;for(let U of O)if(!R.box[U]){R.box[U]=!0;let j=4*U;if(this._circleAndRectCollide(A.x,A.y,A.radius,z[j+0],z[j+1],z[j+2],z[j+3])&&(!C||C(this.boxKeys[U])))return x.push(!0),!0}}let N=this.circleCells[v];if(N!==null){let z=this.circles;for(let U of N)if(!R.circle[U]){R.circle[U]=!0;let j=3*U;if(this._circlesCollide(z[j],z[j+1],z[j+2],A.x,A.y,A.radius)&&(!C||C(this.circleKeys[U])))return x.push(!0),!0}}}_forEachCell(o,l,p,_,v,x,E,C){let A=this._convertToXCellCoord(o),R=this._convertToYCellCoord(l),O=this._convertToXCellCoord(p),N=this._convertToYCellCoord(_);for(let z=A;z<=O;z++)for(let U=R;U<=N;U++)if(v.call(this,o,l,p,_,this.xCellCount*U+z,x,E,C))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,l,p,_,v,x){let E=_-o,C=v-l,A=p+x;return A*A>E*E+C*C}_circleAndRectCollide(o,l,p,_,v,x,E){let C=(x-_)/2,A=Math.abs(o-(_+C));if(A>C+p)return!1;let R=(E-v)/2,O=Math.abs(l-(v+R));if(O>R+p)return!1;if(A<=C||O<=R)return!0;let N=A-C,z=O-R;return N*N+z*z<=p*p}}let Ii={unknown:0,flipRequired:1,flipNotRequired:2},ea=Math.tan(85*Math.PI/180);function Sc(f,o,l,p,_,v,x){let E=r.a9.create();if(l)if(v.name==="globe"){let C=r.b6(_,o);r.a9.multiply(E,E,C)}else{let C=r.b7.invert([],x);E[0]=C[0],E[1]=C[1],E[4]=C[2],E[5]=C[3],p||r.a9.rotateZ(E,E,_.angle)}else r.a9.multiply(E,_.labelPlaneMatrix,f);return E}function Mc(f,o,l,p,_,v,x){let E=Sc(f,o,l,p,_,v,x);return v.name==="globe"&&l||(E[2]=E[6]=E[10]=E[14]=0),E}function Ms(f,o,l,p,_,v,x){if(l){if(v.name==="globe"){let E=Sc(f,o,l,p,_,v,x);return r.a9.invert(E,E),r.a9.multiply(E,f,E),E}{let E=r.a9.clone(f),C=r.a9.identity([]);return C[0]=x[0],C[1]=x[1],C[4]=x[2],C[5]=x[3],r.a9.multiply(E,E,C),p||r.a9.rotateZ(E,E,-_.angle),E}}return _.glCoordMatrix}function co(f,o,l,p){let _=[f,o,l,1];l?r.aa.transformMat4(_,_,p):zf(_,_,p);let v=_[3];return _[0]/=v,_[1]/=v,_[2]/=v,_}function bd(f,o){return Math.min(.5+f/o*.5,1.5)}function xd(f,o){let l=f[0]/f[3],p=f[1]/f[3];return l>=-o[0]&&l<=o[0]&&p>=-o[1]&&p<=o[1]}function wd(f,o,l,p,_,v,x,E,C,A){let R=l.transform,O=p?f.textSizeData:f.iconSizeData,N=r.b8(O,l.transform.zoom),z=R.projection.name==="globe",U=[256/l.width*2+1,256/l.height*2+1],j=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;j.clear();let G=null;z&&(G=p?f.text.globeExtVertexArray:f.icon.globeExtVertexArray);let H=f.lineVertexArray,Z=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ne=l.transform.width/l.transform.height,te,re=!1;for(let q=0;q<Z.length;q++){let X=Z.get(q),{numGlyphs:ce,writingMode:ae}=X;if(ae!==r.b9.vertical||re||te===r.b9.horizontal||(re=!0),te=ae,(X.hidden||ae===r.b9.vertical)&&!re){Oa(ce,j);continue}re=!1;let pe=new r.P(X.tileAnchorX,X.tileAnchorY),{x:Ee,y:fe,z:be}=R.projection.projectTilePoint(pe.x,pe.y,A.canonical);if(C){let[ot,pt,wt]=C(pe);Ee+=ot,fe+=pt,be+=wt}let De=[Ee,fe,be,1];if(r.aa.transformMat4(De,De,o),!xd(De,U)){Oa(ce,j);continue}let he=De[3],ye=bd(l.transform.getCameraToCenterDistance(R.projection),he),Ve=r.ba(O,N,X),ge=x?Ve/ye:Ve*ye,we=co(Ee,fe,be,_);if(we[3]<=0){Oa(ce,j);continue}let Te={},ie=x?null:C,Re=ml(X,ge,!1,E,o,_,v,f.glyphOffsetArray,H,j,G,we,pe,Te,ne,ie,R.projection,A,x);re=Re.useVertical,ie&&Re.needsFlipping&&(Te={}),(Re.notEnoughRoom||re||Re.needsFlipping&&ml(X,ge,!0,E,o,_,v,f.glyphOffsetArray,H,j,G,we,pe,Te,ne,ie,R.projection,A,x).notEnoughRoom)&&Oa(ce,j)}p?(f.text.dynamicLayoutVertexBuffer.updateData(j),G&&f.text.globeExtVertexBuffer&&f.text.globeExtVertexBuffer.updateData(G)):(f.icon.dynamicLayoutVertexBuffer.updateData(j),G&&f.icon.globeExtVertexBuffer&&f.icon.globeExtVertexBuffer.updateData(G))}function Ac(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j){let{lineStartIndex:G,glyphStartIndex:H,segment:Z}=E,ne=H+E.numGlyphs,te=G+E.lineLength,re=o.getoffsetX(H),q=o.getoffsetX(ne-1),X=ka(f*re,l,p,_,v,x,Z,G,te,C,A,R,O,N,!0,z,U,j);if(!X)return null;let ce=ka(f*q,l,p,_,v,x,Z,G,te,C,A,R,O,N,!0,z,U,j);return ce?{first:X,last:ce}:null}function ta(f,o,l,p){return f===r.b9.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:f===r.b9.vertical?p>0?{needsFlipping:!0}:null:o!==Ii.unknown&&function(_,v){return _===0||Math.abs(v/_)>ea}(l,p)?o===Ii.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function ml(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G,H,Z){let ne=o/24,te=f.lineOffsetX*ne,re=f.lineOffsetY*ne,{lineStartIndex:q,glyphStartIndex:X,numGlyphs:ce,segment:ae,writingMode:pe,flipState:Ee}=f,fe=q+f.lineLength,be=De=>{if(R){let[ge,we,Te]=De.up,ie=A.length;r.bb(R,ie+0,ge,we,Te),r.bb(R,ie+1,ge,we,Te),r.bb(R,ie+2,ge,we,Te),r.bb(R,ie+3,ge,we,Te)}let[he,ye,Ve]=De.point;r.bc(A,he,ye,Ve,De.angle)};if(ce>1){let De=Ac(ne,E,te,re,l,O,N,f,C,v,z,j,!1,G,H,Z);if(!De)return{notEnoughRoom:!0};if(p&&!l){let[he,ye,Ve]=De.first.point,[ge,we,Te]=De.last.point;[he,ye]=co(he,ye,Ve,x),[ge,we]=co(ge,we,Te,x);let ie=ta(pe,Ee,(ge-he)*U,we-ye);if(f.flipState=ie&&ie.needsFlipping?Ii.flipRequired:Ii.flipNotRequired,ie)return ie}be(De.first);for(let he=X+1;he<X+ce-1;he++){let ye=ka(ne*E.getoffsetX(he),te,re,l,O,N,ae,q,fe,C,v,z,j,!1,!1,G,H,Z);if(!ye)return A.length-=4*(he-X),{notEnoughRoom:!0};be(ye)}be(De.last)}else{if(p&&!l){let he=co(N.x,N.y,0,_),ye=q+ae+1,Ve=new r.P(C.getx(ye),C.gety(ye)),ge=co(Ve.x,Ve.y,0,_),we=ge[3]>0?ge:Nf(N,Ve,he,1,_,void 0,G,H.canonical),Te=ta(pe,Ee,(we[0]-he[0])*U,we[1]-he[1]);if(f.flipState=Te&&Te.needsFlipping?Ii.flipRequired:Ii.flipNotRequired,Te)return Te}let De=ka(ne*E.getoffsetX(X),te,re,l,O,N,ae,q,fe,C,v,z,j,!1,!1,G,H,Z);if(!De)return{notEnoughRoom:!0};be(De)}return{}}function Ed(f,o,l,p,_){let{x:v,y:x,z:E}=p.projectTilePoint(f.x,f.y,o);if(!_)return co(v,x,E,l);let[C,A,R]=_(f);return co(v+C,x+A,E+R,l)}function Nf(f,o,l,p,_,v,x,E){let C=Ed(f.sub(o)._unit()._add(f),E,_,x,v);return r.Q.sub(C,l,C),r.Q.normalize(C,C),r.Q.scaleAndAdd(C,l,C,p)}function ka(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G,H){let Z=p?f-o:f+o,ne=Z>0?1:-1,te=0;p&&(ne*=-1,te=Math.PI),ne<0&&(te+=Math.PI);let re=E+x+(ne>0?0:1)|0,q=_,X=_,ce=0,ae=0,pe=Math.abs(Z),Ee=[],fe=[],be=v,De=be,he=()=>Nf(De,be,X,pe-ce+1,R,N,j,G.canonical);for(;ce+ae<=pe;){if(re+=ne,re<E||re>=C)return null;if(X=q,De=be,Ee.push(X),z&&fe.push(De),be=new r.P(A.getx(re),A.gety(re)),q=O[re],!q){let pt=Ed(be,G.canonical,R,j,N);q=pt[3]>0?O[re]=pt:he()}ce+=ae,ae=r.Q.distance(X,q)}U&&N&&(O[re]&&(q=he(),ae=r.Q.distance(X,q)),O[re]=q);let ye=(pe-ce)/ae,Ve=be.sub(De)._mult(ye)._add(De),ge=r.Q.sub([],q,X),we=r.Q.scaleAndAdd([],X,ge,ye),Te=[0,0,1],ie=ge[0],Re=ge[1];if(H&&(Te=j.upVector(G.canonical,Ve.x,Ve.y),Te[0]!==0||Te[1]!==0||Te[2]!==1)){let pt=[Te[2],0,-Te[0]],wt=r.Q.cross([],Te,pt);r.Q.normalize(pt,pt),r.Q.normalize(wt,wt),ie=r.Q.dot(ge,pt),Re=r.Q.dot(ge,wt)}if(l){let pt=r.Q.cross([],Te,ge);r.Q.normalize(pt,pt),r.Q.scaleAndAdd(we,we,pt,l*ne)}let ot=te+Math.atan2(Re,ie);return Ee.push(we),z&&fe.push(Ve),{point:we,angle:ot,path:Ee,tilePath:fe,up:Te}}function Oa(f,o){let l=o.length,p=l+4*f;o.resize(p),o.float32.fill(-1/0,4*l,4*p)}function zf(f,o,l){let p=o[0],_=o[1];return f[0]=l[0]*p+l[4]*_+l[12],f[1]=l[1]*p+l[5]*_+l[13],f[3]=l[3]*p+l[7]*_+l[15],f}let jo=100;class Cg{constructor(o,l,p=new Lf(o.width+200,o.height+200,25),_=new Lf(o.width+200,o.height+200,25)){this.transform=o,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+jo,this.screenBottomBoundary=o.height+jo,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=l}placeCollisionBox(o,l,p,_,v,x,E,C){let A=p.projectedAnchorX,R=p.projectedAnchorY,O=p.projectedAnchorZ,N=p.elevation,z=p.tileID,U=o.getProjection();if(N&&z){let[q,X,ce]=U.upVector(z.canonical,p.tileAnchorX,p.tileAnchorY),ae=U.upVectorScale(z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;A+=q*N*ae,R+=X*N*ae,O+=ce*N*ae}let j=this.projectAndGetPerspectiveRatio(E,A,R,O,p.tileID,U.name==="globe"||!!N||this.transform.pitch>0,U),G=x*j.perspectiveRatio,H=(p.x1*l+_.x-p.padding)*G+j.point.x,Z=(p.y1*l+_.y-p.padding)*G+j.point.y,ne=(p.x2*l+_.x+p.padding)*G+j.point.x,te=(p.y2*l+_.y+p.padding)*G+j.point.y,re=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(H,Z,ne,te)||!v&&this.grid.hitTest(H,Z,ne,te,C)||re?{box:[],offscreen:!1,occluded:j.occluded}:{box:[H,Z,ne,te],offscreen:this.isOffscreen(H,Z,ne,te),occluded:!1}}placeCollisionCircles(o,l,p,_,v,x,E,C,A,R,O,N,z,U,j){let G=[],H=this.transform.elevation,Z=o.getProjection(),ne=H?H.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,Z):null,te=new r.P(p.tileAnchorX,p.tileAnchorY),{x:re,y:q,z:X}=Z.projectTilePoint(te.x,te.y,j.canonical);if(ne){let[Ve,ge,we]=ne(te);re+=Ve,q+=ge,X+=we}let ce=Z.name==="globe",ae=this.projectAndGetPerspectiveRatio(E,re,q,X,j,ce||!!H||this.transform.pitch>0,Z),{perspectiveRatio:pe}=ae,Ee=(O?x/pe:x*pe)/r.bf,fe=co(re,q,X,C),be=ae.signedDistanceFromCamera>0?Ac(Ee,v,p.lineOffsetX*Ee,p.lineOffsetY*Ee,!1,fe,te,p,_,C,{},H&&!O?ne:null,O&&!!H,Z,j,O):null,De=!1,he=!1,ye=!0;if(be&&!ae.occluded){let Ve=.5*z*pe+U,ge=new r.P(-100,-100),we=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Te=new Ss,{first:ie,last:Re}=be,ot=ie.path.length,pt=[];for(let It=ot-1;It>=1;It--)pt.push(ie.path[It]);for(let It=1;It<Re.path.length;It++)pt.push(Re.path[It]);let wt=2.5*Ve;A&&(pt=pt.map(([It,fn,$t],yn)=>(ne&&!ce&&($t=ne(yn<ot-1?ie.tilePath[ot-1-yn]:Re.tilePath[yn-ot+2])[2]),co(It,fn,$t,A))),pt.some(It=>It[3]<=0)&&(pt=[]));let yt=[];if(pt.length>0){let It=1/0,fn=-1/0,$t=1/0,yn=-1/0;for(let pn of pt)It=Math.min(It,pn[0]),$t=Math.min($t,pn[1]),fn=Math.max(fn,pn[0]),yn=Math.max(yn,pn[1]);fn>=ge.x&&It<=we.x&&yn>=ge.y&&$t<=we.y&&(yt=[pt.map(pn=>new r.P(pn[0],pn[1]))],(It<ge.x||fn>we.x||$t<ge.y||yn>we.y)&&(yt=r.bd(yt,ge.x,ge.y,we.x,we.y)))}for(let It of yt){Te.reset(It,.25*Ve);let fn=0;fn=Te.length<=.5*Ve?1:Math.ceil(Te.paddedLength/wt)+1;for(let $t=0;$t<fn;$t++){let yn=$t/Math.max(fn-1,1),pn=Te.lerp(yn),mi=pn.x+jo,Vn=pn.y+jo;G.push(mi,Vn,Ve,0);let Yi=mi-Ve,Bi=Vn-Ve,ni=mi+Ve,Gn=Vn+Ve;if(ye=ye&&this.isOffscreen(Yi,Bi,ni,Gn),he=he||this.isInsideGrid(Yi,Bi,ni,Gn),!l&&this.grid.hitTestCircle(mi,Vn,Ve,N)&&(De=!0,!R))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!R&&De||!he?[]:G,offscreen:ye,collisionDetected:De,occluded:ae.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let l=[],p=1/0,_=1/0,v=-1/0,x=-1/0;for(let R of o){let O=new r.P(R.x+jo,R.y+jo);p=Math.min(p,O.x),_=Math.min(_,O.y),v=Math.max(v,O.x),x=Math.max(x,O.y),l.push(O)}let E=this.grid.query(p,_,v,x).concat(this.ignoredGrid.query(p,_,v,x)),C={},A={};for(let R of E){let O=R.key;if(C[O.bucketInstanceId]===void 0&&(C[O.bucketInstanceId]={}),C[O.bucketInstanceId][O.featureIndex])continue;let N=[new r.P(R.x1,R.y1),new r.P(R.x2,R.y1),new r.P(R.x2,R.y2),new r.P(R.x1,R.y2)];r.be(l,N)&&(C[O.bucketInstanceId][O.featureIndex]=!0,A[O.bucketInstanceId]===void 0&&(A[O.bucketInstanceId]=[]),A[O.bucketInstanceId].push(O.featureIndex))}return A}insertCollisionBox(o,l,p,_,v){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:v},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,l,p,_,v){let x=l?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:_,collisionGroupID:v};for(let C=0;C<o.length;C+=4)x.insertCircle(E,o[C],o[C+1],o[C+2])}projectAndGetPerspectiveRatio(o,l,p,_,v,x,E){let C=[l,p,_,1],A=!1;_||this.transform.pitch>0?(r.aa.transformMat4(C,C,o),this.fogState&&v&&E.name!=="globe"&&(A=function(N,z,U,j,G,H){let Z=H.calculateFogTileMatrix(G),ne=[z,U,j];return r.Q.transformMat4(ne,ne,Z),On(N,r.Q.length(ne),H.pitch,H._fov)}(this.fogState,l,p,_,v.toUnwrapped(),this.transform)>.9)):zf(C,C,o);let R=C[3];return{point:new r.P((C[0]/R+1)/2*this.transform.width+jo,(-C[1]/R+1)/2*this.transform.height+jo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(E)/R*.5,1.5),signedDistanceFromCamera:R,occluded:x&&C[2]>R||A}}isOffscreen(o,l,p,_){return p<jo||o>=this.screenRightBoundary||_<jo||l>this.screenBottomBoundary}isInsideGrid(o,l,p,_){return p>=0&&o<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){let o=r.a9.identity([]);return r.a9.translate(o,o,[-100,-100,0]),o}}function Td(f,o,l){let p=o.createTileMatrix(f,f.worldSize,l.toUnwrapped());return r.a9.multiply(new Float32Array(16),f.projMatrix,p)}function ns(f,o,l){if(o.projection.name===l.projection.name)return f.projMatrix;let p=l.clone();return p.setProjection(o.projection),Td(p,o.getProjection(),f)}function Dd(f,o,l){return o.name===l.projection.name?f.projMatrix:Td(l,o,f)}class Id{constructor(o,l,p,_){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class gl{constructor(o,l,p,_,v,x=!1){this.text=new Id(o?o.text:null,l,p,v),this.icon=new Id(o?o.icon:null,l,_,v),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cd{constructor(o,l,p,_=!1){this.text=o,this.icon=l,this.skipFade=p,this.clipped=_}}class Sg{constructor(){this.invProjMatrix=r.a9.create(),this.viewportMatrix=r.a9.create(),this.circles=[]}}class As{constructor(o,l,p,_,v){this.bucketInstanceId=o,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=v}}class Sd{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let l=++this.maxGroupID;this.collisionGroups[o]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[o]}}function Bf(f,o,l,p,_){let{horizontalAlign:v,verticalAlign:x}=r.bi(f),E=-(v-.5)*o,C=-(x-.5)*l,A=r.bh(f,p);return new r.P(E+A[0]*_,C+A[1]*_)}function _l(f,o,l,p,_){let v=new r.P(f,o);return l&&v._rotate(p?_:-_),v}class Vf{constructor(o,l,p,_,v,x){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Cg(this.transform,v),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Sd(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,l,p,_){let v=p.getBucket(l),x=p.latestFeatureIndex;if(!v||!x||l.fqid!==v.layerIds[0])return;let E=v.layers[0].layout,C=p.collisionBoxArray,A=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),R=p.tileSize/r.Y,O=p.tileID.toUnwrapped();this.transform.setProjection(v.projection);let N=(z=p.tileID,U=v.getProjection(),j=this.transform,U.name===this.projection?j.calculateProjMatrix(z.toUnwrapped()):Td(j,U,z));var z,U,j;let G=E.get("text-pitch-alignment")==="map",H=E.get("text-rotation-alignment")==="map";l.compileFilter();let Z=l.dynamicFilter(),ne=l.dynamicFilterNeedsFeature(),te=this.transform.calculatePixelsToTileUnitsMatrix(p),re=Mc(N,p.tileID.canonical,G,H,this.transform,v.getProjection(),te),q=null;if(G){let ae=Ms(N,p.tileID.canonical,G,H,this.transform,v.getProjection(),te);q=r.a9.multiply([],this.transform.labelPlaneMatrix,ae)}let X=null;Z&&p.latestFeatureIndex&&(X={unwrappedTileID:O,dynamicFilter:Z,dynamicFilterNeedsFeature:ne,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[v.bucketInstanceId]=new As(v.bucketInstanceId,x,v.sourceLayerIndex,v.index,p.tileID);let ce={bucket:v,layout:E,posMatrix:N,textLabelPlaneMatrix:re,labelToScreenMatrix:q,clippingData:X,scale:A,textPixelRatio:R,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:r.b8(v.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.b8(v.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(_)for(let ae of v.sortKeyRanges){let{sortKey:pe,symbolInstanceStart:Ee,symbolInstanceEnd:fe}=ae;o.push({sortKey:pe,symbolInstanceStart:Ee,symbolInstanceEnd:fe,parameters:ce})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G,H,Z){let{textOffset0:ne,textOffset1:te,crossTileID:re}=N,q=[ne,te],X=Bf(o,p,_,q,v),ce=this.collisionIndex.placeCollisionBox(U,v,l,_l(X.x,X.y,x,E,this.transform.angle),O,C,A,R.predicate);if(G){let ae=U.getSymbolInstanceIconSize(Z,this.transform.zoom,N.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(U,ae,G,_l(X.x,X.y,x,E,this.transform.angle),O,C,A,R.predicate).box.length===0)return}if(ce.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[re]&&this.prevPlacement.placements[re]&&this.prevPlacement.placements[re].text&&(ae=this.prevPlacement.variableOffsets[re].anchor),this.variableOffsets[re]={textOffset:q,width:p,height:_,anchor:o,textScale:v,prevAnchor:ae},this.markUsedJustification(U,o,N,j),U.allowVerticalPlacement&&(this.markUsedOrientation(U,j,N),this.placedOrientations[re]=j),{shift:X,placedGlyphBoxes:ce}}}placeLayerBucketPart(o,l,p,_){let{bucket:v,layout:x,posMatrix:E,textLabelPlaneMatrix:C,labelToScreenMatrix:A,clippingData:R,textPixelRatio:O,holdingForFade:N,collisionBoxArray:z,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:j,collisionGroup:G}=o.parameters,H=x.get("text-optional"),Z=x.get("icon-optional"),ne=x.get("text-allow-overlap"),te=x.get("icon-allow-overlap"),re=x.get("text-rotation-alignment")==="map",q=x.get("text-pitch-alignment")==="map",X=x.get("symbol-z-order")==="viewport-y",ce=x.get("symbol-z-elevate");this.transform.setProjection(v.projection);let ae=ne&&(te||!v.hasIconData()||Z),pe=te&&(ne||!v.hasTextData()||H);!v.collisionArrays&&z&&v.deserializeCollisionBoxes(z),p&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,z);let Ee=(fe,be,De)=>{let{crossTileID:he,numVerticalGlyphVertices:ye}=fe;if(R){let ni={zoom:this.transform.zoom,pitch:this.transform.pitch},Gn=null;if(R.dynamicFilterNeedsFeature){let nn=this.retainedQueryData[v.bucketInstanceId];Gn=R.featureIndex.loadFeature({featureIndex:fe.featureIndex,bucketIndex:nn.bucketIndex,sourceLayerIndex:nn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,R.dynamicFilter)(ni,Gn,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new r.P(fe.tileAnchorX,fe.tileAnchorY),this.transform.calculateDistanceTileData(R.unwrappedTileID)))return this.placements[he]=new Cd(!1,!1,!1,!0),void l.add(he)}if(l.has(he))return;if(N)return void(this.placements[he]=new Cd(!1,!1,!1));let Ve=!1,ge=!1,we=!0,Te=!1,ie=!1,Re=null,ot={box:null,offscreen:null,occluded:null},pt={box:null,offscreen:null,occluded:null},wt=null,yt=null,It=null,fn=0,$t=0,yn=0;De.textFeatureIndex?fn=De.textFeatureIndex:fe.useRuntimeCollisionCircles&&(fn=fe.featureIndex),De.verticalTextFeatureIndex&&($t=De.verticalTextFeatureIndex);let pn=ni=>{ni.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;let Gn=this.transform.elevation;ni.elevation=fe.zOffset+(Gn?Gn.getAtTileOffset(ni.tileID,ni.tileAnchorX,ni.tileAnchorY):0)},mi=De.textBox;if(mi){pn(mi);let ni=nn=>{let on=r.b9.horizontal;if(v.allowVerticalPlacement&&!nn&&this.prevPlacement){let hi=this.prevPlacement.placedOrientations[he];hi&&(this.placedOrientations[he]=hi,on=hi,this.markUsedOrientation(v,on,fe))}return on},Gn=(nn,on)=>{if(v.allowVerticalPlacement&&ye>0&&De.verticalTextBox){for(let hi of v.writingModes)if(hi===r.b9.vertical?(ot=on(),pt=ot):ot=nn(),ot&&ot.box&&ot.box.length)break}else ot=nn()};if(x.get("text-variable-anchor")){let nn=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[he]){let ii=this.prevPlacement.variableOffsets[he];nn.indexOf(ii.anchor)>0&&(nn=nn.filter(cn=>cn!==ii.anchor),nn.unshift(ii.anchor))}let on=(ii,cn,Qt)=>{let Gr=v.getSymbolInstanceTextSize(U,fe,this.transform.zoom,be),Dr=(ii.x2-ii.x1)*Gr+2*ii.padding,lr=(ii.y2-ii.y1)*Gr+2*ii.padding,Ir=fe.hasIconTextFit&&!te?cn:null;Ir&&pn(Ir);let $r={box:[],offscreen:!1,occluded:!1},kr=ne?2*nn.length:nn.length;for(let cr=0;cr<kr;++cr){let yr=this.attemptAnchorPlacement(nn[cr%nn.length],ii,Dr,lr,Gr,re,q,O,E,G,cr>=nn.length,fe,be,v,Qt,Ir,U,j);if(yr&&($r=yr.placedGlyphBoxes,$r&&$r.box&&$r.box.length)){Ve=!0,Re=yr.shift;break}}return $r};Gn(()=>on(mi,De.iconBox,r.b9.horizontal),()=>{let ii=De.verticalTextBox;return ii&&pn(ii),v.allowVerticalPlacement&&!(ot&&ot.box&&ot.box.length)&&ye>0&&ii?on(ii,De.verticalIconBox,r.b9.vertical):{box:null,offscreen:null,occluded:null}}),ot&&(Ve=ot.box,we=ot.offscreen,Te=ot.occluded);let hi=ni(!(!ot||!ot.box));if(!Ve&&this.prevPlacement){let ii=this.prevPlacement.variableOffsets[he];ii&&(this.variableOffsets[he]=ii,this.markUsedJustification(v,ii.anchor,fe,hi))}}else{let nn=(on,hi)=>{let ii=v.getSymbolInstanceTextSize(U,fe,this.transform.zoom,be),cn=this.collisionIndex.placeCollisionBox(v,ii,on,new r.P(0,0),ne,O,E,G.predicate);return cn&&cn.box&&cn.box.length&&(this.markUsedOrientation(v,hi,fe),this.placedOrientations[he]=hi),cn};Gn(()=>nn(mi,r.b9.horizontal),()=>{let on=De.verticalTextBox;return v.allowVerticalPlacement&&ye>0&&on?(pn(on),nn(on,r.b9.vertical)):{box:null,offscreen:null,occluded:null}}),ni(!!(ot&&ot.box&&ot.box.length))}}if(wt=ot,Ve=wt&&wt.box&&wt.box.length>0,we=wt&&wt.offscreen,Te=wt&&wt.occluded,fe.useRuntimeCollisionCircles){let ni=v.text.placedSymbolArray.get(fe.centerJustifiedTextSymbolIndex>=0?fe.centerJustifiedTextSymbolIndex:fe.verticalPlacedTextSymbolIndex),Gn=r.ba(v.textSizeData,U,ni),nn=x.get("text-padding");yt=this.collisionIndex.placeCollisionCircles(v,ne,ni,v.lineVertexArray,v.glyphOffsetArray,Gn,E,C,A,p,q,G.predicate,fe.collisionCircleDiameter*Gn/r.bf,nn,this.retainedQueryData[v.bucketInstanceId].tileID),Ve=ne||yt.circles.length>0&&!yt.collisionDetected,we=we&&yt.offscreen,Te=yt.occluded}if(De.iconFeatureIndex&&(yn=De.iconFeatureIndex),De.iconBox){let ni=Gn=>{pn(Gn);let nn=fe.hasIconTextFit&&Re?_l(Re.x,Re.y,re,q,this.transform.angle):new r.P(0,0),on=v.getSymbolInstanceIconSize(j,this.transform.zoom,fe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,on,Gn,nn,te,O,E,G.predicate)};pt&&pt.box&&pt.box.length&&De.verticalIconBox?(It=ni(De.verticalIconBox),ge=It.box.length>0):(It=ni(De.iconBox),ge=It.box.length>0),we=we&&It.offscreen,ie=It.occluded}let Vn=H||fe.numHorizontalGlyphVertices===0&&ye===0,Yi=Z||fe.numIconVertices===0;if(Vn||Yi?Yi?Vn||(ge=ge&&Ve):Ve=ge&&Ve:ge=Ve=ge&&Ve,Ve&&wt&&wt.box&&this.collisionIndex.insertCollisionBox(wt.box,x.get("text-ignore-placement"),v.bucketInstanceId,pt&&pt.box&&$t?$t:fn,G.ID),ge&&It&&this.collisionIndex.insertCollisionBox(It.box,x.get("icon-ignore-placement"),v.bucketInstanceId,yn,G.ID),yt&&(Ve&&this.collisionIndex.insertCollisionCircles(yt.circles,x.get("text-ignore-placement"),v.bucketInstanceId,fn,G.ID),p)){let ni=v.bucketInstanceId,Gn=this.collisionCircleArrays[ni];Gn===void 0&&(Gn=this.collisionCircleArrays[ni]=new Sg);for(let nn=0;nn<yt.circles.length;nn+=4)Gn.circles.push(yt.circles[nn+0]),Gn.circles.push(yt.circles[nn+1]),Gn.circles.push(yt.circles[nn+2]),Gn.circles.push(yt.collisionDetected?1:0)}let Bi=v.projection.name!=="globe";ae=ae&&(Bi||!Te),pe=pe&&(Bi||!ie),this.placements[he]=new Cd(Ve||ae,ge||pe,we||v.justReloaded),l.add(he)};if(ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,this.retainedQueryData[v.bucketInstanceId].tileID),v.updateZOffset()),X){let fe=v.getSortedSymbolIndexes(this.transform.angle);for(let be=fe.length-1;be>=0;--be){let De=fe[be];Ee(v.symbolInstances.get(De),De,v.collisionArrays[De])}v.hasAnyZOffset&&r.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){let fe=v.getSortedIndexesByZOffset();for(let be=0;be<fe.length;++be){let De=fe[be];Ee(v.symbolInstances.get(De),De,v.collisionArrays[De])}}else for(let fe=o.symbolInstanceStart;fe<o.symbolInstanceEnd;fe++)Ee(v.symbolInstances.get(fe),fe,v.collisionArrays[fe]);if(p&&v.bucketInstanceId in this.collisionCircleArrays){let fe=this.collisionCircleArrays[v.bucketInstanceId];r.a9.invert(fe.invProjMatrix,E),fe.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(o,l,p,_){let{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C,crossTileID:A}=p,R=r.bg(l),O=_===r.b9.vertical?C:R==="left"?v:R==="center"?x:R==="right"?E:-1;v>=0&&(o.text.placedSymbolArray.get(v).crossTileID=O>=0&&v!==O?0:A),x>=0&&(o.text.placedSymbolArray.get(x).crossTileID=O>=0&&x!==O?0:A),E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=O>=0&&E!==O?0:A),C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=O>=0&&C!==O?0:A)}markUsedOrientation(o,l,p){let _=l===r.b9.horizontal||l===r.b9.horizontalOnly?l:0,v=l===r.b9.vertical?l:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:A}=p,R=o.text.placedSymbolArray;x>=0&&(R.get(x).placedOrientation=_),E>=0&&(R.get(E).placedOrientation=_),C>=0&&(R.get(C).placedOrientation=_),A>=0&&(R.get(A).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let l=this.prevPlacement,p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;let _=l?l.symbolFadeChange(o):1,v=l?l.opacities:{},x=l?l.variableOffsets:{},E=l?l.placedOrientations:{};for(let C in this.placements){let A=this.placements[C],R=v[C];R?(this.opacities[C]=new gl(R,_,A.text,A.icon,null,A.clipped),p=p||A.text!==R.text.placed||A.icon!==R.icon.placed):(this.opacities[C]=new gl(null,_,A.text,A.icon,A.skipFade,A.clipped),p=p||A.text||A.icon)}for(let C in v){let A=v[C];if(!this.opacities[C]){let R=new gl(A,_,!1,!1);R.isHidden()||(this.opacities[C]=R,p=p||A.text.placed||A.icon.placed)}}for(let C in x)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=x[C]);for(let C in E)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=E[C]);p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:o)}updateLayerOpacities(o,l){let p=new Set;for(let _ of l){let v=_.getBucket(o);v&&_.latestFeatureIndex&&o.fqid===v.layerIds[0]&&(this.updateBucketOpacities(v,p,_.collisionBoxArray),v.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(v,_.tileID),v.updateZOffset()))}}updateBucketOpacities(o,l,p){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let _=o.layers[0].layout,v=!!o.layers[0].dynamicFilter(),x=new gl(null,0,!1,!1,!0),E=_.get("text-allow-overlap"),C=_.get("icon-allow-overlap"),A=_.get("text-variable-anchor"),R=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",N=new gl(null,0,E&&(C||!o.hasIconData()||_.get("icon-optional")),C&&(E||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);let z=(j,G,H)=>{for(let Z=0;Z<G/4;Z++)j.opacityVertexArray.emplaceBack(H)},U=0;for(let j=0;j<o.symbolInstances.length;j++){let G=o.symbolInstances.get(j),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:Z,crossTileID:ne,numIconVertices:te}=G,re=l.has(ne),q=this.opacities[ne];re?q=x:q||(q=N,this.opacities[ne]=q),l.add(ne);let X=H>0||Z>0,ce=te>0,ae=this.placedOrientations[ne],pe=ae===r.b9.vertical,Ee=ae===r.b9.horizontal||ae===r.b9.horizontalOnly;if(!X&&!ce||q.isHidden()||U++,X){let fe=Ad(q.text);z(o.text,H,pe?vl:fe),z(o.text,Z,Ee?vl:fe);let be=q.text.isHidden(),{leftJustifiedTextSymbolIndex:De,centerJustifiedTextSymbolIndex:he,rightJustifiedTextSymbolIndex:ye,verticalPlacedTextSymbolIndex:Ve}=G,ge=o.text.placedSymbolArray,we=be||pe?1:0;De>=0&&(ge.get(De).hidden=we),he>=0&&(ge.get(he).hidden=we),ye>=0&&(ge.get(ye).hidden=we),Ve>=0&&(ge.get(Ve).hidden=be||Ee?1:0);let Te=this.variableOffsets[ne];Te&&this.markUsedJustification(o,Te.anchor,G,ae);let ie=this.placedOrientations[ne];ie&&(this.markUsedJustification(o,"left",G,ie),this.markUsedOrientation(o,ie,G))}if(ce){let fe=Ad(q.icon),{placedIconSymbolIndex:be,verticalPlacedIconSymbolIndex:De}=G,he=o.icon.placedSymbolArray,ye=q.icon.isHidden()?1:0;be>=0&&(z(o.icon,te,pe?vl:fe),he.get(be).hidden=ye),De>=0&&(z(o.icon,G.numVerticalIconVertices,Ee?vl:fe),he.get(De).hidden=ye)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let fe=o.collisionArrays[j];if(fe){let be=new r.P(0,0),De=!0;if(fe.textBox||fe.verticalTextBox){if(A){let ye=this.variableOffsets[ne];ye?(be=Bf(ye.anchor,ye.width,ye.height,ye.textOffset,ye.textScale),R&&be._rotate(O?this.transform.angle:-this.transform.angle)):De=!1}v&&(De=!q.clipped),fe.textBox&&Fa(o.textCollisionBox.collisionVertexArray,q.text.placed,!De||pe,be.x,be.y),fe.verticalTextBox&&Fa(o.textCollisionBox.collisionVertexArray,q.text.placed,!De||Ee,be.x,be.y)}let he=De&&!!(!Ee&&fe.verticalIconBox);fe.iconBox&&Fa(o.iconCollisionBox.collisionVertexArray,q.icon.placed,he,G.hasIconTextFit?be.x:0,G.hasIconTextFit?be.y:0),fe.verticalIconBox&&Fa(o.iconCollisionBox.collisionVertexArray,q.icon.placed,!he,G.hasIconTextFit?be.x:0,G.hasIconTextFit?be.y:0)}}}if(o.fullyClipped=U===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let j=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=j.invProjMatrix,o.placementViewportMatrix=j.viewportMatrix,o.collisionCircleArray=j.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,l){let p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function Fa(f,o,l,p,_){f.emplaceBack(o?1:0,l?1:0,p||0,_||0),f.emplaceBack(o?1:0,l?1:0,p||0,_||0),f.emplaceBack(o?1:0,l?1:0,p||0,_||0),f.emplaceBack(o?1:0,l?1:0,p||0,_||0)}let Pc=Math.pow(2,25),yl=Math.pow(2,24),jf=Math.pow(2,17),Mg=Math.pow(2,16),Ag=Math.pow(2,9),Pg=Math.pow(2,8),Md=Math.pow(2,1);function Ad(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;let o=f.placed?1:0,l=Math.floor(127*f.opacity);return l*Pc+o*yl+l*jf+o*Mg+l*Ag+o*Pg+l*Md+o}let vl=0;class Rc{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,l,p,_,v){let x=this._bucketParts;for(;this._currentTileIndex<o.length;)if(l.getBucketParts(x,_,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((E,C)=>E.sortKey-C.sortKey));this._currentPartIndex<x.length;){let E=x[this._currentPartIndex];if(l.placeLayerBucketPart(E,this._seenCrossTileIDs,p,E.symbolInstanceStart===0),this._currentPartIndex++,v())return!0}return!1}}class kc{constructor(o,l,p,_,v,x,E,C,A){this.placement=new Vf(o,v,x,E,C,A),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,l,p,_){let v=r.f.now(),x=()=>{let E=r.f.now()-v;return!this._forceFullPlacement&&E>2};for(;this._currentPlacementIndex>=0;){let E=l[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=C)&&(!E.maxzoom||E.maxzoom>C)){let A=E,R=A.layout.get("symbol-z-elevate"),O=this._inProgressLayer=this._inProgressLayer||new Rc(A),N=r.aj(E.source,E.scope);if(O.continuePlacement(R?_[N]:p[N],this.placement,this._showCollisionBoxes,E,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let Uf=512/r.Y/2;class Rg{constructor(o,l,p){this.tileID=o,this.bucketInstanceId=p,this.index=new r.bj(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let _=o.canonical.x*r.Y,v=o.canonical.y*r.Y;for(let x=0;x<l.length;x++){let{key:E,crossTileID:C,tileAnchorX:A,tileAnchorY:R}=l.get(x),O=Math.floor((_+A)*Uf),N=Math.floor((v+R)*Uf);this.index.add(O,N),this.keys.push(E),this.crossTileIDs.push(C)}this.index.finish()}findMatches(o,l,p){let _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),v=Uf/Math.pow(2,l.canonical.z-this.tileID.canonical.z),x=l.canonical.x*r.Y,E=l.canonical.y*r.Y;for(let C=0;C<o.length;C++){let A=o.get(C);if(A.crossTileID)continue;let{key:R,tileAnchorX:O,tileAnchorY:N}=A,z=Math.floor((x+O)*v),U=Math.floor((E+N)*v),j=this.index.range(z-_,U-_,z+_,U+_);for(let G of j){let H=this.crossTileIDs[G];if(this.keys[G]===R&&!p.has(H)){p.add(H),A.crossTileID=H;break}}}}}class Pd{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Oc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let l=Math.round((o-this.lng)/360);if(l!==0)for(let p in this.indexes){let _=this.indexes[p],v={};for(let x in _){let E=_[x];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+l),v[E.tileID.key]=E}this.indexes[p]=v}this.lng=o}addBucket(o,l,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<l.symbolInstances.length;v++)l.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let _=this.usedCrossTileIDs[o.overscaledZ];for(let v in this.indexes){let x=this.indexes[v];if(Number(v)>o.overscaledZ)for(let E in x){let C=x[E];C.tileID.isChildOf(o)&&C.findMatches(l.symbolInstances,o,_)}else{let E=x[o.scaledTo(Number(v)).key];E&&E.findMatches(l.symbolInstances,o,_)}}for(let v=0;v<l.symbolInstances.length;v++){let x=l.symbolInstances.get(v);x.crossTileID||(x.crossTileID=p.generate(),_.add(x.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Rg(o,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(o,l){for(let p of l.crossTileIDs)this.usedCrossTileIDs[o].delete(p)}removeStaleBuckets(o){let l=!1;for(let p in this.indexes){let _=this.indexes[p];for(let v in _)o[_[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[v]),delete _[v],l=!0)}return l}}class Gf{constructor(){this.layerIndexes={},this.crossTileIDs=new Pd,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,l,p,_){let v=this.layerIndexes[o.fqid];v===void 0&&(v=this.layerIndexes[o.fqid]=new Oc);let x=!1,E={};_.name!=="globe"&&v.handleWrapJump(p);for(let C of l){let A=C.getBucket(o);A&&o.fqid===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(C.tileID,A,this.crossTileIDs)&&(x=!0),E[A.bucketInstanceId]=!0)}return v.removeStaleBuckets(E)&&(x=!0),x}pruneUnusedLayers(o){let l={};o.forEach(p=>{l[p]=!0});for(let p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}class Fc{constructor(o=0,l=0,p=0,_=0){if(isNaN(o)||o<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=l,this.left=p,this.right=_}interpolate(o,l,p){return l.top!=null&&o.top!=null&&(this.top=r.X(o.top,l.top,p)),l.bottom!=null&&o.bottom!=null&&(this.bottom=r.X(o.bottom,l.bottom,p)),l.left!=null&&o.left!=null&&(this.left=r.X(o.left,l.left,p)),l.right!=null&&o.right!=null&&(this.right=r.X(o.right,l.right,p)),this}getCenter(o,l){let p=r.ad((this.left+o-this.right)/2,0,o),_=r.ad((this.top+l-this.bottom)/2,0,l);return new r.P(p,_)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Fc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Rd(f,o){let l=r.bn(f,3);r.a9.fromQuat(f,o),r.bp(f,3,l)}function $f(f,o){let l=r.bl.identity([]);return r.bl.rotateZ(l,l,-o),r.bl.rotateX(l,l,-f),l}function Uo(f,o){let l=[f[0],f[1],0],p=[o[0],o[1],0];if(r.Q.length(l)>=1e-15){let x=r.Q.normalize([],l);r.Q.scale(p,x,r.Q.dot(p,x)),o[0]=p[0],o[1]=p[1]}let _=r.Q.cross([],o,f);if(r.Q.len(_)<1e-15)return null;let v=Math.atan2(-_[1],_[0]);return $f(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),v)}class bl{constructor(o,l){this.position=o,this.orientation=l}get position(){return this._position}set position(o){if(o){let l=o instanceof r.O?o:new r.O(o[0],o[1],o[2]);this._renderWorldCopies&&(l.x=r.bk(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(o,l){if(this.orientation=null,!this.position)return;let p=this.position,_=this._elevation?this._elevation.getAtPointOrZero(r.O.fromLngLat(o)):0,v=r.O.fromLngLat(o,_),x=[v.x-p.x,v.y-p.y,v.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=Uo(x,l)}setPitchBearing(o,l){this.orientation=$f(r.bm(o),r.bm(-l))}}class Lc{constructor(o,l){this._transform=r.a9.identity([]),this.orientation=l,this.position=o}get mercatorPosition(){let o=this.position;return new r.O(o[0],o[1],o[2])}get position(){let o=r.bn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var l;o&&r.bp(this._transform,3,[(l=o)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.bl.identity([]),o&&Rd(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,l){this._orientation=$f(o,l),Rd(this._transform,this._orientation)}forward(){let o=r.bn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=r.bn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=r.bn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,l){let p=new Float64Array(16);return r.a9.invert(p,this.getWorldToCamera(o,l)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,l,p){let _=this.position;r.Q.scale(_,_,-o);let v=new Float64Array(16);return r.a9.fromScaling(v,[p,p,p]),r.a9.translate(v,v,_),v[10]*=l,v}getWorldToCamera(o,l){let p=new Float64Array(16),_=new Float64Array(4),v=this.position;return r.bl.conjugate(_,this._orientation),r.Q.scale(v,v,-o),r.a9.fromQuat(p,_),r.a9.translate(p,p,v),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(o,l,p,_){let v=new Float64Array(16);return r.a9.perspective(v,o,l,p,_),v}getCameraToClipOrthographic(o,l,p,_,v,x){let E=new Float64Array(16);return r.a9.ortho(E,o,l,p,_,v,x),E}getDistanceToElevation(o,l=!1){let p=o===0?0:r.bo(o,l?r.ax(this.position[1]):this.position[1]),_=this.forward();return(p-this.position[2])/_[2]}clone(){return new Lc([...this.position],[...this.orientation])}}let Hf=(f,o,l)=>(1-l)*f+l*o,xl=f=>f*f*f*f*f;class kd{constructor(o,l,p,_,v,x,E){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=o||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=_??60,this.setProjection(x),this.setMaxBounds(E),this.width=0,this.height=0,this._center=new r.bq(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Fc,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Lc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let o=new kd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,l=!1){let p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(o||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return r.af(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let l=this.projection?this.getProjection():void 0;this.projection=r.br(this.projectionOptions);let p=!T(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.br({name:"mercator"});let l=o!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.bo(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.bk(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let l=-o*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=r.b7.create(),r.b7.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let l=r.ad(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=r.bm(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let l=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let p=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop(),_=0,v=0;for(let x=0;x<l.length;x++){let E=new r.P(l[x][0]*this.width,p+l[x][1]*(this.height-p)),C=o.pointCoordinate(E);if(!C)continue;let A=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);_+=C[3]*A,v+=A}return v===0?NaN:_/v}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(o),v=this._mercatorZfromZoom(this._maxZoom),x=Math.max(_-p,v);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){let l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),p;p=o.z<this._camera.position[2]?[l.x,l.y,l.z]:[o.x,o.y,o.z];let _=r.Q.length(r.Q.sub([],this._camera.position,p));return r.ad(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let l=!1;if(o.orientation&&!r.bl.exactEquals(o.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(o.orientation)),o.position){let p=[o.position.x,o.position.y,o.position.z];r.Q.exactEquals(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,l=new bl;return l.position=new r.O(o[0],o[1],o[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(o){if(!r.bl.length(o))return!1;r.bl.normalize(o,o);let l=r.Q.transformQuat([],[0,0,-1],o),p=r.Q.transformQuat([],[0,-1,0],o);if(p[2]<0)return!1;let _=Uo(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(o){let l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;o[2]=r.ad(o[2],_/p,_/l),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,l,p){this._unmodified=!1,this._edgeInsets.interpolate(o,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let l=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(o){let l=[new r.bs(0,o)];if(this.renderWorldCopies){let p=this.pointCoordinate(new r.P(0,0)),_=this.pointCoordinate(new r.P(this.width,0)),v=this.pointCoordinate(new r.P(this.width,this.height)),x=this.pointCoordinate(new r.P(0,this.height)),E=Math.floor(Math.min(p.x,_.x,v.x,x.x)),C=Math.floor(Math.max(p.x,_.x,v.x,x.x)),A=1;for(let R=E-A;R<=C+A;R++)R!==0&&l.push(new r.bs(R,o))}return l}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(o,l,p){let _=[];if(l[0]===0&&l[1]===0)return _;for(let x of o){let E=x.canonical,C=x.overscaledZ,A=x.wrap,R=1<<E.z,O=E.x+1<R,N=E.x>0,z=E.y+1<R,U=E.y>0,j=x.wrap-(N?0:1),G=x.wrap+(O?0:1),H=N?E.x-1:R-1,Z=O?E.x+1:0;l[0]<0?(_.push(new r.ap(C,G,E.z,Z,E.y)),l[1]<0&&z&&(_.push(new r.ap(C,A,E.z,E.x,E.y+1)),_.push(new r.ap(C,G,E.z,Z,E.y+1))),l[1]>0&&U&&(_.push(new r.ap(C,A,E.z,E.x,E.y-1)),_.push(new r.ap(C,G,E.z,Z,E.y-1)))):l[0]>0?(_.push(new r.ap(C,j,E.z,H,E.y)),l[1]<0&&z&&(_.push(new r.ap(C,A,E.z,E.x,E.y+1)),_.push(new r.ap(C,j,E.z,H,E.y+1))),l[1]>0&&U&&(_.push(new r.ap(C,A,E.z,E.x,E.y-1)),_.push(new r.ap(C,j,E.z,H,E.y-1)))):l[1]<0&&z?_.push(new r.ap(C,A,E.z,E.x,E.y+1)):U&&_.push(new r.ap(C,A,E.z,E.x,E.y-1))}if(_.length>1){_.sort((C,A)=>C.overscaledZ-A.overscaledZ||C.wrap-A.wrap||C.canonical.z-A.canonical.z||C.canonical.x-A.canonical.x||C.canonical.y-A.canonical.y);let x=0,E=0;for(;E<_.length;)_[E].equals(_[x])?++E:_[++x]=_[E++];_.length=x+1}let v=[];for(let x of _)_.some(E=>x.isChildOf(E))||v.push(x);return _=v.filter(x=>!o.some(E=>!!(x.overscaledZ<p&&E.isChildOf(x))||x.equals(E)||x.isChildOf(E))),_}coveringTiles(o){let l=this.coveringZoomLevel(o),p=l,_=this.elevation&&this.elevation.exaggeration(),v=_&&!o.isTerrainDEM,x=this.projection.name==="mercator";if(o.minzoom!==void 0&&l<o.minzoom)return[];o.maxzoom!==void 0&&l>o.maxzoom&&(l=o.maxzoom);let E=this.locationCoordinate(this.center),C=this.center.lat,A=1<<l,R=[A*E.x,A*E.y,0],O=this.projection.name==="globe",N=!O,z=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,N),U=O?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=A*r.bo(1,this.center.lat),G=this._camera.position[2]/r.bo(1,this.center.lat),H=[A*U.x,A*U.y,G*(N?1:j)],Z=O||_,ne=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),te=this.isLODDisabled(!0)?l:0,re;if(this._elevation&&o.isTerrainDEM)re=1e4*this._elevation.exaggeration();else if(this._elevation){let ge=this._elevation.getMinMaxForVisibleTiles();re=ge?ge.max:this._centerAltitude}else re=this._centerAltitude;let q=o.isTerrainDEM?-re:this._elevation?this._elevation.getMinElevationBelowMSL():0,X=this.projection.isReprojectedInTileSpace?r.bu(this):1,ce=ge=>{let Te=new r.O(ge.x+25e-6,ge.y,ge.z),ie=new r.O(ge.x,ge.y+25e-6,ge.z),Re=ge.toLngLat(),ot=Te.toLngLat(),pt=ie.toLngLat(),wt=this.locationCoordinate(Re),yt=this.locationCoordinate(ot),It=this.locationCoordinate(pt),fn=Math.hypot(yt.x-wt.x,yt.y-wt.y),$t=Math.hypot(It.x-wt.x,It.y-wt.y);return Math.sqrt(fn*$t)*X/25e-6},ae=ge=>{let we=re,Te=q;return{aabb:r.bx(this,A,0,0,0,ge,Te,we,this.projection),zoom:0,x:0,y:0,minZ:Te,maxZ:we,wrap:ge,fullyVisible:!1}},pe=[],Ee=[],fe=l,be=o.reparseOverscaled?p:l,De=ge=>ge*ge,he=De((G-this._centerAltitude)*j),ye=ge=>{if(!this._elevation||!ge.tileID||!x)return;let we=this._elevation.getMinMaxForTile(ge.tileID),Te=ge.aabb;we?(Te.min[2]=we.min,Te.max[2]=we.max,Te.center[2]=(Te.min[2]+Te.max[2])/2):(ge.shouldSplit=Ve(ge),ge.shouldSplit||(Te.min[2]=Te.max[2]=Te.center[2]=this._centerAltitude))},Ve=ge=>{if(ge.zoom<te)return!0;if(ge.zoom===fe)return!1;if(ge.shouldSplit!=null)return ge.shouldSplit;let we=ge.aabb.distanceX(H),Te=ge.aabb.distanceY(H),ie=he,Re=1;if(O){ie=De(ge.aabb.distanceZ(H));let wt=Math.pow(2,ge.zoom),yt=r.ax((ge.y+1)/wt),It=r.ax(ge.y/wt),fn=Math.min(Math.max(C,yt),It),$t=r.bM(fn)/r.bM(C);if(Re=fn===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,$t/this._mercatorScaleRatio),this.zoom<=r.bJ&&ge.zoom===fe-1&&$t>=.9)return!0}else if(v&&(ie=De(ge.aabb.distanceZ(H)*j)),this.projection.isReprojectedInTileSpace&&p<=5){let wt=Math.pow(2,ge.zoom),yt=ce(new r.O((ge.x+.5)/wt,(ge.y+.5)/wt));Re=yt>.85?1:yt}let ot=we*we+Te*Te+ie,pt=De((1<<fe-ge.zoom)*ne*Re*((wt,yt)=>{if(yt*De(.707)<wt)return 1;let It=Math.sqrt(yt/wt);return It/(1.4144271570014144+(Math.pow(1.1,It-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ie,he),ot));return ot<pt};if(this.renderWorldCopies)for(let ge=1;ge<=3;ge++)pe.push(ae(-ge)),pe.push(ae(ge));for(pe.push(ae(0));pe.length>0;){let ge=pe.pop(),we=ge.x,Te=ge.y,ie=ge.fullyVisible,Re=()=>this.projection.name==="globe"&&(ge.y===0||ge.y===(1<<ge.zoom)-1);if(!ie){let ot=Z?ge.aabb.intersects(z):ge.aabb.intersectsFlat(z);if(ot===0&&Re()){let pt=new r.bv(ge.zoom,we,Te);ot=r.bw(this,A,pt,!0).intersects(z)}if(ot===0)continue;ie=ot===2}if(ge.zoom!==fe&&Ve(ge))for(let ot=0;ot<4;ot++){let pt=(we<<1)+ot%2,wt=(Te<<1)+(ot>>1),yt={aabb:x?ge.aabb.quadrant(ot):r.bx(this,A,ge.zoom+1,pt,wt,ge.wrap,ge.minZ,ge.maxZ,this.projection),zoom:ge.zoom+1,x:pt,y:wt,wrap:ge.wrap,fullyVisible:ie,tileID:void 0,shouldSplit:void 0,minZ:ge.minZ,maxZ:ge.maxZ};v&&!O&&(yt.tileID=new r.ap(ge.zoom+1===fe?be:ge.zoom+1,ge.wrap,ge.zoom+1,pt,wt),ye(yt)),pe.push(yt)}else{let ot=ge.zoom===fe?be:ge.zoom;if(o.minzoom&&o.minzoom>ot)continue;if(!ie){let It=Z?ge.aabb.intersectsPrecise(z):ge.aabb.intersectsPreciseFlat(z);if(It===0&&Re()){let fn=new r.bv(ge.zoom,we,Te);It=r.bw(this,A,fn,!0).intersectsPrecise(z)}if(It===0)continue}let pt=R[0]-(.5+we+(ge.wrap<<ge.zoom))*(1<<l-ge.zoom),wt=R[1]-.5-Te,yt=ge.tileID?ge.tileID:new r.ap(ot,ge.wrap,ge.zoom,we,Te);Ee.push({tileID:yt,distanceSq:pt*pt+wt*wt})}}if(this.fogCullDistSq){let ge=this.fogCullDistSq,we=this.horizonLineFromTop();Ee=Ee.filter(Te=>{let ie=[0,0,0,1],Re=[r.Y,r.Y,0,1],ot=this.calculateFogTileMatrix(Te.tileID.toUnwrapped());r.aa.transformMat4(ie,ie,ot),r.aa.transformMat4(Re,Re,ot);let pt=r.aa.min([],ie,Re),wt=r.aa.max([],ie,Re),yt=r.by(pt,wt);if(yt===0)return!0;let It=!1,fn=this._elevation;if(fn&&yt>ge&&we!==0){let $t=this.calculateProjMatrix(Te.tileID.toUnwrapped()),yn;o.isTerrainDEM||(yn=fn.getMinMaxForTile(Te.tileID)),yn||(yn={min:q,max:re});let pn=r.bK(this.rotation),mi=[pn[0]*r.Y,pn[1]*r.Y,yn.max];r.Q.transformMat4(mi,mi,$t),It=(1-mi[1])*this.height*.5<we}return yt<ge||It})}return Ee.sort((ge,we)=>ge.distanceSq-we.distanceSq).map(ge=>ge.tileID)}resize(o,l){this.width=o,this.height=l,this.pixelsToGLUnits=[2/o,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){let l=r.ad(o.lat,-r.bz,r.bz),p=this.projection.project(o.lng,l);return new r.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.bo(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,l){let p,_,v=this.centerPoint;if(this.projection.name==="globe"){let E=this.worldSize;p=(l.x-v.x)/E,_=(l.y-v.y)/E}else{let E=this.pointCoordinate(l),C=this.pointCoordinate(v);p=E.x-C.x,_=E.y-C.y}let x=this.locationCoordinate(o);this.setLocation(new r.O(x.x-p,x.y-_))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,l){let p=l?r.bo(l,o.lat):void 0,_=this.projection.project(o.lng,o.lat);return new r.O(_.x,_.y,p)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,l){let p=l??this._centerAltitude,_=[o.x,o.y,0,1],v=[o.x,o.y,1,1];r.aa.transformMat4(_,_,this.pixelMatrixInverse),r.aa.transformMat4(v,v,this.pixelMatrixInverse);let x=v[3];r.aa.scale(_,_,1/_[3]),r.aa.scale(v,v,1/x);let E=_[2],C=v[2];return{p0:_,p1:v,t:E===C?0:(p-E)/(C-E)}}screenPointToMercatorRay(o){let l=[o.x,o.y,0,1],p=[o.x,o.y,1,1];return r.aa.transformMat4(l,l,this.pixelMatrixInverse),r.aa.transformMat4(p,p,this.pixelMatrixInverse),r.aa.scale(l,l,1/l[3]),r.aa.scale(p,p,1/p[3]),l[2]=r.bo(l[2],this._center.lat)*this.worldSize,p[2]=r.bo(p[2],this._center.lat)*this.worldSize,r.aa.scale(l,l,1/this.worldSize),r.aa.scale(p,p,1/this.worldSize),new r.a5([l[0],l[1],l[2]],r.Q.normalize([],r.Q.sub([],p,l)))}rayIntersectionCoordinate(o){let{p0:l,p1:p,t:_}=o,v=r.bo(l[2],this._center.lat),x=r.bo(p[2],this._center.lat);return new r.O(r.X(l[0],p[0],_)/this.worldSize,r.X(l[1],p[1],_)/this.worldSize,r.X(v,x,_))}pointCoordinate(o,l=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,l)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let l=this.projection.pointCoordinate3D(this,o.x,o.y);if(l)return new r.O(l[0],l[1],l[2]);let p=0,_=this.horizonLineFromTop();if(o.y>_)return this.pointCoordinate(o);let v=.02*_,x=o.clone();for(let E=0;E<10&&_-p>v;E++){x.y=r.X(p,_,.66);let C=this.projection.pointCoordinate3D(this,x.x,x.y);C?(_=x.y,l=C):p=x.y}return l?new r.O(l[0],l[1],l[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=r.bA)return!this.isPointAboveHorizon(o);let l=this.pointCoordinate(o);return l.y>=0&&l.y<=1}_coordinatePoint(o,l){let p=l&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,_=[o.x*this.worldSize,o.y*this.worldSize,p+o.toAltitude(),1];return r.aa.transformMat4(_,_,this.pixelMatrix),_[3]>0?new r.P(_[0]/_[3],_[1]/_[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,v=this.pointLocation3D(new r.P(l,o)),x=this.pointLocation3D(new r.P(_,o)),E=this.pointLocation3D(new r.P(_,p)),C=this.pointLocation3D(new r.P(l,p)),A=Math.min(v.lng,x.lng,E.lng,C.lng),R=Math.max(v.lng,x.lng,E.lng,C.lng),O=Math.min(v.lat,x.lat,E.lat,C.lat),N=Math.max(v.lat,x.lat,E.lat,C.lat),z=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,j=(G,H,Z,ne,te)=>{let re=(G+Z)/2,q=(H+ne)/2,X=new r.P(re,q),{lng:ce,lat:ae}=this.pointLocation3D(X),pe=Math.max(0,A-ce,O-ae,ce-R,ae-N);A=Math.min(A,ce),R=Math.max(R,ce),O=Math.min(O,ae),N=Math.max(N,ae),(te<U||pe>z)&&(j(G,H,re,q,te+1),j(re,q,Z,ne,te+1))};if(j(l,o,_,o,1),j(_,o,_,p,1),j(_,p,l,p,1),j(l,p,l,o,1),this.projection.name==="globe"){let[G,H]=r.bB(this);G?(N=90,R=180,A=-180):H&&(O=-90,R=180,A=-180)}return new r.ag(new r.bq(A,O),new r.bq(R,N))}_getBoundsRectangular(o,l){let{top:p,left:_}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,E=new r.P(_,p),C=new r.P(x,p),A=new r.P(x,v),R=new r.P(_,v),O=this.pointCoordinate(E,o),N=this.pointCoordinate(C,o),z=this.pointCoordinate(A,l),U=this.pointCoordinate(R,l),j=(G,H)=>(H.y-G.y)/(H.x-G.x);return O.y>1&&N.y>=0?O=new r.O((1-U.y)/j(U,O)+U.x,1):O.y<0&&N.y<=1&&(O=new r.O(-U.y/j(U,O)+U.x,0)),N.y>1&&O.y>=0?N=new r.O((1-z.y)/j(z,N)+z.x,1):N.y<0&&O.y<=1&&(N=new r.O(-z.y/j(z,N)+z.x,0)),new r.ag().extend(this.coordinateLocation(O)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(z))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let l=o.visibleDemTiles.reduce((p,_)=>{if(_.dem){let v=_.dem.tree;p.min=Math.min(p.min,v.minimums[0]),p.max=Math.max(p.max,v.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*o.exaggeration(),l.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return o?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.bz,this.maxLat=r.bz,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.a8(this.minLng)*this.tileSize,this.worldMaxX=r.a8(this.maxLng)*this.tileSize,this.worldMinY=r.ah(this.maxLat)*this.tileSize,this.worldMaxY=r.ah(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,l){return this.projection.createTileMatrix(this,l,o)}calculateDistanceTileData(o){let l=o.key,p=this._distanceTileDataCache;if(p[l])return p[l];let _=o.canonical,v=1/this.height,x=this.cameraWorldSize,E=x/this.zoomScale(_.z),C=(_.x+Math.pow(2,_.z)*o.wrap)*E,A=_.y*E,R=this.point;R.x*=x/this.worldSize,R.y*=x/this.worldSize;let O=this.angle,N=Math.sin(-O),z=-Math.cos(-O);return p[l]={bearing:[N,z],center:[(R.x-C)*v,(R.y-A)*v],scale:E/r.Y*v},p[l]}calculateFogTileMatrix(o){let l=o.key,p=this._fogTileMatrixCache;if(p[l])return p[l];let _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return r.a9.multiply(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(o,l=!1,p=!1){let _=o.key,v;if(v=p?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,v[_])return v[_];let x=this.calculatePosMatrix(o,this.worldSize),E;return E=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,r.a9.multiply(x,E,x),v[_]=new Float32Array(x),v[_]}calculatePixelsToTileUnitsMatrix(o){let l=o.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];let _=r.bC(o,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,l=r.a9.fromScaling([],[o,o,o]);return r.a9.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let l=r.bo(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),v=r.bo(1,this._center.lat);p[2]/=v,_[2]/=v,r.Q.normalize(_,_);let x=o.raycast(p,_,o.exaggeration());if(x){let E=r.Q.scaleAndAdd([],p,_,x),C=new r.O(E[0],E[1],r.bo(E[2],r.ax(E[1]))),A=(C.z+r.Q.length([C.x-p[0],C.y-p[1],C.z-p[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(A),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let l=this._elevation,p=r.bo(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(p),v=l.getAtPointOrZero(new r.O(..._)),x=this.pixelsPerMeter/this.worldSize*v,E=this._minimumHeightOverTerrain(),C=_[2]-x;if(C<=E)if(C<0||o){let A=this.locationCoordinate(this._center,this._centerAltitude),R=[_[0],_[1],A.z-_[2]],O=r.Q.length(R);R[2]-=(E-C)/this._pixelsPerMercatorPixel;let N=r.Q.length(R);if(N===0)return;r.Q.scale(R,R,O/N*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],A.z*this._pixelsPerMercatorPixel-R[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let N=this.center;return N.lat=r.ad(N.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(N.lng=r.ad(N.lng,this.minLng,this.maxLng)),this.center=N,void(this._constraining=!1)}let l=this._unmodified,{x:p,y:_}=this.point,v=0,x=p,E=_,C=this.width/2,A=this.height/2,R=this.worldMinY*this.scale,O=this.worldMaxY*this.scale;if(_-A<R&&(E=R+A),_+A>O&&(E=O-A),O-R<this.height&&(v=Math.max(v,this.height/(O-R)),E=(O+R)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let N=this.worldMinX*this.scale,z=this.worldMaxX*this.scale,U=this.worldSize/2-(N+z)/2;x=(p+U+this.worldSize)%this.worldSize-U,x-C<N&&(x=N+C),x+C>z&&(x=z-C),z-N<this.width&&(v=Math.max(v,this.width/(z-N)),x=(z+N)/2)}x===p&&E===_||(this.center=this.unproject(new r.P(x,E))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,l=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.bo(1,this.center.lat)/r.bo(1,r.bL));let _=r.bD(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let v=this.projection.zAxisUnit==="meters"?p:1,x=this._camera.getWorldToCamera(this.worldSize,v),E,C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-o.x/this.width,C[9]=2*o.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),pe=ae*this.aspect,Ee=-pe,fe=-ae;pe-=o.x,Ee-=o.x,ae+=o.y,fe+=o.y,E=this._camera.getCameraToClipOrthographic(Ee,pe,fe,ae,this._nearZ,this._farZ),((be,De,he,ye)=>{for(let Ve=0;Ve<16;Ve++)be[Ve]=Hf(De[Ve],he[Ve],ye)})(E,E,C,xl(this.pitch>=15?1:this.pitch/15))}else E=C;let A=r.a9.mul([],C,x),R=r.a9.mul([],E,x);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),pe=r.a9.identity([]);r.a9.translate(pe,pe,[ae.x*this.worldSize,ae.y*this.worldSize,0]),r.a9.multiply(pe,pe,r.bE(this)),r.a9.translate(pe,pe,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),r.a9.multiply(R,R,pe),r.a9.multiply(A,A,pe),this.inverseAdjustmentMatrix=r.bF(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.a9.scale([],R,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=R,this.invProjMatrix=r.a9.invert(new Float64Array(16),this.projMatrix),l){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-o.x/this.width,ae[9]=2*o.y/this.height,this.expandedFarZProjMatrix=r.a9.mul([],ae,x)}else this.expandedFarZProjMatrix=this.projMatrix;let O=r.a9.invert([],E);this.frustumCorners=r.bG.fromInvProjectionMatrix(O,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);let N=new Float32Array(16);r.a9.identity(N),r.a9.scale(N,N,[1,-1,1]),r.a9.rotateX(N,N,this._pitch),r.a9.rotateZ(N,N,this.angle);let z=r.a9.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.a9.clone(z);let U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-o.x/this.width,z[9]=2*(o.y+U)/this.height,this.skyboxMatrix=r.a9.multiply(N,z,N);let j=this.point,G=j.x,H=j.y,Z=this.width%2/2,ne=this.height%2/2,te=Math.cos(this.angle),re=Math.sin(this.angle),q=G-Math.round(G)+te*Z+re*ne,X=H-Math.round(H)+te*ne+re*Z,ce=new Float64Array(R);if(r.a9.translate(ce,ce,[q>.5?q-1:q,X>.5?X-1:X,0]),this.alignedProjMatrix=ce,R=r.a9.create(),r.a9.scale(R,R,[this.width/2,-this.height/2,1]),r.a9.translate(R,R,[1,-1,0]),this.labelPlaneMatrix=R,R=r.a9.create(),r.a9.scale(R,R,[1,-1,1]),r.a9.translate(R,R,[-1,-1,0]),r.a9.scale(R,R,[2/this.width,2/this.height,1]),this.glCoordMatrix=R,this.pixelMatrix=r.a9.multiply(new Float64Array(16),this.labelPlaneMatrix,A),this._calcFogMatrices(),this._distanceTileDataCache={},R=r.a9.invert(new Float64Array(16),this.pixelMatrix),!R)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=R,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.bH(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.Q.transformMat4(ae,ae,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=R;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,v=[o,o,l];r.Q.scale(v,v,_),r.Q.scale(p,p,-1),r.Q.multiply(p,p,v);let x=r.a9.create();r.a9.translate(x,x,p),r.a9.scale(x,x,v),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,l,_)}_computeCameraPosition(o){let l=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-o/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*v,_.y/this.worldSize-p[1]*v,o/this.worldSize*this._centerAltitude-p[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],_=o[2],v=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(v=Math.min((l-p)/_,1)),this._camera.position=r.Q.scaleAndAdd([],this._camera.position,o,v),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),v=r.bo(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.bm(this._maxPitch)),E=Math.max((o[2]-v)/Math.cos(p),x),C=this._zoomFromMercatorZ(E);r.Q.scaleAndAdd(o,o,l,E),this._pitch=r.ad(p,r.bm(this.minPitch),r.bm(this.maxPitch)),this.angle=r.bk(_,-Math.PI,Math.PI),this._setZoom(r.ad(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.O(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let l=0,p=r.bA,_=0,v=1/0;for(;p-l>1e-6&&p>l;){let x=l+.5*(p-l),E=this.tileSize*Math.pow(2,x),C=this.getCameraToCenterDistance(this.projection,x,E),A=this.scaleZoom(C/(o*this.tileSize)),R=Math.abs(x-A);R<v&&(v=R,_=x),x<A?l=x:p=x}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,l){let p=Math.min(o.x,l.x),_=Math.max(o.x,l.x),v=Math.min(o.y,l.y),x=Math.max(o.y,l.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let E=[new r.P(p,v),new r.P(_,x),new r.P(p,x),new r.P(_,v)],C=this.renderWorldCopies?-3:0,A=this.renderWorldCopies?4:1;for(let R of E){let O=this.pointRayIntersection(R);if(O.t<0)return!0;let N=this.rayIntersectionCoordinate(O);if(N.x<C||N.y<0||N.x>A||N.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.bI(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(o,l){let p=r.Q.length(r.Q.sub([],this._camera.position,o)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){let o=function([l,p,_],v){let x=[l,p,_,1];r.aa.transformMat4(x,x,v);let E=x[3]=Math.max(x[3],1e-6);return x[0]/=E,x[1]/=E,x[2]/=E,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,o))}}getCameraToCenterDistance(o,l=this.zoom,p=this.worldSize){let _=r.bD(o,l,this.width,this.height,1024),v=o.pixelSpaceConversion(this.center.lat,p,_),x=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(x=Hf(1,x,xl(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.a9.multiply(o,o,this.globeMatrix),o}getFrustum(o){return r.bt.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}let Yr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},na=(f,o)=>{if(o>0&&f.terrain&&r.w("Cutoff is currently disabled on terrain"),o<=0||f.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let l=f.transform,p=Math.max(Math.abs(l._zoom-(f.minCutoffZoom-1)),1),_=l.isLODDisabled(!1)?r.S(60,45,l.pitch):r.S(30,15,l.pitch),v=l._farZ-l._nearZ,x=o*l.height,E=((1-(C=_))*l.cameraToCenterDistance+C*(l._farZ+x))*p;var C;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(E-l._nearZ)/v,(E-x-l._nearZ)/v]}}},Xr={cascadeCount:2,shadowMapResolution:2048};class kg{constructor(o,l){this.aabb=o,this.lastCascade=l}}class _b{add(o,l){let p=this.receivers[o.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],l.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],l.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],l.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],l.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],l.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],l.max[2])):this.receivers[o.key]=new kg(l,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,l,p){let _=r.bV.fromPoints(o.points),v=0;for(let x in this.receivers){let E=this.receivers[x];if(!E||!_.intersectsAabb(E.aabb))continue;E.aabb.min=_.closestPoint(E.aabb.min),E.aabb.max=_.closestPoint(E.aabb.max);let C=E.aabb.getCorners();for(let A=0;A<p.length;A++){let R=!0;for(let O of C){let N=[O[0]*l,O[1]*l,O[2]];if(r.Q.transformMat4(N,N,p[A].matrix),N[0]<-1||N[0]>1||N[1]<-1||N[1]>1){R=!1;break}}if(E.lastCascade=A,v=Math.max(v,A),R)break}}return v+1}}class Og{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new _b,this._depthMode=new Ct(o.context.gl.LEQUAL,Ct.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,o.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),o.tp.registerParameter(Xr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(Xr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),o.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,l){let p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;let _=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||_<=0||(this._shadowLayerCount=p.style.order.reduce((U,j)=>{let G=p.style._mergedLayers[j];return U+(G.hasShadowPass()&&!G.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;let v=p.context,x=Xr.shadowMapResolution,E=Xr.shadowMapResolution;if(this._cascades.length===0||Xr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<Xr.cascadeCount;++U){let j=p._shadowMapDebug,G=v.gl,H=v.createFramebuffer(x,E,j,"texture"),Z=new r.T(v,{width:x,height:E,data:null},G.DEPTH_COMPONENT);if(H.depthAttachment.set(Z.texture),j){let ne=new r.T(v,{width:x,height:E,data:null},G.RGBA);H.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:H,texture:Z,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.bt,scale:0})}}this.shadowDirection=Fd(l);let C=0;if(o.elevation){let U=o.elevation,j=[1e4,-1e4];U.visibleDemTiles.filter(G=>G.dem).forEach(G=>{let H=G.dem.tree;j[0]=Math.min(j[0],H.minimums[0]),j[1]=Math.max(j[1],H.maximums[0])}),j[0]!==1e4&&(C=(j[1]-j[0])*U.exaggeration())}let A=1.5*o.cameraToCenterDistance,R=3*A,O=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){let j=this._cascades[U],G=o.height/50,H=1;Xr.cascadeCount===1?H=R:U===0?H=A:(G=A,H=R);let[Z,ne]=Ld(o,this.shadowDirection,G,H,Xr.shadowMapResolution,C);j.scale=o.scale,j.matrix=Z,j.boundingSphereRadius=ne,r.a9.invert(O,j.matrix),j.frustum=r.bt.fromInvProjectionMatrix(O,1,0,!0),j.far=H}let N=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[N].far,this._cascades[N].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Xr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Xr.shadowMapResolution,this._uniformValues.u_shadowmap_0=Yr.ShadowMap0,this._uniformValues.u_shadowmap_1=Yr.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let z=p.transform.elevation;for(let U of this._groundShadowTiles){let j={min:0,max:0};if(z){let G=z.getMinMaxForTile(U);G&&(j=G)}this.addShadowReceiver(U.toUnwrapped(),j.min,j.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,l){if(!this.enabled)return;let p=this.painter,_=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),_.viewport.set([0,0,Xr.shadowMapResolution,Xr.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){p.currentShadowCascade=v,_.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),_.clear({color:r.aA.white,depth:1});for(let x of o.order){let E=o._mergedLayers[x];if(!E.hasShadowPass()||E.isHidden(p.transform.zoom))continue;let C=o.getLayerSourceCache(E),A=C?l[C.id]:void 0;(E.type==="model"||A&&A.length)&&p.renderLayer(p,C,E,A)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;let o=this.painter,l=o.style,p=o.context,_=l.directionalLight,v=l.ambientLight;if(!_||!v)return;let x=[],E=na(o,o.longestCutoffRange);E.shouldRenderCutoff&&x.push("RENDER_CUTOFF");let C=qf(_,v),A=new Ct(p.gl.LEQUAL,Ct.ReadOnly,o.depthRangeFor3D);for(let R of this._groundShadowTiles){let O=R.toUnwrapped(),N=o.isTileAffectedByFog(R),z=o.getOrCreateProgram("groundShadow",{defines:x,overrideFog:N});this.setupShadows(O,z),o.uploadCommonUniforms(p,z,O,null,E);let U={u_matrix:o.transform.calculateProjMatrix(O),u_ground_shadow_factor:C};z.draw(o,p.gl.TRIANGLES,A,qt.disabled,an.multiply,Vt.disabled,U,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?an.unblended:an.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let l=this.painter.transform,p=l.calculatePosMatrix(o,l.worldSize);return r.a9.multiply(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(o){return r.a9.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,l,p,_=0){if(!this.enabled)return;let v=this.painter.transform,x=this.painter.context,E=x.gl,C=this._uniformValues,A=new Float64Array(16),R=v.calculatePosMatrix(o,v.worldSize);for(let O=0;O<this._cascades.length;O++)r.a9.multiply(A,this._cascades[O].matrix,R),C[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(A),x.activeTexture.set(E.TEXTURE0+Yr.ShadowMap0+O),this._cascades[O].texture.bind(E.NEAREST,E.CLAMP_TO_EDGE);if(this.useNormalOffset=!!p,this.useNormalOffset){let O=r.bU(o.canonical),N=2/v.tileSize*r.Y/Xr.shadowMapResolution,z=N*this._cascades[0].boundingSphereRadius,U=N*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(p==="vector-tile"?1:3)/Math.pow(2,_-o.canonical.z-(1-v.zoom+Math.floor(v.zoom)));C.u_shadow_normal_offset=[O,z*j,U*j],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(x,C)}setupShadowsFromMatrix(o,l,p=!1){if(!this.enabled)return;let _=this.painter.context,v=_.gl,x=this._uniformValues,E=new Float64Array(16);for(let C=0;C<Xr.cascadeCount;C++)r.a9.multiply(E,this._cascades[C].matrix,o),x[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),_.activeTexture.set(v.TEXTURE0+Yr.ShadowMap0+C),this._cascades[C].texture.bind(v.NEAREST,v.CLAMP_TO_EDGE);this.useNormalOffset=p,p?(x.u_shadow_normal_offset=[1,5,5],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(_,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,l,p,_){if(_[2]>=0)return{};let v=function(C,A,R){let O=R/(1<<C.canonical.z);return new r.bV([C.canonical.x*O+C.wrap*R,C.canonical.y*O+C.wrap*R,0],[(C.canonical.x+1)*O+C.wrap*R,(C.canonical.y+1)*O+C.wrap*R,A])}(o,l,p).getCorners(),x=l/-_[2];_[0]<0?(r.Q.add(v[0],v[0],[_[0]*x,0,0]),r.Q.add(v[3],v[3],[_[0]*x,0,0])):_[0]>0&&(r.Q.add(v[1],v[1],[_[0]*x,0,0]),r.Q.add(v[2],v[2],[_[0]*x,0,0])),_[1]<0?(r.Q.add(v[0],v[0],[0,_[1]*x,0]),r.Q.add(v[1],v[1],[0,_[1]*x,0])):_[1]>0&&(r.Q.add(v[2],v[2],[0,_[1]*x,0]),r.Q.add(v[3],v[3],[0,_[1]*x,0]));let E={};return E.vertices=v,E.planes=[Od(v[1],v[0],v[4]),Od(v[2],v[1],v[5]),Od(v[3],v[2],v[6]),Od(v[0],v[3],v[7])],E}addShadowReceiver(o,l,p){this._receivers.add(o,r.bV.fromTileIdAndHeight(o,l,p))}getMaxCascadeForTile(o){let l=this._receivers.get(o);return l&&l.lastCascade?l.lastCascade:0}}function Od(f,o,l){let p=r.Q.sub([],l,o),_=r.Q.sub([],f,o),v=r.Q.cross([],p,_),x=r.Q.length(v);return x===0?[0,0,1,0]:(r.Q.scale(v,v,1/x),[v[0],v[1],v[2],-r.Q.dot(v,o)])}function Fd(f){let o=f.properties.get("direction"),l=r.bT(o.x,o.y,o.z);l[2]=r.ad(l[2],0,75);let p=r.bW([l[0],l[1],l[2]]);return r.Q.fromValues(p.x,p.y,p.z)}function qf(f,o){let l=f.properties.get("color"),p=f.properties.get("intensity"),_=f.properties.get("direction"),v=[_.x,_.y,_.z],x=o.properties.get("color"),E=o.properties.get("intensity"),C=Math.max(r.Q.dot([0,0,1],v),0),A=[0,0,0];r.Q.scale(A,x.toArray01Linear().slice(0,3),E);let R=[0,0,0];return r.Q.scale(R,l.toArray01Linear().slice(0,3),C*p),r.bX([A[0]>0?A[0]/(A[0]+R[0]):0,A[1]>0?A[1]/(A[1]+R[1]):0,A[2]>0?A[2]/(A[2]+R[2]):0])}function Ld(f,o,l,p,_,v){let x=f.zoom,E=f.scale,C=f.worldSize,A=1/C,R=f.aspect,O=Math.sqrt(1+R*R)*Math.tan(.5*f.fovX),N=O*O,z=p-l,U=p+l,j,G;N>z/U?(j=p,G=p*O):(j=.5*U*(1+N),G=.5*Math.sqrt(z*z+2*(p*p+l*l)*N+U*U*N*N));let H=f.projection.pixelsPerMeter(f.center.lat,C),Z=f._camera.getCameraToWorldMercator(),ne=[0,0,-j*A];r.Q.transformMat4(ne,ne,Z);let te=G*A,re=f._edgeInsets;if(!(re.left===0&&re.top===0&&re.right===0&&re.bottom===0||re.left===re.right&&re.top===re.bottom)){let ie=f._camera.getWorldToCamera(f.worldSize,f.projection.zAxisUnit==="meters"?H:1),Re=f._camera.getCameraToClipPerspective(f._fov,f.width/f.height,l,p);Re[8]=2*-f.centerOffset.x/f.width,Re[9]=2*f.centerOffset.y/f.height;let ot=new Float64Array(16);r.a9.mul(ot,Re,ie);let pt=new Float64Array(16);r.a9.invert(pt,ot);let wt=r.bt.fromInvProjectionMatrix(pt,C,x,!0);for(let yt of wt.points){let It=((q=yt)[0]/=E,q[1]/=E,q[2]=r.bo(q[2],f._center.lat),q);te=Math.max(te,r.Q.len(r.Q.subtract([],ne,It)))}}var q;te*=_/(_-1);let X=Math.acos(o[2]),ce=Math.atan2(-o[0],-o[1]),ae=new Lc;ae.position=ne,ae.setPitchBearing(X,ce);let pe=ae.getWorldToCamera(C,H),Ee=te*C,fe=Math.min(f._mercatorZfromZoom(17)*C*-2,-2*Ee),be=ae.getCameraToClipOrthographic(-Ee,Ee,-Ee,Ee,fe,(Ee+v*H)/o[2]),De=new Float64Array(16);r.a9.multiply(De,be,pe);let he=r.Q.fromValues(Math.floor(1e6*ne[0])/1e6*C,Math.floor(1e6*ne[1])/1e6*C,0),ye=.5*_,Ve=[0,0,0];r.Q.transformMat4(Ve,he,De),r.Q.scale(Ve,Ve,ye);let ge=[Math.floor(Ve[0]),Math.floor(Ve[1]),Math.floor(Ve[2])],we=[0,0,0];r.Q.sub(we,Ve,ge),r.Q.scale(we,we,-1/ye);let Te=new Float64Array(16);return r.a9.identity(Te),r.a9.translate(Te,Te,we),r.a9.multiply(De,Te,De),[De,Ee]}let is=(f,o)=>ft(f,o&&o.filter(l=>l.identifier!=="source.canvas")),Fg=r.af(Sn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),yb=r.af(Sn,["setCenter","setZoom","setBearing","setPitch"]),Wf={version:8,layers:[],sources:{}},Zf={duration:300,delay:0};class Go extends r.E{constructor(o,l={}){super(),this.map=o,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=r.e({},Zf),this._buildingIndex=new kf(this),this.crossTileSymbolIndex=new Gf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new Gt,this.dispatcher=l.dispatcher?l.dispatcher:new r.bZ(r.b_(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Js,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new r.b$(o._requestManager,l.localFontFamily?r.c0.all:l.localIdeographFontFamily?r.c0.ideographs:r.c0.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new vi(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",r.c1());let p=this;this._rtlTextPluginCallback=Go.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(v,x)=>{if(r.c2(v),x&&x.every(E=>E))for(let E in p._sourceCaches){let C=p._sourceCaches[E],A=C.getSource().type;A!=="vector"&&A!=="geojson"||C.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;let v=this.getOwnSource(_.sourceId);if(v&&v.vectorLayerIds)for(let x in this._layers){let E=this._layers[x];E.source===v.id&&this._validateLayer(E)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(r.c3(o))return o;let l=r.c4(o);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${r.c5(JSON.stringify(o))}`}_diffStyle(o,l,p){this.globalId=this._getGlobalId(o);let _=(v,x)=>{try{x(null,this.setState(v,p))}catch(E){x(E,!1)}};if(typeof o=="string"){let v=this.map._requestManager.normalizeStyleURL(o),x=this.map._requestManager.transformRequest(v,r.R.Style);r.g(x,(E,C)=>{E?this.fire(new r.a(E)):C&&_(C,l)})}else typeof o=="object"&&_(o,l)}loadURL(o,l={}){this.fire(new r.b("dataloading",{dataType:"style"}));let p=typeof l.validate=="boolean"?l.validate:!r.c3(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,l.accessToken),this.resolvedImports.add(o);let _=this.importsCache.get(o);if(_)return this._load(_,p);let v=this.map._requestManager.transformRequest(o,r.R.Style);this._request=r.g(v,(x,E)=>{if(this._request=null,x)this.fire(new r.a(x));else if(E)return this.importsCache.set(o,E),this._load(E,p)})}loadJSON(o,l={}){this.fire(new r.b("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=r.f.frame(()=>{this._request=null,this._load(o,l.validate!==!1)})}loadEmpty(){this.fire(new r.b("dataloading",{dataType:"style"})),this._load(Wf,!1)}_loadImports(o,l,p){if(this.importDepth>=4)return r.w("Style doesn't support nesting deeper than 5"),Promise.resolve();let _=[];for(let v of o){let x=this._createFragmentStyle(v),E=new Promise(R=>{x.once("style.import.load",R),x.once("error",R)}).then(()=>this.mergeAll());if(_.push(E),this.resolvedImports.has(v.url)){x.loadEmpty();continue}let C=v.data||this.importsCache.get(v.url);C?(x.loadJSON(C,{validate:l}),this._isInternalStyle(C)&&(x.globalId=null)):v.url?x.loadURL(v.url,{validate:l}):x.loadEmpty();let A={style:x,id:v.id,config:v.config};if(p){let R=this.fragments.findIndex(({id:O})=>O===p);this.fragments=this.fragments.slice(0,R).concat(A).concat(this.fragments.slice(R))}else this.fragments.push(A)}return Promise.allSettled(_)}getImportGlobalIds(o=this,l=new Set){for(let p of o.fragments)p.style.globalId&&l.add(p.style.globalId),this.getImportGlobalIds(p.style,l);return[...l.values()]}_createFragmentStyle(o){let l=this.scope?r.aj(o.id,this.scope):o.id,p,_=this._initialConfig&&this._initialConfig[l];(o.config||_)&&(p=r.e({},o.config,_));let v=new Go(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,l){let p=o.schema;if(this._isInternalStyle(o)){let E=r.e({},Wf,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(E,l)}if(this.updateConfig(this._config,p),l&&is(this,zt(o)))return;this._loaded=!0,this.stylesheet=r.c6(o);for(let E in o.sources)this.addSource(E,o.sources[E],{validate:!1,isInitialLoad:!0});o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(o.glyphs,this.scope);let _=Dg(this.stylesheet.layers);if(this._order=_.map(E=>E.id),this.stylesheet.light&&r.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let E=this.stylesheet.lights[0];this.light=new Et(E.properties,E.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Et(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let E of _){let C=r.c7(E,this.scope,this.options);C.isConfigDependent&&this._configDependentLayers.add(C.fqid),C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize();let A=this.getOwnLayerSourceCache(C),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();A&&C.canCastShadows()&&R&&(A.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let v=this.stylesheet.terrain;v&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(v,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.b("data",{dataType:"style"}));let x=this.isRootStyle();o.imports?this._loadImports(o.imports,l).then(()=>{this._reloadImports(),this.fire(new r.b(x?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new r.b(x?"style.load":"style.import.load")))}isRootStyle(){return this.importDepth===0}mergeAll(){let o,l,p,_,v,x,E,C;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(A=>{if(A.stylesheet){if(A.light!=null&&(o=A.light),A.stylesheet.lights)for(let R of A.stylesheet.lights)R.type==="ambient"&&A.ambientLight!=null&&(l=A.ambientLight),R.type==="directional"&&A.directionalLight!=null&&(p=A.directionalLight);_=this._prioritizeTerrain(_,A.terrain,A.stylesheet.terrain),A.stylesheet.fog&&A.fog!=null&&(v=A.fog),A.stylesheet.camera!=null&&(C=A.stylesheet.camera),A.stylesheet.projection!=null&&(x=A.stylesheet.projection),A.stylesheet.transition!=null&&(E=A.stylesheet.transition)}}),this.light=o,this.ambientLight=l,this.directionalLight=p,this.fog=v,_===null?delete this.terrain:this.terrain=_,this.camera=C||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=r.e({},Zf,E),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){let l=p=>{for(let _ of p.fragments)l(_.style);o(p)};l(this)}_prioritizeTerrain(o,l,p){let _=o&&o.drapeRenderMode===0;return p===null?l&&l.drapeRenderMode===0?l:_?o:null:l!=null&&(!o||_||l&&l.drapeRenderMode===1)?l:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{o=this._prioritizeTerrain(o,l.terrain,l.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(o=l.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},l={},p={};this.forEachFragmentStyle(_=>{for(let v in _._sourceCaches){let x=r.aj(v,_.scope);o[x]=_._sourceCaches[v]}for(let v in _._otherSourceCaches){let x=r.aj(v,_.scope);l[x]=_._otherSourceCaches[v]}for(let v in _._symbolSourceCaches){let x=r.aj(v,_.scope);p[x]=_._symbolSourceCaches[v]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=p}mergeLayers(){let o={},l=[],p={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(let x of v._order){let E=v._layers[x];if(E.type==="slot"){let C=r.c8(x);if(o[C])continue;o[C]=[]}E.slot&&o[E.slot]?o[E.slot].push(E):l.push(E)}}),this._mergedOrder=[];let _=(v=[])=>{for(let x of v)if(x.type==="slot"){let E=r.c8(x.id);o[E]&&_(o[E])}else{let E=r.aj(x.id,x.scope);this._mergedOrder.push(E),p[E]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0)}};_(l),this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=r.e({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(l,p,_){let v,x,E,C=r.f.devicePixelRatio>1?"@2x":"",A=r.g(p.transformRequest(p.normalizeSpriteURL(l,C,".json"),r.R.SpriteJSON),(N,z)=>{A=null,E||(E=N,v=z,O())}),R=r.d(p.transformRequest(p.normalizeSpriteURL(l,C,".png"),r.R.SpriteImage),(N,z)=>{R=null,E||(E=N,x=z,O())});function O(){if(E)_(E);else if(v&&x){let N=r.f.getImageData(x),z={};for(let U in v){let{width:j,height:G,x:H,y:Z,sdf:ne,pixelRatio:te,stretchX:re,stretchY:q,content:X}=v[U],ce=new r.h({width:j,height:G});r.h.copy(N,ce,{x:H,y:Z},{x:0,y:0},{width:j,height:G}),z[U]={data:ce,pixelRatio:te,sdf:ne,stretchX:re,stretchY:q,content:X}}_(null,z)}}return{cancel(){A&&(A.cancel(),A=null),R&&(R.cancel(),R=null)}}}(o,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new r.a(l));else if(p)for(let _ in p)this.imageManager.addImage(_,this.scope,p[_]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.b("data",{dataType:"style"}))})}_validateLayer(o){let l=this.getOwnSource(o.source);if(!l)return;let p=o.sourceLayer;p&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(p)===-1)&&this.fire(new r.a(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,l)=>{let p=this.fragments[l];return p&&p.style&&(o.data=p.style.serialize()),o})}_serializeSources(){let o={};for(let l in this._sourceCaches){let p=this._sourceCaches[l].getSource();o[p.id]||(o[p.id]=p.serialize())}return o}_serializeLayers(o){let l=[];for(let p of o){let _=this._layers[p];_&&_.type!=="custom"&&l.push(_.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let l=this.getOwnLayer(o);if(l)return l;this.fire(new r.a(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let l=this.getOwnSource(o);if(l)return l;this.fire(new r.a(new Error(`The source '${o}' does not exist in the map's style.`)))}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let l=this.calculateLightsBrightness();o.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));let p=this._changes.isDirty();if(this._changes.isDirty()){let v=this._changes.getLayerUpdatesByScope();for(let x in v){let{updatedIds:E,removedIds:C}=v[x];(E||C)&&this._updateWorkerLayers(x,E,C)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._changes.reset()}let _={};for(let v in this._mergedSourceCaches){let x=this._mergedSourceCaches[v];_[v]=x.used,x.used=!1,x.tileCoverLift=0}for(let v of this._mergedOrder){let x=this._mergedLayers[v];if(x.recalculate(o,this._availableImages),!x.isHidden(o.zoom)){let E=this.getLayerSourceCache(x);E&&(E.used=!0,E.tileCoverLift=Math.max(E.tileCoverLift,x.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let E=x.minzoom||0;E<(x.maxzoom||25.5);E++){let C=this.map.painter;if(C){let A=x.getProgramIds();if(!A)continue;for(let R of A){let O=x.getDefaultProgramParams(R,o.zoom);O&&(C.style=this,this.fog&&(C._fogVisible=!0,O.overrideFog=!0,C.getOrCreateProgram(R,O)),C._fogVisible=!1,O.overrideFog=!1,C.getOrCreateProgram(R,O),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(O.overrideRtt=!0,C.getOrCreateProgram(R,O)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let v in _){let x=this._mergedSourceCaches[v];_[v]!==x.used&&x.getSource().fire(new r.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),p&&this.fire(new r.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=this._changes.getUpdatedImages();if(o.length){for(let l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,l,p){let _=this.getFragmentStyle(o);_&&this.dispatcher.broadcast("updateLayers",{layers:l?_._serializeLayers(l):[],scope:o,removedIds:p||[],options:_.options})}setState(o,l){if(this._checkLoaded(),is(this,zt(o)))return!1;(o=r.c6(o)).layers=Dg(o.layers);let p=function(x,E){if(!x)return[{command:Sn.setStyle,args:[E]}];let C=[];try{if(!T(x.version,E.version))return[{command:Sn.setStyle,args:[E]}];T(x.center,E.center)||C.push({command:Sn.setCenter,args:[E.center]}),T(x.zoom,E.zoom)||C.push({command:Sn.setZoom,args:[E.zoom]}),T(x.bearing,E.bearing)||C.push({command:Sn.setBearing,args:[E.bearing]}),T(x.pitch,E.pitch)||C.push({command:Sn.setPitch,args:[E.pitch]}),T(x.sprite,E.sprite)||C.push({command:Sn.setSprite,args:[E.sprite]}),T(x.glyphs,E.glyphs)||C.push({command:Sn.setGlyphs,args:[E.glyphs]}),T(x.imports,E.imports)||function(z=[],U=[],j){U=U||[];let G=(z=z||[]).map(pl),H=U.map(pl),Z=z.reduce(Cc,{}),ne=U.reduce(Cc,{}),te=G.slice(),re,q,X,ce;for(re=0,q=0;re<G.length;re++)X=G[re],ne.hasOwnProperty(X)?q++:(j.push({command:Sn.removeImport,args:[X]}),te.splice(te.indexOf(X,q),1));for(re=0,q=0;re<H.length;re++)X=H[H.length-1-re],te[te.length-1-re]!==X&&(Z.hasOwnProperty(X)?(j.push({command:Sn.removeImport,args:[X]}),te.splice(te.lastIndexOf(X,te.length-q),1)):q++,ce=te[te.length-re],j.push({command:Sn.addImport,args:[ne[X],ce]}),te.splice(te.length-re,0,X));for(let ae of U){let pe=Z[ae.id];pe&&!T(pe,ae)&&j.push({command:Sn.updateImport,args:[ae.id,ae]})}}(x.imports,E.imports,C),T(x.transition,E.transition)||C.push({command:Sn.setTransition,args:[E.transition]}),T(x.light,E.light)||C.push({command:Sn.setLight,args:[E.light]}),T(x.fog,E.fog)||C.push({command:Sn.setFog,args:[E.fog]}),T(x.projection,E.projection)||C.push({command:Sn.setProjection,args:[E.projection]}),T(x.lights,E.lights)||C.push({command:Sn.setLights,args:[E.lights]}),T(x.camera,E.camera)||C.push({command:Sn.setCamera,args:[E.camera]});let A={},R=[];(function(z,U,j,G){let H;for(H in U=U||{},z=z||{})z.hasOwnProperty(H)&&(U.hasOwnProperty(H)||Of(H,j,G));for(H in U){if(!U.hasOwnProperty(H))continue;let Z=U[H];z.hasOwnProperty(H)?T(z[H],Z)||(z[H].type==="geojson"&&Z.type==="geojson"&&Ff(z,U,H)?j.push({command:Sn.setGeoJSONSourceData,args:[H,Z.data]}):Ig(H,U,j,G)):vd(H,U,j)}})(x.sources,E.sources,R,A);let O=[];x.layers&&x.layers.forEach(z=>{z.source&&A[z.source]?C.push({command:Sn.removeLayer,args:[z.id]}):O.push(z)});let N=x.terrain;N&&A[N.source]&&(C.push({command:Sn.setTerrain,args:[void 0]}),N=void 0),C=C.concat(R),T(N,E.terrain)||C.push({command:Sn.setTerrain,args:[E.terrain]}),function(z,U,j){U=U||[];let G=(z=z||[]).map(pl),H=U.map(pl),Z=z.reduce(Cc,{}),ne=U.reduce(Cc,{}),te=G.slice(),re=Object.create(null),q,X,ce,ae,pe,Ee,fe;for(q=0,X=0;q<G.length;q++)ce=G[q],ne.hasOwnProperty(ce)?X++:(j.push({command:Sn.removeLayer,args:[ce]}),te.splice(te.indexOf(ce,X),1));for(q=0,X=0;q<H.length;q++)ce=H[H.length-1-q],te[te.length-1-q]!==ce&&(Z.hasOwnProperty(ce)?(j.push({command:Sn.removeLayer,args:[ce]}),te.splice(te.lastIndexOf(ce,te.length-X),1)):X++,Ee=te[te.length-q],j.push({command:Sn.addLayer,args:[ne[ce],Ee]}),te.splice(te.length-q,0,ce),re[ce]=!0);for(q=0;q<H.length;q++)if(ce=H[q],ae=Z[ce],pe=ne[ce],!re[ce]&&!T(ae,pe))if(T(ae.source,pe.source)&&T(ae["source-layer"],pe["source-layer"])&&T(ae.type,pe.type)){for(fe in Ra(ae.layout,pe.layout,j,ce,null,Sn.setLayoutProperty),Ra(ae.paint,pe.paint,j,ce,null,Sn.setPaintProperty),T(ae.slot,pe.slot)||j.push({command:Sn.setSlot,args:[ce,pe.slot]}),T(ae.filter,pe.filter)||j.push({command:Sn.setFilter,args:[ce,pe.filter]}),T(ae.minzoom,pe.minzoom)&&T(ae.maxzoom,pe.maxzoom)||j.push({command:Sn.setLayerZoomRange,args:[ce,pe.minzoom,pe.maxzoom]}),ae)ae.hasOwnProperty(fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&fe!=="slot"&&(fe.indexOf("paint.")===0?Ra(ae[fe],pe[fe],j,ce,fe.slice(6),Sn.setPaintProperty):T(ae[fe],pe[fe])||j.push({command:Sn.setLayerProperty,args:[ce,fe,pe[fe]]}));for(fe in pe)pe.hasOwnProperty(fe)&&!ae.hasOwnProperty(fe)&&fe!=="layout"&&fe!=="paint"&&fe!=="filter"&&fe!=="metadata"&&fe!=="minzoom"&&fe!=="maxzoom"&&fe!=="slot"&&(fe.indexOf("paint.")===0?Ra(ae[fe],pe[fe],j,ce,fe.slice(6),Sn.setPaintProperty):T(ae[fe],pe[fe])||j.push({command:Sn.setLayerProperty,args:[ce,fe,pe[fe]]}))}else j.push({command:Sn.removeLayer,args:[ce]}),Ee=te[te.lastIndexOf(ce)+1],j.push({command:Sn.addLayer,args:[pe,Ee]})}(O,E.layers,C)}catch(A){console.warn("Unable to compute style diff:",A),C=[{command:Sn.setStyle,args:[E]}]}return C}(this.serialize(),o).filter(x=>!(x.command in yb));if(p.length===0)return!1;let _=p.filter(x=>!(x.command in Fg));if(_.length>0)throw new Error(`Unimplemented: ${_.map(x=>x.command).join(", ")}.`);let v=[];return p.forEach(x=>{v.push(this[x.command].apply(this,x.args))}),l&&Promise.all(v).then(l),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(o,l){return this.getImage(o)?this.fire(new r.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,this.scope,l),this._afterImageUpdated(o),this)}updateImage(o,l){this.imageManager.updateImage(o,this.scope,l)}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._afterImageUpdated(o),this):this.fire(new r.a(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(o),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,l,p={}){return this._checkLoaded(),this._validate(vt,`models.${o}`,l,null,p)||(this.modelManager.addModel(o,l,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new r.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,l,p={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(Tc,`sources.${o}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);let _=Pf(o,l,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));let v=x=>{let E=(x?"symbol:":"other:")+_.id,C=r.aj(E,this.scope),A=this._sourceCaches[E]=new Vo(C,_,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=A,A.onAdd(this.map)};v(!1),l.type!=="vector"&&l.type!=="geojson"||v(!0),_.onAdd&&_.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let l=this.getOwnSource(o);if(!l)throw new Error("There is no source with this ID");for(let _ in this._layers)if(this._layers[_].source===o)return this.fire(new r.a(new Error(`Source "${o}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new r.a(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));let p=this.getOwnSourceCaches(o);for(let _ of p){let v=r.c8(_.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(_.id),_.fire(new r.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,l){this._checkLoaded(),this.getOwnSource(o).setData(l),this._changes.setDirty()}getOwnSource(o){let l=this.getOwnSourceCache(o);return l&&l.getSource()}getOwnSources(){let o=[];for(let l in this._otherSourceCaches){let p=this.getOwnSourceCache(l);p&&o.push(p.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let l in o){let p=o[l]._tiles;for(let _ in p){let v=p[_];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let l=this._getTransitionParameters();for(let _ of o){if(this._validate(We,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){let v=this.ambientLight;v.set(_),v.updateTransitions(l)}else this.ambientLight=new Rr(_,No,this.scope,this.options);break;case"directional":if(this.directionalLight){let v=this.directionalLight;v.set(_),v.updateTransitions(l)}else this.directionalLight=new Rr(_,Zi,this.scope,this.options)}}let p=new r.N(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,l=this.ambientLight;if(!o||!l)return;let p=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),_=o.properties.get("color").toArray01(),v=o.properties.get("intensity"),x=o.properties.get("direction"),E=1-r.bT(x.x,x.y,x.z)[2]/90,C=p(_)*v*E,A=l.properties.get("color").toArray01(),R=l.properties.get("intensity");return(C+p(A)*R)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(r.c9(o)){let l=r.ca(o),p=this.fragments.find(({id:v})=>v===l);if(!p)throw new Error(`Style import not found: ${o}`);let _=r.c8(o);return p.style.getFragmentStyle(_)}{let l=this.fragments.find(({id:p})=>p===o);if(!l)throw new Error(`Style import not found: ${o}`);return l.style}}getConfigProperty(o,l){let p=this.getFragmentStyle(o);if(!p)return null;let _=r.aj(l,p.scope),v=p.options.get(_),x=v?v.value||v.default:null;return x?x.serialize():null}setConfigProperty(o,l,p){let _=this.getFragmentStyle(o);if(!_)return;let v=_.stylesheet.schema;if(!v||!v[l])return;let x=r.t(p);if(x.result!=="success")return void is(this,x.value);let E=x.value.expression,C=r.aj(l,_.scope),A=_.options.get(C);if(!A)return;let R,{minValue:O,maxValue:N,stepValue:z,type:U,values:j}=v[l],G=r.t(v[l].default);G.result==="success"&&(R=G.value.expression),R?(this.options.set(C,tr(Yt({},A),{value:E,default:R,minValue:O,maxValue:N,stepValue:z,type:U,values:j})),this.updateConfigDependencies()):this.fire(new r.a(new Error(`No schema defined for the config option "${l}" in the "${o}" fragment.`)))}getConfig(o){let l=this.getFragmentStyle(o);if(!l)return null;let p=l.stylesheet.schema;if(!p)return null;let _={};for(let v in p){let x=r.aj(v,l.scope),E=l.options.get(x),C=E?E.value||E.default:null;_[v]=C?C.serialize():null}return _}setConfig(o,l){let p=this.getFragmentStyle(o);p&&(p.updateConfig(l,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){let l=this.getFragmentStyle(o);return l?l.stylesheet.schema:null}setSchema(o,l){let p=this.getFragmentStyle(o);p&&(p.stylesheet.schema=l,p.updateConfig(p._config,l),this.updateConfigDependencies())}updateConfig(o,l){if(this._config=o,o||l)if(l)for(let p in l){let _,v,x=r.t(l[p].default);if(x.result==="success"&&(_=x.value.expression),o&&o[p]!==void 0){let N=r.t(o[p]);N.result==="success"&&(v=N.value.expression)}let{minValue:E,maxValue:C,stepValue:A,type:R,values:O}=l[p];if(_){let N=r.aj(p,this.scope);this.options.set(N,{default:_,value:v,minValue:E,maxValue:C,stepValue:A,type:R,values:O})}else this.fire(new r.a(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new r.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let o of this._configDependentLayers){let l=this.getLayer(o);l&&(l.possiblyEvaluateVisibility(),this._updateLayer(l))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(o,l,p={}){this._checkLoaded();let _=o.id;if(this._layers[_])return void this.fire(new r.a(new Error(`Layer with id "${_}" already exists on this map`)));let v;if(o.type==="custom"){if(is(this,r.cb(o)))return;v=r.c7(o,this.scope,this.options)}else{if(typeof o.source=="object"&&(this.addSource(_,o.source),o=r.c6(o),o=r.e(o,{source:_})),this._validate(me,`layers.${_}`,o,{arrayIndex:-1},p))return;v=r.c7(o,this.scope,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[v.id]=v.serialize()}v.isConfigDependent&&this._configDependentLayers.add(v.fqid);let x=this._order.length;if(l){let R=this._order.indexOf(l);if(R===-1)return void this.fire(new r.a(new Error(`Layer with id "${l}" does not exist on this map.`)));v.slot===this._layers[l].slot?x=R:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,_),this._layerOrderChanged=!0,this._layers[_]=v;let E=this.getOwnLayerSourceCache(v),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&v.canCastShadows()&&C&&(E.castsShadows=!0);let A=this._changes.getRemovedLayer(v);if(A&&v.source&&E&&v.type!=="custom"){this._changes.discardLayerRemoval(v);let R=r.aj(v.source,v.scope);A.type!==v.type?this._changes.updateSourceCache(R,"clear"):(this._changes.updateSourceCache(R,"reload"),E.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(o,l){this._checkLoaded();let p=this._checkLayer(o);if(!p||o===l)return;let _=this._order.indexOf(o);this._order.splice(_,1);let v=this._order.length;if(l){let x=this._order.indexOf(l);if(x===-1)return void this.fire(new r.a(new Error(`Layer with id "${l}" does not exist on this map.`)));p.slot===this._layers[l].slot?v=x:r.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let l=this._checkLayer(o);if(!l)return;l.setEventedParent(null);let p=this._order.indexOf(o);this._order.splice(p,1),delete this._layers[o],delete this._serializedLayers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);let _=this.getOwnLayerSourceCache(l);if(_&&_.castsShadows){let v=!1;for(let x in this._layers)if(this._layers[x].source===l.source&&this._layers[x].canCastShadows()){v=!0;break}_.castsShadows=v}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let l in this._layers)if(this._layers[l].type===o)return!0;return!1}setLayerZoomRange(o,l,p){this._checkLoaded();let _=this._checkLayer(o);_&&(_.minzoom===l&&_.maxzoom===p||(l!=null&&(_.minzoom=l),p!=null&&(_.maxzoom=p),this._updateLayer(_)))}setSlot(o,l){this._checkLoaded();let p=this._checkLayer(o);p&&p.slot!==l&&(p.slot=l,this._updateLayer(p))}setFilter(o,l,p={}){this._checkLoaded();let _=this._checkLayer(o);if(_&&!T(_.filter,l))return l==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Be,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=r.c6(l),this._updateLayer(_)))}getFilter(o){let l=this._checkLayer(o);if(l)return r.c6(l.filter)}setLayoutProperty(o,l,p,_={}){this._checkLoaded();let v=this._checkLayer(o);if(v&&!T(v.getLayoutProperty(l),p)){if(p!=null&&(!_||_.validate!==!1)&&is(v,Ye.call(zt,{key:`layers.${o}.layout.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:r.G,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(l,p),v.isConfigDependent&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(o,l){let p=this._checkLayer(o);if(p)return p.getLayoutProperty(l)}setPaintProperty(o,l,p,_={}){this._checkLoaded();let v=this._checkLayer(o);if(!v||T(v.getPaintProperty(l),p)||p!=null&&(!_||_.validate!==!1)&&is(v,Ue.call(zt,{key:`layers.${o}.paint.${l}`,layerType:v.type,objectKey:l,value:p,styleSpec:r.G})))return;let x=v.setPaintProperty(l,p);v.isConfigDependent&&this._configDependentLayers.add(v.fqid),x&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(o,l){let p=this._checkLayer(o);if(p)return p.getPaintProperty(l)}setFeatureState(o,l){this._checkLoaded();let p=o.source,_=o.sourceLayer,v=this._checkSource(p);if(!v)return;let x=v.type;if(x==="geojson"&&_)return void this.fire(new r.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!_)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided.")));let E=this.getOwnSourceCaches(p);for(let C of E)C.setFeatureState(_,o.id,l)}removeFeatureState(o,l){this._checkLoaded();let p=o.source,_=this._checkSource(p);if(!_)return;let v=_.type,x=v==="vector"?o.sourceLayer:void 0;if(v==="vector"&&!x)return void this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.a(new Error("A feature id is required to remove its specific state property.")));let E=this.getOwnSourceCaches(p);for(let C of E)C.removeFeatureState(x,o.id,l)}getFeatureState(o){this._checkLoaded();let l=o.source,p=o.sourceLayer,_=this._checkSource(l);if(_){if(_.type!=="vector"||p)return o.id===void 0&&this.fire(new r.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(p,o.id);this.fire(new r.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=r.e({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return r.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),l=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return r.cc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},p=>p!==void 0)}_updateLayer(o){this._changes.updateLayer(o);let l=this.getLayerSourceCache(o),p=r.aj(o.source,o.scope),_=this._changes.getUpdatedSourceCaches();o.source&&!_[p]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),l.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let l=E=>this._mergedLayers[E].type==="fill-extrusion"||this._mergedLayers[E].type==="model",p=this.order,_={},v=[];for(let E=p.length-1;E>=0;E--){let C=p[E];if(l(C)){_[C]=E;for(let A of o){let R=A[C];if(R)for(let O of R)v.push(O)}}}v.sort((E,C)=>C.intersectionZ-E.intersectionZ);let x=[];for(let E=p.length-1;E>=0;E--){let C=p[E];if(l(C))for(let A=v.length-1;A>=0;A--){let R=v[A].feature;if(_[R.layer.id]<E)break;x.push(R),v.pop()}else for(let A of o){let R=A[C];if(R)for(let O of R)x.push(O.feature)}}return x}queryRenderedFeatures(o,l,p){l&&l.filter&&this._validate(Be,"queryRenderedFeatures.filter",l.filter,null,l),l.scope=this.scope,l.availableImages=this._availableImages,l.serializedLayers=this._serializedLayers;let _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new r.a(new Error("parameters.layers must be an Array."))),[];for(let A of l.layers){let R=this._mergedLayers[A];if(!R)return this.fire(new r.a(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];_[R.source]=!0}}let v=[],x=l.serializedLayers||{},E=l&&l.layers?l.layers.some(A=>{let R=this.getLayer(A);return R&&R.is3D()}):this.has3DLayers(),C=Ei.createFromScreenPoints(o,p);for(let A in this._mergedSourceCaches){let R=this._mergedSourceCaches[A].getSource();if(!R||R.scope!==l.scope)continue;let O=this._mergedSourceCaches[A].getSource().id;l.layers&&!_[O]||v.push(bn(this._mergedSourceCaches[A],this._mergedLayers,x,C,l,p,E,!!this.map._showQueryGeometry))}return this.placement&&v.push(function(A,R,O,N,z,U,j){let G={},H=U.queryRenderedSymbols(N),Z=[];for(let ne of Object.keys(H).map(Number))Z.push(j[ne]);Z.sort(Eg);for(let ne of Z){let te=ne.featureIndex.lookupSymbolFeatures(H[ne.bucketInstanceId],R,ne.bucketIndex,ne.sourceLayerIndex,z.filter,z.layers,z.availableImages,A);for(let re in te){let q=G[re]=G[re]||[],X=te[re];X.sort((ce,ae)=>{let pe=ne.featureSortOrder;if(pe){let Ee=pe.indexOf(ce.featureIndex);return pe.indexOf(ae.featureIndex)-Ee}return ae.featureIndex-ce.featureIndex});for(let ce of X)q.push(ce)}}for(let ne in G)G[ne].forEach(te=>{let re=te.feature,q=O(A[ne]);if(!q)return;let X=q.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=X});return G}(this._mergedLayers,x,this.getLayerSourceCache.bind(this),C.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,l){l&&l.filter&&this._validate(Be,"querySourceFeatures.filter",l.filter,null,l);let p=this.getOwnSourceCaches(o),_=[];for(let v of p)_=_.concat(Ur(v,l));return _}addSourceType(o,l,p){return Go.getSourceType(o)?p(new Error(`A source type called "${o}" already exists.`)):(Go.setSourceType(o,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:l.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,l,p={}){this._checkLoaded();let _=this.light.getLight(),v=!1;for(let E in o)if(!T(o[E],_[E])){v=!0;break}if(!v)return;let x=this._getTransitionParameters();this.light.setLight(o,l,p),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,l=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()&&l!==0||delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=o,_=o.source==null;if(l===1){if(typeof p.source=="object"){let E="terrain-dem-src";this.addSource(E,p.source),p=r.c6(p),p=r.e(p,{source:E})}let v=r.e({},p),x={};if(this.terrain&&_){v.source=this.terrain.get().source;let E=this.terrain?this.getFragmentStyle(this.terrain.scope):null;E&&(x.style=E.serialize())}if(this._validate(J,"terrain",v,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l),this.fire(new r.b("data",{dataType:"style"}))}else{let v=this.terrain,x=v.get();for(let E of Object.keys(r.G.terrain))!p.hasOwnProperty(E)&&r.G.terrain[E].default&&(p[E]=r.G.terrain[E].default);for(let E in o)if(!T(o[E],x[E])){v.set(o,this.options),this.stylesheet.terrain=o;let C=this._getTransitionParameters({duration:0});v.updateTransitions(C),this.fire(new r.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let l=this.fog=new Br(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let l=this.fog;if(!T(l.get(),o)){l.set(o,this.options),this.stylesheet.fog=l.get();let p=this._getTransitionParameters({duration:0});l.updateTransitions(p)}}else this._createFog(o);this._markersNeedUpdate=!0}_getTransitionParameters(o){return{now:r.f.now(),transition:r.e(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],l=[];for(let p in this._mergedLayers)this.isLayerDraped(this._mergedLayers[p])?o.push(p):l.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...l)}_createTerrain(o,l){let p=this.terrain=new Kn(o,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let _=this._getTransitionParameters({duration:0});p.updateTransitions(_)}_force3DLayerUpdate(){for(let o in this._layers){let l=this._layers[o];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let l=this._layers[o];l.type==="symbol"&&this._updateLayer(l)}}_validate(o,l,p,_,v={}){if(v&&v.validate===!1)return!1;let x=r.e({},this.serialize());return is(this,o.call(zt,r.e({key:l,style:x,value:p,styleSpec:r.G},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cd.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){let l=this.getSourceCaches(o);for(let p of l)p.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){let l=this.getSourceCaches(o);for(let p of l)p.resume(),p.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}updateSources(o){let l;this.directionalLight&&(l=Fd(this.directionalLight));for(let p in this._mergedSourceCaches)this._mergedSourceCaches[p].update(o,void 0,void 0,l)}_generateCollisionBoxes(){for(let o in this._sourceCaches){let l=this._sourceCaches[o];l.resume(),l.reload()}}_updatePlacement(o,l,p,_,v=!1){let x=!1,E=!1,C={},A={};for(let R of this._mergedOrder){let O=this._mergedLayers[R];if(O.type!=="symbol")continue;let N=r.aj(O.source,O.scope),z=C[N];if(!z){let j=this.getLayerSourceCache(O);if(!j)continue;let G=j.getRenderableIds(!0).map(H=>j.getTileByID(H));A[N]=G.slice(),z=C[N]=G.sort((H,Z)=>Z.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Z.tileID)?-1:1))}let U=this.crossTileSymbolIndex.addLayer(O,z,o.center.lng,o.projection);x=x||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),v=v||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new r.b("neworder")),(v||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.f.now(),o.zoom))&&(this.pauseablePlacement=new kc(o,this._mergedOrder,v,l,p,_,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,C,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.f.now()),E=!0),x&&this.pauseablePlacement.placement.setStale()),E||x){this._buildingIndex.onNewFrame(o.zoom);for(let R of this._mergedOrder){let O=this._mergedLayers[R];O.type==="symbol"&&this.placement.updateLayerOpacities(O,C[r.aj(O.source,O.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.f.now())}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,l){this._checkLoaded();let p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex(({id:v})=>v===o.id)!==-1)return void this.fire(new r.a(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!l)return p.push(o),this._loadImports([o],!0);let _=p.findIndex(({id:v})=>v===l);return _===-1&&this.fire(new r.a(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,_).concat(o).concat(p.slice(_)),this._loadImports([o],!0,l)}updateImport(o,l){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(o);return _===-1?this:typeof l=="string"?(this.setImportUrl(o,l),this):(l.url&&l.url!==p[_].url&&this.setImportUrl(o,l.url),T(l.config,p[_].config)||this.setImportConfig(o,l.config),T(l.data,p[_].data)||this.setImportData(o,l.data),this)}moveImport(o,l){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;let v=this.getImportIndex(l);if(v===-1)return this;let x=p[_],E=this.fragments[_];return p=p.filter(({id:C})=>C!==o),this.fragments=this.fragments.filter(({id:C})=>C!==o),this.stylesheet.imports=p.slice(0,v).concat(x).concat(p.slice(v)),this.fragments=this.fragments.slice(0,v).concat(E).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(o,l){this._checkLoaded();let p=this.stylesheet.imports||[],_=this.getImportIndex(o);if(_===-1)return this;p[_].url=l;let v=this.fragments[_];return v.style=this._createFragmentStyle(p[_]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(l),this}setImportData(o,l){this._checkLoaded();let p=this.getImportIndex(o),_=this.stylesheet.imports||[];return p===-1?this:l?(this.fragments[p].style.setState(l),this._reloadImports(),this):(delete _[p].data,this.setImportUrl(o,_[p].url))}setImportConfig(o,l){this._checkLoaded();let p=this.getImportIndex(o),_=this.stylesheet.imports||[];if(p===-1)return this;l?_[p].config=l:delete _[p].config;let v=this.fragments[p],x=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=l,v.style.updateConfig(l,x),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let l=this.stylesheet.imports||[],p=this.getImportIndex(o);p!==-1&&(l.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(o){let l=(this.stylesheet.imports||[]).findIndex(p=>p.id===o);return l===-1&&this.fire(new r.a(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),l}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let l in this._mergedOtherSourceCaches){let p=this._mergedOtherSourceCaches[l];p&&o.push(p.getSource())}return o}getSource(o,l){let p=this.getSourceCache(o,l);return p&&p.getSource()}getLayerSource(o){let l=this.getLayerSourceCache(o);return l&&l.getSource()}getSourceCache(o,l){let p=r.aj(o,l);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(o){let l=r.aj(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);let l=[];return this._mergedOtherSourceCaches[o]&&l.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&l.push(this._mergedSymbolSourceCaches[o]),l}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let l in o){let p=o[l];p==="reload"?this.reloadSource(l):p==="clear"&&this.clearSource(l)}}updateLayers(o){let l=this._changes.getUpdatedPaintProperties();for(let p of l){let _=this.getLayer(p);_&&_.updateTransitions(o)}}getImages(o,l,p){this.imageManager.getImages(l.icons,l.scope,p),this._updateTilesForChangedImages();let _=v=>{v&&v.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(o,l,p){this.glyphManager.getGlyphs(l.stacks,l.scope,p)}getResource(o,l,p){return r.ce(l,p)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let l=[];return this._otherSourceCaches[o]&&l.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&l.push(this._symbolSourceCaches[o]),l}_isSourceCacheLoaded(o){let l=this.getOwnSourceCaches(o);return l.length===0?(this.fire(new r.a(new Error(`There is no source with ID '${o}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Go.getSourceType=function(f){return tt[f]},Go.setSourceType=function(f,o){tt[f]=o},Go.registerForPluginStateChange=r.bY;var Nc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Nd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,ia="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",zd=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,La=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Yf=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,zc=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Bd=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec4 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Bc=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Vd=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let Bn=[];ra(Nc,Bn),ra(Nd,Bn),ra(Qf,Bn);let sn={"_prelude_fog.vertex.glsl":La,"_prelude_terrain.vertex.glsl":zd,"_prelude_shadow.vertex.glsl":Bc,"_prelude_fog.fragment.glsl":Yf,"_prelude_shadow.fragment.glsl":Vd,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":zc,"_prelude_raster_particle.glsl":Bd},Vc={};ln("",zd),ln(Yf,La),ln(Vd,Bc),ln(zc,""),ln(Bd,"");let jc=ln(Qf,Nd),jd=Nc;var $o={background:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:ln("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ln(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ln("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:ln("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:ln(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:ln(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:ln(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform mediump float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
#endif
#ifdef LINE_JOIN_NONE
float pattern_len=pattern_size.x/aspect;float segment_phase=pattern_len-mod((v_linesofar-v_pattern_data.x),pattern_len);float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in float a_linesofar;
#ifdef LINE_JOIN_NONE
in vec2 a_pattern_data;out vec2 v_pattern_data;
#endif
uniform mat4 u_matrix;uniform mediump float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef LINE_JOIN_NONE
v_width+=ANTIALIASING;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5/u_tile_units_to_pixels;v_linesofar+=line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:ln("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:ln("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ln(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp float speed=velocity==INVALID_VELOCITY ? 0.0 : length(velocity);highp float reset_rate_bump=speed*u_reset_rate;highp vec2 particle_pos_min=-u_particle_pos_offset;highp vec2 particle_pos_max=vec2(1.0)+u_particle_pos_offset;highp vec2 pos_drop_rate=vec2(1.0)-step(particle_pos_min,pos)+step(particle_pos_max,pos);highp float drop_rate=max(u_reset_rate+reset_rate_bump,length(pos_drop_rate));highp float drop=step(1.0-drop_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbolIcon:ln(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
out_color*=alpha;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:ln(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:ln("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:ln(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ia),skyboxGradient:ln(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ia),skyboxCapture:ln(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:ln(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:ln(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:ln(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:ln(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function ra(f,o){let l=f.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of l)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let _=p.split(" ");for(let v of _)o.includes(v)||o.push(v)}}function ln(f,o){let l=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,_=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(A=>{let R=A.split(" ");return R[R.length-1]}),_=[...new Set(_)]);let v={},x=[],E=[];if(f=f.replace(l,(A,R)=>(E.push(R),"")),(o=o.replace(l,(A,R)=>(x.push(R),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...Bn];ra(f,C),ra(o,C);for(let A of[...x,...E])sn[A]||console.error(`Undefined include: ${A}`),Vc[A]||(Vc[A]=[],ra(sn[A],Vc[A])),C=[...C,...Vc[A]];return{fragmentSource:f=f.replace(p,(A,R,O,N,z)=>(v[z]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${z}
in ${O} ${N} ${z};
#else
uniform ${O} ${N} u_${z};
#endif
`:R==="initialize"?`
#ifdef HAS_UNIFORM_u_${z}
    ${O} ${N} ${z} = u_${z};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${O} ${N} ${z};
#endif
`:R==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(p,(A,R,O,N,z)=>{let U=N==="float"?"vec2":N,j=z.match(/color/)?"color":U;return R==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${z}
in ${O} ${N} a_${z};
#endif
`:v[z]?R==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${O} ${U} a_${z};
out ${O} ${N} ${z};
#else
uniform ${O} ${N} u_${z};
#endif
`:R==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = a_${z};
#else
    ${O} ${N} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${O} ${N} ${z} = u_${z};
#endif
`:R==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    in ${O} ${N} a_${z};
    out ${O} ${N} ${z};
#endif
`:R==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${z} = a_${z};
#endif
`:void 0:R==="define"?`
#ifndef HAS_UNIFORM_u_${z}
uniform lowp float u_${z}_t;
in ${O} ${U} a_${z};
#else
uniform ${O} ${N} u_${z};
#endif
`:R==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${z}0;
in vec4 a_${z}1;
in vec4 a_${z}2;
in vec4 a_${z}3;
#else
uniform ${O} ${N} u_${z};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${O} ${U} a_${z};
#else
uniform ${O} ${N} u_${z};
#endif
`:R==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${z}
    ${O} ${N} ${z} = a_${z};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${z}
    ${O} ${N} ${z} = a_${z};
#else
    ${O} ${N} ${z} = u_${z};
#endif
`:`
#ifndef HAS_UNIFORM_u_${z}
    ${O} ${N} ${z} = unpack_mix_${j}(a_${z}, u_${z}_t);
#else
    ${O} ${N} ${z} = u_${z};
#endif
`}),staticAttributes:_,usedDefines:C,vertexIncludes:x,fragmentIncludes:E}}class ut{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,l,p,_,v,x,E,C){this.context=o;let A=this.boundPaintVertexBuffers.length!==_.length;for(let O=0;!A&&O<_.length;O++)this.boundPaintVertexBuffers[O]!==_[O]&&(A=!0);let R=this.boundDynamicVertexBuffers.length!==E.length;for(let O=0;!R&&O<E.length;O++)this.boundDynamicVertexBuffers[O]!==E[O]&&(R=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||A||R||this.boundIndexBuffer!==v||this.boundVertexOffset!==x)this.freshBind(l,p,_,v,x,E,C);else{o.bindVertexArrayOES.set(this.vao);for(let O of E)O&&(O.bind(),C&&O.instanceCount&&O.setVertexAttribDivisor(o.gl,l,C));v&&v.dynamicDraw&&v.bind()}}freshBind(o,l,p,_,v,x,E){let C=o.numAttributes,A=this.context,R=A.gl;this.vao&&this.destroy(),this.vao=A.gl.createVertexArray(),A.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=x,l.enableAttributes(R,o),l.bind(),l.setVertexAttribPointers(R,o,v);for(let O of p)O.enableAttributes(R,o),O.bind(),O.setVertexAttribPointers(R,o,v);for(let O of x)O&&(O.enableAttributes(R,o),O.bind(),O.setVertexAttribPointers(R,o,v),E&&O.instanceCount&&O.setVertexAttribDivisor(R,o,E));_&&_.bind(),A.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Mn(f,o){let l=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new r.O(0,p/l).toLngLat().lat,new r.O(0,(p+1)/l).toLngLat().lat]}function An(f,o,l,p,_,v,x){let E=f.context,C=E.gl,A=l.hillshadeFBO;if(!A)return;f.prepareDrawTile();let R=f.isTileAffectedByFog(o),O=f.getOrCreateProgram("hillshade",{overrideFog:R});E.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get());let N=((G,H,Z,ne)=>{let te=Z.paint.get("hillshade-shadow-color"),re=Z.paint.get("hillshade-highlight-color"),q=Z.paint.get("hillshade-accent-color"),X=Z.paint.get("hillshade-emissive-strength"),ce=r.bm(Z.paint.get("hillshade-illumination-direction"));if(Z.paint.get("hillshade-illumination-anchor")==="viewport")ce-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){let pe=G.style.directionalLight.properties.get("direction"),Ee=r.bT(pe.x,pe.y,pe.z);ce=r.bm(Ee[1])}let ae=!G.options.moving;return{u_matrix:ne||G.transform.calculateProjMatrix(H.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Mn(0,H.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),ce],u_shadow:te,u_highlight:re,u_emissive_strength:X,u_accent:q}})(f,l,p,f.terrain?o.projMatrix:null);f.uploadCommonUniforms(E,O,o.toUnwrapped());let{tileBoundsBuffer:z,tileBoundsIndexBuffer:U,tileBoundsSegments:j}=f.getTileBoundsBuffers(l);O.draw(f,C.TRIANGLES,_,v,x,Vt.disabled,N,p.id,z,U,j)}function uo(f,o,l){if(!o.needsDEMTextureUpload)return;let p=f.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||f.getTileTexture(l.stride);let v=l.getPixels();o.demTexture?o.demTexture.update(v,{premultiply:!1}):o.demTexture=new r.T(p,v,_.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function wl(f,o,l){let p=f.context,_=p.gl;if(!o.dem)return;let v=o.dem;if(p.activeTexture.set(_.TEXTURE1),uo(f,o,v),!o.demTexture)return;o.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);let x=v.dim;p.activeTexture.set(_.TEXTURE0);let E=o.hillshadeFBO;if(!E){let N=new r.T(p,{width:x,height:x,data:null},_.RGBA);N.bind(_.LINEAR,_.CLAMP_TO_EDGE),E=o.hillshadeFBO=p.createFramebuffer(x,x,!0,"renderbuffer"),E.colorAttachment.set(N.texture)}p.bindFramebuffer.set(E.framebuffer),p.viewport.set([0,0,x,x]);let{tileBoundsBuffer:C,tileBoundsIndexBuffer:A,tileBoundsSegments:R}=f.getMercatorTileBoundsBuffers(),O=[];f.linearFloatFilteringSupported()&&O.push("TERRAIN_DEM_FLOAT_FORMAT"),f.getOrCreateProgram("hillshadePrepare",{defines:O}).draw(f,_.TRIANGLES,Ct.disabled,qt.disabled,an.unblended,Vt.disabled,((N,z)=>{let U=z.stride,j=r.a9.create();return r.a9.ortho(j,0,r.Y,-r.Y,0,0,1),r.a9.translate(j,j,[0,-r.Y,0]),{u_matrix:j,u_image:1,u_dimension:[U,U],u_zoom:N.overscaledZ}})(o.tileID,v),l.id,C,A,R),o.needsHillshadePrepare=!1}let xn=f=>({u_matrix:new r.bN(f),u_image0:new r.bR(f),u_skirt_height:new r.bQ(f),u_ground_shadow_factor:new r.bP(f)}),Uc=(f,o,l)=>({u_matrix:f,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:l}),El=(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:_,u_merc_center:v,u_image0:0,u_frustum_tl:x,u_frustum_tr:E,u_frustum_br:C,u_frustum_bl:A,u_globe_pos:R,u_globe_radius:O,u_viewport:N,u_grid_matrix:j?Float32Array.from(j):new Float32Array(9),u_skirt_height:z,u_far_z_cutoff:U});function Tl(f,o){return f!=null&&o!=null&&!(!f.hasData()||!o.hasData())&&f.demTexture!=null&&o.demTexture!=null&&f.tileID.key!==o.tileID.key}let mr=new class{constructor(){this.operations={}}newMorphing(f,o,l,p,_){if(f in this.operations){let v=this.operations[f];v.to.tileID.key!==l.tileID.key&&(v.queued=l)}else this.operations[f]={startTime:p,phase:0,duration:_,from:o,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;let o=this.operations[f];return{from:o.from,to:o.to,phase:o.phase}}update(f){for(let o in this.operations){let l=this.operations[o];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[o];break}}}_nextOp(f,o){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=o,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},ki={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Lg(f,o,l){if(o===0)return 0;let p=o<1&&l===514?.25/o:1;return 6*Math.pow(1.5,22-f)*Math.max(o,1)*p}function Gc(f,o){let l=1<<f.z;return!o&&(f.x===0||f.x===l-1)||f.y===0||f.y===l-1}let $c=f=>({u_matrix:f});function Na(f,o,l,p,_){if(_>0){let v=r.f.now(),x=(v-f.timeAdded)/_,E=o?(v-o.timeAdded)/_:-1,C=l.getSource(),A=p.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),R=!o||Math.abs(o.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),O=R&&f.refreshedUponExpiration?1:r.ad(R?x:1-E,0,1);return f.refreshedUponExpiration&&x>=1&&(f.refreshedUponExpiration=!1),o?{opacity:1,mix:1-O}:{opacity:O,mix:0}}return{opacity:1,mix:0}}class Xf extends Vo{constructor(o){let l={type:"raster-dem",maxzoom:o.transform.maxZoom},p=new r.bZ(r.b_(),null),_=Pf("mock-dem",l,p,o.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,l){o.state="loaded",l(null)}}class Ud extends Vo{constructor(o){let l=Pf("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new r.bZ(r.b_(),null),o.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,l,p){if(o.freezeTileCoverage)return;this.transform=o;let _=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,x)=>{if(v[x.key]="",!this._tiles[x.key]){let E=new Bo(x,this._source.tileSize*x.overscaleFactor(),o.tileZoom);E.state="loaded",this._tiles[x.key]=E}return v},{});for(let v in this._tiles)v in _||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(o){let l=this.proxyCachedFBO[o];if(l!==void 0){let p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Er extends r.ap{constructor(o,l,p){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class ho extends r.cp{constructor(o,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[p,_,v]=function(C){let A=new r.aQ,R=new r.az,O=131;A.reserve(17161),R.reserve(33800);let N=r.Y/128,z=r.Y+N/2,U=z+N;for(let G=-N;G<U;G+=N)for(let H=-N;H<U;H+=N){let Z=H<0||H>z||G<0||G>z?24575:0,ne=r.ad(Math.round(H),0,r.Y),te=r.ad(Math.round(G),0,r.Y);A.emplaceBack(ne+Z,te)}let j=(G,H)=>{let Z=H*O+G;R.emplaceBack(Z+1,Z,Z+O),R.emplaceBack(Z+O,Z+O+1,Z+1)};for(let G=1;G<129;G++)for(let H=1;H<129;H++)j(H,G);return[0,129].forEach(G=>{for(let H=0;H<130;H++)j(H,G),j(G,H)}),[A,R,32768]}(),x=o.context;this.gridBuffer=x.createVertexBuffer(p,r.aS.members),this.gridIndexBuffer=x.createIndexBuffer(_),this.gridSegments=r.aE.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=r.aE.simpleSegment(0,0,p.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ud(l.map),this.orthoMatrix=r.a9.create(),r.a9.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.Y,0,r.Y,0,1);let E=x.gl;this._overlapStencilMode=new qt({func:E.GEQUAL,mask:255},0,255,E.KEEP,E.KEEP,E.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Xf(l.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,l,p){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let _=o.terrain.properties,v=o.terrain.drapeRenderMode===0,x=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.f.now();let E=o.terrain&&o.terrain.scope,C=_.get("source"),A=v?this._mockSourceCache:o.getSourceCache(C,E);if(!A)return void r.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=A,this._exaggeration=x?this.calculateExaggeration(l):_.get("exaggeration"),!l.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;let R=()=>{this.sourceCache.used&&r.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let O=this.getScaledDemTileSize();this.sourceCache.update(l,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,R(),this._initializing=!0),R(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(o){let l=this._previousCameraAltitude,p=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=p;let _=l!=null?p-l:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;let v=o.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(v);let E=v-this._previousZoom,C=this._previousUpdateTimestamp,A=v;this._evaluationZoom!=null&&(A=this._evaluationZoom,Math.abs(v-A)>.5&&(E=.5*(v-A+E)),E*_<0&&(A+=E)),this._evaluationZoom=A;let R=x.getExaggeration(A),O=R===x.getExaggeration(Math.max(0,A-.1));if(O&&Math.abs(R-this._exaggeration)<.01)return R;let N=Math.min(.1,.00375*(this._updateTimestamp-C));return(O||R<.1||Math.abs(E)<1e-4)&&(N=Math.min(.2,4*N)),r.X(this._exaggeration,R,N)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(r.O.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let _=this.proxyCoords=l.getIds().map(C=>{let A=l.getTileByID(C).tileID;return A.projMatrix=p.calculateProjMatrix(A.toUnwrapped()),A});(function(C,A){let R=A.transform.pointCoordinate(A.transform.getCameraPoint()),O=new r.P(R.x,R.y);C.sort((N,z)=>{if(z.overscaledZ-N.overscaledZ)return z.overscaledZ-N.overscaledZ;let U=new r.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),j=new r.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),G=O.mult(1<<N.canonical.z);return G.x-=.5,G.y-=.5,G.distSqr(U)-G.distSqr(j)})})(_,this.painter);let v=this.proxyToSource||{};this.proxyToSource={},_.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};let x=this._style._mergedSourceCaches;for(let C in x){let A=x[C];if(!A.used||(A!==this.sourceCache&&this.resetTileLookupCache(A.id),this._setupProxiedCoordsForOrtho(A,o[C],v),A.usedForTerrain))continue;let R=o[C];A.getSource().reparseOverscaled&&this._assignTerrainTiles(R)}this.proxiedCoords[l.id]=_.map(C=>new Er(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;let E={};this._visibleDemTiles=[];for(let C of this.proxyCoords){let A=this.terrainTileForTile[C.key];if(!A)continue;let R=A.tileID.key;R in E||(this._visibleDemTiles.push(A),E[R]=R)}}_assignTerrainTiles(o){this._initializing||o.forEach(l=>{if(this.terrainTileForTile[l.key])return;let p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){let o=this.painter.context,l=o.gl;for(let p in this.terrainTileForTile){let _=this.terrainTileForTile[p],v=_.dem;!v||_.demTexture&&!_.needsDEMTextureUpload||(o.activeTexture.set(l.TEXTURE1),uo(this.painter,_,v))}}_prepareDemTileUniforms(o,l,p,_){if(!l||l.demTexture==null)return!1;let v=o.tileID.canonical,x=Math.pow(2,l.tileID.canonical.z-v.z),E=_||"";return p[`u_dem_tl${E}`]=[v.x*x%1,v.y*x%1],p[`u_dem_scale${E}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let o=this.painter.context,l=o.gl;if(!this._emptyDepthBufferTexture){let p=new r.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.T(o,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0,l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;let v=_.dem.tree.minimums[0];return v>0&&o++,p+v},0);return o?l/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,l=o.gl;o.activeTexture.set(l.TEXTURE2);let p=this._getLoadedAreaMinimum(),[_,v]=(()=>{let E=new r.cr({width:1,height:1},new Float32Array([p]));return[l.R32F,E]})();this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(v,{premultiply:!1}):x=this._emptyDEMTexture=new r.T(o,v,_,{premultiply:!1}),x}setupElevationDraw(o,l,p){let _=this.painter.context,v=_.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};x.u_exaggeration=this.exaggeration();let E=null,C=null,A=1;if(p&&p.morphing&&this._useVertexMorphing){let N=p.morphing.srcDemTile,z=p.morphing.dstDemTile;A=p.morphing.phase,N&&z&&(this._prepareDemTileUniforms(o,N,x,"_prev")&&(C=N),this._prepareDemTileUniforms(o,z,x)&&(E=z))}let R=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST,O=N=>{x.u_dem_size=N.size[0]===1?1:N.size[0]-2};if(C&&E)_.activeTexture.set(v.TEXTURE2),E.demTexture.bind(R(E),v.CLAMP_TO_EDGE),_.activeTexture.set(v.TEXTURE4),C.demTexture.bind(R(C),v.CLAMP_TO_EDGE),E.demTexture&&O(E.demTexture),x.u_dem_lerp=A;else{E=this.terrainTileForTile[o.tileID.key],_.activeTexture.set(v.TEXTURE2);let N=this._prepareDemTileUniforms(o,E,x)?E.demTexture:this.emptyDEMTexture;N.bind(R(E),v.CLAMP_TO_EDGE),O(N)}if(_.activeTexture.set(v.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&E){let N=(1<<E.tileID.canonical.z)*r.bo(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=N}if(p&&p.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,x),this.painter.transform.projection.name==="globe"){let N=this.globeUniformValues(this.painter.transform,o.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(_,N)}}globeUniformValues(o,l,p){let _=o.projection;return{u_tile_tl_up:_.upVector(l,0,0),u_tile_tr_up:_.upVector(l,r.Y,0),u_tile_br_up:_.upVector(l,r.Y,r.Y),u_tile_bl_up:_.upVector(l,0,r.Y),u_tile_up_scale:p?r.cq(1):_.upVectorScale(l,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let l=this.painter,p=this.painter.context;o.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,v,x,E,C){if(_.transform.projection.name==="globe")(function(A,R,O,N,z){let U=A.context,j=U.gl,G,H,Z=A.transform,ne=r.ci(A,U,Z),te=(be,De)=>{if(H===De)return;let he=[ki[De],"PROJECTION_GLOBE_VIEW"];ne&&he.push("CUSTOM_ANTIALIASING");let ye=A.isTileAffectedByFog(be);G=A.getOrCreateProgram("globeRaster",{defines:he,overrideFog:ye}),H=De},re=A.colorModeForRenderPass(),q=new Ct(j.LEQUAL,Ct.ReadWrite,A.depthRangeFor3D);mr.update(z);let X=r.cj(Z),ce=[r.a8(Z.center.lng),r.ah(Z.center.lat)],ae=A.globeSharedBuffers,pe=[Z.width*r.f.devicePixelRatio,Z.height*r.f.devicePixelRatio],Ee=Float32Array.from(Z.globeMatrix),fe={useDenormalizedUpVectorScale:!0};{let be=A.transform,De=Lg(be.zoom,R.exaggeration(),R.sourceCache._source.tileSize);H=-1;let he=j.TRIANGLES;for(let ye of N){let Ve=O.getTile(ye),ge=qt.disabled,we=R.prevTerrainTileForTile[ye.key],Te=R.terrainTileForTile[ye.key];Tl(we,Te)&&mr.newMorphing(ye.key,we,Te,z,250),U.activeTexture.set(j.TEXTURE0),Ve.texture&&Ve.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let ie=mr.getMorphValuesForProxy(ye.key),Re=ie?1:0;ie&&r.k(fe,{morphing:{srcDemTile:ie.from,dstDemTile:ie.to,phase:r.ch(ie.phase)}});let ot=r.ck(ye.canonical),pt=r.cl(ot.getCenter().lat),wt=r.cm(ye.canonical,ot,pt,be.worldSize/be._pixelsPerMercatorPixel),yt=r.aW(r.cn(ye.canonical)),It=El(be.expandedFarZProjMatrix,Ee,X,yt,r.W(be.zoom),ce,be.frustumCorners.TL,be.frustumCorners.TR,be.frustumCorners.BR,be.frustumCorners.BL,be.globeCenterInViewSpace,be.globeRadius,pe,De,be._farZ,wt);if(te(ye,Re),G&&(R.setupElevationDraw(Ve,G,fe),A.uploadCommonUniforms(U,G,ye.toUnwrapped()),ae)){let[fn,$t,yn]=ae.getGridBuffers(pt,De!==0);G.draw(A,he,q,ge,re,Vt.backCCW,It,"globe_raster",fn,$t,yn)}}}if(ae&&(A.renderDefaultNorthPole||A.renderDefaultSouthPole)){let be=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&be.push("CUSTOM_ANTIALIASING"),G=A.getOrCreateProgram("globeRaster",{defines:be});for(let De of N){let{x:he,y:ye,z:Ve}=De.canonical,ge=ye===0,we=ye===(1<<Ve)-1,[Te,ie,Re,ot]=ae.getPoleBuffers(Ve,!1);if(ot&&(ge||we)){let pt=O.getTile(De);U.activeTexture.set(j.TEXTURE0),pt.texture&&pt.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let wt=r.co(Ve,he,Z),yt=r.aW(r.cn(De.canonical)),It=(fn,$t)=>fn.draw(A,j.TRIANGLES,q,qt.disabled,re,Vt.disabled,El(Z.expandedFarZProjMatrix,wt,wt,yt,0,ce,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,pe,0,Z._farZ),"globe_pole_raster",$t,Re,ot);R.setupElevationDraw(pt,G,fe),A.uploadCommonUniforms(U,G,De.toUnwrapped()),ge&&A.renderDefaultNorthPole&&It(G,Te),we&&A.renderDefaultSouthPole&&(wt=r.a9.scale(r.a9.create(),wt,[1,-1,1]),It(G,ie))}}}})(_,v,x,E,C);else{let A=_.context,R=A.gl,O,N,z=_.shadowRenderer,U=na(_,_.longestCutoffRange),j=re=>{if(N===re)return;let q=[];q.push(ki[re]),U.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),O=_.getOrCreateProgram("terrainRaster",{defines:q}),N=re},G=_.colorModeForRenderPass(),H=new Ct(R.LEQUAL,Ct.ReadWrite,_.depthRangeFor3D);mr.update(C);let Z=_.transform,ne=Lg(Z.zoom,v.exaggeration(),v.sourceCache._source.tileSize),te=[0,0,0];if(z){let re=_.style.directionalLight,q=_.style.ambientLight;re&&q&&(te=qf(re,q))}{N=-1;let re=R.TRIANGLES,[q,X]=[v.gridIndexBuffer,v.gridSegments];for(let ce of E){let ae=x.getTile(ce),pe=qt.disabled,Ee=v.prevTerrainTileForTile[ce.key],fe=v.terrainTileForTile[ce.key];Tl(Ee,fe)&&mr.newMorphing(ce.key,Ee,fe,C,250),A.activeTexture.set(R.TEXTURE0),ae.texture&&ae.texture.bind(R.LINEAR,R.CLAMP_TO_EDGE);let be=mr.getMorphValuesForProxy(ce.key),De=be?1:0,he;be&&(he={morphing:{srcDemTile:be.from,dstDemTile:be.to,phase:r.ch(be.phase)}});let ye=Uc(ce.projMatrix,Gc(ce.canonical,Z.renderWorldCopies)?ne/10:ne,te);if(j(De),!O)continue;v.setupElevationDraw(ae,O,he);let Ve=ce.toUnwrapped();z&&z.setupShadows(Ve,O),_.uploadCommonUniforms(A,O,Ve,null,U),O.draw(_,re,H,pe,G,Vt.backCCW,ye,"terrain_raster",v.gridBuffer,q,X)}}}}(l,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let l=this.painter,p=this.painter.context,_=this.proxySourceCache,v=this.proxiedCoords[_.id],x=this._drapedRenderBatches.shift(),E=l.style.order,C=[],A=0;for(let R of v){let O=_.getTileByID(R.proxyTileKey),N=_.proxyCachedFBO[R.key]?_.proxyCachedFBO[R.key][o]:void 0,z=N!==void 0?_.renderCache[N]:this.pool[A++],U=N!==void 0;if(O.texture=z.tex,U&&!z.dirty){C.push(O.tileID);continue}let j;p.bindFramebuffer.set(z.fb.framebuffer),this.renderedToTile=!1,z.dirty&&(p.clear({color:r.aA.transparent,stencil:0}),z.dirty=!1);for(let G=x.start;G<=x.end;++G){let H=l.style._mergedLayers[E[G]];if(H.isHidden(l.transform.zoom))continue;let Z=l.style.getLayerSourceCache(H),ne=Z?this.proxyToSource[R.key][Z.id]:[R];if(!ne)continue;let te=ne;p.viewport.set([0,0,z.fb.width,z.fb.height]),j!==(Z?Z.id:null)&&(this._setupStencil(z,ne,H,Z),j=Z?Z.id:null),l.renderLayer(l,Z,H,te)}if(this._drapedRenderBatches.length===0)for(let G of this._pendingGroundEffectLayers){let H=l.style._mergedLayers[E[G]];if(H.isHidden(l.transform.zoom))continue;let Z=l.style.getLayerSourceCache(H),ne=Z?this.proxyToSource[R.key][Z.id]:[R];if(!ne)continue;let te=ne;p.viewport.set([0,0,z.fb.width,z.fb.height]),j!==(Z?Z.id:null)&&(this._setupStencil(z,ne,H,Z),j=Z?Z.id:null),l.renderLayer(l,Z,H,te)}this.renderedToTile?(z.dirty=!0,C.push(O.tileID)):U||--A,A===5&&(A=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),x.end+1}postRender(){}isLayerOrderingCorrect(o){let l=o.order.length,p=-1,_=l;for(let v=0;v<l;++v)this._style.isLayerDraped(o._mergedLayers[o.order[v]])?p=Math.max(p,v):_=Math.min(_,v);return _>p}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{o=Math.min(o,l.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,l,p){if(!this._visibleDemTiles)return null;let _=this._visibleDemTiles.filter(v=>v.dem).map(v=>{let x=v.tileID,E=1<<x.overscaledZ,{x:C,y:A}=x.canonical,R=C/E,O=(C+1)/E,N=A/E,z=(A+1)/E;return{minx:R,miny:N,maxx:O,maxy:z,t:v.dem.tree.raycastRoot(R,N,O,z,o,l,p),tile:v}});_.sort((v,x)=>(v.t!==null?v.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(let v of _){if(v.t==null)return null;let x=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,o,l,p);if(x!=null)return x}return null}_createFBO(){let o=this.painter.context,l=o.gl,p=this.drapeBufferSize;o.activeTexture.set(l.TEXTURE0);let _=new r.T(o,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);let v=o.createFramebuffer(p[0],p[1],!0,null);return v.colorAttachment.set(_.texture),v.depthAttachment=new pb(o,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:v,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let l=this._style._mergedLayers[o],p=l.isHidden(this.painter.transform.zoom);return l.type==="custom"?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let p of this._style.getSources())if(p instanceof it){o=!0;break}if(!o)return;let l={};for(let p=0;p<this._style.order.length;++p){let _=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(_);if(v&&!l[v.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof r.Z){l[v.id]=!0;for(let x of this.proxyCoords){let E=this.proxyToSource[x.key][v.id];if(E)for(let C of E)this._clearRenderCacheForTile(v.id,C)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof rt){o=!0;break}if(!o)return;let l={};for(let p=0;p<this._style.order.length;++p){let _=this._style._mergedLayers[this._style.order[p]],v=this._style.getLayerSourceCache(_);if(!v||l[v.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;let x=_.paint.get("raster-fade-duration");for(let E of this.proxyCoords){let C=this.proxyToSource[E.key][v.id];if(C)for(let A of C){let R=Na(v.getTile(A),v.findLoadedParent(A,0),v,this.painter.transform,x);(R.opacity!==1||R.mix!==0)&&this._clearRenderCacheForTile(v.id,A)}}}}_setupDrapedRenderBatches(){let o=this._style.order,l=o.length;if(l===0)return;let p=[];this._pendingGroundEffectLayers=[];let _,v=0,x=this._style._mergedLayers[o[v]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++v<l;)x=this._style._mergedLayers[o[v]];for(;v<l;++v){let E=this._style._mergedLayers[o[v]];E.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(E)?_===void 0&&(_=v):(E.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),_!==void 0&&(p.push({start:_,end:v-1}),_=void 0)))}if(_!==void 0&&p.push({start:_,end:v-1}),p.length!==0){let E=p[p.length-1];this._pendingGroundEffectLayers.every(C=>C>E.end)||r.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(o){let l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){let x=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let E=0;E<x.length;++E){let C=Object.values(x[E]);l.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();let p=this.proxyCoords,_=this._tilesDirty;for(let x=p.length-1;x>=0;x--){let E=p[x];if(l.getTileByID(E.key),l.proxyCachedFBO[E.key]!==void 0){let C=o[E.key],A=this.proxyToSource[E.key],R=0;for(let O in A){let N=A[O],z=C[O];if(!z||z.length!==N.length||N.some((U,j)=>U!==z[j]||_[O]&&_[O].hasOwnProperty(U.key))){R=-1;break}++R}for(let O in l.proxyCachedFBO[E.key])l.renderCache[l.proxyCachedFBO[E.key][O]].dirty=R<0||R!==Object.values(C).length}}let v=[...this._drapedRenderBatches];v.sort((x,E)=>E.end-E.start-(x.end-x.start));for(let x of v)for(let E of p){if(l.proxyCachedFBO[E.key])continue;let C=l.renderCachePool.pop();C===void 0&&l.renderCache.length<50&&(C=l.renderCache.length,l.renderCache.push(this._createFBO())),C!==void 0&&(l.proxyCachedFBO[E.key]={},l.proxyCachedFBO[E.key][x.start]=C,l.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(o,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let v=this.painter.context,x=v.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let E;if(p.isTileClipped())E=l.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);E=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+E>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=E,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):qt.disabled}_renderTileClippingMasks(o,l){let p=this.painter,_=this.painter.context,v=_.gl;p._tileClippingMaskIDs={},_.setColorMode(an.disabled),_.setDepthMode(Ct.disabled);let x=p.getOrCreateProgram("clippingMask");for(let E of o){let C=p._tileClippingMaskIDs[E.key]=--l;x.draw(p,v.TRIANGLES,Ct.disabled,new qt({func:v.ALWAYS,mask:0},C,255,v.KEEP,v.KEEP,v.REPLACE),an.disabled,Vt.disabled,$c(E.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(o){let l=this.painter.transform;if(o.x<0||o.x>l.width||o.y<0||o.y>l.height)return null;let p=[o.x,o.y,1,1];r.aa.transformMat4(p,p,l.pixelMatrixInverse),r.aa.scale(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;let _=l._camera.position,v=r.bo(1,l.center.lat),x=[_[0],_[1],_[2]/v,0],E=r.Q.subtract([],p.slice(0,3),x);r.Q.normalize(E,E);let C=this.raycast(x,E,this._exaggeration);return C!==null&&C?(r.Q.scaleAndAdd(x,x,E,C),x[3]=x[2],x[2]*=v,x):null}drawDepth(){let o=this.painter,l=o.context,p=this.proxySourceCache,_=Math.ceil(o.width),v=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===v||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let x=l.gl,E=l.createFramebuffer(_,v,!0,"renderbuffer");l.activeTexture.set(x.TEXTURE0);let C=new r.T(l,{width:_,height:v,data:null},x.RGBA);C.bind(x.NEAREST,x.CLAMP_TO_EDGE),E.colorAttachment.set(C.texture);let A=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,v);E.depthAttachment.set(A),this._depthFBO=E,this._depthTexture=C}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,v]),function(x,E,C,A){if(x.transform.projection.name==="globe")return;let R=x.context,O=R.gl;R.clear({depth:1});let N=x.getOrCreateProgram("terrainDepth"),z=new Ct(O.LESS,Ct.ReadWrite,x.depthRangeFor3D);for(let U of A){let j=C.getTile(U),G=Uc(U.projMatrix,0,[0,0,0]);E.setupElevationDraw(j,N),N.draw(x,O.TRIANGLES,z,qt.disabled,an.unblended,Vt.backCCW,G,"terrain_depth",E.gridBuffer,E.gridIndexBuffer,E.gridNoSkirtSegments)}}(o,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,l,p){if(o.getSource()instanceof r.as)return this._setupProxiedCoordsForImageSource(o,l,p);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let _=this.proxiedCoords[o.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){let A=v[C],R=this._findTileCoveringTileID(A,o);if(R){let O=this._createProxiedId(A,R,p[A.key]&&p[A.key][o.id]);_.push(O),this.proxyToSource[A.key][o.id]=[O]}}let x=!1,E=new Set;for(let C=0;C<l.length;C++){let A=o.getTile(l[C]);if(!A||!A.hasData())continue;let R=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(R&&R.tileID.canonical.z!==A.tileID.canonical.z){let O=this.proxyToSource[R.tileID.key][o.id],N=this._createProxiedId(R.tileID,A,p[R.tileID.key]&&p[R.tileID.key][o.id]);O?O.splice(O.length-1,0,N):this.proxyToSource[R.tileID.key][o.id]=[N];let z=this.proxyToSource[R.tileID.key][o.id];E.has(z)||E.add(z),_.push(N),x=!0}}if(this._sourceTilesOverlap[o.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(let C of E)C.sort((A,R)=>R.overscaledZ-A.overscaledZ)}_setupProxiedCoordsForImageSource(o,l,p){if(!o.getSource().loaded())return;let _=this.proxiedCoords[o.id]=[],v=this.proxyCoords,x=o.getSource(),E=x.tileID;if(!E)return;let C=new r.P(E.x,E.y)._div(1<<E.z),A=x.coordinates.map(r.O.fromLngLat).reduce((O,N)=>(O.min.x=Math.min(O.min.x,N.x-C.x),O.min.y=Math.min(O.min.y,N.y-C.y),O.max.x=Math.max(O.max.x,N.x-C.x),O.max.y=Math.max(O.max.y,N.y-C.y),O),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),R=(O,N)=>{let z=O.wrap+O.canonical.x/(1<<O.canonical.z),U=O.canonical.y/(1<<O.canonical.z),j=r.Y/(1<<O.canonical.z),G=N.wrap+N.canonical.x/(1<<N.canonical.z),H=N.canonical.y/(1<<N.canonical.z);return z+j<G+A.min.x||z>G+A.max.x||U+j<H+A.min.y||U>H+A.max.y};for(let O=0;O<v.length;O++){let N=v[O];for(let z=0;z<l.length;z++){let U=o.getTile(l[z]);if(!U||!U.hasData()||R(N,U.tileID))continue;let j=this._createProxiedId(N,U,p[N.key]&&p[N.key][o.id]),G=this.proxyToSource[N.key][o.id];G?G.push(j):this.proxyToSource[N.key][o.id]=[j],_.push(j)}}}_createProxiedId(o,l,p){let _=this.orthoMatrix;if(p){let v=p.find(x=>x.key===l.tileID.key);if(v)return v}if(l.tileID.key!==o.key){let v=o.canonical.z-l.tileID.canonical.z,x,E,C;_=r.a9.create();let A=l.tileID.wrap-o.wrap<<o.overscaledZ;v>0?(x=r.Y>>v,E=x*((l.tileID.canonical.x<<v)-o.canonical.x+A),C=x*((l.tileID.canonical.y<<v)-o.canonical.y)):(x=r.Y<<-v,E=r.Y*(l.tileID.canonical.x-(o.canonical.x+A<<-v)),C=r.Y*(l.tileID.canonical.y-(o.canonical.y<<-v))),r.a9.ortho(_,0,x,0,x,0,1),r.a9.translate(_,_,[E,C,0])}return new Er(l.tileID,o.key,_)}_findTileCoveringTileID(o,l){let p=l.getTile(o);if(p&&p.hasData())return p;let _=this._findCoveringTileCache[l.id],v=_[o.key];if(p=v?l.getTileByID(v):null,p&&p.hasData()||v===null)return p;let x=p?p.tileID:o,E=x.overscaledZ,C=l.getSource().minzoom,A=[];if(!v){let O=l.getSource().maxzoom;if(o.canonical.z>=O){let N=o.canonical.z-O;l.getSource().reparseOverscaled?(E=Math.max(o.canonical.z+2,l.transform.tileZoom),x=new r.ap(E,o.wrap,O,o.canonical.x>>N,o.canonical.y>>N)):N!==0&&(E=O,x=new r.ap(E,o.wrap,O,o.canonical.x>>N,o.canonical.y>>N))}x.key!==o.key&&(A.push(x.key),p=l.getTile(x))}let R=O=>{A.forEach(N=>{_[N]=O}),A.length=0};for(E-=1;E>=C&&(!p||!p.hasData());E--){p&&R(p.tileID.key);let O=x.calculateScaledKey(E);if(p=l.getTileByID(O),p&&p.hasData())break;let N=_[O];if(N===null)break;N===void 0?A.push(O):p=l.getTileByID(N)}return R(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,l){let p=this._tilesDirty[o];p||(p=this._tilesDirty[o]={}),p[l.key]=!0}}function Ng(f,o,l){let p=function(E,C,A){let R=r.Q.dot(C,E),O=r.Q.dot(A,[.2126,.7152,.0722]),N=(U,j,G)=>(1-G)*U+G*j,z=N(1-.3*Math.min(O,1),1,Math.min(R+1,1));return N(.92,1,Math.asin(r.ad(C[2],-1,1))/Math.PI+.5)*z}(f,[0,0,1],o),_=[0,0,0];r.Q.scale(_,l.slice(0,3),p);let v=[0,0,0];r.Q.scale(v,o.slice(0,3),f[2]);let x=[0,0,0];return r.Q.add(x,_,v),r.bX(x)}let Dl=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Qi=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class To{static cacheKey(o,l,p,_){let v=`${l}${_?_.cacheKey:""}`;for(let x of p)o.usedDefines.includes(x)&&(v+=`/${x}`);return v}constructor(o,l,p,_,v,x){let E=o.gl;this.program=E.createProgram(),this.configuration=_,this.name=l,this.fixedDefines=[...x];let C=_?_.getBinderAttributes():[],A=(p.staticAttributes||[]).concat(C),R=_?_.defines():[];R=R.concat(x.map(G=>`#define ${G}`));let O=`#version 300 es
`,N=O+R.concat("precision mediump float;",jd,jc.fragmentSource).join(`
`);for(let G of p.fragmentIncludes)N+=`
${sn[G]}`;N+=`
${p.fragmentSource}`;let z=O+R.concat("precision highp float;",jd,jc.vertexSource).join(`
`);for(let G of p.vertexIncludes)z+=`
${sn[G]}`;z+=`
${p.vertexSource}`;let U=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(U,N),E.compileShader(U),E.attachShader(this.program,U);let j=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(j,z),E.compileShader(j),E.attachShader(this.program,j),this.attributes={},this.numAttributes=A.length;for(let G=0;G<this.numAttributes;G++)if(A[G]){let H=A[G].startsWith("a_")?A[G]:`a_${A[G]}`;E.bindAttribLocation(this.program,G,H),this.attributes[H]=G}E.linkProgram(this.program),E.deleteShader(j),E.deleteShader(U),this.fixedUniforms=v(o),this.binderUniforms=_?_.getUniforms(o):[],x.includes("TERRAIN")&&(this.terrainUniforms=(G=>({u_dem:new r.bR(G),u_dem_prev:new r.bR(G),u_dem_tl:new r.bO(G),u_dem_scale:new r.bQ(G),u_dem_tl_prev:new r.bO(G),u_dem_scale_prev:new r.bQ(G),u_dem_size:new r.bQ(G),u_dem_lerp:new r.bQ(G),u_exaggeration:new r.bQ(G),u_depth:new r.bR(G),u_depth_size_inv:new r.bO(G),u_meter_to_dem:new r.bQ(G),u_label_plane_matrix_inv:new r.bN(G)}))(o)),x.includes("GLOBE")&&(this.globeUniforms=(G=>({u_tile_tl_up:new r.bP(G),u_tile_tr_up:new r.bP(G),u_tile_br_up:new r.bP(G),u_tile_bl_up:new r.bP(G),u_tile_up_scale:new r.bQ(G)}))(o)),x.includes("FOG")&&(this.fogUniforms=(G=>({u_fog_matrix:new r.bN(G),u_fog_range:new r.bO(G),u_fog_color:new r.bS(G),u_fog_horizon_blend:new r.bQ(G),u_fog_vertical_limit:new r.bO(G),u_fog_temporal_offset:new r.bQ(G),u_frustum_tl:new r.bP(G),u_frustum_tr:new r.bP(G),u_frustum_br:new r.bP(G),u_frustum_bl:new r.bP(G),u_globe_pos:new r.bP(G),u_globe_radius:new r.bQ(G),u_globe_transition:new r.bQ(G),u_is_globe:new r.bR(G),u_viewport:new r.bO(G)}))(o)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(G=>({u_cutoff_params:new r.bS(G)}))(o)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(G=>({u_lighting_ambient_color:new r.bP(G),u_lighting_directional_dir:new r.bP(G),u_lighting_directional_color:new r.bP(G),u_ground_radiance:new r.bP(G)}))(o)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(G=>({u_light_matrix_0:new r.bN(G),u_light_matrix_1:new r.bN(G),u_fade_range:new r.bO(G),u_shadow_normal_offset:new r.bP(G),u_shadow_intensity:new r.bQ(G),u_shadow_texel_size:new r.bQ(G),u_shadow_map_resolution:new r.bQ(G),u_shadow_direction:new r.bP(G),u_shadow_bias:new r.bP(G),u_shadowmap_0:new r.bR(G),u_shadowmap_1:new r.bR(G)}))(o))}}setTerrainUniformValues(o,l){if(!this.terrainUniforms)return;let p=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setGlobeUniformValues(o,l){if(!this.globeUniforms)return;let p=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in l)p[_]&&p[_].set(this.program,_,l[_])}}setFogUniformValues(o,l){if(!this.fogUniforms)return;let p=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}setCutoffUniformValues(o,l){if(!this.cutoffUniforms)return;let p=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}setLightsUniformValues(o,l){if(!this.lightsUniforms)return;let p=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}}setShadowUniformValues(o,l){if(this.failedToCreate||!this.shadowUniforms)return;let p=this.shadowUniforms;o.program.set(this.program);for(let _ in l)p[_].set(this.program,_,l[_])}_drawDebugWireframe(o,l,p,_,v,x,E,C,A,R){let O=o.options.wireframe;if(O.terrain===!1&&O.layers2D===!1&&O.layers3D===!1)return;let N=o.context;if(!(!(!O.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!O.layers2D||o._terrain&&o._terrain.renderingToTexture||!Dl.includes(this.name))||!(!O.layers3D||!Qi.includes(this.name))))return;let z=N.gl,U=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,v,N);if(!U)return;let j=[...this.fixedDefines];j.push("DEBUG_WIREFRAME");let G=o.getOrCreateProgram(this.name,{config:this.configuration,defines:j});N.program.set(G.program);let H=(te,re,q)=>{if(re[te]&&q[te])for(let X in re[te])q[te][X]&&q[te][X].set(q.program,X,re[te][X].current)};A&&A.setUniforms(G.program,N,G.binderUniforms,E,{zoom:C}),H("fixedUniforms",this,G),H("terrainUniforms",this,G),H("globeUniforms",this,G),H("fogUniforms",this,G),H("lightsUniforms",this,G),H("shadowUniforms",this,G),U.bind(),N.setColorMode(new an([z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ZERO,z.ONE],r.aA.transparent,[!0,!0,!0,!1])),N.setDepthMode(new Ct(l.func===z.LESS?z.LEQUAL:l.func,Ct.ReadOnly,l.range)),N.setStencilMode(qt.disabled);let Z=3*x.primitiveLength*2,ne=3*x.primitiveOffset*2*2;R&&R>1?z.drawElementsInstanced(z.LINES,Z,z.UNSIGNED_SHORT,ne,R):z.drawElements(z.LINES,Z,z.UNSIGNED_SHORT,ne),v.bind(),N.program.set(this.program),N.setDepthMode(l),N.setStencilMode(p),N.setColorMode(_)}draw(o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G){let H=o.context,Z=H.gl;if(this.failedToCreate)return;H.program.set(this.program),H.setDepthMode(p),H.setStencilMode(_),H.setColorMode(v),H.setCullFace(x);for(let re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(this.program,re,E[re]);U&&U.setUniforms(this.program,H,this.binderUniforms,N,{zoom:z});let ne={[Z.POINTS]:1,[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[l],te=G&&G>0?1:void 0;for(let re of O.get()){let q=re.vaos||(re.vaos={});(q[C]||(q[C]=new ut)).bind(H,this,A,U?U.getPaintVertexBuffers():[],R,re.vertexOffset,j||[],te),G&&G>1?Z.drawElementsInstanced(l,re.primitiveLength*ne,Z.UNSIGNED_SHORT,re.primitiveOffset*ne*2,G):R?Z.drawElements(l,re.primitiveLength*ne,Z.UNSIGNED_SHORT,re.primitiveOffset*ne*2):Z.drawArrays(l,re.vertexOffset,re.vertexLength),l===Z.TRIANGLES&&R&&this._drawDebugWireframe(o,p,_,v,R,re,N,z,U,G)}}}function rs(f,o){let l=Math.pow(2,o.tileID.overscaledZ),p=o.tileSize*Math.pow(2,f.transform.tileZoom)/l,_=p*(o.tileID.canonical.x+o.tileID.wrap*l),v=p*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.a6(o,1,f.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v]}}let ar=r.a9.create(),Gd=(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j)=>{let G=o.style.light,H=G.properties.get("position"),Z=[H.x,H.y,H.z],ne=r.ct.create();G.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(ne,-o.transform.angle),r.Q.transformMat3(Z,Z,ne));let te=G.properties.get("color"),re=o.transform,q={u_matrix:f,u_lightpos:Z,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ar,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:_,u_edge_radius:v,u_flood_light_color:O,u_vertical_scale:N,u_flood_light_intensity:z,u_ground_shadow_factor:U,u_emissive_strength:j};return re.projection.name==="globe"&&(q.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],q.u_zoom_transition=C,q.u_inv_rot_matrix=R,q.u_merc_center=A,q.u_up_dir=re.projection.upVector(new r.bv(0,0,0),A[0]*r.Y,A[1]*r.Y),q.u_height_lift=E),q},Ho=(f,o,l)=>({u_matrix:f,u_edge_radius:o,u_vertical_scale:l}),Hc=(f,o,l,p,_,v,x,E,C,A,R,O,N,z)=>{let U=Gd(f,o,l,p,_,v,x,C,A,R,O,N,z,1,[0,0,0],0),j={u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8};return r.e(U,rs(o,E),j)},Il=(f,o)=>({u_matrix:f,u_emissive_strength:o}),oa=(f,o,l,p)=>r.e(Il(f,o),rs(l,p)),vb=(f,o,l)=>({u_matrix:f,u_world:l,u_emissive_strength:o}),Ps=(f,o,l,p,_)=>r.e(oa(f,o,l,p),{u_world:_}),bb=(f,o,l,p)=>{let _=r.Y/l.tileSize;return{u_matrix:f,u_camera_to_center_distance:o.getCameraToCenterDistance(p),u_extrude_scale:[o.pixelsToGLUnits[0]/_,o.pixelsToGLUnits[1]/_]}},Kf=(f,o,l=1)=>({u_matrix:f,u_color:o,u_overlay:0,u_overlay_scale:l}),Kr=r.a9.create(),xb=(f,o,l,p,_,v,x)=>{let E=f.transform,C=E.projection.name==="globe",A=C?r.cu(E.zoom,o.canonical)*E._pixelsPerMercatorPixel:r.a6(l,1,v),R={u_matrix:o.projMatrix,u_extrude_scale:A,u_intensity:x,u_inv_rot_matrix:Kr,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){R.u_inv_rot_matrix=p,R.u_merc_center=_,R.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],R.u_zoom_transition=r.W(E.zoom);let O=_[0]*r.Y,N=_[1]*r.Y;R.u_up_dir=E.projection.upVector(new r.bv(0,0,0),O,N)}return R};function qc(f,[o,l,p,_],[v,x]){if(v===x)return[0,0,0,0];let E=255*(f-1)/(f*(x-v));return[o*E,l*E,p*E,_*E]}function Jf(f,o,[l,p]){return l===p?0:.5/f+(o-l)*(f-1)/(f*(p-l))}let zg=(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G,H,Z,ne,te)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:A,u_fade_t:R.mix,u_opacity:R.opacity*O.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:O.paint.get("raster-brightness-min"),u_brightness_high:O.paint.get("raster-brightness-max"),u_saturation_factor:r.cv(O.paint.get("raster-saturation")),u_contrast_factor:r.cw(O.paint.get("raster-contrast")),u_spin_weights:wb(O.paint.get("raster-hue-rotate")),u_perspective_transform:N,u_raster_elevation:z,u_zoom_transition:x,u_merc_center:E,u_cutoff_params:C,u_colorization_mix:qc(r.cx,j,H),u_colorization_offset:Jf(r.cx,G,H),u_color_ramp:U,u_texture_offset:[ne/(Z+2*ne),Z/(Z+2*ne)],u_texture_res:[Z+2*ne,Z+2*ne],u_emissive_strength:te});function wb(f){f*=Math.PI/180;let o=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*o-l+1)/3,(Math.sqrt(3)*o-l+1)/3]}let Wc=(f,o,l,p,_,v,x,E,C,A,R,O)=>({u_matrix:f,u_normalize_matrix:o,u_globe_matrix:l,u_merc_matrix:p,u_grid_matrix:_,u_tl_parent:v,u_scale_parent:A,u_fade_t:R.mix,u_opacity:R.opacity,u_image0:0,u_image1:1,u_raster_elevation:O,u_zoom_transition:x,u_merc_center:E,u_cutoff_params:C}),Zc=(f,o,l,p,_,v,x,E,C,A)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_tile_offset:l,u_velocity:p,u_color_ramp:v,u_velocity_res:_,u_max_speed:x,u_uv_offset:E,u_data_scale:C,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Pa,Pa]}),Eb=(f,o,l,p,_,v,x,E,C,A)=>({u_particle_texture:f,u_particle_texture_side_len:o,u_velocity:l,u_velocity_res:p,u_max_speed:_,u_speed_factor:v,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:E,u_data_scale:C,u_data_offset:A,u_particle_pos_scale:1.3,u_particle_pos_offset:[Pa,Pa]}),za=r.a9.create(),ep=(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G,H)=>{let Z=_.transform,ne={u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Z.getCameraToCenterDistance(j),u_rotate_symbol:+l,u_aspect_ratio:Z.width/Z.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:x,u_coord_matrix:E,u_is_text:+C,u_pitch_with_map:+p,u_texsize:A,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:za,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:za,u_up_vector:[0,-1,0],u_color_adj_mat:G,u_icon_transition:H||0};return j.name==="globe"&&(ne.u_tile_id=[R.canonical.x,R.canonical.y,1<<R.canonical.z],ne.u_zoom_transition=O,ne.u_inv_rot_matrix=z,ne.u_merc_center=N,ne.u_camera_forward=Z._camera.forward(),ne.u_ecef_origin=r.cy(Z.globeMatrix,R.toUnwrapped()),ne.u_tile_matrix=Float32Array.from(Z.globeMatrix),ne.u_up_vector=U),ne},Cl=(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G)=>r.e(ep(f,o,l,p,_,v,x,E,C,A,O,N,z,U,j,G),{u_gamma_scale:p?_.transform.getCameraToCenterDistance(G)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:r.f.devicePixelRatio,u_is_halo:+R,undefined:void 0}),sa=(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j)=>r.e(Cl(f,o,l,p,_,v,x,E,!0,C,!0,R,O,N,z,U,j),{u_texsize_icon:A,u_texture_icon:1}),Tb=(f,o,l,p)=>({u_matrix:f,u_emissive_strength:o,u_opacity:l,u_color:p}),Db=(f,o,l,p,_,v,x)=>r.e(function(E,C,A,R){let O=A.imageManager.getPattern(E.toString(),C),{width:N,height:z}=A.imageManager.getPixelSize(C),U=Math.pow(2,R.tileID.overscaledZ),j=R.tileSize*Math.pow(2,A.transform.tileZoom)/U,G=j*(R.tileID.canonical.x+R.tileID.wrap*U),H=j*R.tileID.canonical.y;return{u_image:0,u_pattern_tl:O.tl,u_pattern_br:O.br,u_texsize:[N,z],u_pattern_size:O.displaySize,u_tile_units_to_pixels:1/r.a6(R,1,A.transform.tileZoom),u_pixel_coord_upper:[G>>16,H>>16],u_pixel_coord_lower:[65535&G,65535&H]}}(_,v,p,x),{u_matrix:f,u_emissive_strength:o,u_opacity:l}),tp=new Float32Array(r.a9.identity([])),$d=(f,o,l,p,_,v,x,E,C,A,R,O,N,z=[0,0,0],U)=>{let j=_.style.light,G=j.properties.get("position"),H=[-G.x,-G.y,G.z],Z=r.ct.create();j.properties.get("anchor")==="viewport"&&(r.ct.fromRotation(Z,-_.transform.angle),r.Q.transformMat3(H,H,Z));let ne=R.alphaMode==="MASK",te=j.properties.get("color"),re=N.paint.get("model-ambient-occlusion-intensity"),q=N.paint.get("model-color").constantOr(r.aA.white),X=N.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:f,u_lighting_matrix:o,u_normal_matrix:l,u_node_matrix:p||tp,u_lightpos:H,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[te.r,te.g,te.b],u_camera_pos:z,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+ne,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[E[0],E[1],E[2],1],u_metallicFactor:C,u_roughnessFactor:A,u_baseColorTexture:Yr.BaseColor,u_metallicRoughnessTexture:Yr.MetallicRoughness,u_normalTexture:Yr.Normal,u_occlusionTexture:Yr.Occlusion,u_emissionTexture:Yr.Emission,u_color_mix:[q.r,q.g,q.b,X],u_aoIntensity:re,u_emissive_strength:O,u_occlusionTextureTransform:U||[0,0,0,0]}},Bg=(f,o=tp,l=tp)=>({u_matrix:f,u_instance:o,u_node_matrix:l}),np={fillExtrusion:f=>({u_matrix:new r.bN(f),u_lightpos:new r.bP(f),u_lightintensity:new r.bQ(f),u_lightcolor:new r.bP(f),u_vertical_gradient:new r.bQ(f),u_opacity:new r.bQ(f),u_edge_radius:new r.bQ(f),u_ao:new r.bO(f),u_tile_id:new r.bP(f),u_zoom_transition:new r.bQ(f),u_inv_rot_matrix:new r.bN(f),u_merc_center:new r.bO(f),u_up_dir:new r.bP(f),u_height_lift:new r.bQ(f),u_flood_light_color:new r.bP(f),u_vertical_scale:new r.bQ(f),u_flood_light_intensity:new r.bQ(f),u_ground_shadow_factor:new r.bP(f),u_emissive_strength:new r.bQ(f)}),fillExtrusionDepth:f=>({u_matrix:new r.bN(f),u_edge_radius:new r.bQ(f),u_vertical_scale:new r.bQ(f)}),fillExtrusionPattern:f=>({u_matrix:new r.bN(f),u_lightpos:new r.bP(f),u_lightintensity:new r.bQ(f),u_lightcolor:new r.bP(f),u_vertical_gradient:new r.bQ(f),u_height_factor:new r.bQ(f),u_edge_radius:new r.bQ(f),u_ao:new r.bO(f),u_tile_id:new r.bP(f),u_zoom_transition:new r.bQ(f),u_inv_rot_matrix:new r.bN(f),u_merc_center:new r.bO(f),u_up_dir:new r.bP(f),u_height_lift:new r.bQ(f),u_image:new r.bR(f),u_texsize:new r.bO(f),u_pixel_coord_upper:new r.bO(f),u_pixel_coord_lower:new r.bO(f),u_tile_units_to_pixels:new r.bQ(f),u_opacity:new r.bQ(f)}),fillExtrusionGroundEffect:f=>({u_matrix:new r.bN(f),u_opacity:new r.bQ(f),u_ao_pass:new r.bQ(f),u_meter_to_tile:new r.bQ(f),u_ao:new r.bO(f),u_flood_light_intensity:new r.bQ(f),u_flood_light_color:new r.bP(f),u_attenuation:new r.bQ(f),u_edge_radius:new r.bQ(f),u_fb:new r.bR(f),u_fb_size:new r.bQ(f)}),fill:f=>({u_matrix:new r.bN(f),u_emissive_strength:new r.bQ(f)}),fillPattern:f=>({u_matrix:new r.bN(f),u_emissive_strength:new r.bQ(f),u_image:new r.bR(f),u_texsize:new r.bO(f),u_pixel_coord_upper:new r.bO(f),u_pixel_coord_lower:new r.bO(f),u_tile_units_to_pixels:new r.bQ(f)}),fillOutline:f=>({u_matrix:new r.bN(f),u_emissive_strength:new r.bQ(f),u_world:new r.bO(f)}),fillOutlinePattern:f=>({u_matrix:new r.bN(f),u_emissive_strength:new r.bQ(f),u_world:new r.bO(f),u_image:new r.bR(f),u_texsize:new r.bO(f),u_pixel_coord_upper:new r.bO(f),u_pixel_coord_lower:new r.bO(f),u_tile_units_to_pixels:new r.bQ(f)}),circle:r.cz,collisionBox:f=>({u_matrix:new r.bN(f),u_camera_to_center_distance:new r.bQ(f),u_extrude_scale:new r.bO(f)}),collisionCircle:f=>({u_matrix:new r.bN(f),u_inv_matrix:new r.bN(f),u_camera_to_center_distance:new r.bQ(f),u_viewport_size:new r.bO(f)}),debug:f=>({u_color:new r.cf(f),u_matrix:new r.bN(f),u_overlay:new r.bR(f),u_overlay_scale:new r.bQ(f)}),clippingMask:f=>({u_matrix:new r.bN(f)}),heatmap:f=>({u_extrude_scale:new r.bQ(f),u_intensity:new r.bQ(f),u_matrix:new r.bN(f),u_inv_rot_matrix:new r.bN(f),u_merc_center:new r.bO(f),u_tile_id:new r.bP(f),u_zoom_transition:new r.bQ(f),u_up_dir:new r.bP(f)}),heatmapTexture:f=>({u_image:new r.bR(f),u_color_ramp:new r.bR(f),u_opacity:new r.bQ(f)}),hillshade:f=>({u_matrix:new r.bN(f),u_image:new r.bR(f),u_latrange:new r.bO(f),u_light:new r.bO(f),u_shadow:new r.cf(f),u_highlight:new r.cf(f),u_emissive_strength:new r.bQ(f),u_accent:new r.cf(f)}),hillshadePrepare:f=>({u_matrix:new r.bN(f),u_image:new r.bR(f),u_dimension:new r.bO(f),u_zoom:new r.bQ(f)}),line:r.cA,linePattern:r.cB,raster:f=>({u_matrix:new r.bN(f),u_normalize_matrix:new r.bN(f),u_globe_matrix:new r.bN(f),u_merc_matrix:new r.bN(f),u_grid_matrix:new r.cg(f),u_tl_parent:new r.bO(f),u_scale_parent:new r.bQ(f),u_fade_t:new r.bQ(f),u_opacity:new r.bQ(f),u_image0:new r.bR(f),u_image1:new r.bR(f),u_brightness_low:new r.bQ(f),u_brightness_high:new r.bQ(f),u_saturation_factor:new r.bQ(f),u_contrast_factor:new r.bQ(f),u_spin_weights:new r.bP(f),u_perspective_transform:new r.bO(f),u_raster_elevation:new r.bQ(f),u_zoom_transition:new r.bQ(f),u_merc_center:new r.bO(f),u_cutoff_params:new r.bS(f),u_colorization_mix:new r.bS(f),u_colorization_offset:new r.bQ(f),u_color_ramp:new r.bR(f),u_texture_offset:new r.bO(f),u_texture_res:new r.bO(f),u_emissive_strength:new r.bQ(f)}),rasterParticle:f=>({u_matrix:new r.bN(f),u_normalize_matrix:new r.bN(f),u_globe_matrix:new r.bN(f),u_merc_matrix:new r.bN(f),u_grid_matrix:new r.cg(f),u_tl_parent:new r.bO(f),u_scale_parent:new r.bQ(f),u_fade_t:new r.bQ(f),u_opacity:new r.bQ(f),u_image0:new r.bR(f),u_image1:new r.bR(f),u_raster_elevation:new r.bQ(f),u_zoom_transition:new r.bQ(f),u_merc_center:new r.bO(f),u_cutoff_params:new r.bS(f)}),rasterParticleTexture:f=>({u_texture:new r.bR(f),u_opacity:new r.bQ(f)}),rasterParticleDraw:f=>({u_particle_texture:new r.bR(f),u_particle_texture_side_len:new r.bQ(f),u_tile_offset:new r.bO(f),u_velocity:new r.bR(f),u_color_ramp:new r.bR(f),u_velocity_res:new r.bO(f),u_max_speed:new r.bQ(f),u_uv_offset:new r.bO(f),u_data_scale:new r.bS(f),u_data_offset:new r.bQ(f),u_particle_pos_scale:new r.bQ(f),u_particle_pos_offset:new r.bO(f)}),rasterParticleUpdate:f=>({u_particle_texture:new r.bR(f),u_particle_texture_side_len:new r.bQ(f),u_velocity:new r.bR(f),u_velocity_res:new r.bO(f),u_max_speed:new r.bQ(f),u_speed_factor:new r.bQ(f),u_reset_rate:new r.bQ(f),u_rand_seed:new r.bQ(f),u_uv_offset:new r.bO(f),u_data_scale:new r.bS(f),u_data_offset:new r.bQ(f),u_particle_pos_scale:new r.bQ(f),u_particle_pos_offset:new r.bO(f)}),symbolIcon:f=>({u_is_size_zoom_constant:new r.bR(f),u_is_size_feature_constant:new r.bR(f),u_size_t:new r.bQ(f),u_size:new r.bQ(f),u_camera_to_center_distance:new r.bQ(f),u_rotate_symbol:new r.bR(f),u_aspect_ratio:new r.bQ(f),u_fade_change:new r.bQ(f),u_matrix:new r.bN(f),u_label_plane_matrix:new r.bN(f),u_coord_matrix:new r.bN(f),u_is_text:new r.bR(f),u_pitch_with_map:new r.bR(f),u_texsize:new r.bO(f),u_tile_id:new r.bP(f),u_zoom_transition:new r.bQ(f),u_inv_rot_matrix:new r.bN(f),u_merc_center:new r.bO(f),u_camera_forward:new r.bP(f),u_tile_matrix:new r.bN(f),u_up_vector:new r.bP(f),u_ecef_origin:new r.bP(f),u_texture:new r.bR(f),u_icon_transition:new r.bQ(f),u_color_adj_mat:new r.bN(f)}),symbolSDF:f=>({u_is_size_zoom_constant:new r.bR(f),u_is_size_feature_constant:new r.bR(f),u_size_t:new r.bQ(f),u_size:new r.bQ(f),u_camera_to_center_distance:new r.bQ(f),u_rotate_symbol:new r.bR(f),u_aspect_ratio:new r.bQ(f),u_fade_change:new r.bQ(f),u_matrix:new r.bN(f),u_label_plane_matrix:new r.bN(f),u_coord_matrix:new r.bN(f),u_is_text:new r.bR(f),u_pitch_with_map:new r.bR(f),u_texsize:new r.bO(f),u_texture:new r.bR(f),u_gamma_scale:new r.bQ(f),u_device_pixel_ratio:new r.bQ(f),u_tile_id:new r.bP(f),u_zoom_transition:new r.bQ(f),u_inv_rot_matrix:new r.bN(f),u_merc_center:new r.bO(f),u_camera_forward:new r.bP(f),u_tile_matrix:new r.bN(f),u_up_vector:new r.bP(f),u_ecef_origin:new r.bP(f),u_is_halo:new r.bR(f)}),symbolTextAndIcon:f=>({u_is_size_zoom_constant:new r.bR(f),u_is_size_feature_constant:new r.bR(f),u_size_t:new r.bQ(f),u_size:new r.bQ(f),u_camera_to_center_distance:new r.bQ(f),u_rotate_symbol:new r.bR(f),u_aspect_ratio:new r.bQ(f),u_fade_change:new r.bQ(f),u_matrix:new r.bN(f),u_label_plane_matrix:new r.bN(f),u_coord_matrix:new r.bN(f),u_is_text:new r.bR(f),u_pitch_with_map:new r.bR(f),u_texsize:new r.bO(f),u_texsize_icon:new r.bO(f),u_texture:new r.bR(f),u_texture_icon:new r.bR(f),u_gamma_scale:new r.bQ(f),u_device_pixel_ratio:new r.bQ(f),u_is_halo:new r.bR(f)}),background:f=>({u_matrix:new r.bN(f),u_emissive_strength:new r.bQ(f),u_opacity:new r.bQ(f),u_color:new r.cf(f)}),backgroundPattern:f=>({u_matrix:new r.bN(f),u_emissive_strength:new r.bQ(f),u_opacity:new r.bQ(f),u_image:new r.bR(f),u_pattern_tl:new r.bO(f),u_pattern_br:new r.bO(f),u_texsize:new r.bO(f),u_pattern_size:new r.bO(f),u_pixel_coord_upper:new r.bO(f),u_pixel_coord_lower:new r.bO(f),u_tile_units_to_pixels:new r.bQ(f)}),terrainRaster:xn,terrainDepth:xn,skybox:f=>({u_matrix:new r.bN(f),u_sun_direction:new r.bP(f),u_cubemap:new r.bR(f),u_opacity:new r.bQ(f),u_temporal_offset:new r.bQ(f)}),skyboxGradient:f=>({u_matrix:new r.bN(f),u_color_ramp:new r.bR(f),u_center_direction:new r.bP(f),u_radius:new r.bQ(f),u_opacity:new r.bQ(f),u_temporal_offset:new r.bQ(f)}),skyboxCapture:f=>({u_matrix_3f:new r.cg(f),u_sun_direction:new r.bP(f),u_sun_intensity:new r.bQ(f),u_color_tint_r:new r.bS(f),u_color_tint_m:new r.bS(f),u_luminance:new r.bQ(f)}),globeRaster:f=>({u_proj_matrix:new r.bN(f),u_globe_matrix:new r.bN(f),u_normalize_matrix:new r.bN(f),u_merc_matrix:new r.bN(f),u_zoom_transition:new r.bQ(f),u_merc_center:new r.bO(f),u_image0:new r.bR(f),u_grid_matrix:new r.cg(f),u_skirt_height:new r.bQ(f),u_far_z_cutoff:new r.bQ(f),u_frustum_tl:new r.bP(f),u_frustum_tr:new r.bP(f),u_frustum_br:new r.bP(f),u_frustum_bl:new r.bP(f),u_globe_pos:new r.bP(f),u_globe_radius:new r.bQ(f),u_viewport:new r.bO(f)}),globeAtmosphere:f=>({u_frustum_tl:new r.bP(f),u_frustum_tr:new r.bP(f),u_frustum_br:new r.bP(f),u_frustum_bl:new r.bP(f),u_horizon:new r.bQ(f),u_transition:new r.bQ(f),u_fadeout_range:new r.bQ(f),u_color:new r.bS(f),u_high_color:new r.bS(f),u_space_color:new r.bS(f),u_temporal_offset:new r.bQ(f),u_horizon_angle:new r.bQ(f)}),model:f=>({u_matrix:new r.bN(f),u_lighting_matrix:new r.bN(f),u_normal_matrix:new r.bN(f),u_node_matrix:new r.bN(f),u_lightpos:new r.bP(f),u_lightintensity:new r.bQ(f),u_lightcolor:new r.bP(f),u_camera_pos:new r.bP(f),u_opacity:new r.bQ(f),u_baseColorFactor:new r.bS(f),u_emissiveFactor:new r.bS(f),u_metallicFactor:new r.bQ(f),u_roughnessFactor:new r.bQ(f),u_baseTextureIsAlpha:new r.bR(f),u_alphaMask:new r.bR(f),u_alphaCutoff:new r.bQ(f),u_baseColorTexture:new r.bR(f),u_metallicRoughnessTexture:new r.bR(f),u_normalTexture:new r.bR(f),u_occlusionTexture:new r.bR(f),u_emissionTexture:new r.bR(f),u_color_mix:new r.bS(f),u_aoIntensity:new r.bQ(f),u_emissive_strength:new r.bQ(f),u_occlusionTextureTransform:new r.bS(f)}),modelDepth:f=>({u_matrix:new r.bN(f),u_instance:new r.bN(f),u_node_matrix:new r.bN(f)}),groundShadow:f=>({u_matrix:new r.bN(f),u_ground_shadow_factor:new r.bP(f)}),stars:f=>({u_matrix:new r.bN(f),u_up:new r.bP(f),u_right:new r.bP(f),u_intensity_multiplier:new r.bQ(f)})},Qc;function ip(f,o,l,p,_,v,x){let E=f.context,C=E.gl,A=f.transform,R=f.getOrCreateProgram("collisionBox"),O=[],N=0,z=0;for(let te=0;te<p.length;te++){let re=p[te],q=o.getTile(re),X=q.getBucket(l);if(!X)continue;let ce=ns(re,X,A),ae=ce;_[0]===0&&_[1]===0||(ae=f.translatePosMatrix(ce,q,_,v));let pe=x?X.textCollisionBox:X.iconCollisionBox,Ee=X.collisionCircleArray;if(Ee.length>0){let fe=r.a9.create(),be=ae;r.a9.mul(fe,X.placementInvProjMatrix,A.glCoordMatrix),r.a9.mul(fe,fe,X.placementViewportMatrix),O.push({circleArray:Ee,circleOffset:z,transform:be,invTransform:fe,projection:X.getProjection()}),N+=Ee.length/4,z=N}pe&&(f.terrain&&f.terrain.setupElevationDraw(q,R),R.draw(f,C.LINES,Ct.disabled,qt.disabled,f.colorModeForRenderPass(),Vt.disabled,bb(ae,A,q,X.getProjection()),l.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,null,A.zoom,null,[pe.collisionVertexBuffer,pe.collisionVertexBufferExt]))}if(!x||!O.length)return;let U=f.getOrCreateProgram("collisionCircle"),j=new r.cC;j.resize(4*N),j._trim();let G=0;for(let te of O)for(let re=0;re<te.circleArray.length/4;re++){let q=4*re,X=te.circleArray[q+0],ce=te.circleArray[q+1],ae=te.circleArray[q+2],pe=te.circleArray[q+3];j.emplace(G++,X,ce,ae,pe,0),j.emplace(G++,X,ce,ae,pe,1),j.emplace(G++,X,ce,ae,pe,2),j.emplace(G++,X,ce,ae,pe,3)}(!Qc||Qc.length<2*N)&&(Qc=function(te){let re=2*te,q=new r.az;q.resize(re),q._trim();for(let X=0;X<re;X++){let ce=6*X;q.uint16[ce+0]=4*X+0,q.uint16[ce+1]=4*X+1,q.uint16[ce+2]=4*X+2,q.uint16[ce+3]=4*X+2,q.uint16[ce+4]=4*X+3,q.uint16[ce+5]=4*X+0}return q}(N));let H=E.createIndexBuffer(Qc,!0),Z=E.createVertexBuffer(j,r.cD.members,!0);for(let te of O){let re={u_matrix:te.transform,u_inv_matrix:te.invTransform,u_camera_to_center_distance:(ne=A).getCameraToCenterDistance(te.projection),u_viewport_size:[ne.width,ne.height]};U.draw(f,C.TRIANGLES,Ct.disabled,qt.disabled,f.colorModeForRenderPass(),Vt.disabled,re,l.id,Z,H,r.aE.simpleSegment(0,2*te.circleOffset,te.circleArray.length,te.circleArray.length/2),null,A.zoom)}var ne;Z.destroy(),H.destroy()}let Yc=r.a9.create();function rp(f){let o=f._camera.getWorldToCamera(f.worldSize,1),l=r.a9.multiply([],o,f.globeMatrix);r.a9.invert(l,l);let p=[0,0,0],_=[0,1,0,0];return r.aa.transformMat4(_,_,l),p[0]=_[0],p[1]=_[1],p[2]=_[2],r.Q.normalize(p,p),p}function Ba({width:f,height:o,anchor:l,textOffset:p,textScale:_},v){let{horizontalAlign:x,verticalAlign:E}=r.bi(l),C=-(x-.5)*f,A=-(E-.5)*o,R=r.bh(l,p);return new r.P((C/_+R[0])*v,(A/_+R[1])*v)}function Vg(f,o,l,p,_,v,x,E,C,A,R){let O=f.text.placedSymbolArray,N=f.text.dynamicLayoutVertexArray,z=f.icon.dynamicLayoutVertexArray,U={},j=f.getProjection(),G=Dd(E,j,v),H=v.elevation,Z=j.upVectorScale(E.canonical,v.center.lat,v.worldSize).metersToTile;N.clear();for(let ne=0;ne<O.length;ne++){let te=O.get(ne),{tileAnchorX:re,tileAnchorY:q,numGlyphs:X}=te,ce=te.hidden||!te.crossTileID||f.allowVerticalPlacement&&!te.placedOrientation?null:p[te.crossTileID];if(ce){let ae=0,pe=0,Ee=0;if(H){let Te=H?H.getAtTileOffset(E,re,q):0,[ie,Re,ot]=j.upVector(E.canonical,re,q);ae=Te*ie*Z,pe=Te*Re*Z,Ee=Te*ot*Z}let[fe,be,De,he]=co(te.projectedAnchorX+ae,te.projectedAnchorY+pe,te.projectedAnchorZ+Ee,l?G:x),ye=bd(v.getCameraToCenterDistance(j),he),Ve=_.evaluateSizeForFeature(f.textSizeData,A,te)*ye/r.bf;l&&(Ve*=f.tilePixelRatio/C);let ge=Ba(ce,Ve);l?({x:fe,y:be,z:De}=j.projectTilePoint(re+ge.x,q+ge.y,E.canonical),[fe,be,De]=co(fe+ae,be+pe,De+Ee,x)):(o&&ge._rotate(-v.angle),fe+=ge.x,be+=ge.y,De=0);let we=f.allowVerticalPlacement&&te.placedOrientation===r.b9.vertical?Math.PI/2:0;for(let Te=0;Te<X;Te++)r.bc(N,fe,be,De,we);R&&te.associatedIconIndex>=0&&(U[te.associatedIconIndex]={x:fe,y:be,z:De,angle:we})}else Oa(X,N)}if(R){z.clear();let ne=f.icon.placedSymbolArray;for(let te=0;te<ne.length;te++){let re=ne.get(te),{numGlyphs:q}=re,X=U[te];if(re.hidden||!X)Oa(q,z);else{let{x:ce,y:ae,z:pe,angle:Ee}=X;for(let fe=0;fe<q;fe++)r.bc(z,ce,ae,pe,Ee)}}f.icon.dynamicLayoutVertexBuffer.updateData(z)}f.text.dynamicLayoutVertexBuffer.updateData(N)}function Xc(f,o,l,p,_,v,x={}){let E=l.paint.get("icon-translate"),C=l.paint.get("text-translate"),A=l.paint.get("icon-translate-anchor"),R=l.paint.get("text-translate-anchor"),O=l.layout.get("icon-rotation-alignment"),N=l.layout.get("text-rotation-alignment"),z=l.layout.get("icon-pitch-alignment"),U=l.layout.get("text-pitch-alignment"),j=l.layout.get("icon-keep-upright"),G=l.layout.get("text-keep-upright"),H=l.paint.get("icon-color-saturation"),Z=l.paint.get("icon-color-contrast"),ne=l.paint.get("icon-color-brightness-min"),te=l.paint.get("icon-color-brightness-max"),re=f.context,q=re.gl,X=f.transform,ce=O==="map",ae=N==="map",pe=z==="map",Ee=U==="map",fe=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,be=!1,De=f.depthModeForSublayer(0,Ct.ReadOnly),he=[r.a8(X.center.lng),r.ah(X.center.lat)],ye=l.layout.get("text-variable-anchor"),Ve=X.projection.name==="globe",ge=[],we=[0,-1,0];for(let Te of p){let ie=o.getTile(Te),Re=ie.getBucket(l);if(!Re||Re.projection.name==="mercator"&&Ve||Re.fullyClipped)continue;let ot=Re.projection.name==="globe",pt=ot?r.W(X.zoom):0,wt=Dd(Te,Re.getProjection(),X),yt=X.calculatePixelsToTileUnitsMatrix(ie),It=ye&&Re.hasTextData(),fn=Re.hasIconTextFit()&&It&&Re.hasIconData(),$t=Re.getProjection().createInversionMatrix(X,Te.canonical),yn=()=>{let nn=ce&&l.layout.get("symbol-placement")!=="point",on=[],hi=nn||fn,ii=l.paint.get("icon-image-cross-fade").constantOr(0);f.terrainRenderModeElevated()&&pe&&on.push("PITCH_WITH_MAP_TERRAIN"),ot&&(on.push("PROJECTION_GLOBE_VIEW"),hi&&on.push("PROJECTED_POS_ON_VIEWPORT")),ii>0&&on.push("ICON_TRANSITION"),Re.icon.zOffsetVertexBuffer&&on.push("Z_OFFSET"),H===0&&Z===0&&ne===0&&te===1||on.push("COLOR_ADJUSTMENT");let cn=Re.icon.programConfigurations.get(l.id),Qt=f.getOrCreateProgram(Re.sdfIcons?"symbolSDF":"symbolIcon",{config:cn,defines:on}),Gr,Dr=ie.imageAtlasTexture?ie.imageAtlasTexture.size:[0,0],lr=Re.iconSizeData,Ir=r.b8(lr,X.zoom),$r=pe||X.pitch!==0,kr=Sc(wt,ie.tileID.canonical,pe,ce,X,Re.getProjection(),yt),cr=Ms(wt,ie.tileID.canonical,pe,ce,X,Re.getProjection(),yt),yr=f.translatePosMatrix(cr,ie,E,A,!0),vr=f.translatePosMatrix(wt,ie,E,A),ss=hi?Yc:kr,Wo=ce&&!pe&&!nn,as=we;!Ve&&!X.mercatorFromTransition||ce||(as=rp(X));let ls=ot?as:we;if(Re.sdfIcons&&!Re.iconsInText)Gr=Cl(lr.kind,Ir,Wo,pe,f,vr,ss,yr,!1,Dr,!0,Te,pt,he,$t,ls,Re.getProjection());else{let Os=l.getColorAdjustmentMatrix(H,Z,ne,te);Gr=ep(lr.kind,Ir,Wo,pe,f,vr,ss,yr,!1,Dr,Te,pt,he,$t,ls,Re.getProjection(),Os,ii)}let da=ie.imageAtlasTexture?ie.imageAtlasTexture:null,Do=l.layout.get("icon-size").constantOr(0)!==1||Re.iconsNeedLinear,du=Re.sdfIcons||f.options.rotating||f.options.zooming||Do||$r?q.LINEAR:q.NEAREST,Nl=Re.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,hu=f.terrain&&pe&&nn?r.a9.invert(r.a9.create(),kr):Yc;if(nn&&Re.icon){let Os=X.elevation,ur=Os?Os.getAtTileOffsetFunc(Te,X.center.lat,X.worldSize,Re.getProjection()):null,fu=Mc(wt,ie.tileID.canonical,pe,ce,X,Re.getProjection(),yt);wd(Re,wt,f,!1,fu,cr,pe,j,ur,Te)}return{program:Qt,buffers:Re.icon,uniformValues:Gr,atlasTexture:da,atlasTextureIcon:null,atlasInterpolation:du,atlasInterpolationIcon:null,isSDF:Re.sdfIcons,hasHalo:Nl,tile:ie,labelPlaneMatrixInv:hu}},pn=()=>{let nn=ae&&l.layout.get("symbol-placement")!=="point",on=[],hi=nn||ye||fn;f.terrainRenderModeElevated()&&Ee&&on.push("PITCH_WITH_MAP_TERRAIN"),ot&&(on.push("PROJECTION_GLOBE_VIEW"),hi&&on.push("PROJECTED_POS_ON_VIEWPORT")),Re.text.zOffsetVertexBuffer&&on.push("Z_OFFSET");let ii=Re.text.programConfigurations.get(l.id),cn=f.getOrCreateProgram(Re.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:ii,defines:on}),Qt,Gr=[0,0],Dr=null,lr=Re.textSizeData;Re.iconsInText&&(Gr=ie.imageAtlasTexture?ie.imageAtlasTexture.size:[0,0],Dr=ie.imageAtlasTexture?ie.imageAtlasTexture:null,Qt=Ee||X.pitch!==0||f.options.rotating||f.options.zooming||lr.kind==="composite"||lr.kind==="camera"?q.LINEAR:q.NEAREST);let Ir=ie.glyphAtlasTexture?ie.glyphAtlasTexture.size:[0,0],$r=r.b8(lr,X.zoom),kr=Sc(wt,ie.tileID.canonical,Ee,ae,X,Re.getProjection(),yt),cr=Ms(wt,ie.tileID.canonical,Ee,ae,X,Re.getProjection(),yt),yr=f.translatePosMatrix(cr,ie,C,R,!0),vr=f.translatePosMatrix(wt,ie,C,R),ss=hi?Yc:kr,Wo=ae&&!Ee&&!nn,as=we;!Ve&&!X.mercatorFromTransition||ae||(as=rp(X));let ls=ot?as:we,da;da=Re.iconsInText?sa(lr.kind,$r,Wo,Ee,f,vr,ss,yr,Ir,Gr,Te,pt,he,$t,ls,Re.getProjection()):Cl(lr.kind,$r,Wo,Ee,f,vr,ss,yr,!0,Ir,!0,Te,pt,he,$t,ls,Re.getProjection());let Do=ie.glyphAtlasTexture?ie.glyphAtlasTexture:null,du=q.LINEAR,Nl=l.paint.get("text-halo-width").constantOr(1)!==0,hu=f.terrain&&Ee&&nn?r.a9.invert(r.a9.create(),kr):Yc;if(nn&&Re.text){let Os=X.elevation,ur=Os?Os.getAtTileOffsetFunc(Te,X.center.lat,X.worldSize,Re.getProjection()):null,fu=Mc(wt,ie.tileID.canonical,Ee,ae,X,Re.getProjection(),yt);wd(Re,wt,f,!0,fu,cr,Ee,G,ur,Te)}return{program:cn,buffers:Re.text,uniformValues:da,atlasTexture:Do,atlasTextureIcon:Dr,atlasInterpolation:du,atlasInterpolationIcon:Qt,isSDF:!0,hasHalo:Nl,tile:ie,labelPlaneMatrixInv:hu}},mi=Re.icon.segments.get().length,Vn=Re.text.segments.get().length,Yi=mi&&!x.onlyText?yn():null,Bi=Vn&&!x.onlyIcons?pn():null,ni=l.paint.get("icon-opacity").constantOr(1),Gn=l.paint.get("text-opacity").constantOr(1);if(fe&&Re.canOverlap){be=!0;let nn=ni&&!x.onlyText?Re.icon.segments.get():[],on=Gn&&!x.onlyIcons?Re.text.segments.get():[];for(let hi of nn)ge.push({segments:new r.aE([hi]),sortKey:hi.sortKey,state:Yi});for(let hi of on)ge.push({segments:new r.aE([hi]),sortKey:hi.sortKey,state:Bi})}else x.onlyText||ge.push({segments:ni?Re.icon.segments:new r.aE([]),sortKey:0,state:Yi}),x.onlyIcons||ge.push({segments:Gn?Re.text.segments:new r.aE([]),sortKey:0,state:Bi})}be&&ge.sort((Te,ie)=>Te.sortKey-ie.sortKey);for(let Te of ge){let ie=Te.state;if(ie)if(f.terrain&&f.terrain.setupElevationDraw(ie.tile,ie.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ie.labelPlaneMatrixInv}),re.activeTexture.set(q.TEXTURE0),ie.atlasTexture&&ie.atlasTexture.bind(ie.atlasInterpolation,q.CLAMP_TO_EDGE,!0),ie.atlasTextureIcon&&(re.activeTexture.set(q.TEXTURE1),ie.atlasTextureIcon&&ie.atlasTextureIcon.bind(ie.atlasInterpolationIcon,q.CLAMP_TO_EDGE,!0)),f.uploadCommonLightUniforms(f.context,ie.program),ie.hasHalo){let Re=ie.uniformValues;Re.u_is_halo=1,Hd(ie.buffers,Te.segments,l,f,ie.program,De,_,v,Re,2),Re.u_is_halo=0}else{if(ie.isSDF){let Re=ie.uniformValues;ie.hasHalo&&(Re.u_is_halo=1,Hd(ie.buffers,Te.segments,l,f,ie.program,De,_,v,Re,1)),Re.u_is_halo=0}Hd(ie.buffers,Te.segments,l,f,ie.program,De,_,v,ie.uniformValues,1)}}}function Hd(f,o,l,p,_,v,x,E,C,A){let R=[f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer,f.iconTransitioningVertexBuffer,f.globeExtVertexBuffer,f.zOffsetVertexBuffer];_.draw(p,p.context.gl.TRIANGLES,v,x,E,Vt.disabled,C,l.id,f.layoutVertexBuffer,f.indexBuffer,o,l.paint,p.transform.zoom,f.programConfigurations.get(l.id),R,A)}function qd(f,o,l,p,_,v,x){let E=f.context.gl,C=l.paint.get("fill-pattern"),A=C&&C.constantOr(1),R,O,N,z,U;x?(O=A&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=E.LINES):(O=A?"fillPattern":"fill",R=E.TRIANGLES);for(let j of p){let G=o.getTile(j);if(A&&!G.patternsLoaded())continue;let H=G.getBucket(l);if(!H)continue;f.prepareDrawTile();let Z=H.programConfigurations.get(l.id),ne=f.isTileAffectedByFog(j),te=f.getOrCreateProgram(O,{config:Z,overrideFog:ne});A&&(f.context.activeTexture.set(E.TEXTURE0),G.imageAtlasTexture&&G.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Z.updatePaintBuffers());let re=C.constantOr(null);if(re&&G.imageAtlas){let ce=G.imageAtlas.patternPositions[re.toString()];ce&&Z.setConstantPatternPositions(ce)}let q=f.translatePosMatrix(j.projMatrix,G,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),X=l.paint.get("fill-emissive-strength");if(x){z=H.indexBuffer2,U=H.segments2;let ce=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[E.drawingBufferWidth,E.drawingBufferHeight];N=O==="fillOutlinePattern"&&A?Ps(q,X,f,G,ce):vb(q,X,ce)}else z=H.indexBuffer,U=H.segments,N=A?oa(q,X,f,G):Il(q,X);f.uploadCommonUniforms(f.context,te,j.toUnwrapped()),te.draw(f,R,_,f.stencilModeForClipping(j),v,Vt.disabled,N,l.id,H.layoutVertexBuffer,z,U,l.paint,f.transform.zoom,Z,void 0)}}function nt(f,o,l,p,_,v,x,E){l.resetLayerRenderingStats(f);let C=f.context,A=C.gl,R=f.transform,O=l.paint.get("fill-extrusion-pattern"),N=O.constantOr(1),z=l.paint.get("fill-extrusion-opacity"),U=f.style.enable3dLights(),j=l.paint.get(U&&!N?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),G=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),j],H=l.layout.get("fill-extrusion-edge-radius"),Z=H>0&&!l.paint.get("fill-extrusion-rounded-roof"),ne=Z?0:H,te=R.projection.name==="globe"?r.cM():0,re=R.projection.name==="globe",q=re?r.W(R.zoom):0,X=[r.a8(R.center.lng),r.ah(R.center.lat)],ce=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ae=l.paint.get("fill-extrusion-flood-light-intensity"),pe=l.paint.get("fill-extrusion-vertical-scale"),Ee=na(f,l.paint.get("fill-extrusion-cutoff-fade-range")),fe=l.paint.get("fill-extrusion-emissive-strength"),be=[],De;re&&be.push("PROJECTION_GLOBE_VIEW"),G[0]>0&&be.push("FAUX_AO"),Z&&be.push("ZERO_ROOF_RADIUS"),E&&be.push("HAS_CENTROID"),ae>0&&be.push("FLOOD_LIGHT"),Ee.shouldRenderCutoff&&be.push("RENDER_CUTOFF");let he=f.renderPass==="shadow",ye=f.shadowRenderer,Ve=he&&!!ye;f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!0);let ge=[0,0,0];if(ye){let ie=f.style.directionalLight,Re=f.style.ambientLight;ie&&Re&&(ge=qf(ie,Re)),De=be.concat(["SHADOWS_SINGLE_CASCADE"])}let we=Ve?"fillExtrusionDepth":N?"fillExtrusionPattern":"fillExtrusion",Te=l.getLayerRenderingStats();for(let ie of p){let Re=o.getTile(ie),ot=Re.getBucket(l);if(!ot||ot.projection.name!==R.projection.name)continue;let pt=!1;ye&&(pt=ye.getMaxCascadeForTile(ie.toUnwrapped())===0);let wt=f.isTileAffectedByFog(ie),yt=ot.programConfigurations.get(l.id),It=f.getOrCreateProgram(we,{config:yt,defines:pt?De:be,overrideFog:wt});if(f.terrain&&f.terrain.setupElevationDraw(Re,It,{useMeterToDem:!0}),!ot.centroidVertexBuffer){let Vn=It.attributes.a_centroid_pos;Vn!==void 0&&A.vertexAttrib2f(Vn,0,0)}!he&&ye&&ye.setupShadows(Re.tileID.toUnwrapped(),It,"vector-tile",Re.tileID.overscaledZ),N&&(f.context.activeTexture.set(A.TEXTURE0),Re.imageAtlasTexture&&Re.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),yt.updatePaintBuffers());let fn=O.constantOr(null);if(fn&&Re.imageAtlas){let Vn=Re.imageAtlas.patternPositions[fn.toString()];Vn&&yt.setConstantPatternPositions(Vn)}let $t=l.paint.get("fill-extrusion-vertical-gradient"),yn;if(he&&ye){if(Rs(Re.tileID,ot,f))continue;let Vn=ye.calculateShadowPassMatrixFromTile(Re.tileID.toUnwrapped());yn=Ho(Vn,ne,pe)}else{let Vn=f.translatePosMatrix(ie.expandedProjMatrix,Re,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Yi=R.projection.createInversionMatrix(R,ie.canonical);yn=N?Hc(Vn,f,$t,z,G,ne,ie,Re,te,q,X,Yi,ce,pe):Gd(Vn,f,$t,z,G,ne,ie,te,q,X,Yi,ce,pe,ae,ge,fe)}f.uploadCommonUniforms(C,It,ie.toUnwrapped(),null,Ee);let pn=ot.segments;if(R.projection.name==="mercator"&&!he&&(pn=ot.getVisibleSegments(Re.tileID,f.terrain,f.transform.getFrustum(0)),!pn.get().length))continue;if(Te)if(he)for(let Vn of pn.get())Te.numRenderedVerticesInShadowPass+=Vn.primitiveLength;else for(let Vn of pn.get())Te.numRenderedVerticesInTransparentPass+=Vn.primitiveLength;let mi=[];(f.terrain||E)&&mi.push(ot.centroidVertexBuffer),re&&mi.push(ot.layoutVertexExtBuffer),It.draw(f,C.gl.TRIANGLES,_,v,x,Vt.backCCW,yn,l.id,ot.layoutVertexBuffer,ot.indexBuffer,pn,l.paint,f.transform.zoom,yt,mi)}f.shadowRenderer&&(f.shadowRenderer.useNormalOffset=!1)}function Va(f,o,l,p,_,v,x,E,C,A,R,O,N,z,U,j,G,H,Z){let ne=f.context,te=ne.gl,re=f.transform,q=f.transform.zoom,X=[],ce=na(f,l.paint.get("fill-extrusion-cutoff-fade-range"));A==="clear"?(X.push("CLEAR_SUBPASS"),Z&&(X.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(te.TEXTURE0),Z.bind(te.LINEAR,te.CLAMP_TO_EDGE))):A==="sdf"&&X.push("SDF_SUBPASS"),G&&X.push("HAS_CENTROID"),ce.shouldRenderCutoff&&X.push("RENDER_CUTOFF");let ae=l.layout.get("fill-extrusion-edge-radius"),pe=(Ee,fe,be,De,he)=>{let ye=fe.programConfigurations.get(l.id),Ve=f.isTileAffectedByFog(Ee),ge=f.getOrCreateProgram("fillExtrusionGroundEffect",{config:ye,defines:X,overrideFog:Ve}),we=((ie,Re,ot,pt,wt,yt,It,fn,$t,yn,pn)=>({u_matrix:Re,u_opacity:ot,u_ao_pass:pt?1:0,u_meter_to_tile:wt,u_ao:yt,u_flood_light_intensity:It,u_flood_light_color:fn,u_attenuation:$t,u_edge_radius:yn,u_fb:0,u_fb_size:pn}))(0,De,R,C,he,[O,N*he],z,U,j,q>=17?0:ae*he,Z?Z.size[0]:0),Te=[];G&&Te.push(fe.hiddenByLandmarkVertexBuffer),f.uploadCommonUniforms(ne,ge,Ee.toUnwrapped(),null,ce),ge.draw(f,ne.gl.TRIANGLES,_,v,x,E,we,l.id,fe.vertexBuffer,fe.indexBuffer,be,l.paint,q,ye,Te)};for(let Ee of p){let fe=o.getTile(Ee),be=fe.getBucket(l);if(!be||be.projection.name!==re.projection.name||!be.groundEffect||be.groundEffect&&!be.groundEffect.hasData())continue;let De=be.groundEffect,he=1/be.tileToMeter;{let ye=f.translatePosMatrix(Ee.projMatrix,fe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ve=De.getDefaultSegment();pe(Ee,De,Ve,ye,he)}if(H)for(let ye=0;ye<4;ye++){let Ve=r.cN[ye](Ee),ge=o.getTile(Ve);if(!ge)continue;let we=ge.getBucket(l);if(!we||we.projection.name!==re.projection.name||!we.groundEffect||we.groundEffect&&!we.groundEffect.hasData())continue;let Te=we.groundEffect,ie,Re;ye===0?(ie=[-r.Y,0,0],Re=1):ye===1?(ie=[r.Y,0,0],Re=0):ye===2?(ie=[0,-r.Y,0],Re=3):(ie=[0,r.Y,0],Re=2);let ot=Te.regionSegments[Re];if(!ot)continue;let pt=new Float32Array(16);r.a9.translate(pt,Ee.projMatrix,ie),pe(Ee,Te,ot,f.translatePosMatrix(pt,fe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),he)}}}function op(f,o,l,p,_,v,x){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();let E=v?v.findDEMTileFor(l):null;if(!(E&&E.dem||x))return;let C=H=>new r.P(Math.ceil((H+r.cQ)*r.cR),0),A=H=>{let Z=o.getSource().minzoom,ne=re=>{let q=o.getTileByID(re);if(q&&q.hasData())return q.getBucket(_)},te=[0,-1,1];for(let re of te){if(H.overscaledZ+re<Z)continue;let q=ne(H.calculateScaledKey(H.overscaledZ+re));if(q)return q}},R=[0,0,0],O=(H,Z)=>(R[0]=Math.min(H.min.y,Z.min.y),R[1]=Math.max(H.max.y,Z.max.y),R[2]=r.Y-Z.min.x>H.max.x?Z.min.x-r.Y:H.max.x,R),N=(H,Z)=>(R[0]=Math.min(H.min.x,Z.min.x),R[1]=Math.max(H.max.x,Z.max.x),R[2]=r.Y-Z.min.y>H.max.y?Z.min.y-r.Y:H.max.y,R),z=[(H,Z)=>O(H,Z),(H,Z)=>O(Z,H),(H,Z)=>N(H,Z),(H,Z)=>N(Z,H)],U=(H,Z,ne,te,re,q,X)=>{if(!v)return 0;let ce=[[q?ne:H,q?H:ne,0],[q?ne:Z,q?Z:ne,0]],ae=X<0?r.Y+X:X,pe=[q?ae:(H+Z)/2,q?(H+Z)/2:ae,0];return ne===0&&X<0||ne!==0&&X>0?v.getForTilePoints(re,[pe],!0,te):ce.push(pe),v.getForTilePoints(l,ce,!0,E),Math.max(ce[0][2],ce[1][2],pe[2])/v.exaggeration()};for(let H=0;H<4;H++){let Z=p.borderFeatureIndices[H];if(Z.length===0)continue;let ne=r.cN[H](l),te=A(ne);if(!(te&&te instanceof r.cO)||p.borderDoneWithNeighborZ[H]===te.canonical.z)continue;te.centroidVertexArray.length===0&&te.createCentroidsBuffer();let re=v?v.findDEMTileFor(ne):null;if(!(re&&re.dem||x))continue;let q=(H<2?1:5)-H,X=te.borderDoneWithNeighborZ[q]!==p.canonical.z,ce=te.borderFeatureIndices[q],ae=0;if(p.canonical.z!==te.canonical.z){for(let pe of Z)p.showCentroid(p.featuresOnBorder[pe]);if(X)for(let pe of ce)te.showCentroid(te.featuresOnBorder[pe]);p.borderDoneWithNeighborZ[H]=te.canonical.z,te.borderDoneWithNeighborZ[q]=p.canonical.z}for(let pe of Z){let Ee=p.featuresOnBorder[pe],fe=p.centroidData[Ee.centroidDataIndex],be=Ee.borders[H],De;for(;ae<ce.length;){De=te.featuresOnBorder[ce[ae]];let he=De.borders[q];if(he[1]>be[0]+3||he[0]>be[0]-3)break;te.showCentroid(De),ae++}if(De&&ae<ce.length){let he=ae,ye=0;for(;!(De.borders[q][0]>be[1]-3)&&(ye++,++ae!==ce.length);)De=te.featuresOnBorder[ce[ae]];if(De=te.featuresOnBorder[ce[he]],ye>1){let we=De.borders[q];Math.abs(be[0]-we[0])<3&&Math.abs(be[1]-we[1])<3&&(ye=1,ae=he+1)}else if(ye===0){p.showCentroid(Ee);continue}let Ve=te.centroidData[De.centroidDataIndex];x&&ye===1&&(((j=fe).flags|(G=Ve).flags)&r.cP?(j.flags|=r.cP,G.flags|=r.cP):(j.flags&=~r.cP,G.flags&=~r.cP));let ge=Ee.intersectsCount()>1||De.intersectsCount()>1;if(ye>1)ae=he,fe.centroidXY=Ve.centroidXY=new r.P(0,0);else if(re&&re.dem&&!ge){let we=z[H](fe,Ve),Te=H%2?r.Y-1:0,ie=U(we[0],Math.min(r.Y-1,we[1]),Te,re,ne,H<2,we[2]);fe.centroidXY=Ve.centroidXY=C(ie)}else ge?fe.centroidXY=Ve.centroidXY=new r.P(0,0):(fe.centroidXY=p.encodeBorderCentroid(Ee),Ve.centroidXY=te.encodeBorderCentroid(De));p.writeCentroidToBuffer(fe),te.writeCentroidToBuffer(Ve)}else p.showCentroid(Ee)}p.borderDoneWithNeighborZ[H]=te.canonical.z,te.borderDoneWithNeighborZ[q]=p.canonical.z}var j,G;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(f)}let sp=[1,0,0],jg=[0,1,0],Wd=[0,0,1];function Rs(f,o,l){let p=l.transform,_=l.shadowRenderer;if(!_)return!0;let v=f.toUnwrapped(),x=p.tileSize*_._cascades[l.currentShadowCascade].scale,E=o.maxHeight;if(p.elevation){let j=p.elevation.getMinMaxForTile(f);j&&(E+=j.max)}let C=[..._.shadowDirection];C[2]=-C[2];let A=_.computeSimplifiedTileShadowVolume(v,E,x,C);if(!A)return!1;let R=[sp,jg,Wd,C,[C[0],0,C[2]],[0,C[1],C[2]]],O=p.projection.name==="globe",N=p.scaleZoom(x),z=r.bt.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,N,!O),U=_.getCurrentCascadeFrustum();return z.intersectsPrecise(A.vertices,A.planes,R)===0||U.intersectsPrecise(A.vertices,A.planes,R)===0}function Zd(f){return[f[0]*r.cS,f[1]*r.cS,f[2]*r.cS,0]}function ks(f,o,l,p,_,v,x,E,C){let A=p.getSource(),R=l.globeSharedBuffers;if(!R)return;let O,N,z;if(o&&(O=p.getTile(o)),A instanceof r.as?(N=A.texture,z=r.co(0,0,l.transform)):O&&o&&(N=O.texture,z=r.co(o.canonical.z,o.canonical.x,l.transform)),!N||!z)return;f||(z=r.a9.scale(r.a9.create(),z,[1,-1,1]));let U=l.context,j=U.gl,G=_.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR,H=l.colorModeForDrapableLayerRenderPass(v),Z=x.defines;Z.push("GLOBE_POLES");let ne=new Ct(j.LEQUAL,Ct.ReadWrite,l.depthRangeFor3D),te=Float32Array.from(l.transform.expandedFarZProjMatrix),re=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),U.activeTexture.set(j.TEXTURE0),N.bind(G,j.CLAMP_TO_EDGE),U.activeTexture.set(j.TEXTURE1),N.bind(G,j.CLAMP_TO_EDGE),N.useMipmap&&U.extTextureFilterAnisotropic&&l.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,U.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,U.extTextureFilterAnisotropicMax);let[q,X,ce,ae]=o?R.getPoleBuffers(o.canonical.z,!1):R.getPoleBuffers(0,!0),pe=_.paint.get("raster-elevation"),Ee;f?(Ee=q,l.renderDefaultNorthPole=pe!==0):(Ee=X,l.renderDefaultSouthPole=pe!==0);let fe=Zd(x.mix),be=((he,ye,Ve,ge,we,Te,ie,Re,ot,pt,wt,yt,It)=>zg(he,ye,Ve,new Float32Array(16),new Float32Array(9),[0,0],ge,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Te,[0,0],Re,2,pt,wt,yt,1,0,It))(te,re,z,r.W(l.transform.zoom),0,_,0,pe,0,fe,x.offset,x.range,v),De=l.getOrCreateProgram("raster",{defines:Z});l.uploadCommonUniforms(U,De,null),De.draw(l,j.TRIANGLES,ne,C,H,E,be,_.id,Ee,ce,ae)}function Qd(f){let o=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-o,_=.2*f.height,v=o+_;return[o,l,(v-_-o)/p,(v-o)/p]}function Sl(f,o,l,p){if(f)return o instanceof Je&&f instanceof yd?o.getTextureDescriptor(f,l,!0):{texture:f.texture,mix:Zd(p.mix),offset:p.offset,buffer:0,tileSize:1}}function Ib(f,o,l){if(!f)return null;let p=o.getTextureDescriptor(f,l,!0);if(!p)return null;let{texture:_,mix:v,offset:x,tileSize:E,buffer:C,format:A}=p;if(!_||!A)return null;let R=!1;return A==="uint32"&&(R=!0,v[3]=0,v=qc(r.cT,v,[0,l.paint.get("raster-particle-max-speed")]),x=Jf(r.cT,x,[0,l.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[C/(E+2*C),E/(E+2*C)],tileSize:E,scalarData:R,scale:v,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[A]]}}function Cb(f){let o=f._nearZ,l=f.projection.farthestPixelDistance(f),p=l-o,_=.2*f.height,v=o+_;return[o,l,(v-_-o)/p,(v-o)/p]}let ap=new r.aA(1,0,0,1),Sb=new r.aA(0,1,0,1),Ug=new r.aA(0,0,1,1),Gg=new r.aA(1,0,1,1),lp=new r.aA(0,1,1,1);function Ml(f,o,l,p,_,v,x){let E=f.context,C=f.transform,A=E.gl,R=C.projection.name==="globe",O=R?["PROJECTION_GLOBE_VIEW"]:[],N=r.a9.clone(l.projMatrix);if(R&&r.W(C.zoom)>0){let fe=r.aV(l.canonical,C),be=r.cU(fe);N=r.a9.multiply(new Float32Array(16),C.globeMatrix,be),r.a9.multiply(N,C.projMatrix,N)}let z=r.a9.create();z[12]+=2*_/(r.f.devicePixelRatio*C.width),z[13]+=2*v/(r.f.devicePixelRatio*C.height),r.a9.multiply(N,z,N);let U=f.getOrCreateProgram("debug",{defines:O}),j=o.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(j,U);let G=Ct.disabled,H=qt.disabled,Z=f.colorModeForRenderPass(),ne="$debug";E.activeTexture.set(A.TEXTURE0),f.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),R?j._makeGlobeTileDebugBuffers(f.context,C):j._makeDebugTileBoundsBuffers(f.context,C.projection);let te=j._tileDebugBuffer||f.debugBuffer,re=j._tileDebugIndexBuffer||f.debugIndexBuffer,q=j._tileDebugSegments||f.debugSegments;if(U.draw(f,A.LINE_STRIP,G,H,Z,Vt.disabled,Kf(N,p),ne,te,re,q,null,null,null,[j._globeTileDebugBorderBuffer]),x){let fe=j.latestRawTileData,be=Math.floor((fe&&fe.byteLength||0)/1024),De=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(De+=` => ${l.overscaledZ}`),De+=` ${j.state}`,De+=` ${be}kb`,function(he,ye){he.initDebugOverlayCanvas();let Ve=he.debugOverlayCanvas,ge=he.context.gl,we=he.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,Ve.width,Ve.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(ye,5,5),we.strokeText(ye,5,5),he.debugOverlayTexture.update(Ve),he.debugOverlayTexture.bind(ge.LINEAR,ge.CLAMP_TO_EDGE)}(f,De)}let X=o.getTile(l).tileSize,ce=512/Math.min(X,512)*(l.overscaledZ/C.zoom)*.5,ae=j._tileDebugTextBuffer||f.debugBuffer,pe=j._tileDebugTextIndexBuffer||f.quadTriangleIndexBuffer,Ee=j._tileDebugTextSegments||f.debugSegments;U.draw(f,A.TRIANGLES,G,H,an.alphaBlended,Vt.disabled,Kf(N,r.aA.transparent,ce),ne,ae,pe,Ee,null,null,null,[j._globeTileDebugTextBuffer])}function $g(f,o,l,p){Yd(f,0,o+l/2,f.transform.width,l,p)}function Hg(f,o,l,p){Yd(f,o-l/2,0,l,f.transform.height,p)}function Yd(f,o,l,p,_,v){let x=f.context,E=x.gl;E.enable(E.SCISSOR_TEST),E.scissor(o*r.f.devicePixelRatio,l*r.f.devicePixelRatio,p*r.f.devicePixelRatio,_*r.f.devicePixelRatio),x.clear({color:v}),E.disable(E.SCISSOR_TEST)}let qg=r.aB([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mb}=qg;function qo(f,o,l,p){f.emplaceBack(o,l,p)}class Wg{constructor(o){this.vertexArray=new r.cV,this.indices=new r.az,qo(this.vertexArray,-1,-1,1),qo(this.vertexArray,1,-1,1),qo(this.vertexArray,-1,1,1),qo(this.vertexArray,1,1,1),qo(this.vertexArray,-1,-1,-1),qo(this.vertexArray,1,-1,-1),qo(this.vertexArray,-1,1,-1),qo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Mb),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.aE.simpleSegment(0,0,36,12)}}function ja(f,o,l,p,_,v){let x=f.context.gl,E=o.paint.get("sky-atmosphere-color"),C=o.paint.get("sky-atmosphere-halo-color"),A=o.paint.get("sky-atmosphere-sun-intensity"),R=((O,N,z,U,j)=>({u_matrix_3f:O,u_sun_direction:N,u_sun_intensity:z,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[j.r,j.g,j.b,j.a],u_luminance:5e-5}))(r.ct.fromMat4(r.ct.create(),p),_,A,E,C);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+v,o.skyboxTexture,0),l.draw(f,x.TRIANGLES,Ct.disabled,qt.disabled,an.unblended,Vt.frontCW,R,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let cp=r.aB([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xd{constructor(o){let l=new r.cW;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);let p=new r.az;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(l,cp.members),this.indexBuffer=o.createIndexBuffer(p),this.segments=r.aE.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let up=r.aB([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ua{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class dp{constructor(o){this.colorModeAlphaBlendedWriteRGB=new an([1,gd,1,gd],r.aA.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new an([1,0,1,0],r.aA.transparent,[!1,!1,!1,!0]),this.params=new Ua,this.updateNeeded=!0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),o.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),o.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(o){let l=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Xd(l);let p=this.params.sizeRange,_=this.params.intensityRange,v=function(R){let O=r.aC(30),N=[];for(let z=0;z<R;++z){let U=2*Math.PI*O(),j=Math.acos(1-2*O())-.5*Math.PI;N.push(r.Q.fromValues(Math.cos(j)*Math.cos(U),Math.cos(j)*Math.sin(U),Math.sin(j)))}return N}(this.params.starsCount),x=r.aC(300),E=new r.cX,C=new r.az,A=0;for(let R=0;R<v.length;++R){let O=r.Q.scale([],v[R],200),N=Math.max(0,1+.01*p*(1*x()-.5)),z=Math.max(0,1+.01*_*(1*x()-.5));E.emplaceBack(O[0],O[1],O[2],-1,-1,N,z),E.emplaceBack(O[0],O[1],O[2],1,-1,N,z),E.emplaceBack(O[0],O[1],O[2],1,1,N,z),E.emplaceBack(O[0],O[1],O[2],-1,1,N,z),C.emplaceBack(A+0,A+1,A+2),C.emplaceBack(A+0,A+2,A+3),A+=4}this.starsVx=l.createVertexBuffer(E,up.members),this.starsIdx=l.createIndexBuffer(C),this.starsSegments=r.aE.simpleSegment(0,0,E.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,l){let p=o.context,_=p.gl,v=o.transform,x=new Ct(_.LEQUAL,Ct.ReadOnly,[0,1]),E=r.W(v.zoom),C=l.properties.get("color").toArray01(),A=l.properties.get("high-color").toArray01(),R=l.properties.get("space-color").toArray01PremultipliedAlpha(),O=5e-4,N=r.cY(l.properties.get("horizon-blend"),0,1,O,.25),z=r.ci(o,p,v)&&N===O?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,U=o.frameCounter/1e3%1,j=r.Q.length(v.globeCenterInViewSpace),G=Math.sqrt(Math.pow(j,2)-Math.pow(z,2)),H=Math.acos(G/j),Z=ne=>{let te=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&te.push("ALPHA_PASS");let re=o.getOrCreateProgram("globeAtmosphere",{defines:te}),q=((ce,ae,pe,Ee,fe,be,De,he,ye,Ve,ge,we)=>({u_frustum_tl:ce,u_frustum_tr:ae,u_frustum_br:pe,u_frustum_bl:Ee,u_horizon:fe,u_transition:be,u_fadeout_range:De,u_color:he,u_high_color:ye,u_space_color:Ve,u_temporal_offset:ge,u_horizon_angle:we}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,E,N,C,A,R,U,H);o.uploadCommonUniforms(p,re);let X=this.atmosphereBuffer;X&&re.draw(o,_.TRIANGLES,x,qt.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Vt.backCW,q,ne?"atmosphere_glow_alpha":"atmosphere_glow",X.vertexBuffer,X.indexBuffer,X.segments)};Z(!1),Z(!0)}drawStars(o,l){let p=r.ad(l.properties.get("star-intensity"),0,1);if(p===0)return;let _=o.context,v=_.gl,x=o.transform,E=o.getOrCreateProgram("stars"),C=r.bl.identity([]);r.bl.rotateX(C,C,-x._pitch),r.bl.rotateZ(C,C,-x.angle),r.bl.rotateX(C,C,r.bm(x._center.lat)),r.bl.rotateY(C,C,-r.bm(x._center.lng));let A=r.a9.fromQuat(new Float32Array(16),C),R=r.a9.multiply([],x.starsProjMatrix,A),O=r.ct.fromMat4([],A),N=r.ct.invert([],O),z=[0,1,0];r.Q.transformMat3(z,z,N),r.Q.scale(z,z,this.params.sizeMultiplier);let U=[1,0,0];r.Q.transformMat3(U,U,N),r.Q.scale(U,U,this.params.sizeMultiplier);let j=(G=z,H=U,Z=p,{u_matrix:Float32Array.from(R),u_up:G,u_right:H,u_intensity_multiplier:Z});var G,H,Z;o.uploadCommonUniforms(_,E),this.starsVx&&this.starsIdx&&E.draw(o,v.TRIANGLES,Ct.disabled,qt.disabled,this.colorModeAlphaBlendedWriteRGB,Vt.disabled,j,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function hp(f,o){let l=[...f],p=o.cameraWorldSizeForFog/o.worldSize,_=r.a9.identity([]);return r.a9.scale(_,_,[p,p,1]),r.a9.multiply(l,_,l),r.a9.multiply(l,o.worldToFogMatrix,l),l}function aa(f,o,l,p){let _=l.material,v=p.context,{baseColorTexture:x,metallicRoughnessTexture:E}=_.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:A,emissionTexture:R}=_;function O(N,z,U){if(N&&(f.push(z),v.activeTexture.set(v.gl.TEXTURE0+U),N.gfxTexture)){let{minFilter:j,magFilter:G,wrapS:H,wrapT:Z}=N.sampler;N.gfxTexture.bindExtraParam(j,G,H,Z)}}O(x,"HAS_TEXTURE_u_baseColorTexture",Yr.BaseColor),O(E,"HAS_TEXTURE_u_metallicRoughnessTexture",Yr.MetallicRoughness),O(C,"HAS_TEXTURE_u_normalTexture",Yr.Normal),O(A,"HAS_TEXTURE_u_occlusionTexture",Yr.Occlusion),O(R,"HAS_TEXTURE_u_emissionTexture",Yr.Emission),l.texcoordBuffer&&(f.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(l.texcoordBuffer)),l.colorBuffer&&(f.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(l.colorBuffer)),l.normalBuffer&&(f.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(l.normalBuffer)),l.pbrBuffer&&(f.push("HAS_ATTRIBUTE_a_pbr"),f.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(l.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||f.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||f.push("DIFFUSE_SHADED"),f.push("USE_STANDARD_DERIVATIVES")}function la(f,o,l,p,_,v){let x=l.paint.get("model-opacity"),E=o.context,C=new Ct(o.context.gl.LEQUAL,Ct.ReadWrite,o.depthRangeFor3D),A=o.transform,R=f.mesh,O=R.material,N=O.pbrMetallicRoughness,z=o.style.fog,U;U=o.transform.projection.zAxisUnit==="pixels"?[...f.nodeModelMatrix]:r.a9.multiply([],p.zScaleMatrix,f.nodeModelMatrix),r.a9.multiply(U,p.negCameraPosMatrix,U);let j=r.a9.invert([],U);r.a9.transpose(j,j);let G=l.paint.get("model-emissive-strength").constantOr(0),H=$d(new Float32Array(f.worldViewProjection),new Float32Array(U),new Float32Array(j),null,o,x,N.baseColorFactor,O.emissiveFactor,N.metallicFactor,N.roughnessFactor,O,G,l),Z={defines:[]},ne=[];aa(Z.defines,ne,R,o);let te=o.shadowRenderer;te&&(te.useNormalOffset=!1);let re=null;if(z){let ce=hp(f.nodeModelMatrix,o.transform);if(re=new Float32Array(ce),A.projection.name!=="globe"){let ae=R.aabb.min,pe=R.aabb.max,[Ee,fe]=z.getOpacityForBounds(ce,ae[0],ae[1],pe[0],pe[1]);Z.overrideFog=Ee>=kn||fe>=kn}}let q=na(o,l.paint.get("model-cutoff-fade-range"));q.shouldRenderCutoff&&Z.defines.push("RENDER_CUTOFF");let X=o.getOrCreateProgram("model",Z);o.uploadCommonUniforms(E,X,null,re,q),o.renderPass!=="shadow"&&te&&te.setupShadowsFromMatrix(f.nodeModelMatrix,X),X.draw(o,E.gl.TRIANGLES,C,_,v,R.material.doubleSided?Vt.disabled:Vt.backCCW,H,l.id,R.vertexBuffer,R.indexBuffer,R.segments,l.paint,o.transform.zoom,void 0,ne)}function Kc(f,o,l,p,_,v,x){let E;E=f.projection.name==="globe"?r.c_(l,f):[...l],r.a9.multiply(E,E,o.matrix);let C=r.a9.multiply([],p,E);if(o.meshes)for(let A of o.meshes){if(A.material.alphaMode!=="BLEND"){x.push({mesh:A,depth:0,modelIndex:_,worldViewProjection:C,nodeModelMatrix:E});continue}let R=r.Q.transformMat4([],A.centroid,C);R[2]>0&&v.push({mesh:A,depth:R[2],modelIndex:_,worldViewProjection:C,nodeModelMatrix:E})}if(o.children)for(let A of o.children)Kc(f,A,l,p,_,v,x)}function Jc(f,o,l,p){let _=l.shadowRenderer;if(!_)return;let v=_.getShadowPassDepthMode(),x=_.getShadowPassColorMode(),E=_.calculateShadowPassMatrixFromMatrix(o),C=Bg(E);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,v,qt.disabled,x,Vt.backCCW,C,p.id,f.vertexBuffer,f.indexBuffer,f.segments,p.paint,l.transform.zoom,void 0,void 0)}function eu(f,o,l){let p=o.updateZoomBasedPaintProperties(),_=function(v,x,E){let C,A,R,O=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&O>0){let N=v.terrain,z=N.findDEMTileFor(E);z&&z.dem?C=r.d0.create(N,E,z):O=0}if(O===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),O===x.validForExaggeration&&(O===0||C&&C._demTile&&C._demTile.tileID===x.validForDEMTile.id&&C._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(let N in x.instancesPerModel){let z=x.instancesPerModel[N];for(let U=0;U<z.instancedDataArray.length;++U){let j=(C?O*C.getElevationAt(0|z.instancedDataArray.float32[16*U],0|z.instancedDataArray.float32[16*U+1],!0,!0):0)+z.instancesEvaluatedElevation[U];z.instancedDataArray.float32[16*U+6]=j,A=A?Math.min(x.terrainElevationMin,j):j,R=R?Math.max(x.terrainElevationMax,j):j}}return x.terrainElevationMin=A||0,x.terrainElevationMax=R||0,x.validForExaggeration=O,x.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(f,o,l);(p||_)&&(o.uploaded=!1,o.upload(f.context))}let fo={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.bV([0,0,0],[r.Y,r.Y,0])};function Kd(f,o){let l=1<<f.canonical.z,p=o.getFreeCameraOptions().position,_=o.elevation,v=f.canonical.x/l,x=(f.canonical.x+1)/l,E=f.canonical.y/l,C=(f.canonical.y+1)/l,A=o._centerAltitude;if(_){let z=_.getMinMaxForTile(f);z&&z.max>A&&(A=z.max)}let R=r.ad(p.x,v,x)-p.x,O=r.ad(p.y,E,C)-p.y,N=r.bo(A,o.center.lat)-p.z;return o._zoomFromMercatorZ(Math.sqrt(R*R+O*O+N*N))}function Jd(f,o,l,p,_,v,x){let E=f.context,C=f.renderPass==="shadow",A=f.shadowRenderer,R=C&&A?A.getShadowPassDepthMode():new Ct(E.gl.LEQUAL,Ct.ReadWrite,f.depthRangeFor3D),O=f.isTileAffectedByFog(v);if(l.meshes)for(let N of l.meshes){let z=["MODEL_POSITION_ON_GPU"],U=[],j,G,H;p.instancedDataArray.length>20&&z.push("INSTANCED_ARRAYS");let Z=na(f,o.paint.get("model-cutoff-fade-range"));if(Z.shouldRenderCutoff&&z.push("RENDER_CUTOFF"),C&&A)j=f.getOrCreateProgram("modelDepth",{defines:z}),G=Bg(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(l.matrix)),H=A.getShadowPassColorMode();else{aa(z,U,N,f),j=f.getOrCreateProgram("model",{defines:z,overrideFog:O});let te=N.material,re=te.pbrMetallicRoughness,q=o.paint.get("model-opacity"),X=o.paint.get("model-emissive-strength").constantOr(0);G=$d(v.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,f,q,re.baseColorFactor,te.emissiveFactor,re.metallicFactor,re.roughnessFactor,te,X,o,_),A&&(x.shadowUniformsInitialized?j.setShadowUniformValues(E,A.getShadowUniformValues()):(A.setupShadows(v.toUnwrapped(),j,"model-tile",v.overscaledZ),x.shadowUniformsInitialized=!0)),H=Z.shouldRenderCutoff||q<1||te.alphaMode!=="OPAQUE"?an.alphaBlended:an.unblended}f.uploadCommonUniforms(E,j,v.toUnwrapped(),null,Z);let ne=N.material.doubleSided?Vt.disabled:Vt.backCCW;if(p.instancedDataArray.length>20)U.push(p.instancedDataBuffer),j.draw(f,E.gl.TRIANGLES,R,qt.disabled,H,ne,G,o.id,N.vertexBuffer,N.indexBuffer,N.segments,o.paint,f.transform.zoom,void 0,U,p.instancedDataArray.length);else{let te=C?"u_instance":"u_normal_matrix";for(let re=0;re<p.instancedDataArray.length;++re)G[te]=new Float32Array(p.instancedDataArray.arrayBuffer,64*re,16),j.draw(f,E.gl.TRIANGLES,R,qt.disabled,H,ne,G,o.id,N.vertexBuffer,N.indexBuffer,N.segments,o.paint,f.transform.zoom,void 0,U)}}if(l.children)for(let N of l.children)Jd(f,o,N,p,_,v,x)}let eh=[1,-1,1];function tu(f,o,l,p){if(!l.modelManager)return!0;let _=l.modelManager;if(!l.shadowRenderer)return!0;let v=l.shadowRenderer,x=o.aabb,E=!0,C=f.maxHeight;if(C===0){let R=0;for(let O in f.instancesPerModel){let N=_.getModel(O,p);N?R=Math.max(R,Math.max(Math.max(N.aabb.max[0],N.aabb.max[1]),N.aabb.max[2])):E=!1}C=f.maxScale*R*1.41+f.maxVerticalOffset,E&&(f.maxHeight=C)}x.max[2]=C,x.min[2]+=f.terrainElevationMin,x.max[2]+=f.terrainElevationMax,r.Q.transformMat4(x.min,x.min,o.tileMatrix),r.Q.transformMat4(x.max,x.max,o.tileMatrix);let A=x.intersects(v.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(f.isInsideFirstShadowMapFrustum=A===2),A===0}class Zg{}class Qg{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,l,p){{let O=this._storage.get(l.id);if(O)return O.lastUsedFrameIdx=o,O.buf}let _=p.gl,v=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),x=new ArrayBuffer(v),E=new Int16Array(x);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));let C=new r.d2;for(let O=0;O<v/2;O+=3){let N=E[O],z=E[O+1],U=E[O+2];C.emplaceBack(N,z),C.emplaceBack(z,U),C.emplaceBack(U,N)}let A=p.bindVertexArrayOES.current,R=new Zg;return R.buf=new Di(p,C),R.lastUsedFrameIdx=o,this._storage.set(l.id,R),p.bindVertexArrayOES.set(A),R.buf}update(o){for(let[l,p]of this._storage)o-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(l))}destroy(){for(let[o,l]of this._storage)l.buf.destroy(),this._storage.delete(o)}}let th={symbol:function(f,o,l,p,_){if(f.renderPass!=="translucent")return;let v=qt.disabled,x=f.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(A,R,O,N,z,U,j){let G=R.transform,H=z==="map",Z=U==="map";for(let ne of A){let te=N.getTile(ne),re=te.getBucket(O);if(!re||!re.text||!re.text.segments.get().length)continue;let q=r.b8(re.textSizeData,G.zoom),X=Dd(ne,re.getProjection(),G),ce=G.calculatePixelsToTileUnitsMatrix(te),ae=Sc(X,te.tileID.canonical,Z,H,G,re.getProjection(),ce),pe=re.hasIconTextFit()&&re.hasIconData();if(q){let Ee=Math.pow(2,G.zoom-te.tileID.overscaledZ);Vg(re,H,Z,j,r.cE,G,ae,ne,Ee,q,pe)}}}(p,f,l,o,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_);let E=l.paint.get("icon-opacity").constantOr(1)!==0,C=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(E||C)?Xc(f,o,l,p,v,x):(E&&Xc(f,o,l,p,v,x,{onlyIcons:!0}),C&&Xc(f,o,l,p,v,x,{onlyText:!0})),o.map.showCollisionBoxes&&(ip(f,o,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ip(f,o,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,o,l,p){if(f.renderPass!=="translucent")return;let _=l.paint.get("circle-opacity"),v=l.paint.get("circle-stroke-width"),x=l.paint.get("circle-stroke-opacity"),E=l.layout.get("circle-sort-key").constantOr(1)!==void 0,C=l.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(v.constantOr(1)===0||x.constantOr(1)===0))return;let A=f.context,R=A.gl,O=f.transform,N=f.depthModeForSublayer(0,Ct.ReadOnly),z=qt.disabled,U=f.colorModeForDrapableLayerRenderPass(C),j=O.projection.name==="globe",G=[r.a8(O.center.lng),r.ah(O.center.lat)],H=[];for(let ne=0;ne<p.length;ne++){let te=p[ne],re=o.getTile(te),q=re.getBucket(l);if(!q||q.projection.name!==O.projection.name)continue;let X=q.programConfigurations.get(l.id),ce=r.cF(l),ae=f.isTileAffectedByFog(te);j&&ce.push("PROJECTION_GLOBE_VIEW");let pe=f.getOrCreateProgram("circle",{config:X,defines:ce,overrideFog:ae}),Ee=q.layoutVertexBuffer,fe=q.globeExtVertexBuffer,be=q.indexBuffer,De=O.projection.createInversionMatrix(O,te.canonical),he={programConfiguration:X,program:pe,layoutVertexBuffer:Ee,globeExtVertexBuffer:fe,indexBuffer:be,uniformValues:r.cG(f,te,re,De,G,l),tile:re};if(E){let ye=q.segments.get();for(let Ve of ye)H.push({segments:new r.aE([Ve]),sortKey:Ve.sortKey,state:he})}else H.push({segments:q.segments,sortKey:0,state:he})}E&&H.sort((ne,te)=>ne.sortKey-te.sortKey);let Z={useDepthForOcclusion:O.depthOcclusionForSymbolsAndCircles};for(let ne of H){let{programConfiguration:te,program:re,layoutVertexBuffer:q,globeExtVertexBuffer:X,indexBuffer:ce,uniformValues:ae,tile:pe}=ne.state,Ee=ne.segments;f.terrain&&f.terrain.setupElevationDraw(pe,re,Z),f.uploadCommonUniforms(A,re,pe.tileID.toUnwrapped()),re.draw(f,R.TRIANGLES,N,z,U,Vt.disabled,ae,l.id,q,ce,Ee,l.paint,O.zoom,te,[X])}},heatmap:function(f,o,l,p){if(l.paint.get("heatmap-opacity")!==0)if(f.renderPass==="offscreen"){let _=f.context,v=_.gl,x=qt.disabled,E=new an([v.ONE,v.ONE,v.ONE,v.ONE],r.aA.transparent,[!0,!0,!0,!0]);(function(z,U,j,G){let H=z.gl,Z=U.width*G,ne=U.height*G;z.activeTexture.set(H.TEXTURE1),z.viewport.set([0,0,Z,ne]);let te=j.heatmapFbo;if(!te||te&&(te.width!==Z||te.height!==ne)){te&&te.destroy();let re=H.createTexture();H.bindTexture(H.TEXTURE_2D,re),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_S,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_WRAP_T,H.CLAMP_TO_EDGE),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.LINEAR),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.LINEAR),te=j.heatmapFbo=z.createFramebuffer(Z,ne,!0,null),function(q,X,ce,ae,pe,Ee){let fe=q.gl;fe.texImage2D(fe.TEXTURE_2D,0,q.extRenderToTextureHalfFloat?fe.RGBA16F:fe.RGBA,pe,Ee,0,fe.RGBA,q.extRenderToTextureHalfFloat?fe.HALF_FLOAT:fe.UNSIGNED_BYTE,null),ae.colorAttachment.set(ce)}(z,0,re,te,Z,ne)}else H.bindTexture(H.TEXTURE_2D,te.colorAttachment.get()),z.bindFramebuffer.set(te.framebuffer)})(_,f,l,f.transform.projection.name==="globe"?.5:.25),_.clear({color:r.aA.transparent});let C=f.transform,A=C.projection.name==="globe",R=A?["PROJECTION_GLOBE_VIEW"]:[],O=A?Vt.frontCCW:Vt.disabled,N=[r.a8(C.center.lng),r.ah(C.center.lat)];for(let z=0;z<p.length;z++){let U=p[z];if(o.hasRenderableParent(U))continue;let j=o.getTile(U),G=j.getBucket(l);if(!G||G.projection.name!==C.projection.name)continue;let H=f.isTileAffectedByFog(U),Z=G.programConfigurations.get(l.id),ne=f.getOrCreateProgram("heatmap",{config:Z,defines:R,overrideFog:H}),{zoom:te}=f.transform;f.terrain&&f.terrain.setupElevationDraw(j,ne),f.uploadCommonUniforms(_,ne,U.toUnwrapped());let re=C.projection.createInversionMatrix(C,U.canonical);ne.draw(f,v.TRIANGLES,Ct.disabled,x,E,O,xb(f,U,j,re,N,te,l.paint.get("heatmap-intensity")),l.id,G.layoutVertexBuffer,G.indexBuffer,G.segments,l.paint,f.transform.zoom,Z,A?[G.globeExtVertexBuffer]:null)}_.viewport.set([0,0,f.width,f.height])}else f.renderPass==="translucent"&&(f.context.setColorMode(f.colorModeForRenderPass()),function(_,v){let x=_.context,E=x.gl,C=v.heatmapFbo;if(!C)return;x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get()),x.activeTexture.set(E.TEXTURE1);let A=v.colorRampTexture;A||(A=v.colorRampTexture=new r.T(x,v.colorRamp,E.RGBA)),A.bind(E.LINEAR,E.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,E.TRIANGLES,Ct.disabled,qt.disabled,_.colorModeForRenderPass(),Vt.disabled,((R,O,N,z)=>({u_image:0,u_color_ramp:1,u_opacity:O.paint.get("heatmap-opacity")}))(0,v),v.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,v.paint,_.transform.zoom)}(f,l))},line:function(f,o,l,p){if(f.renderPass!=="translucent")return;let _=l.paint.get("line-opacity"),v=l.paint.get("line-width");if(_.constantOr(1)===0||v.constantOr(1)===0)return;let x=l.paint.get("line-emissive-strength"),E=f.depthModeForSublayer(0,Ct.ReadOnly),C=f.colorModeForDrapableLayerRenderPass(x),A=f.terrain&&f.terrain.renderingToTexture?1:r.f.devicePixelRatio,R=l.paint.get("line-dasharray"),O=R.constantOr(1),N=l.layout.get("line-cap"),z=l.paint.get("line-pattern"),U=z.constantOr(1),j=l.paint.get("line-opacity").constantOr(1)!==1,G=!U&&j,H=l.paint.get("line-gradient"),Z=U?"linePattern":"line",ne=f.context,te=ne.gl,re=r.cH(l);f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(G=!1);for(let q of p){let X=o.getTile(q);if(U&&!X.patternsLoaded())continue;let ce=X.getBucket(l);if(!ce)continue;f.prepareDrawTile();let ae=ce.programConfigurations.get(l.id),pe=f.isTileAffectedByFog(q),Ee=f.getOrCreateProgram(Z,{config:ae,defines:re,overrideFog:pe}),fe=z.constantOr(null);if(fe&&X.imageAtlas){let Te=X.imageAtlas.patternPositions[fe.toString()];Te&&ae.setConstantPatternPositions(Te)}let be=R.constantOr(null),De=N.constantOr(null);if(!U&&be&&De&&X.lineAtlas){let Te=X.lineAtlas.getDash(be,De);Te&&ae.setConstantPatternPositions(Te)}let[he,ye]=l.paint.get("line-trim-offset");(De==="round"||De==="square")&&he!==ye&&(he===0&&(he-=1),ye===1&&(ye+=1));let Ve=f.terrain?q.projMatrix:null,ge=U?r.cI(f,X,l,Ve,A,[he,ye]):r.cJ(f,X,l,Ve,ce.lineClipsArray.length,A,[he,ye]);if(H){let Te=ce.gradients[l.id],ie=Te.texture;if(l.gradientVersion!==Te.version){let Re=256;if(l.stepInterpolant){let ot=o.getSource().maxzoom,pt=q.canonical.z===ot?Math.ceil(1<<f.transform.maxZoom-q.canonical.z):1;Re=r.ad(r.cK(ce.maxLineLength/r.Y*1024*pt),256,ne.maxTextureSize)}Te.gradient=r.cL({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Re,image:Te.gradient||void 0,clips:ce.lineClipsArray}),Te.texture?Te.texture.update(Te.gradient):Te.texture=new r.T(ne,Te.gradient,te.RGBA),Te.version=l.gradientVersion,ie=Te.texture}ne.activeTexture.set(te.TEXTURE1),ie.bind(l.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}O&&(ne.activeTexture.set(te.TEXTURE0),X.lineAtlasTexture&&X.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),ae.updatePaintBuffers()),U&&(ne.activeTexture.set(te.TEXTURE0),X.imageAtlasTexture&&X.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),ae.updatePaintBuffers()),f.uploadCommonUniforms(ne,Ee,q.toUnwrapped());let we=Te=>{Ee.draw(f,te.TRIANGLES,E,Te,C,Vt.disabled,ge,l.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,l.paint,f.transform.zoom,ae,[ce.layoutVertexBuffer2,ce.patternVertexBuffer])};if(G){let Te=f.stencilModeForClipping(q).ref;Te===0&&f.terrain&&ne.clear({stencil:0});let ie={func:te.EQUAL,mask:255};ge.u_alpha_discard_threshold=.8,we(new qt(ie,Te,255,te.KEEP,te.KEEP,te.INVERT)),ge.u_alpha_discard_threshold=0,we(new qt(ie,Te,255,te.KEEP,te.KEEP,te.KEEP))}else we(f.stencilModeForClipping(q))}G&&(f.resetStencilClippingMasks(),f.terrain&&ne.clear({stencil:0}))},fill:function(f,o,l,p){let _=l.paint.get("fill-color"),v=l.paint.get("fill-opacity");if(v.constantOr(1)===0)return;let x=l.paint.get("fill-emissive-strength"),E=f.colorModeForDrapableLayerRenderPass(x),C=l.paint.get("fill-pattern"),A=f.opaquePassEnabledForLayer()&&!C.constantOr(1)&&_.constantOr(r.aA.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";if(f.renderPass===A){let R=f.depthModeForSublayer(1,f.renderPass==="opaque"?Ct.ReadWrite:Ct.ReadOnly);qd(f,o,l,p,R,E,!1)}if(f.renderPass==="translucent"&&l.paint.get("fill-antialias")){let R=f.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Ct.ReadOnly);qd(f,o,l,p,R,E,!0)}},"fill-extrusion":function(f,o,l,p){let _=l.paint.get("fill-extrusion-opacity"),v=f.context,x=v.gl,E=f.terrain,C=E&&E.renderingToTexture;if(_===0)return;let A=f.conflationActive&&f.layerUsedInConflation(l,o.getSource());if(A&&function(R,O,N,z){for(let U of z){let j=O.getTile(U).getBucket(N);j&&(j.updateReplacement(U,R.replacementSource),j.uploadCentroid(R.context))}}(f,o,l,p),E||A)for(let R of p){let O=o.getTile(R).getBucket(l);O&&op(f.context,o,R,O,l,E,A)}if(f.renderPass==="shadow"&&f.shadowRenderer){let R=f.shadowRenderer;if(E&&_<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.Z)return;let O=R.getShadowPassDepthMode(),N=R.getShadowPassColorMode();nt(f,o,l,p,O,qt.disabled,N,A)}else if(f.renderPass==="translucent"){let R=!l.paint.get("fill-extrusion-pattern").constantOr(1),O=l.paint.get("fill-extrusion-color").constantOr(r.aA.white);if(!C&&O.a!==0){let N=new Ct(f.context.gl.LEQUAL,Ct.ReadWrite,f.depthRangeFor3D);_===1&&R?nt(f,o,l,p,N,qt.disabled,an.unblended,A):(nt(f,o,l,p,N,qt.disabled,an.disabled,A),nt(f,o,l,p,N,f.stencilModeFor3D(),f.colorModeForRenderPass(),A),f.resetStencilClippingMasks())}if(f.style.enable3dLights()&&R&&(!E&&f.transform.projection.name!=="globe"||C)){let N=l.paint.get("fill-extrusion-opacity"),z=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),j=l.paint.get("fill-extrusion-flood-light-intensity"),G=l.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),H=z>0&&U>0,Z=j>0,ne=(re,q,X)=>(1-X)*re+X*q,te=re=>{let q=f.depthModeForSublayer(1,Ct.ReadOnly,x.LEQUAL,!0),X=l.paint.get(re?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ce=ne(.1,3,X),ae=f._showOverdrawInspector;if(!ae){let pe=new qt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ee=new an([x.ONE,x.ONE,x.ONE,x.ONE],r.aA.transparent,[!1,!1,!1,!0],x.MIN);Va(f,o,l,p,q,pe,Ee,Vt.disabled,re,"sdf",N,z,U,j,G,ce,A,!1)}{let pe=ae?qt.disabled:new qt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ee=ae?f.colorModeForRenderPass():new an([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],r.aA.transparent,[!0,!0,!0,!0]);Va(f,o,l,p,q,pe,Ee,Vt.disabled,re,"color",N,z,U,j,G,ce,A,!1)}};if(C){let re=(q,X,ce)=>{let ae=f.depthModeForSublayer(1,Ct.ReadOnly,x.LEQUAL,!1),pe=l.paint.get(q?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=ne(.1,3,pe);{let fe=new an([x.ONE,x.ONE,x.ONE,x.ONE],r.aA.transparent,[!1,!1,!1,!0]);Va(f,o,l,p,ae,qt.disabled,fe,Vt.disabled,q,"clear",N,z,U,j,G,Ee,A,X)}{let fe=new qt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),be=new an([x.ONE,x.ONE,x.ONE,x.ONE],r.aA.transparent,[!1,!1,!1,!0],x.MIN);Va(f,o,l,p,ae,fe,be,Vt.disabled,q,"sdf",N,z,U,j,G,Ee,A,X)}{let fe=q?x.ZERO:x.ONE_MINUS_DST_ALPHA,be=new qt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),De=new an([fe,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],r.aA.transparent,[!0,!0,!0,!0]);Va(f,o,l,p,ae,be,De,Vt.disabled,q,"color",N,z,U,j,G,Ee,A,X)}{let fe=new an([x.ONE,x.ONE,x.ONE,q?x.ZERO:x.ONE],r.aA.transparent,[!1,!1,!1,!0],q?x.FUNC_ADD:x.MAX);Va(f,o,l,p,ae,qt.disabled,fe,Vt.disabled,q,"clear",N,z,U,j,G,Ee,A,X,ce)}};if(H||Z){let q;if(f.prepareDrawTile(),E){let X=E.drapeBufferSize[0],ce=E.drapeBufferSize[1];q=E.framebufferCopyTexture,q&&(!q||q.size[0]===X&&q.size[1]===ce)||(q&&q.destroy(),q=E.framebufferCopyTexture=new r.T(v,new r.h({width:X,height:ce}),x.RGBA)),q.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGBA,0,0,X,ce,0)}H&&re(!0,!1,q),Z&&re(!1,!0,q)}}else H&&te(!0),Z&&te(!1)}}},hillshade:function(f,o,l,p){if(f.renderPass!=="offscreen"&&f.renderPass!=="translucent"||f.style.disableElevatedTerrain)return;let _=f.context,v=f.terrain&&f.terrain.renderingToTexture,[x,E]=f.renderPass!=="translucent"||v?[{},p]:f.stencilConfigForOverlap(p);for(let C of E){let A=o.getTile(C);if(A.needsHillshadePrepare&&f.renderPass==="offscreen")wl(f,A,l);else if(f.renderPass==="translucent"){let R=f.depthModeForSublayer(0,Ct.ReadOnly),O=l.paint.get("hillshade-emissive-strength"),N=f.colorModeForDrapableLayerRenderPass(O),z=v&&f.terrain?f.terrain.stencilModeForRTTOverlap(C):x[C.overscaledZ];An(f,C,A,l,R,z,N)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,o,l,p,_,v){if(f.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;let x=f.transform.projection.name==="globe",E=l.paint.get("raster-elevation")!==0,C=E&&x;if(f.renderElevatedRasterBackface&&!C)return;let A=f.context,R=A.gl,O=o.getSource(),N=function(q,X,ce,ae){let pe=X.paint.get("raster-color"),Ee=q.type==="raster-array",fe=[],be=X.paint.get("raster-resampling"),De=X.paint.get("raster-color-mix"),he=X.paint.get("raster-color-range"),ye=[De[0],De[1],De[2],0],Ve=De[3],ge=be==="nearest"?ae.NEAREST:ae.LINEAR;if(Ee&&(fe.push("RASTER_ARRAY"),pe||fe.push("RASTER_COLOR"),be==="linear"&&fe.push("RASTER_ARRAY_LINEAR"),ge=ae.NEAREST,!he&&q.rasterLayers)){let we=q.rasterLayers.find(({id:Te})=>Te===X.sourceLayer);we&&we.fields&&we.fields.range&&(he=we.fields.range)}if(he=he||[0,1],pe){fe.push("RASTER_COLOR"),ce.activeTexture.set(ae.TEXTURE2),X.updateColorRamp(he);let we=X.colorRampTexture;we||(we=X.colorRampTexture=new r.T(ce,X.colorRamp,ae.RGBA)),we.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return{mix:ye,range:he,offset:Ve,defines:fe,resampling:ge}}(O,l,A,R);if(O instanceof r.as&&!p.length&&!x)return;let z=l.paint.get("raster-emissive-strength"),U=f.colorModeForDrapableLayerRenderPass(z),j=f.terrain&&f.terrain.renderingToTexture,G=!f.options.moving,H=l.paint.get("raster-resampling")==="nearest"?R.NEAREST:R.LINEAR;if(O instanceof r.as&&!p.length&&(O.onNorthPole||O.onSouthPole)){let q=E?f.stencilModeFor3D():qt.disabled;return void ks(!!O.onNorthPole,null,f,o,l,z,N,Vt.disabled,q)}if(!p.length)return;let[Z,ne]=O instanceof r.as||j?[{},p]:f.stencilConfigForOverlap(p),te=ne[ne.length-1].overscaledZ;C&&N.defines.push("PROJECTION_GLOBE_VIEW"),E&&N.defines.push("RENDER_CUTOFF");let re=(q,X,ce)=>{for(let ae of q){let pe=ae.toUnwrapped(),Ee=o.getTile(ae);if(j&&(!Ee||!Ee.hasData()))continue;A.activeTexture.set(R.TEXTURE0);let fe=Sl(Ee,O,l,N);if(!fe||!fe.texture)continue;let{texture:be,mix:De,offset:he,tileSize:ye,buffer:Ve}=fe,ge,we;j?(ge=Ct.disabled,we=ae.projMatrix):E?(ge=new Ct(R.LEQUAL,Ct.ReadWrite,f.depthRangeFor3D),we=x?Float32Array.from(f.transform.expandedFarZProjMatrix):f.transform.calculateProjMatrix(pe,G)):(ge=f.depthModeForSublayer(ae.overscaledZ-te,l.paint.get("raster-opacity")===1?Ct.ReadWrite:Ct.ReadOnly,R.LESS),we=f.transform.calculateProjMatrix(pe,G));let Te=f.terrain&&j?f.terrain.stencilModeForRTTOverlap(ae):Z[ae.overscaledZ],ie=v?0:l.paint.get("raster-fade-duration");Ee.registerFadeDuration(ie);let Re=o.findLoadedParent(ae,0),ot=Na(Ee,Re,o,f.transform,ie),pt,wt;f.terrain&&f.terrain.prepareDrawTile(),A.activeTexture.set(R.TEXTURE0),be.bind(H,R.CLAMP_TO_EDGE),A.activeTexture.set(R.TEXTURE1),Re?(Re.texture&&Re.texture.bind(H,R.CLAMP_TO_EDGE),pt=Math.pow(2,Re.tileID.overscaledZ-Ee.tileID.overscaledZ),wt=[Ee.tileID.canonical.x*pt%1,Ee.tileID.canonical.y*pt%1]):be.bind(H,R.CLAMP_TO_EDGE),be.useMipmap&&A.extTextureFilterAnisotropic&&f.transform.pitch>20&&R.texParameterf(R.TEXTURE_2D,A.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,A.extTextureFilterAnisotropicMax);let yt=f.transform,It,fn=E?Qd(yt):[0,0,0,0],$t,yn,pn,mi,Vn,Yi=0;if(C&&O instanceof r.as&&O.coordinates.length>3)$t=Float32Array.from(r.aW(r.cn(new r.bv(0,0,0)))),yn=Float32Array.from(yt.globeMatrix),pn=Float32Array.from(r.cj(yt)),mi=[r.a8(yt.center.lng),r.ah(yt.center.lat)],It=O.elevatedGlobePerspectiveTransform,Vn=O.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){let nn=r.ck(ae.canonical);Yi=r.cl(nn.getCenter().lat),$t=Float32Array.from(r.aW(r.cn(ae.canonical))),yn=Float32Array.from(yt.globeMatrix),pn=Float32Array.from(r.cj(yt)),mi=[r.a8(yt.center.lng),r.ah(yt.center.lat)],It=[0,0],Vn=Float32Array.from(r.cm(ae.canonical,nn,Yi,yt.worldSize/yt._pixelsPerMercatorPixel))}else It=O instanceof r.as?O.perspectiveTransform:[0,0],$t=new Float32Array(16),yn=new Float32Array(9),pn=new Float32Array(16),mi=[0,0],Vn=new Float32Array(9);let Bi=zg(we,$t,yn,pn,Vn,wt||[0,0],r.W(f.transform.zoom),mi,fn,pt||1,ot,l,It,E?l.paint.get("raster-elevation"):0,2,De,he,N.range,ye,Ve,z),ni=f.isTileAffectedByFog(ae),Gn=f.getOrCreateProgram("raster",{defines:N.defines,overrideFog:ni});if(f.uploadCommonUniforms(A,Gn,pe),O instanceof r.as){let nn=O.elevatedGlobeVertexBuffer,on=O.elevatedGlobeIndexBuffer;if(j||!x)O.boundsBuffer&&O.boundsSegments&&Gn.draw(f,R.TRIANGLES,ge,qt.disabled,U,Vt.disabled,Bi,l.id,O.boundsBuffer,f.quadTriangleIndexBuffer,O.boundsSegments);else if(nn&&on){let hi=yt.zoom<=r.bJ?O.elevatedGlobeSegments:O.getSegmentsForLongitude(yt.center.lng);hi&&Gn.draw(f,R.TRIANGLES,ge,qt.disabled,U,X,Bi,l.id,nn,on,hi)}}else if(C){ge=new Ct(R.LEQUAL,Ct.ReadOnly,f.depthRangeFor3D);let nn=f.globeSharedBuffers;if(nn){let[on,hi,ii]=nn.getGridBuffers(Yi,!1);Gn.draw(f,R.TRIANGLES,ge,ce||Te,f.colorModeForRenderPass(),X,Bi,l.id,on,hi,ii)}}else{let{tileBoundsBuffer:nn,tileBoundsIndexBuffer:on,tileBoundsSegments:hi}=f.getTileBoundsBuffers(Ee);Gn.draw(f,R.TRIANGLES,ge,Te,U,Vt.disabled,Bi,l.id,nn,on,hi)}}if(!(O instanceof r.as)&&C)for(let ae of q){let pe=ae.canonical.y===(1<<ae.canonical.z)-1;ae.canonical.y===0&&ks(!0,ae,f,o,l,z,N,X,ce||qt.disabled),pe&&ks(!1,ae,f,o,l,z,N,X===Vt.frontCW?Vt.backCW:Vt.frontCW,ce||qt.disabled)}};C?re(ne,f.renderElevatedRasterBackface?Vt.backCW:Vt.frontCW,f.stencilModeFor3D()):re(ne,Vt.disabled,void 0),f.resetStencilClippingMasks()},"raster-particle":function(f,o,l,p,_,v){f.renderPass==="offscreen"&&function(x,E,C,A){if(!A.length)return;let R=x.context,O=R.gl,N=E.getSource();if(!(N instanceof Je))return;let z=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count"))),U=C.particleFramebuffer;U?U.width!==z&&(U.destroy(),U=C.particleFramebuffer=R.createFramebuffer(z,z,!0,null)):U=C.particleFramebuffer=R.createFramebuffer(z,z,!0,null);let j=[];for(let Z of A){let ne=E.getTile(Z);if(!(ne instanceof yd))continue;let te=Ib(ne,N,C);if(!te)continue;let re=[ne.tileSize,ne.tileSize],q=C.tileFramebuffer;q||(q=C.tileFramebuffer=R.createFramebuffer(re[0],re[1],!0,null));let X=ne.rasterParticleState;X||(X=ne.rasterParticleState=new wg(R,Z,re,z));let ce=X.update(C.lastInvalidatedAt);X.particleTextureDimension!==z&&X.setParticleTextureDimension(Z,z);let ae=X.targetColorTexture;X.targetColorTexture=X.backgroundColorTexture,X.backgroundColorTexture=ae;let pe=X.particleTexture0;X.particleTexture0=X.particleTexture1,X.particleTexture1=pe,j.push([Z,te,X,ce])}if(j.length===0)return;let G=r.f.now(),H=C.previousDrawTimestamp?.001*(G-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=G,C.hasColorMap()){R.activeTexture.set(O.TEXTURE0+2);let Z=C.colorRampTexture;Z||(Z=C.colorRampTexture=new r.T(R,C.colorRamp,O.RGBA)),Z.bind(O.LINEAR,O.CLAMP_TO_EDGE)}R.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(Z,ne,te){let re=Z.context,q=re.gl,X=ne.tileFramebuffer;re.activeTexture.set(q.TEXTURE0);let ce={u_texture:0,u_opacity:1.05*(pe=ne.paint.get("raster-particle-fade-opacity-factor"))/(pe+.05)},ae=Z.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var pe;for(let Ee of te){let[,,fe,be]=Ee;X.colorAttachment.set(fe.targetColorTexture.texture),re.viewport.set([0,0,X.width,X.height]),re.clear({color:r.aA.transparent}),be&&(fe.backgroundColorTexture.bind(q.NEAREST,q.CLAMP_TO_EDGE),ae.draw(Z,q.TRIANGLES,Ct.disabled,qt.disabled,an.alphaBlended,Vt.disabled,ce,ne.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments))}}(x,C,j),function(Z,ne,te,re){let q=Z.context,X=q.gl,ce=te.tileFramebuffer,ae=Z.transform.projection.name==="globe",pe=te.paint.get("raster-particle-max-speed");for(let Ee of re){let[fe,be,De]=Ee;q.activeTexture.set(X.TEXTURE0+0),be.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ce.colorAttachment.set(De.targetColorTexture.texture);let he=Z.getOrCreateProgram("rasterParticleDraw",{defines:be.defines,overrideFog:!1});q.activeTexture.set(X.TEXTURE0+1);let ye=be.scalarData?[]:[0,1,2,3].map(we=>r.cN[we](fe));ye.push(fe);let Ve=fe.canonical.x,ge=fe.canonical.y;for(let we of ye){let Te=ne.getTile(ae?we.wrapped():we);if(!Te)continue;let ie=Te.rasterParticleState;if(!ie)continue;let Re=we.canonical.x+(1<<we.canonical.z)*(we.wrap-fe.wrap),ot=we.canonical.y;ie.particleTexture0.bind(X.NEAREST,X.CLAMP_TO_EDGE);let pt=Zc(1,ie.particleTexture0.size[0],[Re-Ve,ot-ge],0,be.texture.size,2,pe,be.textureOffset,be.scale,be.offset);he.draw(Z,X.POINTS,Ct.disabled,qt.disabled,an.alphaBlended,Vt.disabled,pt,te.id,ie.particleIndexBuffer,void 0,ie.particleSegment)}}}(x,E,C,j),R.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(Z,ne,te,re){let q=Z.context,X=q.gl,ce=ne.paint.get("raster-particle-max-speed"),ae=re*ne.paint.get("raster-particle-speed-factor")*.3,pe=function(fe){return Math.pow(fe,6)}(.01+1*ne.paint.get("raster-particle-reset-rate-factor")),Ee=ne.particleFramebuffer;q.viewport.set([0,0,Ee.width,Ee.height]);for(let fe of te){let[,be,De]=fe;q.activeTexture.set(X.TEXTURE0+0),be.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),q.activeTexture.set(X.TEXTURE0+1);let he=De.particleTexture0;he.bind(X.NEAREST,X.CLAMP_TO_EDGE);let ye=Eb(1,he.size[0],0,be.texture.size,ce,ae,pe,be.textureOffset,be.scale,be.offset);Ee.colorAttachment.set(De.particleTexture1.texture),q.clear({color:r.aA.transparent}),Z.getOrCreateProgram("rasterParticleUpdate",{defines:be.defines}).draw(Z,X.TRIANGLES,Ct.disabled,qt.disabled,an.unblended,Vt.disabled,ye,ne.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments)}}(x,C,j,H)}(f,o,l,p),f.renderPass==="translucent"&&(function(x,E,C,A,R){let O=x.context,N=O.gl,z=!x.options.moving,U=x.transform.projection.name==="globe";if(!A.length)return;let[j,G]=x.stencilConfigForOverlap(A),H=[];U&&H.push("PROJECTION_GLOBE_VIEW");let Z=x.stencilModeFor3D();for(let ne of G){let te=ne.toUnwrapped(),re=E.getTile(ne);if(!re.rasterParticleState)continue;let q=re.rasterParticleState,X=100;re.registerFadeDuration(X);let ce=E.findLoadedParent(ne,0),ae=Na(re,ce,E,x.transform,X),pe,Ee;x.terrain&&x.terrain.prepareDrawTile(),O.activeTexture.set(N.TEXTURE0),q.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),O.activeTexture.set(N.TEXTURE1),ce&&ce.rasterParticleState?(ce.rasterParticleState.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),pe=Math.pow(2,ce.tileID.overscaledZ-re.tileID.overscaledZ),Ee=[re.tileID.canonical.x*pe%1,re.tileID.canonical.y*pe%1]):q.targetColorTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);let fe=U?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(te,z),be=x.transform,De=Cb(be),he=r.ck(ne.canonical),ye=r.cl(he.getCenter().lat),Ve,ge,we,Te,ie;U?(Ve=Float32Array.from(r.aW(r.cn(ne.canonical))),ge=Float32Array.from(be.globeMatrix),we=Float32Array.from(r.cj(be)),Te=[r.a8(be.center.lng),r.ah(be.center.lat)],ie=Float32Array.from(r.cm(ne.canonical,he,ye,be.worldSize/be._pixelsPerMercatorPixel))):(Ve=new Float32Array(16),ge=new Float32Array(9),we=new Float32Array(16),Te=[0,0],ie=new Float32Array(9));let Re=Wc(fe,Ve,ge,we,ie,Ee||[0,0],r.W(x.transform.zoom),Te,De,pe||1,ae,250),ot=x.isTileAffectedByFog(ne),pt=x.getOrCreateProgram("rasterParticle",{defines:H,overrideFog:ot});if(x.uploadCommonUniforms(O,pt,te),U){let wt=new Ct(N.LEQUAL,Ct.ReadWrite,x.depthRangeFor3D),yt=0,It=x.globeSharedBuffers;if(It){let[fn,$t,yn]=It.getGridBuffers(ye,yt!==0);pt.draw(x,N.TRIANGLES,wt,Z,an.alphaBlended,Vt.backCCW,Re,C.id,fn,$t,yn)}}else{let wt=x.depthModeForSublayer(0,Ct.ReadOnly),yt=j[ne.overscaledZ],{tileBoundsBuffer:It,tileBoundsIndexBuffer:fn,tileBoundsSegments:$t}=x.getTileBoundsBuffers(re);pt.draw(x,N.TRIANGLES,wt,yt,an.alphaBlended,Vt.disabled,Re,C.id,It,fn,$t)}}x.resetStencilClippingMasks()}(f,o,l,p),f.style.map.triggerRepaint())},background:function(f,o,l,p){let _=l.paint.get("background-color"),v=l.paint.get("background-opacity"),x=l.paint.get("background-emissive-strength");if(v===0)return;let E=f.context,C=E.gl,A=f.transform,R=A.tileSize,O=l.paint.get("background-pattern");if(f.isPatternMissing(O,l.scope))return;let N=!O&&_.a===1&&v===1&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==N)return;let z=qt.disabled,U=f.depthModeForSublayer(0,N==="opaque"?Ct.ReadWrite:Ct.ReadOnly),j=f.colorModeForDrapableLayerRenderPass(x),G=O?"backgroundPattern":"background",H,Z=p;Z||(H=f.getBackgroundTiles(),Z=Object.values(H).map(ne=>ne.tileID)),O&&(E.activeTexture.set(C.TEXTURE0),f.imageManager.bind(f.context,l.scope));for(let ne of Z){let te=f.isTileAffectedByFog(ne),re=f.getOrCreateProgram(G,{overrideFog:te}),q=ne.toUnwrapped(),X=p?ne.projMatrix:f.transform.calculateProjMatrix(q);f.prepareDrawTile();let ce=o?o.getTile(ne):H?H[ne.key]:new Bo(ne,R,A.zoom,f),ae=O?Db(X,x,v,f,O,l.scope,{tileID:ne,tileSize:R}):Tb(X,x,v,_);f.uploadCommonUniforms(E,re,q);let{tileBoundsBuffer:pe,tileBoundsIndexBuffer:Ee,tileBoundsSegments:fe}=f.getTileBoundsBuffers(ce);re.draw(f,C.TRIANGLES,U,z,j,Vt.disabled,ae,l.id,pe,Ee,fe)}},sky:function(f,o,l){let p=f._atmosphere?r.W(f.transform.zoom):1,_=l.paint.get("sky-opacity")*p;if(_===0)return;let v=f.context,x=l.paint.get("sky-type"),E=new Ct(v.gl.LEQUAL,Ct.ReadOnly,[0,1]),C=f.frameCounter/1e3%1;x==="atmosphere"?f.renderPass==="offscreen"?l.needsSkyboxCapture(f)&&(function(A,R,O,N){let z=A.context,U=z.gl,j=R.skyboxFbo;if(!j){j=R.skyboxFbo=z.createFramebuffer(32,32,!0,null),R.skyboxGeometry=new Wg(z),R.skyboxTexture=z.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,R.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let ne=0;ne<6;++ne)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(j.framebuffer),z.viewport.set([0,0,32,32]);let G=R.getCenter(A,!0),H=A.getOrCreateProgram("skyboxCapture"),Z=new Float64Array(16);r.a9.identity(Z),r.a9.rotateY(Z,Z,.5*-Math.PI),ja(A,R,H,Z,G,0),r.a9.identity(Z),r.a9.rotateY(Z,Z,.5*Math.PI),ja(A,R,H,Z,G,1),r.a9.identity(Z),r.a9.rotateX(Z,Z,.5*-Math.PI),ja(A,R,H,Z,G,2),r.a9.identity(Z),r.a9.rotateX(Z,Z,.5*Math.PI),ja(A,R,H,Z,G,3),r.a9.identity(Z),ja(A,R,H,Z,G,4),r.a9.identity(Z),r.a9.rotateY(Z,Z,Math.PI),ja(A,R,H,Z,G,5),z.viewport.set([0,0,A.width,A.height])}(f,l),l.markSkyboxValid(f)):f.renderPass==="sky"&&function(A,R,O,N,z){let U=A.context,j=U.gl,G=A.transform,H=A.getOrCreateProgram("skybox");U.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_CUBE_MAP,R.skyboxTexture);let Z=((ne,te,re,q,X)=>({u_matrix:ne,u_sun_direction:te,u_cubemap:0,u_opacity:q,u_temporal_offset:X}))(G.skyboxMatrix,R.getCenter(A,!1),0,N,z);A.uploadCommonUniforms(U,H),H.draw(A,j.TRIANGLES,O,qt.disabled,A.colorModeForRenderPass(),Vt.backCW,Z,"skybox",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(f,l,E,_,C):x==="gradient"&&f.renderPass==="sky"&&function(A,R,O,N,z){let U=A.context,j=U.gl,G=A.transform,H=A.getOrCreateProgram("skyboxGradient");R.skyboxGeometry||(R.skyboxGeometry=new Wg(U)),U.activeTexture.set(j.TEXTURE0);let Z=R.colorRampTexture;Z||(Z=R.colorRampTexture=new r.T(U,R.colorRamp,j.RGBA)),Z.bind(j.LINEAR,j.CLAMP_TO_EDGE);let ne=((te,re,q,X,ce)=>({u_matrix:te,u_color_ramp:0,u_center_direction:re,u_radius:r.bm(q),u_opacity:X,u_temporal_offset:ce}))(G.skyboxMatrix,R.getCenter(A,!1),R.paint.get("sky-gradient-radius"),N,z);A.uploadCommonUniforms(U,H),H.draw(A,j.TRIANGLES,O,qt.disabled,A.colorModeForRenderPass(),Vt.backCW,ne,"skyboxGradient",R.skyboxGeometry.vertexBuffer,R.skyboxGeometry.indexBuffer,R.skyboxGeometry.segment)}(f,l,E,_,C)},debug:function(f,o,l,p,_,v){for(let x=0;x<l.length;x++)if(_){let A=new r.aA(p.r*.8,p.g*.8,p.b*.8,1);Ml(f,o,l[x],p,-1,-1,v),Ml(f,o,l[x],p,-1,1,v),Ml(f,o,l[x],p,1,1,v),Ml(f,o,l[x],p,1,-1,v),Ml(f,o,l[x],A,0,0,v)}else Ml(f,o,l[x],p,0,0,v)},custom:function(f,o,l,p){let _=f.context,v=l.implementation;if(!f.transform.projection.unsupportedLayers||!f.transform.projection.unsupportedLayers.includes("custom")||f.terrain&&(f.terrain.renderingToTexture||f.renderPass==="offscreen")&&l.isDraped(o)){if(f.renderPass==="offscreen"){let x=v.prerender;if(x){if(f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),f.transform.projection.name==="globe"){let E=f.transform.pointMerc;x.call(v,_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.W(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else x.call(v,_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState()}}else if(f.renderPass==="translucent"){if(f.terrain&&f.terrain.renderingToTexture){let E=v.renderToTile;if(E){let C=p[0].canonical,A=new r.O(C.x+p[0].wrap*(1<<C.z),C.y,C.z);_.setDepthMode(Ct.disabled),_.setStencilMode(qt.disabled),_.setColorMode(f.colorModeForRenderPass()),f.setCustomLayerDefaults(),E.call(v,_.gl,A),_.setDirty(),f.setBaseState()}return}f.setCustomLayerDefaults(),_.setColorMode(f.colorModeForRenderPass()),_.setStencilMode(qt.disabled);let x=v.renderingMode==="3d"?new Ct(f.context.gl.LEQUAL,Ct.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,Ct.ReadOnly);if(_.setDepthMode(x),f.transform.projection.name==="globe"){let E=f.transform.pointMerc;v.render(_.gl,f.transform.customLayerMatrix(),f.transform.getProjection(),f.transform.globeToMercatorMatrix(),r.W(f.transform.zoom),[E.x,E.y],f.transform.pixelsPerMeterRatio)}else v.render(_.gl,f.transform.customLayerMatrix());_.setDirty(),f.setBaseState(),_.bindFramebuffer.set(null)}}else r.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(f,o,l,p){if(f.renderPass==="opaque")return;let _=l.paint.get("model-opacity");if(_===0)return;let v=l.paint.get("model-cast-shadows");if(f.renderPass==="shadow"&&(!v||f.terrain&&_<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof r.Z))return;let x=f.shadowRenderer,E=l.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,E||(x.enabled=!1));let C=()=>{x&&(x.useNormalOffset=!0,E||(x.enabled=!0))},A=o.getSource();if(f.renderPass==="light-beam"&&A.type!=="batched-model")return;if(A.type==="vector"||A.type==="geojson")return function(H,Z,ne,te,re){let q=H.transform;if(q.projection.name!=="mercator")return void r.w(`Drawing 3D models for ${q.projection.name} projection is not yet implemented`);let X=q.getFreeCameraOptions().position;if(!H.modelManager)return;let ce=H.modelManager;ne.modelManager=ce;let ae=H.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let pe=ne._unevaluatedLayout._values["model-id"],Ee=Yt({},ne.layout.get("model-id").parameters);for(let fe of te){let be=Z.getTile(fe).getBucket(ne);if(!be||be.projection.name!==q.projection.name)continue;let De=be.getModelUris();De&&!be.modelsRequested&&(ce.addModelsFromBucket(De,re),be.modelsRequested=!0);let he=Kd(fe,q);Ee.zoom=he;let ye=pe.possiblyEvaluate(Ee);if(eu(H,be,fe),fo.shadowUniformsInitialized=!1,fo.useSingleShadowCascade=!!ae&&ae.getMaxCascadeForTile(fe.toUnwrapped())===0,H.renderPass==="shadow"&&ae){if(H.currentShadowCascade===1&&be.isInsideFirstShadowMapFrustum)continue;let we=q.calculatePosMatrix(fe.toUnwrapped(),q.worldSize);if(fo.tileMatrix.set(we),fo.shadowTileMatrix=Float32Array.from(ae.calculateShadowPassMatrixFromMatrix(we)),fo.aabb.min.fill(0),fo.aabb.max[0]=fo.aabb.max[1]=r.Y,fo.aabb.max[2]=0,tu(be,fo,H,ne.scope))continue}let Ve=1<<fe.canonical.z,ge=[((X.x-fe.wrap)*Ve-fe.canonical.x)*r.Y,(X.y*Ve-fe.canonical.y)*r.Y,X.z*Ve*r.Y];for(let we in be.instancesPerModel){let Te=be.instancesPerModel[we];Te.features.length>0&&(we=ye.evaluate(Te.features[0].feature,{}));let ie=ce.getModel(we,re);if(ie&&ie.uploaded)for(let Re of ie.nodes)Jd(H,ne,Re,Te,ge,fe,fo)}}}(f,o,l,p,A.type==="vector"?l.scope:""),void C();if(!A.loaded())return;if(A.type==="batched-model")return function(H,Z,ne,te){ne.resetLayerRenderingStats(H);let re=H.context,q=H.transform,X=H.style.fog,ce=H.shadowRenderer;if(q.projection.name!=="mercator")return void r.w(`Drawing 3D landmark models for ${q.projection.name} projection is not yet implemented`);let ae=H.transform.getFreeCameraOptions().position,pe=r.Q.scale([],[ae.x,ae.y,ae.z],H.transform.worldSize);r.Q.negate(pe,pe);let Ee=r.a9.identity([]),fe=r.cZ(q.center.lat,q.zoom),be=r.a9.fromScaling([],[1,1,1/fe]);r.a9.translate(Ee,Ee,pe);let De=ne.paint.get("model-opacity"),he=new Ct(re.gl.LEQUAL,Ct.ReadWrite,H.depthRangeFor3D),ye=new Ct(re.gl.LEQUAL,Ct.ReadOnly,H.depthRangeFor3D),Ve=new r.bV([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ge=H.renderPass==="shadow",we=ge&&ce?ce.getCurrentCascadeFrustum():q.getFrustum(q.scaleZoom(q.worldSize)),Te=ne.getLayerRenderingStats(),ie=function(Re,ot){for(let pt of te){let wt=Z.getTile(pt).getBucket(ne);if(!wt||!wt.uploaded)continue;let yt=!1;ce&&(yt=ce.getMaxCascadeForTile(pt.toUnwrapped())===0);let It=q.calculatePosMatrix(pt.toUnwrapped(),q.worldSize),fn=wt.modelTraits;for(let $t of wt.getNodesInfo()){if($t.hiddenByReplacement||!$t.node.meshes)continue;let yn=$t.evaluatedScale,pn=$t.node,mi=0;if(H.terrain&&pn.elevation&&(mi=pn.elevation*H.terrain.exaggeration()),yn[0]<=1&&yn[1]<=1&&yn[2]<=1&&(()=>{let cn=$t.getLocalBounds();return Ve.min=[...cn.min],Ve.max=[...cn.max],Ve.min[2]+=mi,Ve.max[2]+=mi,r.Q.transformMat4(Ve.min,Ve.min,It),r.Q.transformMat4(Ve.max,Ve.max,It),Ve})().intersects(we)===0)continue;let Vn=[...It];r.a9.translate(Vn,Vn,[(pn.anchor?pn.anchor[0]:0)*(yn[0]-1),(pn.anchor?pn.anchor[1]:0)*(yn[1]-1),mi]),r.Q.exactEquals(yn,r.c$)||r.a9.scale(Vn,Vn,yn);let Yi=r.a9.multiply([],Vn,pn.matrix),Bi=r.a9.multiply([],be,Vn);r.a9.multiply(Bi,Ee,Bi);let ni=r.a9.invert([],Bi);r.a9.transpose(ni,ni),r.a9.scale(ni,ni,eh),Bi=r.a9.multiply(Bi,Bi,pn.matrix);let Gn=H.renderPass==="light-beam",nn=r.a9.multiply([],q.expandedFarZProjMatrix,Yi),on=r.a9.multiply([],q.expandedFarZProjMatrix,Vn),hi=fn&r.d1.HasMapboxMeshFeatures,ii=hi?0:$t.evaluatedRMEA[0][2];for(let cn=0;cn<pn.meshes.length;++cn){let Qt=pn.meshes[cn],Gr=cn===pn.lightMeshIndex,Dr=nn;if(Gr){if(!Gn&&!H.terrain&&H.shadowRenderer){H.currentLayer<H.firstLightBeamLayer&&(H.firstLightBeamLayer=H.currentLayer);continue}Dr=on}else if(Gn)continue;let lr={defines:[]},Ir=[];if(aa(lr.defines,Ir,Qt,H),hi||lr.defines.push("DIFFUSE_SHADED"),yt&&lr.defines.push("SHADOWS_SINGLE_CASCADE"),Te&&(ge?Te.numRenderedVerticesInShadowPass+=Qt.vertexArray.length:Te.numRenderedVerticesInTransparentPass+=Qt.vertexArray.length),ge){Jc(Qt,Yi,H,ne);continue}let $r=null;if(X){let Wo=hp(Yi,H.transform);if($r=new Float32Array(Wo),q.projection.name!=="globe"){let as=Qt.aabb.min,ls=Qt.aabb.max,[da,Do]=X.getOpacityForBounds(Wo,as[0],as[1],ls[0],ls[1]);lr.overrideFog=da>=kn||Do>=kn}}let kr=Qt.material,cr;kr.occlusionTexture&&kr.occlusionTexture.offsetScale&&(cr=kr.occlusionTexture.offsetScale,lr.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!ge&&ce&&(ce.useNormalOffset=!!Qt.normalBuffer);let yr=H.getOrCreateProgram("model",lr);!ge&&ce&&ce.setupShadowsFromMatrix(Vn,yr,ce.useNormalOffset),H.uploadCommonUniforms(re,yr,null,$r);let vr=kr.pbrMetallicRoughness;vr.metallicFactor=.9,vr.roughnessFactor=.5;let ss=$d(new Float32Array(Dr),new Float32Array(Bi),new Float32Array(ni),new Float32Array(pn.matrix),H,De,vr.baseColorFactor,kr.emissiveFactor,vr.metallicFactor,vr.roughnessFactor,kr,ii,ne,[0,0,0],cr);yr.draw(H,re.gl.TRIANGLES,ot&&!Gr?he:ye,qt.disabled,Re?Gr||De<1||$t.hasTranslucentParts?an.alphaBlended:an.unblended:an.disabled,Vt.backCCW,ss,ne.id,Qt.vertexBuffer,Qt.indexBuffer,Qt.segments,ne.paint,H.transform.zoom,void 0,Ir)}}}};(function(Re,ot,pt,wt){let yt=Re.terrain?Re.terrain.exaggeration():0,It=Re.transform.zoom;for(let fn of wt){let $t=ot.getTile(fn).getBucket(pt);$t&&(Re.conflationActive&&$t.updateReplacement(fn,Re.replacementSource),$t.evaluateScale(Re,pt),Re.terrain&&yt>0&&$t.elevationUpdate(Re.terrain,yt,fn,pt.source),$t.needsReEvaluation(Re,It,pt)&&$t.evaluate(pt))}})(H,Z,ne,te),De===1?ie(!0,!0):(ie(!1,!0),ie(!0,!1))}(f,o,l,p),void C();let R=A.getModels(),O=[],N=f.transform.getFreeCameraOptions().position,z=r.Q.scale([],[N.x,N.y,N.z],f.transform.worldSize);r.Q.negate(z,z);let U=[],j=[],G=0;for(let H of R){let Z=l.paint.get("model-rotation").constantOr(null),ne=l.paint.get("model-scale").constantOr(null),te=l.paint.get("model-translation").constantOr(null);H.computeModelMatrix(f,Z,ne,te,!0,!0,!1);let re=r.a9.identity([]),q=r.cZ(H.position.lat,f.transform.zoom),X=r.a9.fromScaling([],[1,1,1/q]);r.a9.translate(re,re,z),O.push({zScaleMatrix:X,negCameraPosMatrix:re});for(let ce of H.nodes)Kc(f.transform,ce,H.matrix,f.transform.expandedFarZProjMatrix,G,U,j);G++}if(U.sort((H,Z)=>Z.depth-H.depth),f.renderPass!=="shadow"){if(_===1)for(let H of j)la(H,f,l,O[H.modelIndex],qt.disabled,f.colorModeForRenderPass());else{for(let H of j)la(H,f,l,O[H.modelIndex],qt.disabled,an.disabled);for(let H of j)la(H,f,l,O[H.modelIndex],f.stencilModeFor3D(),f.colorModeForRenderPass());f.resetStencilClippingMasks()}for(let H of U)la(H,f,l,O[H.modelIndex],qt.disabled,f.colorModeForRenderPass());C()}else{for(let H of j)Jc(H.mesh,H.nodeModelMatrix,f,l);for(let H of U)Jc(H.mesh,H.nodeModelMatrix,f,l);C()}}},Ga={model:function(f,o,l){let p=o.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,p.type==="vector"?f.scope:""));if(p.type==="batched-model")return;let _=p.getModels();for(let v of _)v.upload(l.context)},raster:function(f,o,l){let p=o.getSource();if(!(p instanceof Je&&p.loaded()))return;let _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;let v=f.paint.get("raster-array-band")||p.getInitialBand(_);if(v==null)return;let x=o.getIds().map(E=>o.getTileByID(E));for(let E of x)E.updateNeeded(_,v)&&p.prepareTile(E,_,v)},"raster-particle":function(f,o,l){let p=o.getSource();if(!(p instanceof Je&&p.loaded()))return;let _=f.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!_)return;let v=f.paint.get("raster-particle-array-band")||p.getInitialBand(_);if(v==null)return;let x=o.getIds().map(E=>o.getTileByID(E));for(let E of x)E.updateNeeded(_,v)&&p.prepareTile(E,_,v)}};class Yg{constructor(o,l,p,_){this.context=new ts(o,l),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=new Date().getTime(),this._averageFPS=0,this._fpsHistory=[],this._debugParams={showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};let v=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(let x of v)this._debugParams.enabledLayers[x]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(let x of v)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],x);this.setup(),this.numSublayers=Vo.maxUnderzooming+Vo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.d3,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Og(this),this._wireframeDebugCache=new Qg,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(o,l){let p=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ho(this,o));let _=this._terrain;this.transform.elevation=p?_:null,_.update(o,this.transform,l),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(o){let l=o.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);let v=p+.78*(_-p);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,l){if(this.width=o*r.f.devicePixelRatio,this.height=l*r.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let p of this.style.order)this.style._mergedLayers[p].resize()}setup(){let o=this.context,l=new r.aQ;l.emplaceBack(0,0),l.emplaceBack(r.Y,0),l.emplaceBack(0,r.Y),l.emplaceBack(r.Y,r.Y),this.tileExtentBuffer=o.createVertexBuffer(l,r.aS.members),this.tileExtentSegments=r.aE.simpleSegment(0,0,4,2);let p=new r.aQ;p.emplaceBack(0,0),p.emplaceBack(r.Y,0),p.emplaceBack(0,r.Y),p.emplaceBack(r.Y,r.Y),this.debugBuffer=o.createVertexBuffer(p,r.aS.members),this.debugSegments=r.aE.simpleSegment(0,0,4,5);let _=new r.aQ;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,r.aS.members),this.viewportSegments=r.aE.simpleSegment(0,0,4,2);let v=new r.ay;v.emplaceBack(0,0,0,0),v.emplaceBack(r.Y,0,r.Y,0),v.emplaceBack(0,r.Y,0,r.Y),v.emplaceBack(r.Y,r.Y,r.Y,r.Y),this.mercatorBoundsBuffer=o.createVertexBuffer(v,r.aU.members),this.mercatorBoundsSegments=r.aE.simpleSegment(0,0,4,2);let x=new r.az;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(x);let E=new r.aR;for(let A of[0,1,3,2,0])E.emplaceBack(A);this.debugIndexBuffer=o.createIndexBuffer(E),this.emptyTexture=new r.T(o,new r.h({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=r.a9.create();let C=this.context.gl;this.stencilClearMode=new qt({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,Ct.disabled,this.stencilClearMode,an.disabled,Vt.disabled,$c(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,l,p){if(!l||this.currentStencilSource===l.id||!o.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let E=!1;for(let C of p)if(this._tileClippingMaskIDs[C.key]===void 0){E=!0;break}if(!E)return}this.currentStencilSource=l.id;let _=this.context,v=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(an.disabled),_.setDepthMode(Ct.disabled);let x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let E of p){let C=l.getTile(E),A=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,{tileBoundsBuffer:R,tileBoundsIndexBuffer:O,tileBoundsSegments:N}=this.getTileBoundsBuffers(C);x.draw(this,v.TRIANGLES,Ct.disabled,new qt({func:v.ALWAYS,mask:0},A,255,v.KEEP,v.KEEP,v.REPLACE),an.disabled,Vt.disabled,$c(E.projMatrix),"$clipping",R,O,N)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,l=this.context.gl;return new qt({func:l.NOTEQUAL,mask:255},o,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let l=this.context.gl;return new qt({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(o){let l=this.context.gl,p=o.sort((x,E)=>E.overscaledZ-x.overscaledZ),_=p[p.length-1].overscaledZ,v=p[0].overscaledZ-_+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();let x={};for(let E=0;E<v;E++)x[E+_]=new qt({func:l.GEQUAL,mask:255},E+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=v,[x,p]}return[{[_]:qt.disabled},p]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new an([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new r.aA(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?an.unblended:an.alphaBlended}colorModeForDrapableLayerRenderPass(o){let l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new an([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new r.aA(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,l,p,_=!1){if(!this.opaquePassEnabledForLayer()&&!_)return Ct.disabled;let v=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new Ct(p||this.context.gl.LEQUAL,l,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}updateAverageFPS(){let o=new Date().getTime(),l=o-this._timeStamp;this._timeStamp=o,this._fpsHistory.push(l===0?0:1e3/l),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((p,_)=>p+_/this._fpsHistory.length,0))}render(o,l){this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=l;let p=this.style._mergedLayers,_=this.style.order.filter(q=>{let X=p[q];return!(X.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[X.type]}),v=_.map(q=>p[q]),x=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.f.now()),this.imageManager.beginFrame();let E=0,C=!1;for(let q in x){let X=x[q];X.used&&(X.prepare(this.context),X.getSource().usedInConflation&&++E)}for(let q of v)q.isHidden(this.transform.zoom)||this.prepareLayer(q);let A={},R={},O={},N={},z={};for(let q in x){let X=x[q];A[q]=X.getVisibleCoordinates(),R[q]=A[q].slice().reverse(),O[q]=X.getVisibleCoordinates(!0).reverse(),N[q]=X.getShadowCasterCoordinates(),z[q]=X.sortCoordinatesByDistance(A[q])}let U=q=>{let X=this.style.getLayerSourceCache(q);return X&&X.used?X.getSource():null};if(E){let q=[];for(let X of v)this.layerUsedInConflation(X,U(X))&&q.push(X);if(q&&q.length>1){let X=[];for(let ce of q){let ae=this.style.getLayerSourceCache(ce);ae&&ae.used&&ae.getSource().usedInConflation&&X.push({layer:ce.fqid,cache:ae})}this.replacementSource.setSources(X),C=!0}}C||this.replacementSource.clear(),this.conflationActive=C,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let q of v){let X=q.cutoffRange();if(this.longestCutoffRange=Math.max(X,this.longestCutoffRange),X>0){let ce=U(q);ce&&(this.minCutoffZoom=Math.max(ce.minzoom,this.minCutoffZoom)),q.minzoom&&(this.minCutoffZoom=Math.max(q.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let q=0;q<v.length;q++)if(v[q].is3D()){this.opaquePassCutoff=q;break}let j=this.style&&this.style.fog;j?(this._fogVisible=j.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=j.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(O),this.opaquePassCutoff=0);let G=this._shadowRenderer;if(G){G.updateShadowParameters(this.transform,this.style.directionalLight);for(let q in x)for(let X of A[q]){let ce={min:0,max:0};this.terrain&&(ce=this.terrain.getMinMaxForTile(X)||ce),G.addShadowReceiver(X.toUnwrapped(),ce.min,ce.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.d4(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new dp(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.d5(this.context.gl))return;this.renderPass="offscreen";for(let q of v){let X=o.getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;let ce=X?R[X.id]:void 0;(q.type==="custom"||q.type==="raster"||q.type==="raster-particle"||q.isSky()||ce&&ce.length)&&this.renderLayer(this,X,q,ce)}this.depthRangeFor3D=[0,1-(v.length+2)*this.numSublayers*this.depthEpsilon];let H=this.terrain;H&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&H.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,N)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let Z=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ne=(()=>{if(l.showOverdrawInspector)return r.aA.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Z){let q=this.style.fog.properties.get("color").toArray01();return new r.aA(...q)}if(this.style.fog&&this.transform.projection.supportsFog&&Z){let q=this.style.fog.properties.get("space-color").toArray01();return new r.aA(...q)}return r.aA.transparent})();if(this.context.clear({color:ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Z&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){let q=v[this.currentLayer],X=o.getLayerSourceCache(q);if(q.isSky())continue;let ce=X?(q.is3D()?z:R)[X.id]:void 0;this._renderTileClippingMasks(q,X,ce),this.renderLayer(this,X,q,ce)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Z&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.W(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){let q=v[this.currentLayer],X=o.getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,X,q,X?R[X.id]:void 0)}function te(q,X){let ce;return X&&(ce=(q.type==="symbol"?O:q.is3D()?z:R)[X.id]),ce}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<_.length;){let q=v[this.currentLayer];if(q.type==="raster"){let X=o.getLayerSourceCache(q);this.renderLayer(this,X,q,te(q,X))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let re=0;for(G&&(re=G.getShadowCastingLayerCount());this.currentLayer<_.length;){let q=v[this.currentLayer],X=o.getLayerSourceCache(q);if(q.isSky())++this.currentLayer;else if(H&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=H.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(q,X,X?A[X.id]:void 0),this.renderLayer(this,X,q,te(q,X)),!H&&G&&re>0&&q.hasShadowPass()&&--re==0&&(G.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ce=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ce;this.currentLayer++){let ae=v[this.currentLayer];if(!ae.hasLightBeamPass())continue;let pe=o.getLayerSourceCache(ae);this.renderLayer(this,pe,ae,pe?R[pe.id]:void 0)}this.currentLayer=ce,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;v.forEach(X=>{let ce=o.getLayerSourceCache(X);ce&&!X.isHidden(this.transform.zoom)&&ce.getVisibleCoordinates().length&&(!q||q.getSource().maxzoom<ce.getSource().maxzoom)&&(q=ce)}),q&&this.options.showTileBoundaries&&th.debug(this,q,q.getVisibleCoordinates(),r.aA.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&th.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.aA(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(q){let X=q.transform.padding;$g(q,q.transform.height-(X.top||0),3,ap),$g(q,X.bottom||0,3,Sb),Hg(q,X.left||0,3,Ug),Hg(q,q.transform.width-(X.right||0),3,Gg);let ce=q.transform.centerPoint;(function(ae,pe,Ee,fe){Yd(ae,pe-1,Ee-10,2,20,fe),Yd(ae,pe-10,Ee-1,20,2,fe)})(q,ce.x,q.transform.height-ce.y,lp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),C||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);let{unsupportedLayers:l}=this.transform.projection,p=!l||!l.includes(o.type);if(Ga[o.type]&&(p||this.terrain&&o.type==="custom")){let _=this.style.getLayerSourceCache(o);Ga[o.type](o,_,this)}this.gpuTimingEnd()}renderLayer(o,l,p,_){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(p.type)||o.terrain&&p.type==="custom")&&th[p.type](o,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let l=this.context.extTimerQuery,p=this.context.gl,_=this.gpuTimers[o.id];_||(_=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:p.createQuery()}),_.calls++,p.beginQuery(l.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,l=this.context.gl,p=l.createQuery();this.deferredRenderGpuTimeQueries.push(p),l.beginQuery(o.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let l={};for(let p in o){let _=o[p],v=this.context.extTimerQuery,x=v.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(_.query),l[p]=x}return l}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let l=this.context.extTimerQuery,p=this.context.gl,_=0;for(let v of o)_+=l.getQueryParameter(v,p.QUERY_RESULT)/1e6,l.deleteQueryEXT(v);return _}translatePosMatrix(o,l,p,_,v){if(!p[0]&&!p[1])return o;let x=v?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(x){let A=Math.sin(x),R=Math.cos(x);p=[p[0]*R-p[1]*A,p[0]*A+p[1]*R]}let E=[v?p[0]:r.a6(l,p[0],this.transform.zoom),v?p[1]:r.a6(l,p[1],this.transform.zoom),0],C=new Float32Array(16);return r.a9.translate(C,o,E),C}saveTileTexture(o){let l=o.size[0],p=this._tileTextures[l];p?p.push(o):this._tileTextures[l]=[o]}getTileTexture(o){let l=this._tileTextures[o];return l&&l.length>0?l.pop():null}isPatternMissing(o,l){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString(),l)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,l,p){let _=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,v=this.terrain&&this.terrain.exaggeration()===0,x=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT"),v&&x.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||_||l!==void 0&&!l||x.push("FOG","FOG_DITHERING"),_&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(o,l){this.cache=this.cache||{};let p=l&&l.defines||[],_=l&&l.config,v=this.currentGlobalDefines(o,l&&l.overrideFog,l&&l.overrideRtt).concat(p),x=To.cacheKey($o[o],o,v,_);return this.cache[x]||(this.cache[x]=new To(this.context,o,$o[o],_,np[o],v)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,l){if(this.style.enable3dLights()){let p=this.style.directionalLight,_=this.style.ambientLight;if(p&&_){let v=((x,E)=>{let C=x.properties.get("direction"),A=x.properties.get("color").toArray01(),R=x.properties.get("intensity"),O=E.properties.get("color").toArray01(),N=E.properties.get("intensity"),z=[C.x,C.y,C.z],U=r.cs(O,N),j=r.cs(A,R);return{u_lighting_ambient_color:U,u_lighting_directional_dir:z,u_lighting_directional_color:j,u_ground_radiance:Ng(z,j,U)}})(p,_);l.setLightsUniformValues(o,v)}}}uploadCommonUniforms(o,l,p,_,v){if(this.uploadCommonLightUniforms(o,l),this.terrain&&this.terrain.renderingToTexture)return;let x=this.style.fog;if(x){let E=x.getOpacity(this.transform.pitch),C=((A,R,O,N,z,U,j,G,H,Z,ne,te)=>{let re=A.transform,q=R.properties.get("color").toArray01();q[3]=N;let X=A.frameCounter/1e3%1,[ce,ae]=R.properties.get("vertical-range");return{u_fog_matrix:O?re.calculateFogTileMatrix(O):te||A.identityMat,u_fog_range:R.getFovAdjustedRange(re._fov),u_fog_color:q,u_fog_horizon_blend:R.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,ae),ae],u_fog_temporal_offset:X,u_frustum_tl:z,u_frustum_tr:U,u_frustum_br:j,u_frustum_bl:G,u_globe_pos:H,u_globe_radius:Z,u_viewport:ne,u_globe_transition:r.W(re.zoom),u_is_globe:+(re.projection.name==="globe")}})(this,x,p,E,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.f.devicePixelRatio,this.transform.height*r.f.devicePixelRatio],_);l.setFogUniformValues(o,C)}v&&l.setCutoffUniformValues(o,v.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,l=o.createTexture();return o.bindTexture(o.TEXTURE_2D,l),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(let _ of p)l[_.key]=o[_.key]||new Bo(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(o,l){return!(!o.is3D()||o.minzoom&&o.minzoom>this.transform.zoom||o.sourceLayer!=="building"&&(!l||l.type!=="batched-model"))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[o.key];return l||(this._cachedTileFogOpacities[o.key]=l=this.style.fog.getOpacityForTile(o)),l[0]>=kn||l[1]>=kn}}function Xg(f,o){let l=!1,p=null,_=()=>{p=null,l&&(f(),p=setTimeout(_,o),l=!1)};return()=>(l=!0,p||_(),p)}class Ab{constructor(o){this._hashName=o&&encodeURIComponent(o),r.a$(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xg(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let l=Kg(o);if(this._hashName){let p=this._hashName,_=!1,v=location.hash.slice(1).split("&").map(x=>{let E=x.split("=")[0];return E===p?(_=!0,`${E}=${l}`):x}).filter(x=>x);return _||v.push(`${p}=${l}`),`#${v.join("&")}`}return`#${l}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let l;return o.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){let p=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(l[3]||0):o.getBearing();return o.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Kg(f,o){let l=f.getCenter(),p=Math.round(100*f.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,_),x=Math.round(l.lng*v)/v,E=Math.round(l.lat*v)/v,C=f.getBearing(),A=f.getPitch(),R=o?`/${x}/${E}/${p}`:`${p}/${E}/${x}`;return(C||A)&&(R+="/"+Math.round(10*C)/10),A&&(R+=`/${Math.round(A)}`),R}let Al={linearity:.3,easing:r.d6(0,0,.3,1)},fp=r.e({deceleration:2500,maxSpeed:1400},Al),pp=r.e({deceleration:20,maxSpeed:1400},Al),mp=r.e({deceleration:1e3,maxSpeed:360},Al),Jg=r.e({deceleration:1e3,maxSpeed:90},Al);class e_{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.f.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,l=r.f.now();for(;o.length>0&&l-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let l={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:v}of this._inertiaBuffer)l.zoom+=v.zoomDelta||0,l.bearing+=v.bearingDelta||0,l.pitch+=v.pitchDelta||0,v.panDelta&&l.pan._add(v.panDelta),v.around&&(l.around=v.around),v.pinchAround&&(l.pinchAround=v.pinchAround);let p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){let v=ca(l.pan.mag(),p,r.e({},fp,o||{}));_.offset=l.pan.mult(v.amount/l.pan.mag()),_.center=this._map.transform.center,nh(_,v)}if(l.zoom){let v=ca(l.zoom,p,pp);_.zoom=this._map.transform.zoom+v.amount,nh(_,v)}if(l.bearing){let v=ca(l.bearing,p,mp);_.bearing=this._map.transform.bearing+r.ad(v.amount,-179,179),nh(_,v)}if(l.pitch){let v=ca(l.pitch,p,Jg);_.pitch=this._map.transform.pitch+v.amount,nh(_,v)}if(_.zoom||_.bearing){let v=l.pinchAround===void 0?l.around:l.pinchAround;_.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function nh(f,o){(!f.duration||f.duration<o.duration)&&(f.duration=o.duration,f.easing=o.easing)}function ca(f,o,l){let{maxSpeed:p,linearity:_,deceleration:v}=l,x=r.ad(f*_/(o/1e3),-p,p),E=Math.abs(x)/(v*_);return{easing:l.easing,duration:1e3*E,amount:x*(E/2)}}class Tr extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,p,_={}){let v=gn(l.getCanvasContainer(),p),x=l.unproject(v);super(o,r.e({point:v,lngLat:x,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class nu extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,p){let _=o==="touchend"?p.changedTouches:p.touches,v=Xt(l.getCanvasContainer(),_),x=v.map(C=>l.unproject(C)),E=v.reduce((C,A,R,O)=>C.add(A.div(O.length)),new r.P(0,0));super(o,{points:v,point:E,lngLats:x,lngLat:l.unproject(E),originalEvent:p}),this._defaultPrevented=!1}}class po extends r.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,l,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class gp{constructor(o,l){this._map=o,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new po(o.type,this._map,o))}mousedown(o,l){return this._mousedownPos=l,this._firePreventable(new Tr(o.type,this._map,o))}mouseup(o){this._map.fire(new Tr(o.type,this._map,o))}preclick(o){let l=r.e({},o);l.type="preclick",this._map.fire(new Tr(l.type,this._map,l))}click(o,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Tr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Tr(o.type,this._map,o))}mouseover(o){this._map.fire(new Tr(o.type,this._map,o))}mouseout(o){this._map.fire(new Tr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new nu(o.type,this._map,o))}touchmove(o){this._map.fire(new nu(o.type,this._map,o))}touchend(o){this._map.fire(new nu(o.type,this._map,o))}touchcancel(o){this._map.fire(new nu(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ih{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Tr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Tr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rh{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,l){this.isEnabled()&&o.shiftKey&&o.button===0&&(Qe(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(o,l){if(!this._active)return;let p=l,_=this._startPos,v=this._lastPos;if(!_||!v||v.equals(p)||!this._box&&p.dist(_)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Q("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let x=Math.min(_.x,p.x),E=Math.max(_.x,p.x),C=Math.min(_.y,p.y),A=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${C}px)`,this._box.style.width=E-x+"px",this._box.style.height=A-C+"px")})}mouseupWindow(o,l){if(!this._active)return;let p=this._startPos,_=l;if(p&&o.button===0){if(this.reset(),Nt(),p.x!==_.x||p.y!==_.y)return this._map.fire(new r.b("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),dt(),delete this._startPos,delete this._lastPos}_fireEvent(o,l){return this._map.fire(new r.b(o,{originalEvent:l}))}}function iu(f,o){let l={};for(let p=0;p<f.length;p++)l[f[p].identifier]=o[p];return l}class _p{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){let v=new r.P(0,0);for(let x of _)v._add(x);return v.div(_.length)}(l),this.touches=iu(p,l)))}touchmove(o,l,p){if(this.aborted||!this.centroid)return;let _=iu(p,l);for(let v in this.touches){let x=_[v];(!x||x.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,l,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){let _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Pl{constructor(o){this.singleTap=new _p(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,l,p){this.singleTap.touchstart(o,l,p)}touchmove(o,l,p){this.singleTap.touchmove(o,l,p)}touchend(o,l,p){let _=this.singleTap.touchend(o,l,p);if(_){let v=o.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(_)<30;if(v&&x||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class yp{constructor(){this._zoomIn=new Pl({numTouches:1,numTaps:2}),this._zoomOut=new Pl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,l,p){this._zoomIn.touchstart(o,l,p),this._zoomOut.touchstart(o,l,p)}touchmove(o,l,p){this._zoomIn.touchmove(o,l,p),this._zoomOut.touchmove(o,l,p)}touchend(o,l,p){let _=this._zoomIn.touchend(o,l,p),v=this._zoomOut.touchend(o,l,p);return _?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(_)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let vp={0:1,2:2};class Rl{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,l){return!1}_move(o,l){return{}}mousedown(o,l){if(this._lastPoint)return;let p=Ni(o);this._correctButton(o,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(o,l){let p=this._lastPoint;if(p){if(o.preventDefault(),this._eventButton!=null&&function(_,v){let x=vp[v];return _.buttons===void 0||(_.buttons&x)!==x}(o,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}}mouseupWindow(o){this._lastPoint&&Ni(o)===this._eventButton&&(this._moved&&Nt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class t_ extends Rl{mousedown(o,l){super.mousedown(o,l),this._lastPoint&&(this._active=!0)}_correctButton(o,l){return l===0&&!o.ctrlKey}_move(o,l){return{around:l,panDelta:l.sub(o)}}}class bp extends Rl{_correctButton(o,l){return l===0&&o.ctrlKey||l===2}_move(o,l){let p=.8*(l.x-o.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(o){o.preventDefault()}}class $a extends Rl{_correctButton(o,l){return l===0&&o.ctrlKey||l===2}_move(o,l){let p=-.5*(l.y-o.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(o){o.preventDefault()}}class Pb{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),r.a$(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(o,l,p){return this._calculateTransform(o,l,p)}touchmove(o,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!r.d7())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,l,p)}}touchend(o,l,p){this._calculateTransform(o,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,l,p){p.length>0&&(this._active=!0);let _=iu(p,l),v=new r.P(0,0),x=new r.P(0,0),E=0;for(let A in _){let R=_[A],O=this._touches[A];O&&(v._add(R),x._add(R.sub(O)),E++,_[A]=R)}if(this._touches=_,E<this._minTouches||!x.mag())return;let C=x.div(E);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(E),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class xp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,l,p){return{}}touchstart(o,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(o,l,p){let _=this._firstTwoTouches;if(!_)return;o.preventDefault();let[v,x]=_,E=oh(p,l,v),C=oh(p,l,x);if(!E||!C)return;let A=this._aroundCenter?null:E.add(C).div(2);return this._move([E,C],A,o)}touchend(o,l,p){if(!this._firstTwoTouches)return;let[_,v]=this._firstTwoTouches,x=oh(p,l,_),E=oh(p,l,v);x&&E||(this._active&&Nt(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function oh(f,o,l){for(let p=0;p<f.length;p++)if(f[p].identifier===l)return o[p]}function n_(f,o){return Math.log(f/o)/Math.LN2}class Rb extends xp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,l){let p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(n_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:n_(this._distance,p),pinchAround:l}}}function i_(f,o){return 180*f.angleWith(o)/Math.PI}class wp extends xp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,l){let p=this._vector;if(this._vector=o[0].sub(o[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:i_(this._vector,p),pinchAround:l}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;let _=i_(o,p);return Math.abs(_)<l}}function ru(f){return Math.abs(f.y)>Math.abs(f.x)}class r_ extends xp{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,ru(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,l,p){let _=this._lastPoints;if(!_)return;let v=o[0].sub(_[0]),x=o[1].sub(_[1]);return this._map._cooperativeGestures&&!r.d7()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(v,x,p.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(v.y+x.y)/2*-.5})}gestureBeginsVertically(o,l,p){if(this._valid!==void 0)return this._valid;let _=o.mag()>=2,v=l.mag()>=2;if(!_&&!v)return;if(!_||!v)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;let x=o.y>0==l.y>0;return ru(o)&&ru(l)&&x}}let kl={panStep:100,bearingStep:15,pitchStep:10};class o_{constructor(){let o=kl;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let l=0,p=0,_=0,v=0,x=0;switch(o.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?_=1:(o.preventDefault(),x=-1);break;case 40:o.shiftKey?_=-1:(o.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:E=>{let C=E.getZoom();E.easeTo({duration:300,easeId:"keyboardHandler",easing:s_,zoom:l?Math.round(C)+l*(o.shiftKey?2:1):C,bearing:E.getBearing()+p*this._bearingStep,pitch:E.getPitch()+_*this._pitchStep,offset:[-v*this._panStep,-x*this._panStep],center:E.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function s_(f){return f*(2-f)}let Ep=4.000244140625,Tp=1/450;class Ha{constructor(o,l){this._map=o,this._el=o.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Tp,r.a$(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||r.d7()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,p=r.f.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,l!==0&&l%Ep==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),o.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=o,this._delta-=l,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let l=gn(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let l=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let A=this._type==="wheel"&&Math.abs(this._delta)>Ep?this._wheelZoomRate:this._defaultZoomRate,R=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&R!==0&&(R=1/R);let O=l(),N=Math.pow(2,O),z=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(z*R))),this._type==="wheel"&&(this._startZoom=O,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let p=typeof this._targetZoom=="number"?this._targetZoom:l(),_=this._startZoom,v=this._easing,x,E=!1;if(this._type==="wheel"&&_&&v){let A=Math.min((r.f.now()-this._lastWheelEventTime)/200,1),R=v(A);x=r.X(_,p,R),A<1?this._frameId||(this._frameId=!0):E=!0}else x=p,E=!0;this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=x-l();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!E,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let l=r.d8;if(this._prevEase){let p=this._prevEase,_=(r.f.now()-p.start)/p.duration,v=p.easing(_+.01)-p.easing(_),x=.27/Math.sqrt(v*v+1e-4)*.01,E=Math.sqrt(.0729-x*x);l=r.d6(x,E,.25,1)}return this._prevEase={start:r.f.now(),duration:o,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Q("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class a_{constructor(o,l){this._clickZoom=o,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qa{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,l){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(o.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class l_{constructor(){this._tap=new Pl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,l,p){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(o,l,p))}touchmove(o,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;let _=l[0],v=_.y-this._swipePoint.y;return this._swipePoint=_,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,l,p)}touchend(o,l,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(o,l,p)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sh{constructor(o,l,p){this._el=o,this._mousePan=l,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class c_{constructor(o,l,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class u_{constructor(o,l,p,_){this._el=o,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Ol=f=>f.zoom||f.drag||f.pitch||f.rotate;class Dp extends r.b{}class kb{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,l){let p=r.Q.sub([],l,o);this.radius=r.Q.length(p[2]<0?r.Q.div([],p,this.constants):[p[0],p[1],0])}projectRay(o){r.Q.div(o,o,this.constants),r.Q.normalize(o,o),r.Q.mul(o,o,this.constants);let l=r.Q.scale([],o,this.radius);if(l[2]>0){let p=r.Q.scale([],[0,0,1],r.Q.dot(l,[0,0,1])),_=r.Q.scale([],r.Q.normalize([],[l[0],l[1],0]),this.radius),v=r.Q.add([],l,r.Q.scale([],r.Q.sub([],r.Q.add([],_,p),l),2));l[0]=v[0],l[1]=v[1]}return l}}function ou(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class su{constructor(o,l){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new e_(o),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kb,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),r.a$(["handleEvent","handleWindowEvent"],this);let p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(let[_,v,x]of this._listeners){let E=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(v,E,x)}}destroy(){for(let[o,l,p]of this._listeners){let _=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(l,_,p)}}_addDefaultHandlers(o){let l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new gp(l,o));let _=l.boxZoom=new rh(l,o);this._add("boxZoom",_);let v=new yp,x=new qa;l.doubleClickZoom=new a_(x,v),this._add("tapZoom",v),this._add("clickZoom",x);let E=new l_;this._add("tapDragZoom",E);let C=l.touchPitch=new r_(l);this._add("touchPitch",C);let A=new bp(o),R=new $a(o);l.dragRotate=new c_(o,A,R),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",R,["mouseRotate"]);let O=new t_(o),N=new Pb(l,o);l.dragPan=new sh(p,O,N),this._add("mousePan",O),this._add("touchPan",N,["touchZoom","touchRotate"]);let z=new wp,U=new Rb;l.touchZoomRotate=new u_(p,U,z,E),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ih(l));let j=l.scrollZoom=new Ha(l,this);this._add("scrollZoom",j,["mousePan"]);let G=l.keyboard=new o_;this._add("keyboard",G);for(let H of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[H]&&l[H].enable(o[H])}_add(o,l,p){this._handlers.push({handlerName:o,handler:l,allowed:p}),this._handlersById[o]=l}stop(o){if(!this._updatingCamera){for(let{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ol(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,l,p){for(let _ in o)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let l=[];for(let p of o)this._el.contains(p.target)&&l.push(p);return l}handleEvent(o,l){this._updatingCamera=!0;let p=o.type==="renderFrame",_=p?void 0:o,v={needsRenderFrame:!1},x={},E={},C=o.touches?this._getMapTouches(o.touches):void 0,A=C?Xt(this._el,C):p?void 0:gn(this._el,o);for(let{handlerName:N,handler:z,allowed:U}of this._handlers){if(!z.isEnabled())continue;let j;this._blockedByActive(E,U,N)?z.reset():z[l||o.type]&&(j=z[l||o.type](o,A,C),this.mergeHandlerResult(v,x,j,N,_),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||z.isActive())&&(E[N]=z)}let R={};for(let N in this._previousActiveHandlers)E[N]||(R[N]=_);this._previousActiveHandlers=E,(Object.keys(R).length||ou(v))&&(this._changes.push([v,x,R]),this._triggerRenderFrame()),(Object.keys(E).length||ou(v))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:O}=v;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))}mergeHandlerResult(o,l,p,_,v){if(!p)return;r.e(o,p);let x={handlerName:_,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(l.zoom=x),p.panDelta!==void 0&&(l.drag=x),p.pitchDelta!==void 0&&(l.pitch=x),p.bearingDelta!==void 0&&(l.rotate=x)}_applyChanges(){let o={},l={},p={};for(let[_,v,x]of this._changes)_.panDelta&&(o.panDelta=(o.panDelta||new r.P(0,0))._add(_.panDelta)),_.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(o.around=_.around),_.aroundCoord!==void 0&&(o.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(o.pinchAround=_.pinchAround),_.noInertia&&(o.noInertia=_.noInertia),r.e(l,v),r.e(p,x);this._updateMapTransform(o,l,p),this._changes=[]}_updateMapTransform(o,l,p){let _=this._map,v=_.transform,x=Z=>[Z.x,Z.y,Z.z];if((Z=>{let ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!ou(o)){let Z=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),Z!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&_._stop(!0),!ou(o))return void this._fireEvents(l,p,!0);let{panDelta:E,zoomDelta:C,bearingDelta:A,pitchDelta:R,around:O,aroundCoord:N,pinchAround:z}=o;v._isCameraConstrained&&(C>0&&(C=0),v._isCameraConstrained=!1),z!==void 0&&(O=z),(C||(Z=>l[Z]&&!this._eventsInProgress[Z])("drag"))&&O&&(this._dragOrigin=x(v.pointCoordinate3D(O)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",_._stop(!0),O=O||_.transform.centerPoint,A&&(v.bearing+=A),R&&(v.pitch+=R),v._updateCameraState();let U=[0,0,0];if(E)if(v.projection.name==="mercator"){let Z=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(O).dir),ne=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(O.sub(E)).dir);U[0]=ne[0]-Z[0],U[1]=ne[1]-Z[1]}else{let Z=v.pointCoordinate(O);if(v.projection.name==="globe"){E=E.rotate(-v.angle);let ne=v._pixelsPerMercatorPixel/v.worldSize;U[0]=-E.x*r.d9(r.ax(Z.y))*ne,U[1]=-E.y*r.d9(v.center.lat)*ne}else{let ne=v.pointCoordinate(O.sub(E));Z&&ne&&(U[0]=ne.x-Z.x,U[1]=ne.y-Z.y)}}let j=v.zoom,G=[0,0,0];if(C){let Z=x(N||v.pointCoordinate3D(O)),ne={dir:r.Q.normalize([],r.Q.sub([],Z,v._camera.position))};if(ne.dir[2]<0){let te=v.zoomDeltaToMovement(Z,C);r.Q.scale(G,ne.dir,te)}}let H=r.Q.add(U,U,G);v._translateCameraConstrained(H),C&&Math.abs(v.zoom-j)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(l,p,!0)}_fireEvents(o,l,p){let _=Ol(this._eventsInProgress),v=Ol(o),x={};for(let R in o){let{originalEvent:O}=o[R];this._eventsInProgress[R]||(x[`${R}start`]=O),this._eventsInProgress[R]=o[R]}!_&&v&&this._fireEvent("movestart",v.originalEvent);for(let R in x)this._fireEvent(R,x[R]);v&&this._fireEvent("move",v.originalEvent);for(let R in o){let{originalEvent:O}=o[R];this._fireEvent(R,O)}let E={},C;for(let R in this._eventsInProgress){let{handlerName:O,originalEvent:N}=this._eventsInProgress[R];this._handlersById[O].isActive()||(delete this._eventsInProgress[R],C=l[O]||N,E[`${R}end`]=C)}for(let R in E)this._fireEvent(R,E[R]);let A=Ol(this._eventsInProgress);if(p&&(_||v)&&!A){this._updatingCamera=!0;let R=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;R?(O(R.bearing||this._map.getBearing())&&(R.bearing=0),this._map.easeTo(R,{originalEvent:C})):(this._map.fire(new r.b("moveend",{originalEvent:C})),O(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,l){this._map.fire(new r.b(o,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new Dp("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let d_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ob extends r.E{constructor(o,l){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,r.a$(["_renderFrameCallback"],this)}getCenter(){return new r.bq(this.transform.center.lng,this.transform.center.lat)}setCenter(o,l){return this.jumpTo({center:o},l)}panBy(o,l,p){return o=r.P.convert(o).mult(-1),this.panTo(this.transform.center,r.e({offset:o},l),p)}panTo(o,l,p){return this.easeTo(r.e({center:o},l),p)}getZoom(){return this.transform.zoom}setZoom(o,l){return this.jumpTo({zoom:o},l),this}zoomTo(o,l,p){return this.easeTo(r.e({zoom:o},l),p)}zoomIn(o,l){return this.zoomTo(this.getZoom()+1,o,l),this}zoomOut(o,l){return this.zoomTo(this.getZoom()-1,o,l),this}getBearing(){return this.transform.bearing}setBearing(o,l){return this.jumpTo({bearing:o},l),this}getPadding(){return this.transform.padding}setPadding(o,l){return this.jumpTo({padding:o},l),this}rotateTo(o,l,p){return this.easeTo(r.e({bearing:o},l),p)}resetNorth(o,l){return this.rotateTo(0,r.e({duration:1e3},o),l),this}resetNorthPitch(o,l){return this.easeTo(r.e({bearing:0,pitch:0,duration:1e3},o),l),this}snapToNorth(o,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,l):this}getPitch(){return this.transform.pitch}setPitch(o,l){return this.jumpTo({pitch:o},l),this}cameraForBounds(o,l){o=r.ag.convert(o);let p=l&&l.bearing||0,_=l&&l.pitch||0,v=o.getNorthWest(),x=o.getSouthEast();return this._cameraForBounds(this.transform,v,x,p,_,l)}_extendPadding(o){let l={top:0,right:0,bottom:0,left:0};return o==null?r.e({},l,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:r.e({},l,o)}_extendCameraOptions(o){return(o=r.e({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,l){let p=l.max[0]-l.min[0],_=l.max[1]-l.min[1];return p/_>o.aspect?p/(2*Math.tan(.5*o.fovX)*o.aspect):_/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,l,p,_,v,x){let E=o.clone(),C=this._extendCameraOptions(x);E.bearing=_,E.pitch=v;let A=r.bq.convert(l),R=r.bq.convert(p),O=.5*(A.lat+R.lat),N=.5*(A.lng+R.lng),z=r.da(O,N),U=r.Q.normalize([],z),j=r.Q.normalize([],r.Q.cross([],U,[0,1,0])),G=r.Q.cross([],j,U),H=[j[0],j[1],j[2],0,G[0],G[1],G[2],0,U[0],U[1],U[2],0,0,0,0,1],Z=[z,r.da(A.lat,A.lng),r.da(R.lat,A.lng),r.da(R.lat,R.lng),r.da(A.lat,R.lng),r.da(O,A.lng),r.da(O,R.lng),r.da(A.lat,N),r.da(R.lat,N)],ne=r.bV.fromPoints(Z.map(Te=>[r.Q.dot(j,Te),r.Q.dot(G,Te),r.Q.dot(U,Te)])),te=r.Q.transformMat4([],ne.center,H);r.Q.squaredLength(te)===0&&r.Q.set(te,0,0,1),r.Q.normalize(te,te),r.Q.scale(te,te,r.ae),E.center=r.db(te);let re=E.getWorldToCameraMatrix(),q=r.a9.invert(new Float64Array(16),re);ne=r.bV.applyTransform(ne,r.a9.multiply([],re,H));let X=this._extendAABB(ne,E,C,_);if(!X)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=X,r.Q.transformMat4(te,te,re);let ce=.5*(ne.max[2]-ne.min[2]),ae=this._minimumAABBFrustumDistance(E,ne),pe=r.Q.scale([],[0,0,1],ce),Ee=r.Q.add(pe,te,pe),fe=ae+(E.pitch===0?0:r.Q.distance(te,Ee)),be=E.globeCenterInViewSpace,De=r.Q.sub([],te,[be[0],be[1],be[2]]);r.Q.normalize(De,De),r.Q.scale(De,De,fe);let he=r.Q.add([],te,De);r.Q.transformMat4(he,he,q);let ye=r.dc/r.ae,Ve=r.Q.length(he),ge=r.bo(Math.max(Ve*ye-r.dc,Number.EPSILON),0),we=Math.min(E.zoomFromMercatorZAdjusted(ge),C.maxZoom);return we>.5*(r.bJ+r.bA)?(E.setProjection({name:"mercator"}),E.zoom=we,this._cameraForBounds(E,l,p,_,v,x)):{center:E.center,zoom:we,bearing:_,pitch:v}}_extendAABB(o,l,p,_){let v=.5*((p.padding.left||0)+(p.padding.right||0)),x=.5*((p.padding.top||0)+(p.padding.bottom||0)),E=x,C=v,A=v,R=x,O=l.width-(C+A),N=l.height-(E+R),z=r.Q.sub([],o.max,o.min),U=Math.min(O/z[0],N/z[1]),j=Math.min(l.scaleZoom(l.scale*U),p.maxZoom);if(isNaN(j))return null;let G=l.scale/l.zoomScale(j),H=new r.bV([o.min[0]-C*G,o.min[1]-R*G,o.min[2]],[o.max[0]+A*G,o.max[1]+E*G,o.max[2]]),Z=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new r.P(p.offset.x,p.offset.y):r.P.convert(p.offset)).rotate(-r.bm(_));return H.center[0]-=Z.x*G,H.center[1]+=Z.y*G,H}queryTerrainElevation(o,l){let p=this.transform.elevation;return p?(l=r.e({},{exaggerated:!0},l),p.getAtPoint(r.O.fromLngLat(o),null,l.exaggerated)):null}_cameraForBounds(o,l,p,_,v,x){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,l,p,_,v,x);let E=o.clone(),C=this._extendCameraOptions(x);E.bearing=_,E.pitch=v;let A=r.bq.convert(l),R=r.bq.convert(p),O=new r.bq(A.lng,R.lat),N=new r.bq(R.lng,A.lat),z=E.project(A),U=E.project(R),j=this.queryTerrainElevation(A),G=this.queryTerrainElevation(R),H=this.queryTerrainElevation(O),Z=this.queryTerrainElevation(N),ne=[[z.x,z.y,Math.min(j||0,G||0,H||0,Z||0)],[U.x,U.y,Math.max(j||0,G||0,H||0,Z||0)]],te=r.bV.fromPoints(ne),re=E.getWorldToCameraMatrix(),q=r.a9.invert(new Float64Array(16),re);te=r.bV.applyTransform(te,re);let X=this._extendAABB(te,E,C,_);if(!X)return void r.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=X;let ce=.5*r.Q.sub([],te.max,te.min)[2],ae=this._minimumAABBFrustumDistance(E,te),pe=[0,0,1,0];r.aa.transformMat4(pe,pe,re),r.aa.normalize(pe,pe);let Ee=r.Q.scale([],pe,ae+ce),fe=r.Q.add([],te.center,Ee);r.Q.transformMat4(te.center,te.center,q),r.Q.transformMat4(fe,fe,q);let be=[te.center[0],te.center[1],fe[2]*E.pixelsPerMeter];r.Q.scale(be,be,1/E.worldSize);let De=r.aw(be[0]),he=r.ax(be[1]),ye=Math.min(E._zoomFromMercatorZ(be[2]),C.maxZoom),Ve=new r.bq(De,he);return E.mercatorFromTransition&&ye<.5*(r.bJ+r.bA)?(E.setProjection({name:"globe"}),E.zoom=ye,this._cameraForBounds(E,l,p,_,v,x)):{center:Ve,zoom:ye,bearing:_,pitch:v}}fitBounds(o,l,p){let _=this.cameraForBounds(o,l);return this._fitInternal(_,l,p)}fitScreenCoordinates(o,l,p,_,v){let x=r.P.convert(o),E=r.P.convert(l),C=new r.P(Math.min(x.x,E.x),Math.min(x.y,E.y)),A=new r.P(Math.max(x.x,E.x),Math.max(x.y,E.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,E))return this;let R=this.transform.pointLocation3D(C),O=this.transform.pointLocation3D(A),N=this.transform.pointLocation3D(new r.P(C.x,A.y)),z=this.transform.pointLocation3D(new r.P(A.x,C.y)),U=[Math.min(R.lng,O.lng,N.lng,z.lng),Math.min(R.lat,O.lat,N.lat,z.lat)],j=[Math.max(R.lng,O.lng,N.lng,z.lng),Math.max(R.lat,O.lat,N.lat,z.lat)],G=_&&_.pitch?_.pitch:this.getPitch(),H=this._cameraForBounds(this.transform,U,j,p,G,_);return this._fitInternal(H,_,v)}_fitInternal(o,l,p){return o?(l=r.e(o,l)).linear?this.easeTo(l,p):this.flyTo(l,p):this}jumpTo(o,l){this.stop();let p=o.preloadOnly?this.transform.clone():this.transform,_=!1,v=!1,x=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(_=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=r.bq.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(v=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(x=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),o.preloadOnly?(this._preloadTiles(p),this):(this.fire(new r.b("movestart",l)).fire(new r.b("move",l)),_&&this.fire(new r.b("zoomstart",l)).fire(new r.b("zoom",l)).fire(new r.b("zoomend",l)),v&&this.fire(new r.b("rotatestart",l)).fire(new r.b("rotate",l)).fire(new r.b("rotateend",l)),x&&this.fire(new r.b("pitchstart",l)).fire(new r.b("pitch",l)).fire(new r.b("pitchend",l)),this.fire(new r.b("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.w(d_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,l){let p=this.transform;if(!p.projection.supportsFreeCamera)return r.w(d_),this;this.stop();let _=p.zoom,v=p.pitch,x=p.bearing;p.setFreeCameraOptions(o);let E=_!==p.zoom,C=v!==p.pitch,A=x!==p.bearing;return this.fire(new r.b("movestart",l)).fire(new r.b("move",l)),E&&this.fire(new r.b("zoomstart",l)).fire(new r.b("zoom",l)).fire(new r.b("zoomend",l)),A&&this.fire(new r.b("rotatestart",l)).fire(new r.b("rotate",l)).fire(new r.b("rotateend",l)),C&&this.fire(new r.b("pitchstart",l)).fire(new r.b("pitch",l)).fire(new r.b("pitchend",l)),this.fire(new r.b("moveend",l)),this}easeTo(o,l){this._stop(!1,o.easeId),((o=r.e({offset:[0,0],duration:500,easing:r.d8},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let p=this.transform,_=this.getZoom(),v=this.getBearing(),x=this.getPitch(),E=this.getPadding(),C="zoom"in o?+o.zoom:_,A="bearing"in o?this._normalizeBearing(o.bearing,v):v,R="pitch"in o?+o.pitch:x,O=this._extendPadding(o.padding),N=r.P.convert(o.offset),z,U,j;if(p.projection.name==="globe"){let ae=r.O.fromLngLat(p.center),pe=N.rotate(-p.angle);ae.x+=pe.x/p.worldSize,ae.y+=pe.y/p.worldSize;let Ee=ae.toLngLat(),fe=r.bq.convert(o.center||Ee);this._normalizeCenter(fe),z=p.centerPoint.add(pe),U=new r.P(ae.x,ae.y).mult(p.worldSize),j=new r.P(r.a8(fe.lng),r.ah(fe.lat)).mult(p.worldSize).sub(U)}else{z=p.centerPoint.add(N);let ae=p.pointLocation(z),pe=r.bq.convert(o.center||ae);this._normalizeCenter(pe),U=p.project(ae),j=p.project(pe).sub(U)}let G=p.zoomScale(C-_),H,Z;o.around&&(H=r.bq.convert(o.around),Z=p.locationPoint(H));let ne=this._zooming||C!==_,te=this._rotating||v!==A,re=this._pitching||R!==x,q=!p.isPaddingEqual(O),X=ae=>pe=>{if(ne&&(ae.zoom=r.X(_,C,pe)),te&&(ae.bearing=r.X(v,A,pe)),re&&(ae.pitch=r.X(x,R,pe)),q&&(ae.interpolatePadding(E,O,pe),z=ae.centerPoint.add(N)),H)ae.setLocationAtPoint(H,Z);else{let Ee=ae.zoomScale(ae.zoom-_),fe=C>_?Math.min(2,G):Math.max(.5,G),be=Math.pow(fe,1-pe),De=ae.unproject(U.add(j.mult(pe*be)).mult(Ee));ae.setLocationAtPoint(ae.renderWorldCopies?De.wrap():De,z)}return o.preloadOnly||this._fireMoveEvents(l),ae};if(o.preloadOnly){let ae=this._emulate(X,o.duration,p);return this._preloadTiles(ae),this}let ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=te,this._pitching=re,this._padding=q,this._easeId=o.easeId,this._prepareEase(l,o.noMoveStart,ce),this._ease(X(p),ae=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(l,ae)},o),this}_prepareEase(o,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||p.moving||this.fire(new r.b("movestart",o)),this._zooming&&!p.zooming&&this.fire(new r.b("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new r.b("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new r.b("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.b("move",o)),this._zooming&&this.fire(new r.b("zoom",o)),this._rotating&&this.fire(new r.b("rotate",o)),this._pitching&&this.fire(new r.b("pitch",o))}_afterEase(o,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let p=this._zooming,_=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new r.b("zoomend",o)),_&&this.fire(new r.b("rotateend",o)),v&&this.fire(new r.b("pitchend",o)),this.fire(new r.b("moveend",o))}flyTo(o,l){if(this._prefersReducedMotion(o)){let we=r.af(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(we,l)}this.stop(),o=r.e({offset:[0,0],speed:1.2,curve:1.42,easing:r.d8},o);let p=this.transform,_=this.getZoom(),v=this.getBearing(),x=this.getPitch(),E=this.getPadding(),C="zoom"in o?r.ad(+o.zoom,p.minZoom,p.maxZoom):_,A="bearing"in o?this._normalizeBearing(o.bearing,v):v,R="pitch"in o?+o.pitch:x,O=this._extendPadding(o.padding),N=p.zoomScale(C-_),z=r.P.convert(o.offset),U=p.centerPoint.add(z),j=p.pointLocation(U),G=r.bq.convert(o.center||j);this._normalizeCenter(G);let H=p.project(j),Z=p.project(G).sub(H),ne=o.curve,te=Math.max(p.width,p.height),re=te/N,q=Z.mag();if("minZoom"in o){let we=r.ad(Math.min(o.minZoom,_,C),p.minZoom,p.maxZoom),Te=te/p.zoomScale(we-_);ne=Math.sqrt(Te/q*2)}let X=ne*ne;function ce(we){let Te=(re*re-te*te+(we?-1:1)*X*X*q*q)/(2*(we?re:te)*X*q);return Math.log(Math.sqrt(Te*Te+1)-Te)}function ae(we){return(Math.exp(we)-Math.exp(-we))/2}function pe(we){return(Math.exp(we)+Math.exp(-we))/2}let Ee=ce(0),fe=function(we){return pe(Ee)/pe(Ee+ne*we)},be=function(we){return te*((pe(Ee)*(ae(Te=Ee+ne*we)/pe(Te))-ae(Ee))/X)/q;var Te},De=(ce(1)-Ee)/ne;if(Math.abs(q)<1e-6||!isFinite(De)){if(Math.abs(te-re)<1e-6)return this.easeTo(o,l);let we=re<te?-1:1;De=Math.abs(Math.log(re/te))/ne,be=function(){return 0},fe=function(Te){return Math.exp(we*ne*Te)}}o.duration="duration"in o?+o.duration:1e3*De/("screenSpeed"in o?+o.screenSpeed/ne:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let he=v!==A,ye=R!==x,Ve=!p.isPaddingEqual(O),ge=we=>Te=>{let ie=Te*De,Re=1/fe(ie);we.zoom=Te===1?C:_+we.scaleZoom(Re),he&&(we.bearing=r.X(v,A,Te)),ye&&(we.pitch=r.X(x,R,Te)),Ve&&(we.interpolatePadding(E,O,Te),U=we.centerPoint.add(z));let ot=Te===1?G:we.unproject(H.add(Z.mult(be(ie))).mult(Re));return we.setLocationAtPoint(we.renderWorldCopies?ot.wrap():ot,U),we._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(l),we};if(o.preloadOnly){let we=this._emulate(ge,o.duration,p);return this._preloadTiles(we),this}return this._zooming=!0,this._rotating=he,this._pitching=ye,this._padding=Ve,this._prepareEase(l,!1),this._ease(ge(p),()=>this._afterEase(l),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!o){let p=this.handlers;p&&p.stop(!1)}return this}_ease(o,l,p){p.animate===!1||p.duration===0?(o(1),l()):(this._easeStart=r.f.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((r.f.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,l){o=r.bk(o,-180,180);let p=Math.abs(o-l);return Math.abs(o-360-l)<p&&(o-=360),Math.abs(o+360-l)<p&&(o+=360),o}_normalizeCenter(o){let l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;let p=o.lng-l.center.lng;o.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&r.f.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,l,p){let _=Math.ceil(15*l/1e3),v=[],x=o(p.clone());for(let E=0;E<=_;E++){let C=x(E/_);v.push(C.clone())}return v}_preloadTiles(o,l){}}class Ip{constructor(o={}){this.options=o,r.a$(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let l=this.options&&this.options.compact;return this._map=o,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Q("button","mapboxgl-ctrl-attrib-button",this._container),Q("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,l){let p=this._map._getUIString(`AttributionControl.${l}`);o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.dd.ACCESS_TOKEN}];if(o){let p=l.reduce((_,v,x)=>(v.value&&(_+=`${v.key}=${v.value}${x<l.length-1?"&":""}`),_),"?");o.href=`${r.dd.FEEDBACK_URL}/${p}#${Kg(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}let l=this._map.style._mergedSourceCaches;for(let _ in l){let v=l[_];if(v.used){let x=v.getSource();x.attribution&&o.indexOf(x.attribution)<0&&o.push(x.attribution)}}o.sort((_,v)=>_.length-v.length),o=o.filter((_,v)=>{for(let x=v+1;x<o.length;x++)if(o[x].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class h_{constructor(){r.a$(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=Q("div","mapboxgl-ctrl");let l=Q("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let l in o){let p=o[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let l=o[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class ah{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let l=++this._id;return this._queue.push({callback:o,id:l,cancelled:!1}),l}remove(o){let l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(let _ of p)if(_.id===o)return void(_.cancelled=!0)}run(o=0){let l=this._currentlyRunning=this._queue;this._queue=[];for(let p of l)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function lh(f,o,l){if(f=new r.bq(f.lng,f.lat),o){let p=new r.bq(f.lng-360,f.lat),_=new r.bq(f.lng+360,f.lat),v=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),x=l.locationPoint(f).distSqr(o),E=o.x<0||o.y<0||o.x>l.width||o.y>l.height;l.locationPoint(p).distSqr(o)<x&&(E||Math.abs(p.lng-l.center.lng)<v)?f=p:l.locationPoint(_).distSqr(o)<x&&(E||Math.abs(_.lng-l.center.lng)<v)&&(f=_)}for(;Math.abs(f.lng-l.center.lng)>180;){let p=l.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}let Fl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class au extends r.E{constructor(o,l){if(super(),(o instanceof HTMLElement||l)&&(o=r.e({element:o},l)),r.a$(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=r.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q("div");let v=41,x=27,E=ue("svg",{display:"block",height:v*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${v}`},this._element),C=ue("radialGradient",{id:"shadowGradient"},ue("defs",{},E));ue("stop",{offset:"10%","stop-opacity":.4},C),ue("stop",{offset:"100%","stop-opacity":.05},C),ue("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},E),ue("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},E),ue("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},E),ue("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},E),this._offset=r.P.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});let p=this._element.classList;for(let v in Fl)p.remove(`mapboxgl-marker-anchor-${v}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`);let _=o&&o.className?o.className.trim().split(/\s+/):[];p.add(..._),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.bq.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let _=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let l=o.code,p=o.charCode||o.keyCode;l!=="Space"&&l!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(o){let l=o.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,l=this._pos;if(!o||!l)return!1;let p=o.unproject(l),_=o.getFreeCameraOptions();if(!_.position)return!1;let v=_.position.toLngLat();return v.distanceTo(p)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let l=this._pos;if(!l||l.x<0||l.x>o.transform.width||l.y<0||l.y>o.transform.height)return void this._clearFadeTimer();let p=o.unproject(l),_;o._showingGlobe()&&r.de(o.transform,this._lngLat)?_=0:(_=1-o._queryFogOpacity(p),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Fl[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){let o=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!o||p!=="map")return"";if(!l._showingGlobe()){let C=l.getPitch();return C?`rotateX(${C}deg)`:""}let _=r.bI(r.df(l.transform,this._lngLat)),v=o.sub(r.dg(l.transform)),x=Math.abs(v.x)+Math.abs(v.y);if(x===0)return"";let E=_/x;return`rotateX(${-v.y*E}deg) rotateY(${v.x*E}deg)`}_calculateZTransform(){let o=this._pos,l=this._map;if(!l||!o)return"";let p=0,_=this.getRotationAlignment();if(_==="map")if(l._showingGlobe()){let v=l.project(new r.bq(this._lngLat.lng,this._lngLat.lat+.001)),x=l.project(new r.bq(this._lngLat.lng,this._lngLat.lat-.001)).sub(v);p=r.bI(Math.atan2(x.y,x.x))-90}else p=-l.getBearing();else if(_==="horizon"){let v=r.S(4,6,l.getZoom()),x=r.dg(l.transform);x.y+=v*l.transform.height;let E=o.sub(x),C=r.bI(Math.atan2(E.y,E.x));p=(C>90?C-270:C+90)*(1-v)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=lh(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=r.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let l=this._map;if(!l)return;let p=this._pointerdownPos,_=this._positionDelta;if(p&&_){if(!this._isDragging){let v=this._clickTolerance||l._clickTolerance;if(o.point.dist(p)<v)return;this._isDragging=!0}this._pos=o.point.sub(_),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.b("dragstart"))),this.fire(new r.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.b("dragend")),this._state="inactive"}_addDragHandler(o){let l=this._map,p=this._pos;l&&p&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(p),this._pointerdownPos=o.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let l=this._map;return l&&(o?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let lu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},f_=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cu(f=new r.P(0,0),o="bottom"){if(typeof f=="number"){let l=Math.round(Math.sqrt(.5*Math.pow(f,2)));switch(o){case"top":return new r.P(0,f);case"top-left":return new r.P(l,l);case"top-right":return new r.P(-l,l);case"bottom":return new r.P(0,-f);case"bottom-left":return new r.P(l,-l);case"bottom-right":return new r.P(-l,-l);case"left":return new r.P(f,0);case"right":return new r.P(-f,0)}return new r.P(0,0)}return f instanceof r.P||Array.isArray(f)?r.P.convert(f):r.P.convert(f[o]||[0,0])}class ch{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let l=r.ch((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,l,p){this._start=this.getValue(l),this._end=o,this._startTime=l,this._endTime=l+p}}class p_{registerParameter(o,l,p,_,v){}registerButton(o,l,p){}registerBinding(o,l,p,_){}refreshUI(){}}let ua={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},os={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Ll={showCompass:!0,showZoom:!0,visualizePitch:!1};class uh{constructor(o,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new bp({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,p&&(this.mousePitch=new $a({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.a$(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(o,l){this.mouseRotate.mousedown(o,l),this.mousePitch&&this.mousePitch.mousedown(o,l),Qe()}move(o,l){let p=this.map,_=this.mouseRotate.mousemoveWindow(o,l),v=_&&_.bearingDelta;if(v&&p.setBearing(p.getBearing()+v),this.mousePitch){let x=this.mousePitch.mousemoveWindow(o,l),E=x&&x.pitchDelta;E&&p.setPitch(p.getPitch()+E)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){dt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(r.e({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),gn(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,gn(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Xt(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Xt(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let ht={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},m_={maxWidth:100,unit:"metric"},g_={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.du,supported:M,setRTLTextPlugin:r.dw,getRTLTextPluginStatus:r.dx,Map:class extends Ob{constructor(f){let o=f;if((f=r.e({},os,f)).minZoom!=null&&f.maxZoom!=null&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(f.minPitch!=null&&f.maxPitch!=null&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(f.minPitch!=null&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(f.maxPitch!=null&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(f.antialias&&r.dh(window)&&(f.antialias=!1,r.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new kd(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._repaint=!!f.repaint,this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._collectResourceTiming=f.collectResourceTiming,this._language=this._parseLanguage(f.language),this._worldview=f.worldview,this._renderTaskQueue=new ah,this._domRenderTaskQueue=new ah,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.aF(),this._locale=r.e({},ua,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._performanceMetricsCollection=f.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ch(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.di(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,this._contextCreateOptions=f.contextCreateOptions?Yt({},f.contextCreateOptions):{},typeof f.container=="string"){let l=document.getElementById(f.container);if(!l)throw new Error(`Container '${f.container.toString()}' not found.`);this._container=l}else{if(!(f.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&r.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),r.a$(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp=f.devtools?new p_(this):new p_,this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new su(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,(f.style||!f.testMode)&&this.setStyle(f.style||r.dd.DEFAULT_STYLE,{config:f.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),f.hash&&(this._hash=new Ab(typeof f.hash=="string"&&f.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch});let l=f.bounds;l&&(this.resize(),this.fitBounds(l,r.e({},f.fitBoundsOptions,{duration:0})))}this.resize(),f.attributionControl&&this.addControl(new Ip({customAttribution:f.customAttribution})),this._logoControl=new h_,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new r.b(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new r.b(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(f,o){if(o===void 0&&(o=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new r.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let l=f.onAdd(this);this._controls.push(f);let p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new r.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(f);return o>-1&&this._controls.splice(o,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new r.b("movestart",f)).fire(new r.b("move",f)),this.fire(new r.b("resize",f)),o&&this.fire(new r.b("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(r.ag.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new r.b("zoomstart")).fire(new r.b("zoom")).fire(new r.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new r.b("pitchstart")).fire(new r.b("pitch")).fire(new r.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(f){return f==="auto"?navigator.language:Array.isArray(f)?f.length===0?void 0:f.map(o=>o==="auto"?navigator.language:o):f}setLanguage(f){let o=this._parseLanguage(f);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(f){return this.style&&f!==this._worldview?(this._worldview=f,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(f){return this._lazyInitEmptyStyle(),f?typeof f=="string"&&(f={name:f}):f=null,this._useExplicitProjection=!!f,this._prioritizeAndUpdateProjection(f,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let f=this.transform,o=f.projection.name,l;o==="globe"&&f.zoom>=r.bA?(f.setMercatorFromTransition(),l=!0):o==="mercator"&&f.zoom<r.bA&&(f.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(f,o){return this._updateProjection(f||o||{name:"mercator"})}_updateProjection(f){let o;return o=f.name==="globe"&&this.transform.zoom>=r.bA?this.transform.setMercatorFromTransition():this.transform.setProjection(f),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(f){return this.transform.locationPoint3D(r.bq.convert(f))}unproject(f){return this.transform.pointLocation3D(r.P.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(f,o,l){if(f==="mouseenter"||f==="mouseover"){let p=!1,_=x=>{let E=o.filter(A=>this.getLayer(A)),C=E.length?this.queryRenderedFeatures(x.point,{layers:E}):[];C.length?p||(p=!0,l.call(this,new Tr(f,this,x.originalEvent,{features:C}))):p=!1},v=()=>{p=!1};return{layers:new Set(o),listener:l,delegates:{mousemove:_,mouseout:v}}}if(f==="mouseleave"||f==="mouseout"){let p=!1,_=x=>{let E=o.filter(C=>this.getLayer(C));(E.length?this.queryRenderedFeatures(x.point,{layers:E}):[]).length?p=!0:p&&(p=!1,l.call(this,new Tr(f,this,x.originalEvent)))},v=x=>{p&&(p=!1,l.call(this,new Tr(f,this,x.originalEvent)))};return{layers:new Set(o),listener:l,delegates:{mousemove:_,mouseout:v}}}{let p=_=>{let v=o.filter(E=>this.getLayer(E)),x=v.length?this.queryRenderedFeatures(_.point,{layers:v}):[];x.length&&(_.features=x,l.call(this,_),delete _.features)};return{layers:new Set(o),listener:l,delegates:{[f]:p}}}}on(f,o,l){if(l===void 0)return super.on(f,o);if(Array.isArray(o)||(o=[o]),o){for(let _ of o)if(!this._isValidId(_))return this}let p=this._createDelegatedListener(f,o,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(let _ in p.delegates)this.on(_,p.delegates[_]);return this}once(f,o,l){if(l===void 0)return super.once(f,o);if(Array.isArray(o)||(o=[o]),o){for(let _ of o)if(!this._isValidId(_))return this}let p=this._createDelegatedListener(f,o,l);for(let _ in p.delegates)this.once(_,p.delegates[_]);return this}off(f,o,l){if(l===void 0)return super.off(f,o);o=new Set(Array.isArray(o)?o:[o]);for(let v of o)if(!this._isValidId(v))return this;let p=(v,x)=>{if(v.size!==x.size)return!1;for(let E of v)if(!x.has(E))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[f]:void 0;return _&&(v=>{for(let x=0;x<v.length;x++){let E=v[x];if(E.listener===l&&p(E.layers,o)){for(let C in E.delegates)this.off(C,E.delegates[C]);return v.splice(x,1),this}}})(_),this}queryRenderedFeatures(f,o){if(!this.style)return[];if(o!==void 0||f===void 0||f instanceof r.P||Array.isArray(f)||(o=f,f=void 0),f=f||[[0,0],[this.transform.width,this.transform.height]],(o=o||{}).layers&&Array.isArray(o.layers)){for(let l of o.layers)if(!this._isValidId(l))return[]}return this.style.queryRenderedFeatures(f,o,this.transform)}querySourceFeatures(f,o){return this._isValidId(f)?this.style.querySourceFeatures(f,o):[]}isPointOnSurface(f){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&r.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(f))}setStyle(f,o){return o=r.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&f&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(f,(l,p)=>{l?(r.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(f,o)):p&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(f,o))}_getUIString(f){let o=this._locale[f];if(o==null)throw new Error(`Missing UI string '${f}'`);return o}_updateStyle(f,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),f){let l=r.e({},o);o&&o.config&&(l.initialConfig=o.config,delete l.config),this.style=new Go(this,l).setEventedParent(this,{style:this.style}).load(f)}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.w("There is no style added to the map."),!1)}_isValidId(f){return f==null?(this.fire(new r.a(new Error("IDs can't be empty."))),!1):!r.c9(f)||(this.fire(new r.a(new Error(`IDs can't contain special symbols: "${f}".`))),!1)}addSource(f,o){return this._isValidId(f)?(this._lazyInitEmptyStyle(),this.style.addSource(f,o),this._update(!0)):this}isSourceLoaded(f){return!!this._isValidId(f)&&!!this.style&&this.style._isSourceCacheLoaded(f)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(f,o,l){this._lazyInitEmptyStyle(),this.style.addSourceType(f,o,l)}removeSource(f){return this._isValidId(f)?(this.style.removeSource(f),this._updateTerrain(),this._update(!0)):this}getSource(f){return this._isValidId(f)?this.style.getOwnSource(f):null}addImage(f,o,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:v,content:x}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:E,height:C,data:A}=r.f.getImageData(o);this.style.addImage(f,{data:new r.h({width:E,height:C},A),pixelRatio:l,stretchX:_,stretchY:v,content:x,sdf:p,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new r.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:E,height:C}=o,A=o;this.style.addImage(f,{data:new r.h({width:E,height:C},new Uint8Array(A.data)),pixelRatio:l,stretchX:_,stretchY:v,content:x,sdf:p,version:0,userImage:A}),A.onAdd&&A.onAdd(this,f)}}updateImage(f,o){this._lazyInitEmptyStyle();let l=this.style.getImage(f);if(!l)return void this.fire(new r.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let p=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?r.f.getImageData(o):o,{width:_,height:v}=p,x=p.data;if(_===void 0||v===void 0)return void this.fire(new r.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==l.data.width||v!==l.data.height)return void this.fire(new r.a(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));let E=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);l.data.replace(x,E),this.style.updateImage(f,l)}hasImage(f){return f?!!this.style&&!!this.style.getImage(f):(this.fire(new r.a(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,o){r.d(this._requestManager.transformRequest(f,r.R.Image),(l,p)=>{o(l,p instanceof HTMLImageElement?r.f.getImageData(p):p)})}listImages(){return this.style.listImages()}addModel(f,o){this._lazyInitEmptyStyle(),this.style.addModel(f,o)}hasModel(f){return f?this.style.hasModel(f):(this.fire(new r.a(new Error("Missing required model id"))),!1)}removeModel(f){this.style.removeModel(f)}listModels(){return this.style.listModels()}addLayer(f,o){return this._isValidId(f.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(f,o),this._update(!0)):this}getSlot(f){let o=this.getLayer(f);return o&&o.slot||null}setSlot(f,o){return this.style.setSlot(f,o),this.style.mergeLayers(),this._update(!0)}addImport(f,o){return this.style.addImport(f,o),this}updateImport(f,o){return typeof o!="string"&&o.id!==f?(this.removeImport(f),this.addImport(o)):(this.style.updateImport(f,o),this._update(!0))}removeImport(f){return this.style.removeImport(f),this}moveImport(f,o){return this.style.moveImport(f,o),this._update(!0)}moveLayer(f,o){return this._isValidId(f)?(this.style.moveLayer(f,o),this._update(!0)):this}removeLayer(f){return this._isValidId(f)?(this.style.removeLayer(f),this._update(!0)):this}getLayer(f){return this._isValidId(f)?this.style.getOwnLayer(f):null}setLayerZoomRange(f,o,l){return this._isValidId(f)?(this.style.setLayerZoomRange(f,o,l),this._update(!0)):this}setFilter(f,o,l={}){return this._isValidId(f)?(this.style.setFilter(f,o,l),this._update(!0)):this}getFilter(f){return this._isValidId(f)?this.style.getFilter(f):null}setPaintProperty(f,o,l,p={}){return this._isValidId(f)?(this.style.setPaintProperty(f,o,l,p),this._update(!0)):this}getPaintProperty(f,o){return this._isValidId(f)?this.style.getPaintProperty(f,o):null}setLayoutProperty(f,o,l,p={}){return this._isValidId(f)?(this.style.setLayoutProperty(f,o,l,p),this._update(!0)):this}getLayoutProperty(f,o){return this._isValidId(f)?this.style.getLayoutProperty(f,o):null}getSchema(f){return this.style.getSchema(f)}setSchema(f,o){return this.style.setSchema(f,o),this._update(!0)}getConfig(f){return this.style.getConfig(f)}setConfig(f,o){return this.style.setConfig(f,o),this._update(!0)}getConfigProperty(f,o){return this.style.getConfigProperty(f,o)}setConfigProperty(f,o,l){return this.style.setConfigProperty(f,o,l),this._update(!0)}setLights(f){if(this._lazyInitEmptyStyle(),f&&f.length===1&&f[0].type==="flat"){let o=f[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(f),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let f=this.style.getLights()||[];return f.length===0&&f.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),f}setLight(f,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:f}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(f){return this.style.setCamera(f),this._triggerCameraUpdate(f)}_triggerCameraUpdate(f){return this._update(this.transform.setOrthographicProjectionAtLowPitch(f["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.bq.convert(f),this.transform):0}setFeatureState(f,o){return this._isValidId(f.source)?(this.style.setFeatureState(f,o),this._update()):this}removeFeatureState(f,o){return this._isValidId(f.source)?(this.style.removeFeatureState(f,o),this._update()):this}getFeatureState(f){return this._isValidId(f.source)?this.style.getFeatureState(f):null}_updateContainerDimensions(){if(!this._container)return;let f=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,l,p,_,v=this._container;for(;v&&(!p||!_);){let x=window.getComputedStyle(v).transform;x&&x!=="none"&&(l=x.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(p=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(_=l[3])),v=v.parentElement}this._containerWidth=p?Math.abs(f/p):f,this._containerHeight=_?Math.abs(o/_):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Q("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=Q("div","mapboxgl-canvas-container",f);this._canvas=Q("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let l=this._controlContainer=Q("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=Q("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,o){let l=r.f.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(o),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${o}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){let o=this._markers.indexOf(f);o!==-1&&this._markers.splice(o,1)}_addPopup(f){this._popups.push(f)}_removePopup(f){let o=this._popups.indexOf(f);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let f=r.e({},M.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",f);o?(r.dj(o,!0),this.painter=new Yg(o,this._contextCreateOptions,this.transform,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.dk.testSupport(o)):this.fire(new r.a(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.b("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new r.b("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let o;this.fire(new r.b("renderstart"));let l=this.painter.context.extTimerQuery,p=r.f.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=_.createQuery(),_.beginQuery(l.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjectionTransition();let v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let C=this.transform.zoom,A=this.transform.pitch,R=r.f.now(),O=new r.N(C,{now:R,fadeDuration:v,pitch:A,transition:this.style.transition});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(p),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let C=r.f.now()-p;_.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{let A=_.getQueryParameter(o,_.QUERY_RESULT)/1e6;_.deleteQuery(o),this.fire(new r.b("gpu-timing-frame",{cpuTime:C,gpuTime:A}))},50)}if(this.listens("gpu-timing-layer")){let C=this.painter.collectGpuTimers();setTimeout(()=>{let A=this.painter.queryGpuTimers(C);this.fire(new r.b("gpu-timing-layer",{layerTimes:A}))},50)}if(this.listens("gpu-timing-deferred-render")){let C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let A=this.painter.queryGpuTimeDeferredRender(C);this.fire(new r.b("gpu-timing-deferred-render",{gpuTime:A}))},50)}let E=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(E||this._repaint)this.triggerRepaint();else{let C=!this.isMoving()&&this.loaded();if(C&&(x=this._updateAverageElevation(p,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new r.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let A=this._calculateSpeedIndex();this.fire(new r.b("speedindexcompleted",{speedIndex:A})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||E||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.dl(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(f){for(let o of this._markers)f&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!f||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(f,o=!1){let l=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);let p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(o||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){let _=this.transform.averageElevation,v=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=f;let x=Math.abs(_-v);if(x>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(v),l(v);this._averageElevation.easeTo(v,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(v),l(v)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){r.dm(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===r.dn||f.status===401)){let o=this.painter.context.gl;r.dj(o,!1),this._logoControl instanceof h_&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.dp(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&r.dq(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){let f=this._isDragging();this.painter.updateTerrain(this.style,f)}_calculateSpeedIndex(){let f=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let l=this.painter.context.gl,p=l.createFramebuffer();function _(v){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,v,0);let x=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,x),x}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(f),o.canvasCopies.map(_),o.timeStamps)}_canvasPixelComparison(f,o,l){let p=l[1]-l[0],_=f.length/4;for(let v=0;v<o.length;v++){let x=o[v],E=0;for(let C=0;C<x.length;C+=4)x[C]===f[C]&&x[C+1]===f[C+1]&&x[C+2]===f[C+2]&&x[C+3]===f[C+3]&&(E+=1);p+=(l[v+2]-l[v+1])*(1-E/_)}return p}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.dr(this.painter.context.gl),r.ds.remove(),r.dt.remove(),this._removed=!0,this.fire(new r.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=r.f.frame(o=>{let l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(o)}))}_preloadTiles(f){let o=this.style?this.style.getSourceCaches():[];return r.b4(o,(l,p)=>l._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(f){this._showParseStatus!==f&&(this._showParseStatus=f,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(f){this._showLayers2DWireframe!==f&&(this._showLayers2DWireframe=f,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(f){this._showLayers3DWireframe!==f&&(this._showLayers3DWireframe=f,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,this._tp.refreshUI(),f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(f){this._showTileAABBs!==f&&(this._showTileAABBs=f,this._tp.refreshUI(),f&&this._update())}_setCacheLimits(f,o){r.dv(f,o)}get version(){return r.du}},NavigationControl:class{constructor(f){this.options=r.e({},Ll,f),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(r.a$(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),Q("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),Q("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.a$(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:o}):l.resetNorth({},{originalEvent:o}))}),this._compassIcon=Q("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let f=this._map;if(!f)return;let o=f.getZoom(),l=o===f.getMaxZoom(),p=o===f.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){let f=this._map;if(!f)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(f.transform.pitch*(Math.PI/180)),.5)}) rotateX(${f.transform.pitch}deg) rotateZ(${f.transform.angle*(180/Math.PI)}deg)`:`rotate(${f.transform.angle*(180/Math.PI)}deg)`;f._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),f.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&f.on("pitch",this._rotateCompassArrow),f.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new uh(f,this._compass,this.options.visualizePitch)),this._container}onRemove(){let f=this._map;f&&(this._container.remove(),this.options.showZoom&&f.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&f.off("pitch",this._rotateCompassArrow),f.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(f,o){let l=Q("button",f,this._container);return l.type="button",l.addEventListener("click",o),l}_setButtonTitle(f,o){if(!this._map)return;let l=this._map._getUIString(`NavigationControl.${o}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends r.E{constructor(f){super();let o=navigator.geolocation;this.options=r.e({geolocation:o},ht,f),r.a$(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xg(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(f){return this._map=f,this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(f){let o=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,f(l)};this._supportsGeolocation!==void 0?f(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>o(l.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(f){let o=this._map.getMaxBounds(),l=f.coords;return!!o&&(l.longitude<o.getWest()||l.longitude>o.getEast()||l.latitude<o.getSouth()||l.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new r.b("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(f),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(f),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("geolocate",f)),this._finish()}}_updateCamera(f){let o=new r.bq(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,p=this._map.getBearing(),_=r.e({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(l),_,{geolocateSource:!0})}_updateMarker(f){if(f){let o=new r.bq(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let f=this._map.transform,o=r.bo(1,f._center.lat)*f.worldSize,l=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(f.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(f.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.b("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=Q("button","mapboxgl-ctrl-geolocate",this._container),Q("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",f===!1){r.w("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q("div","mapboxgl-user-location"),this._dotElement.appendChild(Q("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Q("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new au({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Q("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new au({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.b("trackuserlocationend")))})}}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:f.absolute===!0&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(f={maximumAge:6e5,timeout:0},this._noTimeout=!0):(f=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let f=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&f()}).catch(console.error):f()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ip,ScaleControl:class{constructor(f){this.options=r.e({},m_,f),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.a$(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let f=this.options.maxWidth||100,o=this._map,l=o._containerHeight/2,p=o._containerWidth/2-f/2,_=o.unproject([p,l]),v=o.unproject([p+f,l]),x=_.distanceTo(v);if(this.options.unit==="imperial"){let E=3.2808*x;E>5280?this._setScale(f,E/5280,"mile"):this._setScale(f,E,"foot")}else this.options.unit==="nautical"?this._setScale(f,x/1852,"nautical-mile"):x>=1e3?this._setScale(f,x/1e3,"kilometer"):this._setScale(f,x,"meter")}_setScale(f,o,l){this._map._requestDomTask(()=>{let p=function(v){let x=Math.pow(10,`${Math.floor(v)}`.length-1),E=v/x;return E=E>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(C){let A=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*A)/A}(E),x*E}(o),_=p/o;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${g_[l]}`,this._container.style.width=f*_+"px"})}onAdd(f){return this._map=f,this._language=f.getLanguage(),this._container=Q("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(f){this._language=f,this._update()}setUnit(f){this.options.unit=f,this._update()}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:r.w("Full screen control 'container' must be a DOM element.")),r.a$(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let f=this._fullscreenButton=Q("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Q("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.E{constructor(f){super(),this.options=r.e(Object.create(lu),f),r.a$(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&f.on("preclick",this._onClose),this.options.closeOnMove&&f.on("move",this._onClose),f.on("remove",this.remove),this._update(),f._addPopup(this),this._focusFirstElement(),this._trackPointer?(f.on("mousemove",this._onMouseEvent),f.on("mouseup",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")):f.on("move",this._update),this.fire(new r.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let f=this._map;return f&&(f.off("move",this._update),f.off("move",this._onClose),f.off("preclick",this._onClose),f.off("click",this._onClose),f.off("remove",this.remove),f.off("mousemove",this._onMouseEvent),f.off("mouseup",this._onMouseEvent),f.off("drag",this._onMouseEvent),f._canvasContainer&&f._canvasContainer.classList.remove("mapboxgl-track-pointer"),f._removePopup(this),this._map=void 0),this.fire(new r.b("close")),this}getLngLat(){return this._lngLat}setLngLat(f){this._lngLat=r.bq.convert(f),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let f=this._map;return f&&(f.off("move",this._update),f.on("mousemove",this._onMouseEvent),f.on("drag",this._onMouseEvent),f._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){let o=document.createDocumentFragment(),l=document.createElement("body"),p;for(l.innerHTML=f;p=l.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=Q("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(f),this.options.closeButton){let l=this._closeButton=Q("button","mapboxgl-popup-close-button",o);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let o;return this._classList.delete(f)?o=!1:(this._classList.add(f),o=!0),this._updateClassList(),o}_onMouseEvent(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;let o=this._map,l=this._container,p=this._pos;if(!o||!l||!p)return"bottom";let _=l.offsetWidth,v=l.offsetHeight,x=p.x<_/2,E=p.x>o.transform.width-_/2;if(p.y+f<v)return x?"top-left":E?"top-right":"top";if(p.y>o.transform.height-v){if(x)return"bottom-left";if(E)return"bottom-right"}return x?"left":E?"right":"bottom"}_updateClassList(){let f=this._container;if(!f)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),f.className=o.join(" ")}_update(f){let o=this._map,l=this._content;if(!o||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=Q("div","mapboxgl-popup",o.getContainer()),this._tip=Q("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=lh(this._lngLat,this._pos,o.transform)),!this._trackPointer||f){let _=this._pos=this._trackPointer&&f?f:o.project(this._lngLat),v=cu(this.options.offset),x=this._anchor=this._getAnchor(v.y),E=cu(this.options.offset,x),C=_.add(E).round();o._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Fl[x]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&o._showingGlobe()){let _=r.de(o.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let f=this._container.querySelector(f_);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._container&&(this._container.style.opacity=`${f}`),this._content&&(this._content.style.pointerEvents=f?"auto":"none")}},Marker:au,Style:Go,LngLat:r.bq,LngLatBounds:r.ag,Point:r.P,MercatorCoordinate:r.O,FreeCameraOptions:bl,Evented:r.E,config:r.dd,prewarm:r.dy,clearPrewarmedResources:r.dz,get accessToken(){return r.dd.ACCESS_TOKEN},set accessToken(f){r.dd.ACCESS_TOKEN=f},get baseApiUrl(){return r.dd.API_URL},set baseApiUrl(f){r.dd.API_URL=f},get workerCount(){return r.dA.workerCount},set workerCount(f){r.dA.workerCount=f},get maxParallelImageRequests(){return r.dd.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){r.dd.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){r.dB(f)},get workerUrl(){return r.dC.workerUrl},set workerUrl(f){r.dC.workerUrl=f},get workerClass(){return r.dC.workerClass},set workerClass(f){r.dC.workerClass=f},get workerParams(){return r.dC.workerParams},set workerParams(f){r.dC.workerParams=f},get dracoUrl(){return r.dD()},set dracoUrl(f){r.dE(f)},get meshoptUrl(){return r.dF()},set meshoptUrl(f){r.dG(f)},setNow:r.f.setNow,restoreNow:r.f.restoreNow}});var m=d;return m})});var f1=null;var h1=1,p1=Symbol("SIGNAL");function ci(a){let i=f1;return f1=a,i}function zS(){return f1}var m1={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function az(a){if(!(b1(a)&&!a.dirty)&&!(!a.dirty&&a.lastCleanEpoch===h1)){if(!a.producerMustRecompute(a)&&!_1(a)){a.dirty=!1,a.lastCleanEpoch=h1;return}a.producerRecomputeValue(a),a.dirty=!1,a.lastCleanEpoch=h1}}function g1(a){return a&&(a.nextProducerIndex=0),ci(a)}function BS(a,i){if(ci(i),!(!a||a.producerNode===void 0||a.producerIndexOfThis===void 0||a.producerLastReadVersion===void 0)){if(b1(a))for(let d=a.nextProducerIndex;d<a.producerNode.length;d++)v1(a.producerNode[d],a.producerIndexOfThis[d]);for(;a.producerNode.length>a.nextProducerIndex;)a.producerNode.pop(),a.producerLastReadVersion.pop(),a.producerIndexOfThis.pop()}}function _1(a){x1(a);for(let i=0;i<a.producerNode.length;i++){let d=a.producerNode[i],c=a.producerLastReadVersion[i];if(c!==d.version||(az(d),c!==d.version))return!0}return!1}function y1(a){if(x1(a),b1(a))for(let i=0;i<a.producerNode.length;i++)v1(a.producerNode[i],a.producerIndexOfThis[i]);a.producerNode.length=a.producerLastReadVersion.length=a.producerIndexOfThis.length=0,a.liveConsumerNode&&(a.liveConsumerNode.length=a.liveConsumerIndexOfThis.length=0)}function v1(a,i){if(lz(a),a.liveConsumerNode.length===1&&cz(a))for(let c=0;c<a.producerNode.length;c++)v1(a.producerNode[c],a.producerIndexOfThis[c]);let d=a.liveConsumerNode.length-1;if(a.liveConsumerNode[i]=a.liveConsumerNode[d],a.liveConsumerIndexOfThis[i]=a.liveConsumerIndexOfThis[d],a.liveConsumerNode.length--,a.liveConsumerIndexOfThis.length--,i<a.liveConsumerNode.length){let c=a.liveConsumerIndexOfThis[i],m=a.liveConsumerNode[i];x1(m),m.producerIndexOfThis[c]=i}}function b1(a){return a.consumerIsAlwaysLive||(a?.liveConsumerNode?.length??0)>0}function x1(a){a.producerNode??=[],a.producerIndexOfThis??=[],a.producerLastReadVersion??=[]}function lz(a){a.liveConsumerNode??=[],a.liveConsumerIndexOfThis??=[]}function cz(a){return a.producerNode!==void 0}function uz(){throw new Error}var dz=uz;function VS(a){dz=a}function Pn(a){return typeof a=="function"}function gy(a){let d=a(c=>{Error.call(c),c.stack=new Error().stack});return d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,d}var _y=gy(a=>function(d){a(this),this.message=d?`${d.length} errors occurred during unsubscription:
${d.map((c,m)=>`${m+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=d});function Su(a,i){if(a){let d=a.indexOf(i);0<=d&&a.splice(d,1)}}var Ki=class a{constructor(i){this.initialTeardown=i,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let i;if(!this.closed){this.closed=!0;let{_parentage:d}=this;if(d)if(this._parentage=null,Array.isArray(d))for(let r of d)r.remove(this);else d.remove(this);let{initialTeardown:c}=this;if(Pn(c))try{c()}catch(r){i=r instanceof _y?r.errors:[r]}let{_finalizers:m}=this;if(m){this._finalizers=null;for(let r of m)try{jS(r)}catch(T){i=i??[],T instanceof _y?i=[...i,...T.errors]:i.push(T)}}if(i)throw new _y(i)}}add(i){var d;if(i&&i!==this)if(this.closed)jS(i);else{if(i instanceof a){if(i.closed||i._hasParent(this))return;i._addParent(this)}(this._finalizers=(d=this._finalizers)!==null&&d!==void 0?d:[]).push(i)}}_hasParent(i){let{_parentage:d}=this;return d===i||Array.isArray(d)&&d.includes(i)}_addParent(i){let{_parentage:d}=this;this._parentage=Array.isArray(d)?(d.push(i),d):d?[d,i]:i}_removeParent(i){let{_parentage:d}=this;d===i?this._parentage=null:Array.isArray(d)&&Su(d,i)}remove(i){let{_finalizers:d}=this;d&&Su(d,i),i instanceof a&&i._removeParent(this)}};Ki.EMPTY=(()=>{let a=new Ki;return a.closed=!0,a})();var w1=Ki.EMPTY;function yy(a){return a instanceof Ki||a&&"closed"in a&&Pn(a.remove)&&Pn(a.add)&&Pn(a.unsubscribe)}function jS(a){Pn(a)?a():a.unsubscribe()}var Gs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Fh={setTimeout(a,i,...d){let{delegate:c}=Fh;return c?.setTimeout?c.setTimeout(a,i,...d):setTimeout(a,i,...d)},clearTimeout(a){let{delegate:i}=Fh;return(i?.clearTimeout||clearTimeout)(a)},delegate:void 0};function vy(a){Fh.setTimeout(()=>{let{onUnhandledError:i}=Gs;if(i)i(a);else throw a})}function sm(){}var US=E1("C",void 0,void 0);function GS(a){return E1("E",void 0,a)}function $S(a){return E1("N",a,void 0)}function E1(a,i,d){return{kind:a,value:i,error:d}}var Mu=null;function Lh(a){if(Gs.useDeprecatedSynchronousErrorHandling){let i=!Mu;if(i&&(Mu={errorThrown:!1,error:null}),a(),i){let{errorThrown:d,error:c}=Mu;if(Mu=null,d)throw c}}else a()}function HS(a){Gs.useDeprecatedSynchronousErrorHandling&&Mu&&(Mu.errorThrown=!0,Mu.error=a)}var Au=class extends Ki{constructor(i){super(),this.isStopped=!1,i?(this.destination=i,yy(i)&&i.add(this)):this.destination=pz}static create(i,d,c){return new tl(i,d,c)}next(i){this.isStopped?D1($S(i),this):this._next(i)}error(i){this.isStopped?D1(GS(i),this):(this.isStopped=!0,this._error(i))}complete(){this.isStopped?D1(US,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(i){this.destination.next(i)}_error(i){try{this.destination.error(i)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},hz=Function.prototype.bind;function T1(a,i){return hz.call(a,i)}var I1=class{constructor(i){this.partialObserver=i}next(i){let{partialObserver:d}=this;if(d.next)try{d.next(i)}catch(c){by(c)}}error(i){let{partialObserver:d}=this;if(d.error)try{d.error(i)}catch(c){by(c)}else by(i)}complete(){let{partialObserver:i}=this;if(i.complete)try{i.complete()}catch(d){by(d)}}},tl=class extends Au{constructor(i,d,c){super();let m;if(Pn(i)||!i)m={next:i??void 0,error:d??void 0,complete:c??void 0};else{let r;this&&Gs.useDeprecatedNextContext?(r=Object.create(i),r.unsubscribe=()=>this.unsubscribe(),m={next:i.next&&T1(i.next,r),error:i.error&&T1(i.error,r),complete:i.complete&&T1(i.complete,r)}):m=i}this.destination=new I1(m)}};function by(a){Gs.useDeprecatedSynchronousErrorHandling?HS(a):vy(a)}function fz(a){throw a}function D1(a,i){let{onStoppedNotification:d}=Gs;d&&Fh.setTimeout(()=>d(a,i))}var pz={closed:!0,next:sm,error:fz,complete:sm};var Nh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function nl(a){return a}function qS(a){return a.length===0?nl:a.length===1?a[0]:function(d){return a.reduce((c,m)=>m(c),d)}}var oi=(()=>{class a{constructor(d){d&&(this._subscribe=d)}lift(d){let c=new a;return c.source=this,c.operator=d,c}subscribe(d,c,m){let r=gz(d)?d:new tl(d,c,m);return Lh(()=>{let{operator:T,source:M}=this;r.add(T?T.call(r,M):M?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(d){try{return this._subscribe(d)}catch(c){d.error(c)}}forEach(d,c){return c=WS(c),new c((m,r)=>{let T=new tl({next:M=>{try{d(M)}catch(F){r(F),T.unsubscribe()}},error:r,complete:m});this.subscribe(T)})}_subscribe(d){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(d)}[Nh](){return this}pipe(...d){return qS(d)(this)}toPromise(d){return d=WS(d),new d((c,m)=>{let r;this.subscribe(T=>r=T,T=>m(T),()=>c(r))})}}return a.create=i=>new a(i),a})();function WS(a){var i;return(i=a??Gs.Promise)!==null&&i!==void 0?i:Promise}function mz(a){return a&&Pn(a.next)&&Pn(a.error)&&Pn(a.complete)}function gz(a){return a&&a instanceof Au||mz(a)&&yy(a)}function _z(a){return Pn(a?.lift)}function Mi(a){return i=>{if(_z(i))return i.lift(function(d){try{return a(d,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Fi(a,i,d,c,m){return new C1(a,i,d,c,m)}var C1=class extends Au{constructor(i,d,c,m,r,T){super(i),this.onFinalize=r,this.shouldUnsubscribe=T,this._next=d?function(M){try{d(M)}catch(F){i.error(F)}}:super._next,this._error=m?function(M){try{m(M)}catch(F){i.error(F)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(M){i.error(M)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var i;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:d}=this;super.unsubscribe(),!d&&((i=this.onFinalize)===null||i===void 0||i.call(this))}}};var ZS=gy(a=>function(){a(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Tn=(()=>{class a extends oi{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(d){let c=new xy(this,this);return c.operator=d,c}_throwIfClosed(){if(this.closed)throw new ZS}next(d){Lh(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(d)}})}error(d){Lh(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=d;let{observers:c}=this;for(;c.length;)c.shift().error(d)}})}complete(){Lh(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:d}=this;for(;d.length;)d.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var d;return((d=this.observers)===null||d===void 0?void 0:d.length)>0}_trySubscribe(d){return this._throwIfClosed(),super._trySubscribe(d)}_subscribe(d){return this._throwIfClosed(),this._checkFinalizedStatuses(d),this._innerSubscribe(d)}_innerSubscribe(d){let{hasError:c,isStopped:m,observers:r}=this;return c||m?w1:(this.currentObservers=null,r.push(d),new Ki(()=>{this.currentObservers=null,Su(r,d)}))}_checkFinalizedStatuses(d){let{hasError:c,thrownError:m,isStopped:r}=this;c?d.error(m):r&&d.complete()}asObservable(){let d=new oi;return d.source=this,d}}return a.create=(i,d)=>new xy(i,d),a})(),xy=class extends Tn{constructor(i,d){super(),this.destination=i,this.source=d}next(i){var d,c;(c=(d=this.destination)===null||d===void 0?void 0:d.next)===null||c===void 0||c.call(d,i)}error(i){var d,c;(c=(d=this.destination)===null||d===void 0?void 0:d.error)===null||c===void 0||c.call(d,i)}complete(){var i,d;(d=(i=this.destination)===null||i===void 0?void 0:i.complete)===null||d===void 0||d.call(i)}_subscribe(i){var d,c;return(c=(d=this.source)===null||d===void 0?void 0:d.subscribe(i))!==null&&c!==void 0?c:w1}};var Pu=class extends Tn{constructor(i){super(),this._value=i}get value(){return this.getValue()}_subscribe(i){let d=super._subscribe(i);return!d.closed&&i.next(this._value),d}getValue(){let{hasError:i,thrownError:d,_value:c}=this;if(i)throw d;return this._throwIfClosed(),c}next(i){super.next(this._value=i)}};var am={now(){return(am.delegate||Date).now()},delegate:void 0};var wy=class extends Tn{constructor(i=1/0,d=1/0,c=am){super(),this._bufferSize=i,this._windowTime=d,this._timestampProvider=c,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=d===1/0,this._bufferSize=Math.max(1,i),this._windowTime=Math.max(1,d)}next(i){let{isStopped:d,_buffer:c,_infiniteTimeWindow:m,_timestampProvider:r,_windowTime:T}=this;d||(c.push(i),!m&&c.push(r.now()+T)),this._trimBuffer(),super.next(i)}_subscribe(i){this._throwIfClosed(),this._trimBuffer();let d=this._innerSubscribe(i),{_infiniteTimeWindow:c,_buffer:m}=this,r=m.slice();for(let T=0;T<r.length&&!i.closed;T+=c?1:2)i.next(r[T]);return this._checkFinalizedStatuses(i),d}_trimBuffer(){let{_bufferSize:i,_timestampProvider:d,_buffer:c,_infiniteTimeWindow:m}=this,r=(m?1:2)*i;if(i<1/0&&r<c.length&&c.splice(0,c.length-r),!m){let T=d.now(),M=0;for(let F=1;F<c.length&&c[F]<=T;F+=2)M=F;M&&c.splice(0,M+1)}}};var Ey=class extends Ki{constructor(i,d){super()}schedule(i,d=0){return this}};var lm={setInterval(a,i,...d){let{delegate:c}=lm;return c?.setInterval?c.setInterval(a,i,...d):setInterval(a,i,...d)},clearInterval(a){let{delegate:i}=lm;return(i?.clearInterval||clearInterval)(a)},delegate:void 0};var Ty=class extends Ey{constructor(i,d){super(i,d),this.scheduler=i,this.work=d,this.pending=!1}schedule(i,d=0){var c;if(this.closed)return this;this.state=i;let m=this.id,r=this.scheduler;return m!=null&&(this.id=this.recycleAsyncId(r,m,d)),this.pending=!0,this.delay=d,this.id=(c=this.id)!==null&&c!==void 0?c:this.requestAsyncId(r,this.id,d),this}requestAsyncId(i,d,c=0){return lm.setInterval(i.flush.bind(i,this),c)}recycleAsyncId(i,d,c=0){if(c!=null&&this.delay===c&&this.pending===!1)return d;d!=null&&lm.clearInterval(d)}execute(i,d){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let c=this._execute(i,d);if(c)return c;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(i,d){let c=!1,m;try{this.work(i)}catch(r){c=!0,m=r||new Error("Scheduled action threw falsy error")}if(c)return this.unsubscribe(),m}unsubscribe(){if(!this.closed){let{id:i,scheduler:d}=this,{actions:c}=d;this.work=this.state=this.scheduler=null,this.pending=!1,Su(c,this),i!=null&&(this.id=this.recycleAsyncId(d,i,null)),this.delay=null,super.unsubscribe()}}};var zh=class a{constructor(i,d=a.now){this.schedulerActionCtor=i,this.now=d}schedule(i,d=0,c){return new this.schedulerActionCtor(this,i).schedule(c,d)}};zh.now=am.now;var Dy=class extends zh{constructor(i,d=zh.now){super(i,d),this.actions=[],this._active=!1}flush(i){let{actions:d}=this;if(this._active){d.push(i);return}let c;this._active=!0;do if(c=i.execute(i.state,i.delay))break;while(i=d.shift());if(this._active=!1,c){for(;i=d.shift();)i.unsubscribe();throw c}}};var cm=new Dy(Ty),QS=cm;var Ru=new oi(a=>a.complete());function Iy(a){return a&&Pn(a.schedule)}function S1(a){return a[a.length-1]}function Cy(a){return Pn(S1(a))?a.pop():void 0}function pa(a){return Iy(S1(a))?a.pop():void 0}function YS(a,i){return typeof S1(a)=="number"?a.pop():i}function KS(a,i,d,c){function m(r){return r instanceof d?r:new d(function(T){T(r)})}return new(d||(d=Promise))(function(r,T){function M(Q){try{$(c.next(Q))}catch(ue){T(ue)}}function F(Q){try{$(c.throw(Q))}catch(ue){T(ue)}}function $(Q){Q.done?r(Q.value):m(Q.value).then(M,F)}$((c=c.apply(a,i||[])).next())})}function XS(a){var i=typeof Symbol=="function"&&Symbol.iterator,d=i&&a[i],c=0;if(d)return d.call(a);if(a&&typeof a.length=="number")return{next:function(){return a&&c>=a.length&&(a=void 0),{value:a&&a[c++],done:!a}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")}function ku(a){return this instanceof ku?(this.v=a,this):new ku(a)}function JS(a,i,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=d.apply(a,i||[]),m,r=[];return m={},M("next"),M("throw"),M("return",T),m[Symbol.asyncIterator]=function(){return this},m;function T(xe){return function(ke){return Promise.resolve(ke).then(xe,ue)}}function M(xe,ke){c[xe]&&(m[xe]=function(Qe){return new Promise(function(dt,st){r.push([xe,Qe,dt,st])>1||F(xe,Qe)})},ke&&(m[xe]=ke(m[xe])))}function F(xe,ke){try{$(c[xe](ke))}catch(Qe){Ae(r[0][3],Qe)}}function $(xe){xe.value instanceof ku?Promise.resolve(xe.value.v).then(Q,ue):Ae(r[0][2],xe)}function Q(xe){F("next",xe)}function ue(xe){F("throw",xe)}function Ae(xe,ke){xe(ke),r.shift(),r.length&&F(r[0][0],r[0][1])}}function eM(a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=a[Symbol.asyncIterator],d;return i?i.call(a):(a=typeof XS=="function"?XS(a):a[Symbol.iterator](),d={},c("next"),c("throw"),c("return"),d[Symbol.asyncIterator]=function(){return this},d);function c(r){d[r]=a[r]&&function(T){return new Promise(function(M,F){T=a[r](T),m(M,F,T.done,T.value)})}}function m(r,T,M,F){Promise.resolve(F).then(function($){r({value:$,done:M})},T)}}var Bh=a=>a&&typeof a.length=="number"&&typeof a!="function";function Sy(a){return Pn(a?.then)}function My(a){return Pn(a[Nh])}function Ay(a){return Symbol.asyncIterator&&Pn(a?.[Symbol.asyncIterator])}function Py(a){return new TypeError(`You provided ${a!==null&&typeof a=="object"?"an invalid object":`'${a}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function yz(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Ry=yz();function ky(a){return Pn(a?.[Ry])}function Oy(a){return JS(this,arguments,function*(){let d=a.getReader();try{for(;;){let{value:c,done:m}=yield ku(d.read());if(m)return yield ku(void 0);yield yield ku(c)}}finally{d.releaseLock()}})}function Fy(a){return Pn(a?.getReader)}function qi(a){if(a instanceof oi)return a;if(a!=null){if(My(a))return vz(a);if(Bh(a))return bz(a);if(Sy(a))return xz(a);if(Ay(a))return tM(a);if(ky(a))return wz(a);if(Fy(a))return Ez(a)}throw Py(a)}function vz(a){return new oi(i=>{let d=a[Nh]();if(Pn(d.subscribe))return d.subscribe(i);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function bz(a){return new oi(i=>{for(let d=0;d<a.length&&!i.closed;d++)i.next(a[d]);i.complete()})}function xz(a){return new oi(i=>{a.then(d=>{i.closed||(i.next(d),i.complete())},d=>i.error(d)).then(null,vy)})}function wz(a){return new oi(i=>{for(let d of a)if(i.next(d),i.closed)return;i.complete()})}function tM(a){return new oi(i=>{Tz(a,i).catch(d=>i.error(d))})}function Ez(a){return tM(Oy(a))}function Tz(a,i){var d,c,m,r;return KS(this,void 0,void 0,function*(){try{for(d=eM(a);c=yield d.next(),!c.done;){let T=c.value;if(i.next(T),i.closed)return}}catch(T){m={error:T}}finally{try{c&&!c.done&&(r=d.return)&&(yield r.call(d))}finally{if(m)throw m.error}}i.complete()})}function Ao(a,i,d,c=0,m=!1){let r=i.schedule(function(){d(),m?a.add(this.schedule(null,c)):this.unsubscribe()},c);if(a.add(r),!m)return r}function Ly(a,i=0){return Mi((d,c)=>{d.subscribe(Fi(c,m=>Ao(c,a,()=>c.next(m),i),()=>Ao(c,a,()=>c.complete(),i),m=>Ao(c,a,()=>c.error(m),i)))})}function Ny(a,i=0){return Mi((d,c)=>{c.add(a.schedule(()=>d.subscribe(c),i))})}function nM(a,i){return qi(a).pipe(Ny(i),Ly(i))}function iM(a,i){return qi(a).pipe(Ny(i),Ly(i))}function rM(a,i){return new oi(d=>{let c=0;return i.schedule(function(){c===a.length?d.complete():(d.next(a[c++]),d.closed||this.schedule())})})}function oM(a,i){return new oi(d=>{let c;return Ao(d,i,()=>{c=a[Ry](),Ao(d,i,()=>{let m,r;try{({value:m,done:r}=c.next())}catch(T){d.error(T);return}r?d.complete():d.next(m)},0,!0)}),()=>Pn(c?.return)&&c.return()})}function zy(a,i){if(!a)throw new Error("Iterable cannot be null");return new oi(d=>{Ao(d,i,()=>{let c=a[Symbol.asyncIterator]();Ao(d,i,()=>{c.next().then(m=>{m.done?d.complete():d.next(m.value)})},0,!0)})})}function sM(a,i){return zy(Oy(a),i)}function aM(a,i){if(a!=null){if(My(a))return nM(a,i);if(Bh(a))return rM(a,i);if(Sy(a))return iM(a,i);if(Ay(a))return zy(a,i);if(ky(a))return oM(a,i);if(Fy(a))return sM(a,i)}throw Py(a)}function Po(a,i){return i?aM(a,i):qi(a)}function ic(...a){let i=pa(a);return Po(a,i)}function lM(a){return a instanceof Date&&!isNaN(a)}function Nr(a,i){return Mi((d,c)=>{let m=0;d.subscribe(Fi(c,r=>{c.next(a.call(i,r,m++))}))})}var{isArray:Dz}=Array;function Iz(a,i){return Dz(i)?a(...i):a(i)}function Vh(a){return Nr(i=>Iz(a,i))}var{isArray:Cz}=Array,{getPrototypeOf:Sz,prototype:Mz,keys:Az}=Object;function By(a){if(a.length===1){let i=a[0];if(Cz(i))return{args:i,keys:null};if(Pz(i)){let d=Az(i);return{args:d.map(c=>i[c]),keys:d}}}return{args:a,keys:null}}function Pz(a){return a&&typeof a=="object"&&Sz(a)===Mz}function Vy(a,i){return a.reduce((d,c,m)=>(d[c]=i[m],d),{})}function M1(...a){let i=pa(a),d=Cy(a),{args:c,keys:m}=By(a);if(c.length===0)return Po([],i);let r=new oi(Rz(c,i,m?T=>Vy(m,T):nl));return d?r.pipe(Vh(d)):r}function Rz(a,i,d=nl){return c=>{cM(i,()=>{let{length:m}=a,r=new Array(m),T=m,M=m;for(let F=0;F<m;F++)cM(i,()=>{let $=Po(a[F],i),Q=!1;$.subscribe(Fi(c,ue=>{r[F]=ue,Q||(Q=!0,M--),M||c.next(d(r.slice()))},()=>{--T||c.complete()}))},c)},c)}}function cM(a,i,d){a?Ao(d,a,i):i()}function uM(a,i,d,c,m,r,T,M){let F=[],$=0,Q=0,ue=!1,Ae=()=>{ue&&!F.length&&!$&&i.complete()},xe=Qe=>$<c?ke(Qe):F.push(Qe),ke=Qe=>{r&&i.next(Qe),$++;let dt=!1;qi(d(Qe,Q++)).subscribe(Fi(i,st=>{m?.(st),r?xe(st):i.next(st)},()=>{dt=!0},void 0,()=>{if(dt)try{for($--;F.length&&$<c;){let st=F.shift();T?Ao(i,T,()=>ke(st)):ke(st)}Ae()}catch(st){i.error(st)}}))};return a.subscribe(Fi(i,xe,()=>{ue=!0,Ae()})),()=>{M?.()}}function rc(a,i,d=1/0){return Pn(i)?rc((c,m)=>Nr((r,T)=>i(c,r,m,T))(qi(a(c,m))),d):(typeof i=="number"&&(d=i),Mi((c,m)=>uM(c,m,a,d)))}function jy(a=1/0){return rc(nl,a)}function dM(){return jy(1)}function jh(...a){return dM()(Po(a,pa(a)))}function A1(...a){let i=Cy(a),{args:d,keys:c}=By(a),m=new oi(r=>{let{length:T}=d;if(!T){r.complete();return}let M=new Array(T),F=T,$=T;for(let Q=0;Q<T;Q++){let ue=!1;qi(d[Q]).subscribe(Fi(r,Ae=>{ue||(ue=!0,$--),M[Q]=Ae},()=>F--,void 0,()=>{(!F||!ue)&&($||r.next(c?Vy(c,M):M),r.complete())}))}});return i?m.pipe(Vh(i)):m}var kz=["addListener","removeListener"],Oz=["addEventListener","removeEventListener"],Fz=["on","off"];function Uh(a,i,d,c){if(Pn(d)&&(c=d,d=void 0),c)return Uh(a,i,d).pipe(Vh(c));let[m,r]=zz(a)?Oz.map(T=>M=>a[T](i,M,d)):Lz(a)?kz.map(hM(a,i)):Nz(a)?Fz.map(hM(a,i)):[];if(!m&&Bh(a))return rc(T=>Uh(T,i,d))(qi(a));if(!m)throw new TypeError("Invalid event target");return new oi(T=>{let M=(...F)=>T.next(1<F.length?F:F[0]);return m(M),()=>r(M)})}function hM(a,i){return d=>c=>a[d](i,c)}function Lz(a){return Pn(a.addListener)&&Pn(a.removeListener)}function Nz(a){return Pn(a.on)&&Pn(a.off)}function zz(a){return Pn(a.addEventListener)&&Pn(a.removeEventListener)}function fM(a=0,i,d=QS){let c=-1;return i!=null&&(Iy(i)?d=i:c=i),new oi(m=>{let r=lM(a)?+a-d.now():a;r<0&&(r=0);let T=0;return d.schedule(function(){m.closed||(m.next(T++),0<=c?this.schedule(void 0,c):m.complete())},r)})}function um(...a){let i=pa(a),d=YS(a,1/0),c=a;return c.length?c.length===1?qi(c[0]):jy(d)(Po(c,i)):Ru}function hs(a,i){return Mi((d,c)=>{let m=0;d.subscribe(Fi(c,r=>a.call(i,r,m++)&&c.next(r)))})}function pM(a){return Mi((i,d)=>{let c=!1,m=null,r=null,T=!1,M=()=>{if(r?.unsubscribe(),r=null,c){c=!1;let $=m;m=null,d.next($)}T&&d.complete()},F=()=>{r=null,T&&d.complete()};i.subscribe(Fi(d,$=>{c=!0,m=$,r||qi(a($)).subscribe(r=Fi(d,M,F))},()=>{T=!0,(!c||!r||r.closed)&&d.complete()}))})}function Uy(a,i=cm){return pM(()=>fM(a,i))}function P1(a,i){return Pn(i)?rc(a,i,1):rc(a,1)}function Gy(a,i=cm){return Mi((d,c)=>{let m=null,r=null,T=null,M=()=>{if(m){m.unsubscribe(),m=null;let $=r;r=null,c.next($)}};function F(){let $=T+a,Q=i.now();if(Q<$){m=this.schedule(void 0,$-Q),c.add(m);return}M()}d.subscribe(Fi(c,$=>{r=$,T=i.now(),m||(m=i.schedule(F,a),c.add(m))},()=>{M(),c.complete()},void 0,()=>{r=m=null}))})}function R1(a){return a<=0?()=>Ru:Mi((i,d)=>{let c=0;i.subscribe(Fi(d,m=>{++c<=a&&(d.next(m),a<=c&&d.complete())}))})}function $y(a,i=nl){return a=a??Bz,Mi((d,c)=>{let m,r=!0;d.subscribe(Fi(c,T=>{let M=i(T);(r||!a(m,M))&&(r=!1,m=M,c.next(T))}))})}function Bz(a,i){return a===i}function Hy(a){return Mi((i,d)=>{try{i.subscribe(d)}finally{d.add(a)}})}function mM(a={}){let{connector:i=()=>new Tn,resetOnError:d=!0,resetOnComplete:c=!0,resetOnRefCountZero:m=!0}=a;return r=>{let T,M,F,$=0,Q=!1,ue=!1,Ae=()=>{M?.unsubscribe(),M=void 0},xe=()=>{Ae(),T=F=void 0,Q=ue=!1},ke=()=>{let Qe=T;xe(),Qe?.unsubscribe()};return Mi((Qe,dt)=>{$++,!ue&&!Q&&Ae();let st=F=F??i();dt.add(()=>{$--,$===0&&!ue&&!Q&&(M=k1(ke,m))}),st.subscribe(dt),!T&&$>0&&(T=new tl({next:Nt=>st.next(Nt),error:Nt=>{ue=!0,Ae(),M=k1(xe,d,Nt),st.error(Nt)},complete:()=>{Q=!0,Ae(),M=k1(xe,c),st.complete()}}),qi(Qe).subscribe(T))})(r)}}function k1(a,i,...d){if(i===!0){a();return}if(i===!1)return;let c=new tl({next:()=>{c.unsubscribe(),a()}});return qi(i(...d)).subscribe(c)}function qy(a,i,d){let c,m=!1;return a&&typeof a=="object"?{bufferSize:c=1/0,windowTime:i=1/0,refCount:m=!1,scheduler:d}=a:c=a??1/0,mM({connector:()=>new wy(c,i,d),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:m})}function dm(a){return hs((i,d)=>a<=d)}function Wy(...a){let i=pa(a);return Mi((d,c)=>{(i?jh(a,d,i):jh(a,d)).subscribe(c)})}function Zy(a,i){return Mi((d,c)=>{let m=null,r=0,T=!1,M=()=>T&&!m&&c.complete();d.subscribe(Fi(c,F=>{m?.unsubscribe();let $=0,Q=r++;qi(a(F,Q)).subscribe(m=Fi(c,ue=>c.next(i?i(F,ue,Q,$++):ue),()=>{m=null,M()}))},()=>{T=!0,M()}))})}function mo(a){return Mi((i,d)=>{qi(a).subscribe(Fi(d,()=>d.complete(),sm)),!d.closed&&i.subscribe(d)})}var Vz="https://g.co/ng/security#xss",kt=class extends Error{constructor(i,d){super(Rv(i,d)),this.code=i}};function Rv(a,i){return`${`NG0${Math.abs(a)}`}${i?": "+i:""}`}function kv(a){return{toString:a}.toString()}var Ws=globalThis;function Li(a){for(let i in a)if(a[i]===Li)return i;throw Error("Could not find renamed property on target object.")}function jz(a,i){for(let d in i)i.hasOwnProperty(d)&&!a.hasOwnProperty(d)&&(a[d]=i[d])}function _o(a){if(typeof a=="string")return a;if(Array.isArray(a))return"["+a.map(_o).join(", ")+"]";if(a==null)return""+a;if(a.overriddenName)return`${a.overriddenName}`;if(a.name)return`${a.name}`;let i=a.toString();if(i==null)return""+i;let d=i.indexOf(`
`);return d===-1?i:i.substring(0,d)}function W1(a,i){return a==null||a===""?i===null?"":i:i==null||i===""?a:a+" "+i}var Uz=Li({__forward_ref__:Li});function Hu(a){return a.__forward_ref__=Hu,a.toString=function(){return _o(this())},a}function go(a){return XM(a)?a():a}function XM(a){return typeof a=="function"&&a.hasOwnProperty(Uz)&&a.__forward_ref__===Hu}function Ft(a){return{token:a.token,providedIn:a.providedIn||null,factory:a.factory,value:void 0}}function Ln(a){return{providers:a.providers||[],imports:a.imports||[]}}function kw(a){return gM(a,KM)||gM(a,JM)}function gM(a,i){return a.hasOwnProperty(i)?a[i]:null}function Gz(a){let i=a&&(a[KM]||a[JM]);return i||null}function _M(a){return a&&(a.hasOwnProperty(yM)||a.hasOwnProperty($z))?a[yM]:null}var KM=Li({\u0275prov:Li}),yM=Li({\u0275inj:Li}),JM=Li({ngInjectableDef:Li}),$z=Li({ngInjectorDef:Li}),Pt=class{constructor(i,d){this._desc=i,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof d=="number"?this.__NG_ELEMENT_ID__=d:d!==void 0&&(this.\u0275prov=Ft({token:this,providedIn:d.providedIn||"root",factory:d.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function eA(a){return a&&!!a.\u0275providers}var Hz=Li({\u0275cmp:Li}),qz=Li({\u0275dir:Li}),Wz=Li({\u0275pipe:Li}),Zz=Li({\u0275mod:Li}),rv=Li({\u0275fac:Li}),hm=Li({__NG_ELEMENT_ID__:Li}),vM=Li({__NG_ENV_ID__:Li});function Ow(a){return typeof a=="string"?a:a==null?"":String(a)}function Qz(a){return typeof a=="function"?a.name||a.toString():typeof a=="object"&&a!=null&&typeof a.type=="function"?a.type.name||a.type.toString():Ow(a)}function Yz(a,i){let d=i?`. Dependency path: ${i.join(" > ")} > ${a}`:"";throw new kt(-200,a)}function Fw(a,i){throw new kt(-201,!1)}var si=function(a){return a[a.Default=0]="Default",a[a.Host=1]="Host",a[a.Self=2]="Self",a[a.SkipSelf=4]="SkipSelf",a[a.Optional=8]="Optional",a}(si||{}),Z1;function tA(){return Z1}function fs(a){let i=Z1;return Z1=a,i}function nA(a,i,d){let c=kw(a);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(d&si.Optional)return null;if(i!==void 0)return i;Fw(a,"Injector")}var Xz={},pm=Xz,Kz="__NG_DI_FLAG__",ov="ngTempTokenPath",Jz="ngTokenPath",e3=/\n/gm,t3="\u0275",bM="__source",qh;function n3(){return qh}function oc(a){let i=qh;return qh=a,i}function i3(a,i=si.Default){if(qh===void 0)throw new kt(-203,!1);return qh===null?nA(a,void 0,i):qh.get(a,i&si.Optional?null:void 0,i)}function Ze(a,i=si.Default){return(tA()||i3)(go(a),i)}function Ot(a,i=si.Default){return Ze(a,Ov(i))}function Ov(a){return typeof a>"u"||typeof a=="number"?a:0|(a.optional&&8)|(a.host&&1)|(a.self&&2)|(a.skipSelf&&4)}function Q1(a){let i=[];for(let d=0;d<a.length;d++){let c=go(a[d]);if(Array.isArray(c)){if(c.length===0)throw new kt(900,!1);let m,r=si.Default;for(let T=0;T<c.length;T++){let M=c[T],F=r3(M);typeof F=="number"?F===-1?m=M.token:r|=F:m=M}i.push(Ze(m,r))}else i.push(Ze(c))}return i}function r3(a){return a[Kz]}function o3(a,i,d,c){let m=a[ov];throw i[bM]&&m.unshift(i[bM]),a.message=s3(`
`+a.message,m,d,c),a[Jz]=m,a[ov]=null,a}function s3(a,i,d,c=null){a=a&&a.charAt(0)===`
`&&a.charAt(1)==t3?a.slice(2):a;let m=_o(i);if(Array.isArray(i))m=i.map(_o).join(" -> ");else if(typeof i=="object"){let r=[];for(let T in i)if(i.hasOwnProperty(T)){let M=i[T];r.push(T+":"+(typeof M=="string"?JSON.stringify(M):_o(M)))}m=`{${r.join(", ")}}`}return`${d}${c?"("+c+")":""}[${m}]: ${a.replace(e3,`
  `)}`}function Zh(a,i){let d=a.hasOwnProperty(rv);return d?a[rv]:null}function a3(a,i,d){if(a.length!==i.length)return!1;for(let c=0;c<a.length;c++){let m=a[c],r=i[c];if(d&&(m=d(m),r=d(r)),r!==m)return!1}return!0}function l3(a){return a.flat(Number.POSITIVE_INFINITY)}function Lw(a,i){a.forEach(d=>Array.isArray(d)?Lw(d,i):i(d))}function iA(a,i,d){i>=a.length?a.push(d):a.splice(i,0,d)}function sv(a,i){return i>=a.length-1?a.pop():a.splice(i,1)[0]}function c3(a,i){let d=[];for(let c=0;c<a;c++)d.push(i);return d}function u3(a,i,d,c){let m=a.length;if(m==i)a.push(d,c);else if(m===1)a.push(c,a[0]),a[0]=d;else{for(m--,a.push(a[m-1],a[m]);m>i;){let r=m-2;a[m]=a[r],m--}a[i]=d,a[i+1]=c}}function Nw(a,i,d){let c=wm(a,i);return c>=0?a[c|1]=d:(c=~c,u3(a,c,i,d)),c}function O1(a,i){let d=wm(a,i);if(d>=0)return a[d|1]}function wm(a,i){return d3(a,i,1)}function d3(a,i,d){let c=0,m=a.length>>d;for(;m!==c;){let r=c+(m-c>>1),T=a[r<<d];if(i===T)return r<<d;T>i?m=r:c=r+1}return~(m<<d)}var Qh={},Ro=[],mm=new Pt(""),rA=new Pt("",-1),oA=new Pt(""),av=class{get(i,d=pm){if(d===pm){let c=new Error(`NullInjectorError: No provider for ${_o(i)}!`);throw c.name="NullInjectorError",c}return d}},sA=function(a){return a[a.OnPush=0]="OnPush",a[a.Default=1]="Default",a}(sA||{}),_a=function(a){return a[a.Emulated=0]="Emulated",a[a.None=2]="None",a[a.ShadowDom=3]="ShadowDom",a}(_a||{}),Yh=function(a){return a[a.None=0]="None",a[a.SignalBased=1]="SignalBased",a[a.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",a}(Yh||{});function h3(a,i,d){let c=a.length;for(;;){let m=a.indexOf(i,d);if(m===-1)return m;if(m===0||a.charCodeAt(m-1)<=32){let r=i.length;if(m+r===c||a.charCodeAt(m+r)<=32)return m}d=m+1}}function Y1(a,i,d){let c=0;for(;c<d.length;){let m=d[c];if(typeof m=="number"){if(m!==0)break;c++;let r=d[c++],T=d[c++],M=d[c++];a.setAttribute(i,T,M,r)}else{let r=m,T=d[++c];p3(r)?a.setProperty(i,r,T):a.setAttribute(i,r,T),c++}}return c}function f3(a){return a===3||a===4||a===6}function p3(a){return a.charCodeAt(0)===64}function gm(a,i){if(!(i===null||i.length===0))if(a===null||a.length===0)a=i.slice();else{let d=-1;for(let c=0;c<i.length;c++){let m=i[c];typeof m=="number"?d=m:d===0||(d===-1||d===2?xM(a,d,m,null,i[++c]):xM(a,d,m,null,null))}}return a}function xM(a,i,d,c,m){let r=0,T=a.length;if(i===-1)T=-1;else for(;r<a.length;){let M=a[r++];if(typeof M=="number"){if(M===i){T=-1;break}else if(M>i){T=r-1;break}}}for(;r<a.length;){let M=a[r];if(typeof M=="number")break;if(M===d){if(c===null){m!==null&&(a[r+1]=m);return}else if(c===a[r+1]){a[r+2]=m;return}}r++,c!==null&&r++,m!==null&&r++}T!==-1&&(a.splice(T,0,i),r=T+1),a.splice(r++,0,d),c!==null&&a.splice(r++,0,c),m!==null&&a.splice(r++,0,m)}var aA="ng-template";function m3(a,i,d,c){let m=0;if(c){for(;m<i.length&&typeof i[m]=="string";m+=2)if(i[m]==="class"&&h3(i[m+1].toLowerCase(),d,0)!==-1)return!0}else if(zw(a))return!1;if(m=i.indexOf(1,m),m>-1){let r;for(;++m<i.length&&typeof(r=i[m])=="string";)if(r.toLowerCase()===d)return!0}return!1}function zw(a){return a.type===4&&a.value!==aA}function g3(a,i,d){let c=a.type===4&&!d?aA:a.value;return i===c}function _3(a,i,d){let c=4,m=a.attrs,r=m!==null?b3(m):0,T=!1;for(let M=0;M<i.length;M++){let F=i[M];if(typeof F=="number"){if(!T&&!$s(c)&&!$s(F))return!1;if(T&&$s(F))continue;T=!1,c=F|c&1;continue}if(!T)if(c&4){if(c=2|c&1,F!==""&&!g3(a,F,d)||F===""&&i.length===1){if($s(c))return!1;T=!0}}else if(c&8){if(m===null||!m3(a,m,F,d)){if($s(c))return!1;T=!0}}else{let $=i[++M],Q=y3(F,m,zw(a),d);if(Q===-1){if($s(c))return!1;T=!0;continue}if($!==""){let ue;if(Q>r?ue="":ue=m[Q+1].toLowerCase(),c&2&&$!==ue){if($s(c))return!1;T=!0}}}}return $s(c)||T}function $s(a){return(a&1)===0}function y3(a,i,d,c){if(i===null)return-1;let m=0;if(c||!d){let r=!1;for(;m<i.length;){let T=i[m];if(T===a)return m;if(T===3||T===6)r=!0;else if(T===1||T===2){let M=i[++m];for(;typeof M=="string";)M=i[++m];continue}else{if(T===4)break;if(T===0){m+=4;continue}}m+=r?1:2}return-1}else return x3(i,a)}function lA(a,i,d=!1){for(let c=0;c<i.length;c++)if(_3(a,i[c],d))return!0;return!1}function v3(a){let i=a.attrs;if(i!=null){let d=i.indexOf(5);if(!(d&1))return i[d+1]}return null}function b3(a){for(let i=0;i<a.length;i++){let d=a[i];if(f3(d))return i}return a.length}function x3(a,i){let d=a.indexOf(4);if(d>-1)for(d++;d<a.length;){let c=a[d];if(typeof c=="number")return-1;if(c===i)return d;d++}return-1}function w3(a,i){e:for(let d=0;d<i.length;d++){let c=i[d];if(a.length===c.length){for(let m=0;m<a.length;m++)if(a[m]!==c[m])continue e;return!0}}return!1}function wM(a,i){return a?":not("+i.trim()+")":i}function E3(a){let i=a[0],d=1,c=2,m="",r=!1;for(;d<a.length;){let T=a[d];if(typeof T=="string")if(c&2){let M=a[++d];m+="["+T+(M.length>0?'="'+M+'"':"")+"]"}else c&8?m+="."+T:c&4&&(m+=" "+T);else m!==""&&!$s(T)&&(i+=wM(r,m),m=""),c=T,r=r||!$s(c);d++}return m!==""&&(i+=wM(r,m)),i}function T3(a){return a.map(E3).join(",")}function D3(a){let i=[],d=[],c=1,m=2;for(;c<a.length;){let r=a[c];if(typeof r=="string")m===2?r!==""&&i.push(r,a[++c]):m===8&&d.push(r);else{if(!$s(m))break;m=r}c++}return{attrs:i,classes:d}}function zr(a){return kv(()=>{let i=dA(a),d=tr(Yt({},i),{decls:a.decls,vars:a.vars,template:a.template,consts:a.consts||null,ngContentSelectors:a.ngContentSelectors,onPush:a.changeDetection===sA.OnPush,directiveDefs:null,pipeDefs:null,dependencies:i.standalone&&a.dependencies||null,getStandaloneInjector:null,signals:a.signals??!1,data:a.data||{},encapsulation:a.encapsulation||_a.Emulated,styles:a.styles||Ro,_:null,schemas:a.schemas||null,tView:null,id:""});hA(d);let c=a.dependencies;return d.directiveDefs=TM(c,!1),d.pipeDefs=TM(c,!0),d.id=A3(d),d})}function I3(a){return Xh(a)||cA(a)}function C3(a){return a!==null}function Nn(a){return kv(()=>({type:a.type,bootstrap:a.bootstrap||Ro,declarations:a.declarations||Ro,imports:a.imports||Ro,exports:a.exports||Ro,transitiveCompileScopes:null,schemas:a.schemas||null,id:a.id||null}))}function EM(a,i){if(a==null)return Qh;let d={};for(let c in a)if(a.hasOwnProperty(c)){let m=a[c],r,T,M=Yh.None;Array.isArray(m)?(M=m[0],r=m[1],T=m[2]??r):(r=m,T=m),i?(d[r]=M!==Yh.None?[c,M]:c,i[r]=T):d[r]=c}return d}function ui(a){return kv(()=>{let i=dA(a);return hA(i),i})}function Xh(a){return a[Hz]||null}function cA(a){return a[qz]||null}function uA(a){return a[Wz]||null}function S3(a){let i=Xh(a)||cA(a)||uA(a);return i!==null?i.standalone:!1}function M3(a,i){let d=a[Zz]||null;if(!d&&i===!0)throw new Error(`Type ${_o(a)} does not have '\u0275mod' property.`);return d}function dA(a){let i={};return{type:a.type,providersResolver:null,factory:null,hostBindings:a.hostBindings||null,hostVars:a.hostVars||0,hostAttrs:a.hostAttrs||null,contentQueries:a.contentQueries||null,declaredInputs:i,inputTransforms:null,inputConfig:a.inputs||Qh,exportAs:a.exportAs||null,standalone:a.standalone===!0,signals:a.signals===!0,selectors:a.selectors||Ro,viewQuery:a.viewQuery||null,features:a.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:EM(a.inputs,i),outputs:EM(a.outputs),debugInfo:null}}function hA(a){a.features?.forEach(i=>i(a))}function TM(a,i){if(!a)return null;let d=i?uA:I3;return()=>(typeof a=="function"?a():a).map(c=>d(c)).filter(C3)}function A3(a){let i=0,d=[a.selectors,a.ngContentSelectors,a.hostVars,a.hostAttrs,a.consts,a.vars,a.decls,a.encapsulation,a.standalone,a.signals,a.exportAs,JSON.stringify(a.inputs),JSON.stringify(a.outputs),Object.getOwnPropertyNames(a.type.prototype),!!a.contentQueries,!!a.viewQuery].join("|");for(let m of d)i=Math.imul(31,i)+m.charCodeAt(0)<<0;return i+=2147483648,"c"+i}function Bw(a){return{\u0275providers:a}}function P3(...a){return{\u0275providers:fA(!0,a),\u0275fromNgModule:!0}}function fA(a,...i){let d=[],c=new Set,m,r=T=>{d.push(T)};return Lw(i,T=>{let M=T;X1(M,r,[],c)&&(m||=[],m.push(M))}),m!==void 0&&pA(m,r),d}function pA(a,i){for(let d=0;d<a.length;d++){let{ngModule:c,providers:m}=a[d];Vw(m,r=>{i(r,c)})}}function X1(a,i,d,c){if(a=go(a),!a)return!1;let m=null,r=_M(a),T=!r&&Xh(a);if(!r&&!T){let F=a.ngModule;if(r=_M(F),r)m=F;else return!1}else{if(T&&!T.standalone)return!1;m=a}let M=c.has(m);if(T){if(M)return!1;if(c.add(m),T.dependencies){let F=typeof T.dependencies=="function"?T.dependencies():T.dependencies;for(let $ of F)X1($,i,d,c)}}else if(r){if(r.imports!=null&&!M){c.add(m);let $;try{Lw(r.imports,Q=>{X1(Q,i,d,c)&&($||=[],$.push(Q))})}finally{}$!==void 0&&pA($,i)}if(!M){let $=Zh(m)||(()=>new m);i({provide:m,useFactory:$,deps:Ro},m),i({provide:oA,useValue:m,multi:!0},m),i({provide:mm,useValue:()=>Ze(m),multi:!0},m)}let F=r.providers;if(F!=null&&!M){let $=a;Vw(F,Q=>{i(Q,$)})}}else return!1;return m!==a&&a.providers!==void 0}function Vw(a,i){for(let d of a)eA(d)&&(d=d.\u0275providers),Array.isArray(d)?Vw(d,i):i(d)}var R3=Li({provide:String,useValue:Li});function mA(a){return a!==null&&typeof a=="object"&&R3 in a}function k3(a){return!!(a&&a.useExisting)}function O3(a){return!!(a&&a.useFactory)}function Kh(a){return typeof a=="function"}function F3(a){return!!a.useClass}var Fv=new Pt(""),Ky={},L3={},F1;function jw(){return F1===void 0&&(F1=new av),F1}var ms=class{},_m=class extends ms{get destroyed(){return this._destroyed}constructor(i,d,c,m){super(),this.parent=d,this.source=c,this.scopes=m,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,J1(i,T=>this.processProvider(T)),this.records.set(rA,Gh(void 0,this)),m.has("environment")&&this.records.set(ms,Gh(void 0,this));let r=this.records.get(Fv);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(oA,Ro,si.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let i=ci(null);try{for(let c of this._ngOnDestroyHooks)c.ngOnDestroy();let d=this._onDestroyHooks;this._onDestroyHooks=[];for(let c of d)c()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),ci(i)}}onDestroy(i){return this.assertNotDestroyed(),this._onDestroyHooks.push(i),()=>this.removeOnDestroy(i)}runInContext(i){this.assertNotDestroyed();let d=oc(this),c=fs(void 0),m;try{return i()}finally{oc(d),fs(c)}}get(i,d=pm,c=si.Default){if(this.assertNotDestroyed(),i.hasOwnProperty(vM))return i[vM](this);c=Ov(c);let m,r=oc(this),T=fs(void 0);try{if(!(c&si.SkipSelf)){let F=this.records.get(i);if(F===void 0){let $=j3(i)&&kw(i);$&&this.injectableDefInScope($)?F=Gh(K1(i),Ky):F=null,this.records.set(i,F)}if(F!=null)return this.hydrate(i,F)}let M=c&si.Self?jw():this.parent;return d=c&si.Optional&&d===pm?null:d,M.get(i,d)}catch(M){if(M.name==="NullInjectorError"){if((M[ov]=M[ov]||[]).unshift(_o(i)),r)throw M;return o3(M,i,"R3InjectorError",this.source)}else throw M}finally{fs(T),oc(r)}}resolveInjectorInitializers(){let i=ci(null),d=oc(this),c=fs(void 0),m;try{let r=this.get(mm,Ro,si.Self);for(let T of r)T()}finally{oc(d),fs(c),ci(i)}}toString(){let i=[],d=this.records;for(let c of d.keys())i.push(_o(c));return`R3Injector[${i.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new kt(205,!1)}processProvider(i){i=go(i);let d=Kh(i)?i:go(i&&i.provide),c=z3(i);if(!Kh(i)&&i.multi===!0){let m=this.records.get(d);m||(m=Gh(void 0,Ky,!0),m.factory=()=>Q1(m.multi),this.records.set(d,m)),d=i,m.multi.push(i)}this.records.set(d,c)}hydrate(i,d){let c=ci(null);try{return d.value===Ky&&(d.value=L3,d.value=d.factory()),typeof d.value=="object"&&d.value&&V3(d.value)&&this._ngOnDestroyHooks.add(d.value),d.value}finally{ci(c)}}injectableDefInScope(i){if(!i.providedIn)return!1;let d=go(i.providedIn);return typeof d=="string"?d==="any"||this.scopes.has(d):this.injectorDefTypes.has(d)}removeOnDestroy(i){let d=this._onDestroyHooks.indexOf(i);d!==-1&&this._onDestroyHooks.splice(d,1)}};function K1(a){let i=kw(a),d=i!==null?i.factory:Zh(a);if(d!==null)return d;if(a instanceof Pt)throw new kt(204,!1);if(a instanceof Function)return N3(a);throw new kt(204,!1)}function N3(a){if(a.length>0)throw new kt(204,!1);let d=Gz(a);return d!==null?()=>d.factory(a):()=>new a}function z3(a){if(mA(a))return Gh(void 0,a.useValue);{let i=gA(a);return Gh(i,Ky)}}function gA(a,i,d){let c;if(Kh(a)){let m=go(a);return Zh(m)||K1(m)}else if(mA(a))c=()=>go(a.useValue);else if(O3(a))c=()=>a.useFactory(...Q1(a.deps||[]));else if(k3(a))c=()=>Ze(go(a.useExisting));else{let m=go(a&&(a.useClass||a.provide));if(B3(a))c=()=>new m(...Q1(a.deps));else return Zh(m)||K1(m)}return c}function Gh(a,i,d=!1){return{factory:a,value:i,multi:d?[]:void 0}}function B3(a){return!!a.deps}function V3(a){return a!==null&&typeof a=="object"&&typeof a.ngOnDestroy=="function"}function j3(a){return typeof a=="function"||typeof a=="object"&&a instanceof Pt}function J1(a,i){for(let d of a)Array.isArray(d)?J1(d,i):d&&eA(d)?J1(d.\u0275providers,i):i(d)}function Lv(a,i){a instanceof _m&&a.assertNotDestroyed();let d,c=oc(a),m=fs(void 0);try{return i()}finally{oc(c),fs(m)}}function _A(){return tA()!==void 0||n3()!=null}function yA(a){if(!_A())throw new kt(-203,!1)}function U3(a){let i=Ws.ng;if(i&&i.\u0275compilerFacade)return i.\u0275compilerFacade;throw new Error("JIT compiler unavailable")}function G3(a){return typeof a=="function"}var xa=0,Fn=1,Dn=2,io=3,qs=4,Fo=5,ym=6,lv=7,gs=8,Jh=9,il=10,Ji=11,vm=12,DM=13,of=14,_s=15,Nu=16,$h=17,rl=18,Nv=19,vA=20,sc=21,L1=22,ps=23,Oo=25,Uw=1;var zu=7,cv=8,ef=9,ko=10,uv=function(a){return a[a.None=0]="None",a[a.HasTransplantedViews=2]="HasTransplantedViews",a}(uv||{});function ac(a){return Array.isArray(a)&&typeof a[Uw]=="object"}function al(a){return Array.isArray(a)&&a[Uw]===!0}function Gw(a){return(a.flags&4)!==0}function zv(a){return a.componentOffset>-1}function Bv(a){return(a.flags&1)===1}function ol(a){return!!a.template}function ew(a){return(a[Dn]&512)!==0}var tw=class{constructor(i,d,c){this.previousValue=i,this.currentValue=d,this.firstChange=c}isFirstChange(){return this.firstChange}};function bA(a,i,d,c){i!==null?i.applyValueToInputSignal(i,c):a[d]=c}function Xo(){return xA}function xA(a){return a.type.prototype.ngOnChanges&&(a.setInput=H3),$3}Xo.ngInherit=!0;function $3(){let a=EA(this),i=a?.current;if(i){let d=a.previous;if(d===Qh)a.previous=i;else for(let c in i)d[c]=i[c];a.current=null,this.ngOnChanges(i)}}function H3(a,i,d,c,m){let r=this.declaredInputs[c],T=EA(a)||q3(a,{previous:Qh,current:null}),M=T.current||(T.current={}),F=T.previous,$=F[r];M[r]=new tw($&&$.currentValue,d,F===Qh),bA(a,i,m,d)}var wA="__ngSimpleChanges__";function EA(a){return a[wA]||null}function q3(a,i){return a[wA]=i}var IM=null;var ma=function(a,i,d){IM?.(a,i,d)},TA="svg",W3="math";function ya(a){for(;Array.isArray(a);)a=a[xa];return a}function Z3(a){for(;Array.isArray(a);){if(typeof a[Uw]=="object")return a;a=a[xa]}return null}function DA(a,i){return ya(i[a])}function ys(a,i){return ya(i[a.index])}function $w(a,i){return a.data[i]}function Q3(a,i){return a[i]}function dc(a,i){let d=i[a];return ac(d)?d:d[xa]}function Y3(a){return(a[Dn]&4)===4}function Hw(a){return(a[Dn]&128)===128}function X3(a){return al(a[io])}function tf(a,i){return i==null?null:a[i]}function IA(a){a[$h]=0}function CA(a){a[Dn]&1024||(a[Dn]|=1024,Hw(a)&&Vv(a))}function K3(a,i){for(;a>0;)i=i[of],a--;return i}function bm(a){return!!(a[Dn]&9216||a[ps]?.dirty)}function nw(a){a[il].changeDetectionScheduler?.notify(7),a[Dn]&64&&(a[Dn]|=1024),bm(a)&&Vv(a)}function Vv(a){a[il].changeDetectionScheduler?.notify(0);let i=Bu(a);for(;i!==null&&!(i[Dn]&8192||(i[Dn]|=8192,!Hw(i)));)i=Bu(i)}function SA(a,i){if((a[Dn]&256)===256)throw new kt(911,!1);a[sc]===null&&(a[sc]=[]),a[sc].push(i)}function J3(a,i){if(a[sc]===null)return;let d=a[sc].indexOf(i);d!==-1&&a[sc].splice(d,1)}function Bu(a){let i=a[io];return al(i)?i[io]:i}var Un={lFrame:zA(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var MA=!1;function eB(){return Un.lFrame.elementDepthCount}function tB(){Un.lFrame.elementDepthCount++}function nB(){Un.lFrame.elementDepthCount--}function AA(){return Un.bindingsEnabled}function PA(){return Un.skipHydrationRootTNode!==null}function iB(a){return Un.skipHydrationRootTNode===a}function rB(){Un.skipHydrationRootTNode=null}function ai(){return Un.lFrame.lView}function ir(){return Un.lFrame.tView}function jv(a){return Un.lFrame.contextLView=a,a[gs]}function Uv(a){return Un.lFrame.contextLView=null,a}function Hr(){let a=RA();for(;a!==null&&a.type===64;)a=a.parent;return a}function RA(){return Un.lFrame.currentTNode}function oB(){let a=Un.lFrame,i=a.currentTNode;return a.isParent?i:i.parent}function qu(a,i){let d=Un.lFrame;d.currentTNode=a,d.isParent=i}function qw(){return Un.lFrame.isParent}function Ww(){Un.lFrame.isParent=!1}function sB(){return Un.lFrame.contextLView}function kA(){return MA}function CM(a){MA=a}function aB(a){return Un.lFrame.bindingIndex=a}function Wu(){return Un.lFrame.bindingIndex++}function OA(a){let i=Un.lFrame,d=i.bindingIndex;return i.bindingIndex=i.bindingIndex+a,d}function lB(){return Un.lFrame.inI18n}function cB(a,i){let d=Un.lFrame;d.bindingIndex=d.bindingRootIndex=a,iw(i)}function uB(){return Un.lFrame.currentDirectiveIndex}function iw(a){Un.lFrame.currentDirectiveIndex=a}function Zw(a){let i=Un.lFrame.currentDirectiveIndex;return i===-1?null:a[i]}function FA(){return Un.lFrame.currentQueryIndex}function Qw(a){Un.lFrame.currentQueryIndex=a}function dB(a){let i=a[Fn];return i.type===2?i.declTNode:i.type===1?a[Fo]:null}function LA(a,i,d){if(d&si.SkipSelf){let m=i,r=a;for(;m=m.parent,m===null&&!(d&si.Host);)if(m=dB(r),m===null||(r=r[of],m.type&10))break;if(m===null)return!1;i=m,a=r}let c=Un.lFrame=NA();return c.currentTNode=i,c.lView=a,!0}function Yw(a){let i=NA(),d=a[Fn];Un.lFrame=i,i.currentTNode=d.firstChild,i.lView=a,i.tView=d,i.contextLView=a,i.bindingIndex=d.bindingStartIndex,i.inI18n=!1}function NA(){let a=Un.lFrame,i=a===null?null:a.child;return i===null?zA(a):i}function zA(a){let i={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:a,child:null,inI18n:!1};return a!==null&&(a.child=i),i}function BA(){let a=Un.lFrame;return Un.lFrame=a.parent,a.currentTNode=null,a.lView=null,a}var VA=BA;function Xw(){let a=BA();a.isParent=!0,a.tView=null,a.selectedIndex=-1,a.contextLView=null,a.elementDepthCount=0,a.currentDirectiveIndex=-1,a.currentNamespace=null,a.bindingRootIndex=-1,a.bindingIndex=-1,a.currentQueryIndex=0}function hB(a){return(Un.lFrame.contextLView=K3(a,Un.lFrame.contextLView))[gs]}function Zu(){return Un.lFrame.selectedIndex}function Vu(a){Un.lFrame.selectedIndex=a}function Em(){let a=Un.lFrame;return $w(a.tView,a.selectedIndex)}function Kw(){Un.lFrame.currentNamespace=TA}function jA(){fB()}function fB(){Un.lFrame.currentNamespace=null}function pB(){return Un.lFrame.currentNamespace}var UA=!0;function Gv(){return UA}function $v(a){UA=a}function mB(a,i,d){let{ngOnChanges:c,ngOnInit:m,ngDoCheck:r}=i.type.prototype;if(c){let T=xA(i);(d.preOrderHooks??=[]).push(a,T),(d.preOrderCheckHooks??=[]).push(a,T)}m&&(d.preOrderHooks??=[]).push(0-a,m),r&&((d.preOrderHooks??=[]).push(a,r),(d.preOrderCheckHooks??=[]).push(a,r))}function Hv(a,i){for(let d=i.directiveStart,c=i.directiveEnd;d<c;d++){let r=a.data[d].type.prototype,{ngAfterContentInit:T,ngAfterContentChecked:M,ngAfterViewInit:F,ngAfterViewChecked:$,ngOnDestroy:Q}=r;T&&(a.contentHooks??=[]).push(-d,T),M&&((a.contentHooks??=[]).push(d,M),(a.contentCheckHooks??=[]).push(d,M)),F&&(a.viewHooks??=[]).push(-d,F),$&&((a.viewHooks??=[]).push(d,$),(a.viewCheckHooks??=[]).push(d,$)),Q!=null&&(a.destroyHooks??=[]).push(d,Q)}}function Jy(a,i,d){GA(a,i,3,d)}function ev(a,i,d,c){(a[Dn]&3)===d&&GA(a,i,d,c)}function N1(a,i){let d=a[Dn];(d&3)===i&&(d&=16383,d+=1,a[Dn]=d)}function GA(a,i,d,c){let m=c!==void 0?a[$h]&65535:0,r=c??-1,T=i.length-1,M=0;for(let F=m;F<T;F++)if(typeof i[F+1]=="number"){if(M=i[F],c!=null&&M>=c)break}else i[F]<0&&(a[$h]+=65536),(M<r||r==-1)&&(gB(a,d,i,F),a[$h]=(a[$h]&4294901760)+F+2),F++}function SM(a,i){ma(4,a,i);let d=ci(null);try{i.call(a)}finally{ci(d),ma(5,a,i)}}function gB(a,i,d,c){let m=d[c]<0,r=d[c+1],T=m?-d[c]:d[c],M=a[T];m?a[Dn]>>14<a[$h]>>16&&(a[Dn]&3)===i&&(a[Dn]+=16384,SM(M,r)):SM(M,r)}var Wh=-1,ju=class{constructor(i,d,c){this.factory=i,this.resolving=!1,this.canSeeViewProviders=d,this.injectImpl=c}};function _B(a){return a instanceof ju}function yB(a){return(a.flags&8)!==0}function vB(a){return(a.flags&16)!==0}var z1={},rw=class{constructor(i,d){this.injector=i,this.parentInjector=d}get(i,d,c){c=Ov(c);let m=this.injector.get(i,z1,c);return m!==z1||d===z1?m:this.parentInjector.get(i,d,c)}};function $A(a){return a!==Wh}function dv(a){return a&32767}function bB(a){return a>>16}function hv(a,i){let d=bB(a),c=i;for(;d>0;)c=c[of],d--;return c}var ow=!0;function MM(a){let i=ow;return ow=a,i}var xB=256,HA=xB-1,qA=5,wB=0,ga={};function EB(a,i,d){let c;typeof d=="string"?c=d.charCodeAt(0)||0:d.hasOwnProperty(hm)&&(c=d[hm]),c==null&&(c=d[hm]=wB++);let m=c&HA,r=1<<m;i.data[a+(m>>qA)]|=r}function fv(a,i){let d=WA(a,i);if(d!==-1)return d;let c=i[Fn];c.firstCreatePass&&(a.injectorIndex=i.length,B1(c.data,a),B1(i,null),B1(c.blueprint,null));let m=Jw(a,i),r=a.injectorIndex;if($A(m)){let T=dv(m),M=hv(m,i),F=M[Fn].data;for(let $=0;$<8;$++)i[r+$]=M[T+$]|F[T+$]}return i[r+8]=m,r}function B1(a,i){a.push(0,0,0,0,0,0,0,0,i)}function WA(a,i){return a.injectorIndex===-1||a.parent&&a.parent.injectorIndex===a.injectorIndex||i[a.injectorIndex+8]===null?-1:a.injectorIndex}function Jw(a,i){if(a.parent&&a.parent.injectorIndex!==-1)return a.parent.injectorIndex;let d=0,c=null,m=i;for(;m!==null;){if(c=KA(m),c===null)return Wh;if(d++,m=m[of],c.injectorIndex!==-1)return c.injectorIndex|d<<16}return Wh}function sw(a,i,d){EB(a,i,d)}function ZA(a,i,d){if(d&si.Optional||a!==void 0)return a;Fw(i,"NodeInjector")}function QA(a,i,d,c){if(d&si.Optional&&c===void 0&&(c=null),!(d&(si.Self|si.Host))){let m=a[Jh],r=fs(void 0);try{return m?m.get(i,c,d&si.Optional):nA(i,c,d&si.Optional)}finally{fs(r)}}return ZA(c,i,d)}function YA(a,i,d,c=si.Default,m){if(a!==null){if(i[Dn]&2048&&!(c&si.Self)){let T=CB(a,i,d,c,ga);if(T!==ga)return T}let r=XA(a,i,d,c,ga);if(r!==ga)return r}return QA(i,d,c,m)}function XA(a,i,d,c,m){let r=DB(d);if(typeof r=="function"){if(!LA(i,a,c))return c&si.Host?ZA(m,d,c):QA(i,d,c,m);try{let T;if(T=r(c),T==null&&!(c&si.Optional))Fw(d);else return T}finally{VA()}}else if(typeof r=="number"){let T=null,M=WA(a,i),F=Wh,$=c&si.Host?i[_s][Fo]:null;for((M===-1||c&si.SkipSelf)&&(F=M===-1?Jw(a,i):i[M+8],F===Wh||!PM(c,!1)?M=-1:(T=i[Fn],M=dv(F),i=hv(F,i)));M!==-1;){let Q=i[Fn];if(AM(r,M,Q.data)){let ue=TB(M,i,d,T,c,$);if(ue!==ga)return ue}F=i[M+8],F!==Wh&&PM(c,i[Fn].data[M+8]===$)&&AM(r,M,i)?(T=Q,M=dv(F),i=hv(F,i)):M=-1}}return m}function TB(a,i,d,c,m,r){let T=i[Fn],M=T.data[a+8],F=c==null?zv(M)&&ow:c!=T&&(M.type&3)!==0,$=m&si.Host&&r===M,Q=tv(M,T,d,F,$);return Q!==null?Uu(i,T,Q,M):ga}function tv(a,i,d,c,m){let r=a.providerIndexes,T=i.data,M=r&1048575,F=a.directiveStart,$=a.directiveEnd,Q=r>>20,ue=c?M:M+Q,Ae=m?M+Q:$;for(let xe=ue;xe<Ae;xe++){let ke=T[xe];if(xe<F&&d===ke||xe>=F&&ke.type===d)return xe}if(m){let xe=T[F];if(xe&&ol(xe)&&xe.type===d)return F}return null}function Uu(a,i,d,c){let m=a[d],r=i.data;if(_B(m)){let T=m;T.resolving&&Yz(Qz(r[d]));let M=MM(T.canSeeViewProviders);T.resolving=!0;let F,$=T.injectImpl?fs(T.injectImpl):null,Q=LA(a,c,si.Default);try{m=a[d]=T.factory(void 0,r,a,c),i.firstCreatePass&&d>=c.directiveStart&&mB(d,r[d],i)}finally{$!==null&&fs($),MM(M),T.resolving=!1,VA()}}return m}function DB(a){if(typeof a=="string")return a.charCodeAt(0)||0;let i=a.hasOwnProperty(hm)?a[hm]:void 0;return typeof i=="number"?i>=0?i&HA:IB:i}function AM(a,i,d){let c=1<<a;return!!(d[i+(a>>qA)]&c)}function PM(a,i){return!(a&si.Self)&&!(a&si.Host&&i)}var Lu=class{constructor(i,d){this._tNode=i,this._lView=d}get(i,d,c){return YA(this._tNode,this._lView,i,Ov(c),d)}};function IB(){return new Lu(Hr(),ai())}function eE(a){return kv(()=>{let i=a.prototype.constructor,d=i[rv]||aw(i),c=Object.prototype,m=Object.getPrototypeOf(a.prototype).constructor;for(;m&&m!==c;){let r=m[rv]||aw(m);if(r&&r!==d)return r;m=Object.getPrototypeOf(m)}return r=>new r})}function aw(a){return XM(a)?()=>{let i=aw(go(a));return i&&i()}:Zh(a)}function CB(a,i,d,c,m){let r=a,T=i;for(;r!==null&&T!==null&&T[Dn]&2048&&!(T[Dn]&512);){let M=XA(r,T,d,c|si.Self,ga);if(M!==ga)return M;let F=r.parent;if(!F){let $=T[vA];if($){let Q=$.get(d,ga,c);if(Q!==ga)return Q}F=KA(T),T=T[of]}r=F}return m}function KA(a){let i=a[Fn],d=i.type;return d===2?i.declTNode:d===1?a[Fo]:null}function RM(a,i=null,d=null,c){let m=JA(a,i,d,c);return m.resolveInjectorInitializers(),m}function JA(a,i=null,d=null,c,m=new Set){let r=[d||Ro,P3(a)];return c=c||(typeof a=="object"?void 0:_o(a)),new _m(r,i||jw(),c||null,m)}var Ou=class Ou{static create(i,d){if(Array.isArray(i))return RM({name:""},d,i,"");{let c=i.name??"";return RM({name:c},i.parent,i.providers,c)}}};Ou.THROW_IF_NOT_FOUND=pm,Ou.NULL=new av,Ou.\u0275prov=Ft({token:Ou,providedIn:"any",factory:()=>Ze(rA)}),Ou.__NG_ELEMENT_ID__=-1;var nr=Ou;var SB=new Pt("");SB.__NG_ELEMENT_ID__=a=>{let i=Hr();if(i===null)throw new kt(204,!1);if(i.type&2)return i.value;if(a&si.Optional)return null;throw new kt(204,!1)};var MB="ngOriginalError";function V1(a){return a[MB]}var va=class{constructor(){this._console=console}handleError(i){let d=this._findOriginalError(i);this._console.error("ERROR",i),d&&this._console.error("ORIGINAL ERROR",d)}_findOriginalError(i){let d=i&&V1(i);for(;d&&V1(d);)d=V1(d);return d||null}},e2=new Pt("",{providedIn:"root",factory:()=>Ot(va).handleError.bind(void 0)}),qv=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=AB,i.__NG_ENV_ID__=c=>c;let a=i;return a})(),lw=class extends qv{constructor(i){super(),this._lView=i}onDestroy(i){return SA(this._lView,i),()=>J3(this._lView,i)}};function AB(){return new lw(ai())}function PB(){return sf(Hr(),ai())}function sf(a,i){return new ti(ys(a,i))}var ti=(()=>{let i=class i{constructor(c){this.nativeElement=c}};i.__NG_ELEMENT_ID__=PB;let a=i;return a})();function RB(a){return a instanceof ti?a.nativeElement:a}var Qu=(()=>{let i=class i{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Pu(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};i.\u0275prov=Ft({token:i,providedIn:"root",factory:()=>new i});let a=i;return a})();var cw=class extends Tn{constructor(i=!1){super(),this.destroyRef=void 0,this.pendingTasks=void 0,this.__isAsync=i,_A()&&(this.destroyRef=Ot(qv,{optional:!0})??void 0,this.pendingTasks=Ot(Qu,{optional:!0})??void 0)}emit(i){let d=ci(null);try{super.next(i)}finally{ci(d)}}subscribe(i,d,c){let m=i,r=d||(()=>null),T=c;if(i&&typeof i=="object"){let F=i;m=F.next?.bind(F),r=F.error?.bind(F),T=F.complete?.bind(F)}this.__isAsync&&(r=this.wrapInTimeout(r),m&&(m=this.wrapInTimeout(m)),T&&(T=this.wrapInTimeout(T)));let M=super.subscribe({next:m,error:r,complete:T});return i instanceof Ki&&i.add(M),M}wrapInTimeout(i){return d=>{let c=this.pendingTasks?.add();setTimeout(()=>{i(d),c!==void 0&&this.pendingTasks?.remove(c)})}}},Ui=cw;function kB(){return this._results[Symbol.iterator]()}var pv=class a{get changes(){return this._changes??=new Ui}constructor(i=!1){this._emitDistinctChangesOnly=i,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;let d=a.prototype;d[Symbol.iterator]||(d[Symbol.iterator]=kB)}get(i){return this._results[i]}map(i){return this._results.map(i)}filter(i){return this._results.filter(i)}find(i){return this._results.find(i)}reduce(i,d){return this._results.reduce(i,d)}forEach(i){this._results.forEach(i)}some(i){return this._results.some(i)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(i,d){this.dirty=!1;let c=l3(i);(this._changesDetected=!a3(this._results,c,d))&&(this._results=c,this.length=c.length,this.last=c[this.length-1],this.first=c[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(i){this._onDirty=i}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}};function t2(a){return(a.flags&128)===128}var n2=new Map,OB=0;function FB(){return OB++}function LB(a){n2.set(a[Nv],a)}function NB(a){n2.delete(a[Nv])}var kM="__ngContext__";function lc(a,i){ac(i)?(a[kM]=i[Nv],LB(i)):a[kM]=i}function i2(a){return o2(a[vm])}function r2(a){return o2(a[qs])}function o2(a){for(;a!==null&&!al(a);)a=a[qs];return a}var uw;function s2(a){uw=a}function zB(){if(uw!==void 0)return uw;if(typeof document<"u")return document;throw new kt(210,!1)}var Tm=new Pt("",{providedIn:"root",factory:()=>BB}),BB="ng",tE=new Pt(""),Qs=new Pt("",{providedIn:"platform",factory:()=>"unknown"});var Lo=new Pt(""),Dm=new Pt("",{providedIn:"root",factory:()=>zB().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var VB="h",jB="b";var UB=()=>null;function nE(a,i,d=!1){return UB(a,i,d)}var a2=!1,GB=new Pt("",{providedIn:"root",factory:()=>a2});var dw=class{constructor(i){this.changingThisBreaksApplicationSecurity=i}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Vz})`}};function Wv(a){return a instanceof dw?a.changingThisBreaksApplicationSecurity:a}var $B=/^>|^->|<!--|-->|--!>|<!-$/g,HB=/(<|>)/g,qB="\u200B$1\u200B";function WB(a){return a.replace($B,i=>i.replace(HB,qB))}function ZB(a){return a instanceof Function?a():a}function l2(a){return(a??Ot(nr)).get(Qs)==="browser"}var sl=function(a){return a[a.Important=1]="Important",a[a.DashCase=2]="DashCase",a}(sl||{}),QB;function iE(a,i){return QB(a,i)}function Hh(a,i,d,c,m){if(c!=null){let r,T=!1;al(c)?r=c:ac(c)&&(T=!0,c=c[xa]);let M=ya(c);a===0&&d!==null?m==null?f2(i,d,M):gv(i,d,M,m||null,!0):a===1&&d!==null?gv(i,d,M,m||null,!0):a===2?uV(i,M,T):a===3&&i.destroyNode(M),r!=null&&hV(i,a,r,d,m)}}function YB(a,i){return a.createText(i)}function XB(a,i,d){a.setValue(i,d)}function KB(a,i){return a.createComment(WB(i))}function c2(a,i,d){return a.createElement(i,d)}function JB(a,i){u2(a,i),i[xa]=null,i[Fo]=null}function eV(a,i,d,c,m,r){c[xa]=m,c[Fo]=i,Qv(a,c,d,1,m,r)}function u2(a,i){i[il].changeDetectionScheduler?.notify(8),Qv(a,i,i[Ji],2,null,null)}function tV(a){let i=a[vm];if(!i)return j1(a[Fn],a);for(;i;){let d=null;if(ac(i))d=i[vm];else{let c=i[ko];c&&(d=c)}if(!d){for(;i&&!i[qs]&&i!==a;)ac(i)&&j1(i[Fn],i),i=i[io];i===null&&(i=a),ac(i)&&j1(i[Fn],i),d=i&&i[qs]}i=d}}function nV(a,i,d,c){let m=ko+c,r=d.length;c>0&&(d[m-1][qs]=i),c<r-ko?(i[qs]=d[m],iA(d,ko+c,i)):(d.push(i),i[qs]=null),i[io]=d;let T=i[Nu];T!==null&&d!==T&&d2(T,i);let M=i[rl];M!==null&&M.insertView(a),nw(i),i[Dn]|=128}function d2(a,i){let d=a[ef],c=i[io];if(ac(c))a[Dn]|=uv.HasTransplantedViews;else{let m=c[io][_s];i[_s]!==m&&(a[Dn]|=uv.HasTransplantedViews)}d===null?a[ef]=[i]:d.push(i)}function rE(a,i){let d=a[ef],c=d.indexOf(i);d.splice(c,1)}function mv(a,i){if(a.length<=ko)return;let d=ko+i,c=a[d];if(c){let m=c[Nu];m!==null&&m!==a&&rE(m,c),i>0&&(a[d-1][qs]=c[qs]);let r=sv(a,ko+i);JB(c[Fn],c);let T=r[rl];T!==null&&T.detachView(r[Fn]),c[io]=null,c[qs]=null,c[Dn]&=-129}return c}function oE(a,i){if(!(i[Dn]&256)){let d=i[Ji];d.destroyNode&&Qv(a,i,d,3,null,null),tV(i)}}function j1(a,i){if(i[Dn]&256)return;let d=ci(null);try{i[Dn]&=-129,i[Dn]|=256,i[ps]&&y1(i[ps]),rV(a,i),iV(a,i),i[Fn].type===1&&i[Ji].destroy();let c=i[Nu];if(c!==null&&al(i[io])){c!==i[io]&&rE(c,i);let m=i[rl];m!==null&&m.detachView(a)}NB(i)}finally{ci(d)}}function iV(a,i){let d=a.cleanup,c=i[lv];if(d!==null)for(let r=0;r<d.length-1;r+=2)if(typeof d[r]=="string"){let T=d[r+3];T>=0?c[T]():c[-T].unsubscribe(),r+=2}else{let T=c[d[r+1]];d[r].call(T)}c!==null&&(i[lv]=null);let m=i[sc];if(m!==null){i[sc]=null;for(let r=0;r<m.length;r++){let T=m[r];T()}}}function rV(a,i){let d;if(a!=null&&(d=a.destroyHooks)!=null)for(let c=0;c<d.length;c+=2){let m=i[d[c]];if(!(m instanceof ju)){let r=d[c+1];if(Array.isArray(r))for(let T=0;T<r.length;T+=2){let M=m[r[T]],F=r[T+1];ma(4,M,F);try{F.call(M)}finally{ma(5,M,F)}}else{ma(4,m,r);try{r.call(m)}finally{ma(5,m,r)}}}}}function h2(a,i,d){return oV(a,i.parent,d)}function oV(a,i,d){let c=i;for(;c!==null&&c.type&168;)i=c,c=i.parent;if(c===null)return d[xa];{let{componentOffset:m}=c;if(m>-1){let{encapsulation:r}=a.data[c.directiveStart+m];if(r===_a.None||r===_a.Emulated)return null}return ys(c,d)}}function gv(a,i,d,c,m){a.insertBefore(i,d,c,m)}function f2(a,i,d){a.appendChild(i,d)}function OM(a,i,d,c,m){c!==null?gv(a,i,d,c,m):f2(a,i,d)}function sV(a,i,d,c){a.removeChild(i,d,c)}function sE(a,i){return a.parentNode(i)}function aV(a,i){return a.nextSibling(i)}function p2(a,i,d){return cV(a,i,d)}function lV(a,i,d){return a.type&40?ys(a,d):null}var cV=lV,FM;function Zv(a,i,d,c){let m=h2(a,c,i),r=i[Ji],T=c.parent||i[Fo],M=p2(T,c,i);if(m!=null)if(Array.isArray(d))for(let F=0;F<d.length;F++)OM(r,m,d[F],M,!1);else OM(r,m,d,M,!1);FM!==void 0&&FM(r,c,i,d,m)}function nv(a,i){if(i!==null){let d=i.type;if(d&3)return ys(i,a);if(d&4)return hw(-1,a[i.index]);if(d&8){let c=i.child;if(c!==null)return nv(a,c);{let m=a[i.index];return al(m)?hw(-1,m):ya(m)}}else{if(d&32)return iE(i,a)()||ya(a[i.index]);{let c=m2(a,i);if(c!==null){if(Array.isArray(c))return c[0];let m=Bu(a[_s]);return nv(m,c)}else return nv(a,i.next)}}}return null}function m2(a,i){if(i!==null){let c=a[_s][Fo],m=i.projection;return c.projection[m]}return null}function hw(a,i){let d=ko+a+1;if(d<i.length){let c=i[d],m=c[Fn].firstChild;if(m!==null)return nv(c,m)}return i[zu]}function uV(a,i,d){let c=sE(a,i);c&&sV(a,c,i,d)}function aE(a,i,d,c,m,r,T){for(;d!=null;){if(d.type===128){d=d.next;continue}let M=c[d.index],F=d.type;if(T&&i===0&&(M&&lc(ya(M),c),d.flags|=2),(d.flags&32)!==32)if(F&8)aE(a,i,d.child,c,m,r,!1),Hh(i,a,m,M,r);else if(F&32){let $=iE(d,c),Q;for(;Q=$();)Hh(i,a,m,Q,r);Hh(i,a,m,M,r)}else F&16?g2(a,i,c,d,m,r):Hh(i,a,m,M,r);d=T?d.projectionNext:d.next}}function Qv(a,i,d,c,m,r){aE(d,c,a.firstChild,i,m,r,!1)}function dV(a,i,d){let c=i[Ji],m=h2(a,d,i),r=d.parent||i[Fo],T=p2(r,d,i);g2(c,0,i,d,m,T)}function g2(a,i,d,c,m,r){let T=d[_s],F=T[Fo].projection[c.projection];if(Array.isArray(F))for(let $=0;$<F.length;$++){let Q=F[$];Hh(i,a,m,Q,r)}else{let $=F,Q=T[io];t2(c)&&($.flags|=128),aE(a,i,$,Q,m,r,!0)}}function hV(a,i,d,c,m){let r=d[zu],T=ya(d);r!==T&&Hh(i,a,c,r,m);for(let M=ko;M<d.length;M++){let F=d[M];Qv(F[Fn],F,a,i,c,r)}}function fV(a,i,d,c,m){if(i)m?a.addClass(d,c):a.removeClass(d,c);else{let r=c.indexOf("-")===-1?void 0:sl.DashCase;m==null?a.removeStyle(d,c,r):(typeof m=="string"&&m.endsWith("!important")&&(m=m.slice(0,-10),r|=sl.Important),a.setStyle(d,c,m,r))}}function pV(a,i,d){a.setAttribute(i,"style",d)}function _2(a,i,d){d===""?a.removeAttribute(i,"class"):a.setAttribute(i,"class",d)}function y2(a,i,d){let{mergedAttrs:c,classes:m,styles:r}=d;c!==null&&Y1(a,i,c),m!==null&&_2(a,i,m),r!==null&&pV(a,i,r)}var ll={};function di(a=1){v2(ir(),ai(),Zu()+a,!1)}function v2(a,i,d,c){if(!c)if((i[Dn]&3)===3){let r=a.preOrderCheckHooks;r!==null&&Jy(i,r,d)}else{let r=a.preOrderHooks;r!==null&&ev(i,r,0,d)}Vu(d)}function Tt(a,i=si.Default){let d=ai();if(d===null)return Ze(a,i);let c=Hr();return YA(c,d,go(a),i)}function b2(){let a="invalid";throw new Error(a)}function x2(a,i,d,c,m,r){let T=ci(null);try{let M=null;m&Yh.SignalBased&&(M=i[c][p1]),M!==null&&M.transformFn!==void 0&&(r=M.transformFn(r)),m&Yh.HasDecoratorInputTransform&&(r=a.inputTransforms[c].call(i,r)),a.setInput!==null?a.setInput(i,M,r,d,c):bA(i,M,c,r)}finally{ci(T)}}function mV(a,i){let d=a.hostBindingOpCodes;if(d!==null)try{for(let c=0;c<d.length;c++){let m=d[c];if(m<0)Vu(~m);else{let r=m,T=d[++c],M=d[++c];cB(T,r);let F=i[r];M(2,F)}}}finally{Vu(-1)}}function Yv(a,i,d,c,m,r,T,M,F,$,Q){let ue=i.blueprint.slice();return ue[xa]=m,ue[Dn]=c|4|128|8|64,($!==null||a&&a[Dn]&2048)&&(ue[Dn]|=2048),IA(ue),ue[io]=ue[of]=a,ue[gs]=d,ue[il]=T||a&&a[il],ue[Ji]=M||a&&a[Ji],ue[Jh]=F||a&&a[Jh]||null,ue[Fo]=r,ue[Nv]=FB(),ue[ym]=Q,ue[vA]=$,ue[_s]=i.type==2?a[_s]:ue,ue}function af(a,i,d,c,m){let r=a.data[i];if(r===null)r=gV(a,i,d,c,m),lB()&&(r.flags|=32);else if(r.type&64){r.type=d,r.value=c,r.attrs=m;let T=oB();r.injectorIndex=T===null?-1:T.injectorIndex}return qu(r,!0),r}function gV(a,i,d,c,m){let r=RA(),T=qw(),M=T?r:r&&r.parent,F=a.data[i]=wV(a,M,d,i,c,m);return a.firstChild===null&&(a.firstChild=F),r!==null&&(T?r.child==null&&F.parent!==null&&(r.child=F):r.next===null&&(r.next=F,F.prev=r)),F}function w2(a,i,d,c){if(d===0)return-1;let m=i.length;for(let r=0;r<d;r++)i.push(c),a.blueprint.push(c),a.data.push(null);return m}function E2(a,i,d,c,m){let r=Zu(),T=c&2;try{Vu(-1),T&&i.length>Oo&&v2(a,i,Oo,!1),ma(T?2:0,m),d(c,m)}finally{Vu(r),ma(T?3:1,m)}}function lE(a,i,d){if(Gw(i)){let c=ci(null);try{let m=i.directiveStart,r=i.directiveEnd;for(let T=m;T<r;T++){let M=a.data[T];if(M.contentQueries){let F=d[T];M.contentQueries(1,F,T)}}}finally{ci(c)}}}function cE(a,i,d){AA()&&(SV(a,i,d,ys(d,i)),(d.flags&64)===64&&I2(a,i,d))}function uE(a,i,d=ys){let c=i.localNames;if(c!==null){let m=i.index+1;for(let r=0;r<c.length;r+=2){let T=c[r+1],M=T===-1?d(i,a):a[T];a[m++]=M}}}function T2(a){let i=a.tView;return i===null||i.incompleteFirstPass?a.tView=dE(1,null,a.template,a.decls,a.vars,a.directiveDefs,a.pipeDefs,a.viewQuery,a.schemas,a.consts,a.id):i}function dE(a,i,d,c,m,r,T,M,F,$,Q){let ue=Oo+c,Ae=ue+m,xe=_V(ue,Ae),ke=typeof $=="function"?$():$;return xe[Fn]={type:a,blueprint:xe,template:d,queries:null,viewQuery:M,declTNode:i,data:xe.slice().fill(null,ue),bindingStartIndex:ue,expandoStartIndex:Ae,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof T=="function"?T():T,firstChild:null,schemas:F,consts:ke,incompleteFirstPass:!1,ssrId:Q}}function _V(a,i){let d=[];for(let c=0;c<i;c++)d.push(c<a?null:ll);return d}function yV(a,i,d,c){let r=c.get(GB,a2)||d===_a.ShadowDom,T=a.selectRootElement(i,r);return vV(T),T}function vV(a){bV(a)}var bV=()=>null;function xV(a,i,d,c){let m=M2(i);m.push(d),a.firstCreatePass&&A2(a).push(c,m.length-1)}function wV(a,i,d,c,m,r){let T=i?i.injectorIndex:-1,M=0;return PA()&&(M|=128),{type:d,index:c,insertBeforeIndex:null,injectorIndex:T,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:M,providerIndexes:0,value:m,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:i,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function LM(a,i,d,c,m){for(let r in i){if(!i.hasOwnProperty(r))continue;let T=i[r];if(T===void 0)continue;c??={};let M,F=Yh.None;Array.isArray(T)?(M=T[0],F=T[1]):M=T;let $=r;if(m!==null){if(!m.hasOwnProperty(r))continue;$=m[r]}a===0?NM(c,d,$,M,F):NM(c,d,$,M)}return c}function NM(a,i,d,c,m){let r;a.hasOwnProperty(d)?(r=a[d]).push(i,c):r=a[d]=[i,c],m!==void 0&&r.push(m)}function EV(a,i,d){let c=i.directiveStart,m=i.directiveEnd,r=a.data,T=i.attrs,M=[],F=null,$=null;for(let Q=c;Q<m;Q++){let ue=r[Q],Ae=d?d.get(ue):null,xe=Ae?Ae.inputs:null,ke=Ae?Ae.outputs:null;F=LM(0,ue.inputs,Q,F,xe),$=LM(1,ue.outputs,Q,$,ke);let Qe=F!==null&&T!==null&&!zw(i)?BV(F,Q,T):null;M.push(Qe)}F!==null&&(F.hasOwnProperty("class")&&(i.flags|=8),F.hasOwnProperty("style")&&(i.flags|=16)),i.initialInputs=M,i.inputs=F,i.outputs=$}function TV(a){return a==="class"?"className":a==="for"?"htmlFor":a==="formaction"?"formAction":a==="innerHtml"?"innerHTML":a==="readonly"?"readOnly":a==="tabindex"?"tabIndex":a}function Xv(a,i,d,c,m,r,T,M){let F=ys(i,d),$=i.inputs,Q;!M&&$!=null&&(Q=$[c])?(fE(a,d,Q,c,m),zv(i)&&DV(d,i.index)):i.type&3?(c=TV(c),m=T!=null?T(m,i.value||"",c):m,r.setProperty(F,c,m)):i.type&12}function DV(a,i){let d=dc(i,a);d[Dn]&16||(d[Dn]|=64)}function hE(a,i,d,c){if(AA()){let m=c===null?null:{"":-1},r=AV(a,d),T,M;r===null?T=M=null:[T,M]=r,T!==null&&D2(a,i,d,T,m,M),m&&PV(d,c,m)}d.mergedAttrs=gm(d.mergedAttrs,d.attrs)}function D2(a,i,d,c,m,r){for(let $=0;$<c.length;$++)sw(fv(d,i),a,c[$].type);kV(d,a.data.length,c.length);for(let $=0;$<c.length;$++){let Q=c[$];Q.providersResolver&&Q.providersResolver(Q)}let T=!1,M=!1,F=w2(a,i,c.length,null);for(let $=0;$<c.length;$++){let Q=c[$];d.mergedAttrs=gm(d.mergedAttrs,Q.hostAttrs),OV(a,d,i,F,Q),RV(F,Q,m),Q.contentQueries!==null&&(d.flags|=4),(Q.hostBindings!==null||Q.hostAttrs!==null||Q.hostVars!==0)&&(d.flags|=64);let ue=Q.type.prototype;!T&&(ue.ngOnChanges||ue.ngOnInit||ue.ngDoCheck)&&((a.preOrderHooks??=[]).push(d.index),T=!0),!M&&(ue.ngOnChanges||ue.ngDoCheck)&&((a.preOrderCheckHooks??=[]).push(d.index),M=!0),F++}EV(a,d,r)}function IV(a,i,d,c,m){let r=m.hostBindings;if(r){let T=a.hostBindingOpCodes;T===null&&(T=a.hostBindingOpCodes=[]);let M=~i.index;CV(T)!=M&&T.push(M),T.push(d,c,r)}}function CV(a){let i=a.length;for(;i>0;){let d=a[--i];if(typeof d=="number"&&d<0)return d}return 0}function SV(a,i,d,c){let m=d.directiveStart,r=d.directiveEnd;zv(d)&&FV(i,d,a.data[m+d.componentOffset]),a.firstCreatePass||fv(d,i),lc(c,i);let T=d.initialInputs;for(let M=m;M<r;M++){let F=a.data[M],$=Uu(i,a,M,d);if(lc($,i),T!==null&&zV(i,M-m,$,F,d,T),ol(F)){let Q=dc(d.index,i);Q[gs]=Uu(i,a,M,d)}}}function I2(a,i,d){let c=d.directiveStart,m=d.directiveEnd,r=d.index,T=uB();try{Vu(r);for(let M=c;M<m;M++){let F=a.data[M],$=i[M];iw(M),(F.hostBindings!==null||F.hostVars!==0||F.hostAttrs!==null)&&MV(F,$)}}finally{Vu(-1),iw(T)}}function MV(a,i){a.hostBindings!==null&&a.hostBindings(1,i)}function AV(a,i){let d=a.directiveRegistry,c=null,m=null;if(d)for(let r=0;r<d.length;r++){let T=d[r];if(lA(i,T.selectors,!1))if(c||(c=[]),ol(T))if(T.findHostDirectiveDefs!==null){let M=[];m=m||new Map,T.findHostDirectiveDefs(T,M,m),c.unshift(...M,T);let F=M.length;fw(a,i,F)}else c.unshift(T),fw(a,i,0);else m=m||new Map,T.findHostDirectiveDefs?.(T,c,m),c.push(T)}return c===null?null:[c,m]}function fw(a,i,d){i.componentOffset=d,(a.components??=[]).push(i.index)}function PV(a,i,d){if(i){let c=a.localNames=[];for(let m=0;m<i.length;m+=2){let r=d[i[m+1]];if(r==null)throw new kt(-301,!1);c.push(i[m],r)}}}function RV(a,i,d){if(d){if(i.exportAs)for(let c=0;c<i.exportAs.length;c++)d[i.exportAs[c]]=a;ol(i)&&(d[""]=a)}}function kV(a,i,d){a.flags|=1,a.directiveStart=i,a.directiveEnd=i+d,a.providerIndexes=i}function OV(a,i,d,c,m){a.data[c]=m;let r=m.factory||(m.factory=Zh(m.type,!0)),T=new ju(r,ol(m),Tt);a.blueprint[c]=T,d[c]=T,IV(a,i,c,w2(a,d,m.hostVars,ll),m)}function FV(a,i,d){let c=ys(i,a),m=T2(d),r=a[il].rendererFactory,T=16;d.signals?T=4096:d.onPush&&(T=64);let M=Kv(a,Yv(a,m,null,T,c,i,null,r.createRenderer(c,d),null,null,null));a[i.index]=M}function LV(a,i,d,c,m,r){let T=ys(a,i);NV(i[Ji],T,r,a.value,d,c,m)}function NV(a,i,d,c,m,r,T){if(r==null)a.removeAttribute(i,m,d);else{let M=T==null?Ow(r):T(r,c||"",m);a.setAttribute(i,m,M,d)}}function zV(a,i,d,c,m,r){let T=r[i];if(T!==null)for(let M=0;M<T.length;){let F=T[M++],$=T[M++],Q=T[M++],ue=T[M++];x2(c,d,F,$,Q,ue)}}function BV(a,i,d){let c=null,m=0;for(;m<d.length;){let r=d[m];if(r===0){m+=4;continue}else if(r===5){m+=2;continue}if(typeof r=="number")break;if(a.hasOwnProperty(r)){c===null&&(c=[]);let T=a[r];for(let M=0;M<T.length;M+=3)if(T[M]===i){c.push(r,T[M+1],T[M+2],d[m+1]);break}}m+=2}return c}function C2(a,i,d,c){return[a,!0,0,i,null,c,null,d,null,null]}function S2(a,i){let d=a.contentQueries;if(d!==null){let c=ci(null);try{for(let m=0;m<d.length;m+=2){let r=d[m],T=d[m+1];if(T!==-1){let M=a.data[T];Qw(r),M.contentQueries(2,i[T],T)}}}finally{ci(c)}}}function Kv(a,i){return a[vm]?a[DM][qs]=i:a[vm]=i,a[DM]=i,i}function pw(a,i,d){Qw(0);let c=ci(null);try{i(a,d)}finally{ci(c)}}function M2(a){return a[lv]??=[]}function A2(a){return a.cleanup??=[]}function P2(a,i,d){return(a===null||ol(a))&&(d=Z3(d[i.index])),d[Ji]}function R2(a,i){let d=a[Jh],c=d?d.get(va,null):null;c&&c.handleError(i)}function fE(a,i,d,c,m){for(let r=0;r<d.length;){let T=d[r++],M=d[r++],F=d[r++],$=i[T],Q=a.data[T];x2(Q,$,c,M,F,m)}}function VV(a,i,d){let c=DA(i,a);XB(a[Ji],c,d)}function jV(a,i){let d=dc(i,a),c=d[Fn];UV(c,d);let m=d[xa];m!==null&&d[ym]===null&&(d[ym]=nE(m,d[Jh])),pE(c,d,d[gs])}function UV(a,i){for(let d=i.length;d<a.blueprint.length;d++)i.push(a.blueprint[d])}function pE(a,i,d){Yw(i);try{let c=a.viewQuery;c!==null&&pw(1,c,d);let m=a.template;m!==null&&E2(a,i,m,1,d),a.firstCreatePass&&(a.firstCreatePass=!1),i[rl]?.finishViewCreation(a),a.staticContentQueries&&S2(a,i),a.staticViewQueries&&pw(2,a.viewQuery,d);let r=a.components;r!==null&&GV(i,r)}catch(c){throw a.firstCreatePass&&(a.incompleteFirstPass=!0,a.firstCreatePass=!1),c}finally{i[Dn]&=-5,Xw()}}function GV(a,i){for(let d=0;d<i.length;d++)jV(a,i[d])}function mE(a,i,d,c){let m=ci(null);try{let r=i.tView,M=a[Dn]&4096?4096:16,F=Yv(a,r,d,M,null,i,null,null,c?.injector??null,c?.embeddedViewInjector??null,c?.dehydratedView??null),$=a[i.index];F[Nu]=$;let Q=a[rl];return Q!==null&&(F[rl]=Q.createEmbeddedView(r)),pE(r,F,d),F}finally{ci(m)}}function $V(a,i){let d=ko+i;if(d<a.length)return a[d]}function _v(a,i){return!i||i.firstChild===null||t2(a)}function gE(a,i,d,c=!0){let m=i[Fn];if(nV(m,i,a,d),c){let T=hw(d,a),M=i[Ji],F=sE(M,a[zu]);F!==null&&eV(m,a[Fo],M,i,F,T)}let r=i[ym];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function HV(a,i){let d=mv(a,i);return d!==void 0&&oE(d[Fn],d),d}function yv(a,i,d,c,m=!1){for(;d!==null;){if(d.type===128){d=m?d.projectionNext:d.next;continue}let r=i[d.index];r!==null&&c.push(ya(r)),al(r)&&qV(r,c);let T=d.type;if(T&8)yv(a,i,d.child,c);else if(T&32){let M=iE(d,i),F;for(;F=M();)c.push(F)}else if(T&16){let M=m2(i,d);if(Array.isArray(M))c.push(...M);else{let F=Bu(i[_s]);yv(F[Fn],F,M,c,!0)}}d=m?d.projectionNext:d.next}return c}function qV(a,i){for(let d=ko;d<a.length;d++){let c=a[d],m=c[Fn].firstChild;m!==null&&yv(c[Fn],c,m,i)}a[zu]!==a[xa]&&i.push(a[zu])}var k2=[];function WV(a){return a[ps]??ZV(a)}function ZV(a){let i=k2.pop()??Object.create(YV);return i.lView=a,i}function QV(a){a.lView[ps]!==a&&(a.lView=null,k2.push(a))}var YV=tr(Yt({},m1),{consumerIsAlwaysLive:!0,consumerMarkedDirty:a=>{Vv(a.lView)},consumerOnSignalRead(){this.lView[ps]=this}});function XV(a){let i=a[ps]??Object.create(KV);return i.lView=a,i}var KV=tr(Yt({},m1),{consumerIsAlwaysLive:!0,consumerMarkedDirty:a=>{let i=Bu(a.lView);for(;i&&!O2(i[Fn]);)i=Bu(i);i&&CA(i)},consumerOnSignalRead(){this.lView[ps]=this}});function O2(a){return a.type!==2}var JV=100;function F2(a,i=!0,d=0){let c=a[il],m=c.rendererFactory,r=!1;r||m.begin?.();try{ej(a,d)}catch(T){throw i&&R2(a,T),T}finally{r||(m.end?.(),c.inlineEffectRunner?.flush())}}function ej(a,i){let d=kA();try{CM(!0),mw(a,i);let c=0;for(;bm(a);){if(c===JV)throw new kt(103,!1);c++,mw(a,1)}}finally{CM(d)}}function tj(a,i,d,c){let m=i[Dn];if((m&256)===256)return;let r=!1,T=!1;!r&&i[il].inlineEffectRunner?.flush(),Yw(i);let M=!0,F=null,$=null;r||(O2(a)?($=WV(i),F=g1($)):zS()===null?(M=!1,$=XV(i),F=g1($)):i[ps]&&(y1(i[ps]),i[ps]=null));try{IA(i),aB(a.bindingStartIndex),d!==null&&E2(a,i,d,2,c);let Q=(m&3)===3;if(!r)if(Q){let xe=a.preOrderCheckHooks;xe!==null&&Jy(i,xe,null)}else{let xe=a.preOrderHooks;xe!==null&&ev(i,xe,0,null),N1(i,0)}if(T||nj(i),L2(i,0),a.contentQueries!==null&&S2(a,i),!r)if(Q){let xe=a.contentCheckHooks;xe!==null&&Jy(i,xe)}else{let xe=a.contentHooks;xe!==null&&ev(i,xe,1),N1(i,1)}mV(a,i);let ue=a.components;ue!==null&&z2(i,ue,0);let Ae=a.viewQuery;if(Ae!==null&&pw(2,Ae,c),!r)if(Q){let xe=a.viewCheckHooks;xe!==null&&Jy(i,xe)}else{let xe=a.viewHooks;xe!==null&&ev(i,xe,2),N1(i,2)}if(a.firstUpdatePass===!0&&(a.firstUpdatePass=!1),i[L1]){for(let xe of i[L1])xe();i[L1]=null}r||(i[Dn]&=-73)}catch(Q){throw r||Vv(i),Q}finally{$!==null&&(BS($,F),M&&QV($)),Xw()}}function L2(a,i){for(let d=i2(a);d!==null;d=r2(d))for(let c=ko;c<d.length;c++){let m=d[c];N2(m,i)}}function nj(a){for(let i=i2(a);i!==null;i=r2(i)){if(!(i[Dn]&uv.HasTransplantedViews))continue;let d=i[ef];for(let c=0;c<d.length;c++){let m=d[c];CA(m)}}}function ij(a,i,d){let c=dc(i,a);N2(c,d)}function N2(a,i){Hw(a)&&mw(a,i)}function mw(a,i){let c=a[Fn],m=a[Dn],r=a[ps],T=!!(i===0&&m&16);if(T||=!!(m&64&&i===0),T||=!!(m&1024),T||=!!(r?.dirty&&_1(r)),T||=!1,r&&(r.dirty=!1),a[Dn]&=-9217,T)tj(c,a,c.template,a[gs]);else if(m&8192){L2(a,1);let M=c.components;M!==null&&z2(a,M,1)}}function z2(a,i,d){for(let c=0;c<i.length;c++)ij(a,i[c],d)}function _E(a,i){let d=kA()?64:1088;for(a[il].changeDetectionScheduler?.notify(i);a;){a[Dn]|=d;let c=Bu(a);if(ew(a)&&!c)return a;a=c}return null}var Gu=class{get rootNodes(){let i=this._lView,d=i[Fn];return yv(d,i,d.firstChild,[])}constructor(i,d,c=!0){this._lView=i,this._cdRefInjectingView=d,this.notifyErrorHandler=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[gs]}set context(i){this._lView[gs]=i}get destroyed(){return(this._lView[Dn]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let i=this._lView[io];if(al(i)){let d=i[cv],c=d?d.indexOf(this):-1;c>-1&&(mv(i,c),sv(d,c))}this._attachedToViewContainer=!1}oE(this._lView[Fn],this._lView)}onDestroy(i){SA(this._lView,i)}markForCheck(){_E(this._cdRefInjectingView||this._lView,4)}detach(){this._lView[Dn]&=-129}reattach(){nw(this._lView),this._lView[Dn]|=128}detectChanges(){this._lView[Dn]|=1024,F2(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new kt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let i=ew(this._lView),d=this._lView[Nu];d!==null&&!i&&rE(d,this._lView),u2(this._lView[Fn],this._lView)}attachToAppRef(i){if(this._attachedToViewContainer)throw new kt(902,!1);this._appRef=i;let d=ew(this._lView),c=this._lView[Nu];c!==null&&!d&&d2(c,this._lView),nw(this._lView)}},Zs=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=sj;let a=i;return a})(),rj=Zs,oj=class extends rj{constructor(i,d,c){super(),this._declarationLView=i,this._declarationTContainer=d,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(i,d){return this.createEmbeddedViewImpl(i,d)}createEmbeddedViewImpl(i,d,c){let m=mE(this._declarationLView,this._declarationTContainer,i,{embeddedViewInjector:d,dehydratedView:c});return new Gu(m)}};function sj(){return Jv(Hr(),ai())}function Jv(a,i){return a.type&4?new oj(i,a,sf(a,i)):null}var p7=new RegExp(`^(\\d+)*(${jB}|${VB})*(.*)`);var aj=()=>null;function vv(a,i){return aj(a,i)}var nf=class{},B2=new Pt("",{providedIn:"root",factory:()=>!1});var V2=new Pt(""),gw=class{},bv=class{};function lj(a){let i=Error(`No component factory found for ${_o(a)}.`);return i[cj]=a,i}var cj="ngComponent";var _w=class{resolveComponentFactory(i){throw lj(i)}},AE=class AE{};AE.NULL=new _w;var ba=AE,cc=class{},Im=(()=>{let i=class i{constructor(){this.destroyNode=null}};i.__NG_ELEMENT_ID__=()=>uj();let a=i;return a})();function uj(){let a=ai(),i=Hr(),d=dc(i.index,a);return(ac(d)?d:a)[Ji]}var dj=(()=>{let i=class i{};i.\u0275prov=Ft({token:i,providedIn:"root",factory:()=>null});let a=i;return a})();var zM=new Set;function Yu(a){zM.has(a)||(zM.add(a),performance?.mark?.("mark_feature_usage",{detail:{feature:a}}))}function j2(a){let i=!0;return setTimeout(()=>{i&&(i=!1,a())}),typeof Ws.requestAnimationFrame=="function"&&Ws.requestAnimationFrame(()=>{i&&(i=!1,a())}),()=>{i=!1}}function BM(a){let i=!0;return queueMicrotask(()=>{i&&a()}),()=>{i=!1}}function VM(...a){}var Wt=class a{constructor({enableLongStackTrace:i=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ui(!1),this.onMicrotaskEmpty=new Ui(!1),this.onStable=new Ui(!1),this.onError=new Ui(!1),typeof Zone>"u")throw new kt(908,!1);Zone.assertZonePatched();let m=this;m._nesting=0,m._outer=m._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(m._inner=m._inner.fork(new Zone.TaskTrackingZoneSpec)),i&&Zone.longStackTraceZoneSpec&&(m._inner=m._inner.fork(Zone.longStackTraceZoneSpec)),m.shouldCoalesceEventChangeDetection=!c&&d,m.shouldCoalesceRunChangeDetection=c,m.callbackScheduled=!1,pj(m)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!a.isInAngularZone())throw new kt(909,!1)}static assertNotInAngularZone(){if(a.isInAngularZone())throw new kt(909,!1)}run(i,d,c){return this._inner.run(i,d,c)}runTask(i,d,c,m){let r=this._inner,T=r.scheduleEventTask("NgZoneEvent: "+m,i,hj,VM,VM);try{return r.runTask(T,d,c)}finally{r.cancelTask(T)}}runGuarded(i,d,c){return this._inner.runGuarded(i,d,c)}runOutsideAngular(i){return this._outer.run(i)}},hj={};function yE(a){if(a._nesting==0&&!a.hasPendingMicrotasks&&!a.isStable)try{a._nesting++,a.onMicrotaskEmpty.emit(null)}finally{if(a._nesting--,!a.hasPendingMicrotasks)try{a.runOutsideAngular(()=>a.onStable.emit(null))}finally{a.isStable=!0}}}function fj(a){a.isCheckStableRunning||a.callbackScheduled||(a.callbackScheduled=!0,Zone.root.run(()=>{j2(()=>{a.callbackScheduled=!1,yw(a),a.isCheckStableRunning=!0,yE(a),a.isCheckStableRunning=!1})}),yw(a))}function pj(a){let i=()=>{fj(a)};a._inner=a._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(d,c,m,r,T,M)=>{if(mj(M))return d.invokeTask(m,r,T,M);try{return jM(a),d.invokeTask(m,r,T,M)}finally{(a.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||a.shouldCoalesceRunChangeDetection)&&i(),UM(a)}},onInvoke:(d,c,m,r,T,M,F)=>{try{return jM(a),d.invoke(m,r,T,M,F)}finally{a.shouldCoalesceRunChangeDetection&&!a.callbackScheduled&&!gj(M)&&i(),UM(a)}},onHasTask:(d,c,m,r)=>{d.hasTask(m,r),c===m&&(r.change=="microTask"?(a._hasPendingMicrotasks=r.microTask,yw(a),yE(a)):r.change=="macroTask"&&(a.hasPendingMacrotasks=r.macroTask))},onHandleError:(d,c,m,r)=>(d.handleError(m,r),a.runOutsideAngular(()=>a.onError.emit(r)),!1)})}function yw(a){a._hasPendingMicrotasks||(a.shouldCoalesceEventChangeDetection||a.shouldCoalesceRunChangeDetection)&&a.callbackScheduled===!0?a.hasPendingMicrotasks=!0:a.hasPendingMicrotasks=!1}function jM(a){a._nesting++,a.isStable&&(a.isStable=!1,a.onUnstable.emit(null))}function UM(a){a._nesting--,yE(a)}var xv=class{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ui,this.onMicrotaskEmpty=new Ui,this.onStable=new Ui,this.onError=new Ui}run(i,d,c){return i.apply(d,c)}runGuarded(i,d,c){return i.apply(d,c)}runOutsideAngular(i){return i()}runTask(i,d,c,m){return i.apply(d,c)}};function mj(a){return U2(a,"__ignore_ng_zone__")}function gj(a){return U2(a,"__scheduler_tick__")}function U2(a,i){return!Array.isArray(a)||a.length!==1?!1:a[0]?.data?.[i]===!0}function _j(a="zone.js",i){return a==="noop"?new xv:a==="zone.js"?new Wt(i):a}var Fu=function(a){return a[a.EarlyRead=0]="EarlyRead",a[a.Write=1]="Write",a[a.MixedReadWrite=2]="MixedReadWrite",a[a.Read=3]="Read",a}(Fu||{}),G2={destroy(){}};function Cm(a,i){!i&&yA(Cm);let d=i?.injector??Ot(nr);if(!l2(d))return G2;Yu("NgAfterRender");let c=d.get(t0),m=c.handler??=new Ev,r=i?.phase??Fu.MixedReadWrite,T=()=>{m.unregister(F),M()},M=d.get(qv).onDestroy(T),F=Lv(d,()=>new wv(r,a));return m.register(F),{destroy:T}}function e0(a,i){!i&&yA(e0);let d=i?.injector??Ot(nr);if(!l2(d))return G2;Yu("NgAfterNextRender");let c=d.get(t0),m=c.handler??=new Ev,r=i?.phase??Fu.MixedReadWrite,T=()=>{m.unregister(F),M()},M=d.get(qv).onDestroy(T),F=Lv(d,()=>new wv(r,()=>{T(),a()}));return m.register(F),{destroy:T}}var wv=class{constructor(i,d){this.phase=i,this.callbackFn=d,this.zone=Ot(Wt),this.errorHandler=Ot(va,{optional:!0}),Ot(nf,{optional:!0})?.notify(6)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(i){this.errorHandler?.handleError(i)}}},Ev=class{constructor(){this.executingCallbacks=!1,this.buckets={[Fu.EarlyRead]:new Set,[Fu.Write]:new Set,[Fu.MixedReadWrite]:new Set,[Fu.Read]:new Set},this.deferredCallbacks=new Set}register(i){(this.executingCallbacks?this.deferredCallbacks:this.buckets[i.phase]).add(i)}unregister(i){this.buckets[i.phase].delete(i),this.deferredCallbacks.delete(i)}execute(){this.executingCallbacks=!0;for(let i of Object.values(this.buckets))for(let d of i)d.invoke();this.executingCallbacks=!1;for(let i of this.deferredCallbacks)this.buckets[i.phase].add(i);this.deferredCallbacks.clear()}destroy(){for(let i of Object.values(this.buckets))i.clear();this.deferredCallbacks.clear()}},t0=(()=>{let i=class i{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let c=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let m of c)m()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};i.\u0275prov=Ft({token:i,providedIn:"root",factory:()=>new i});let a=i;return a})();function Tv(a,i,d){let c=d?a.styles:null,m=d?a.classes:null,r=0;if(i!==null)for(let T=0;T<i.length;T++){let M=i[T];if(typeof M=="number")r=M;else if(r==1)m=W1(m,M);else if(r==2){let F=M,$=i[++T];c=W1(c,F+": "+$+";")}}d?a.styles=c:a.stylesWithoutHost=c,d?a.classes=m:a.classesWithoutHost=m}var Dv=class extends ba{constructor(i){super(),this.ngModule=i}resolveComponentFactory(i){let d=Xh(i);return new Iv(d,this.ngModule)}};function GM(a){let i=[];for(let d in a){if(!a.hasOwnProperty(d))continue;let c=a[d];c!==void 0&&i.push({propName:Array.isArray(c)?c[0]:c,templateName:d})}return i}function yj(a){let i=a.toLowerCase();return i==="svg"?TA:i==="math"?W3:null}var Iv=class extends bv{get inputs(){let i=this.componentDef,d=i.inputTransforms,c=GM(i.inputs);if(d!==null)for(let m of c)d.hasOwnProperty(m.propName)&&(m.transform=d[m.propName]);return c}get outputs(){return GM(this.componentDef.outputs)}constructor(i,d){super(),this.componentDef=i,this.ngModule=d,this.componentType=i.type,this.selector=T3(i.selectors),this.ngContentSelectors=i.ngContentSelectors?i.ngContentSelectors:[],this.isBoundToModule=!!d}create(i,d,c,m){let r=ci(null);try{m=m||this.ngModule;let T=m instanceof ms?m:m?.injector;T&&this.componentDef.getStandaloneInjector!==null&&(T=this.componentDef.getStandaloneInjector(T)||T);let M=T?new rw(i,T):i,F=M.get(cc,null);if(F===null)throw new kt(407,!1);let $=M.get(dj,null),Q=M.get(t0,null),ue=M.get(nf,null),Ae={rendererFactory:F,sanitizer:$,inlineEffectRunner:null,afterRenderEventManager:Q,changeDetectionScheduler:ue},xe=F.createRenderer(null,this.componentDef),ke=this.componentDef.selectors[0][0]||"div",Qe=c?yV(xe,c,this.componentDef.encapsulation,M):c2(xe,ke,yj(ke)),dt=512;this.componentDef.signals?dt|=4096:this.componentDef.onPush||(dt|=16);let st=null;Qe!==null&&(st=nE(Qe,M,!0));let Nt=dE(0,null,null,1,0,null,null,null,null,null,null),gn=Yv(null,Nt,null,dt,null,null,Ae,xe,M,null,st);Yw(gn);let Xt,Ni;try{let Xn=this.componentDef,Gt,vi=null;Xn.findHostDirectiveDefs?(Gt=[],vi=new Map,Xn.findHostDirectiveDefs(Xn,Gt,vi),Gt.push(Xn)):Gt=[Xn];let $i=vj(gn,Qe),oo=bj($i,Qe,Xn,Gt,gn,Ae,xe);Ni=$w(Nt,Oo),Qe&&Ej(xe,Xn,Qe,c),d!==void 0&&Tj(Ni,this.ngContentSelectors,d),Xt=wj(oo,Xn,Gt,vi,gn,[Dj]),pE(Nt,gn,null)}finally{Xw()}return new vw(this.componentType,Xt,sf(Ni,gn),gn,Ni)}finally{ci(r)}}},vw=class extends gw{constructor(i,d,c,m,r){super(),this.location=c,this._rootLView=m,this._tNode=r,this.previousInputValues=null,this.instance=d,this.hostView=this.changeDetectorRef=new Gu(m,void 0,!1),this.componentType=i}setInput(i,d){let c=this._tNode.inputs,m;if(c!==null&&(m=c[i])){if(this.previousInputValues??=new Map,this.previousInputValues.has(i)&&Object.is(this.previousInputValues.get(i),d))return;let r=this._rootLView;fE(r[Fn],r,m,i,d),this.previousInputValues.set(i,d);let T=dc(this._tNode.index,r);_E(T,1)}}get injector(){return new Lu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(i){this.hostView.onDestroy(i)}};function vj(a,i){let d=a[Fn],c=Oo;return a[c]=i,af(d,c,2,"#host",null)}function bj(a,i,d,c,m,r,T){let M=m[Fn];xj(c,a,i,T);let F=null;i!==null&&(F=nE(i,m[Jh]));let $=r.rendererFactory.createRenderer(i,d),Q=16;d.signals?Q=4096:d.onPush&&(Q=64);let ue=Yv(m,T2(d),null,Q,m[a.index],a,r,$,null,null,F);return M.firstCreatePass&&fw(M,a,c.length-1),Kv(m,ue),m[a.index]=ue}function xj(a,i,d,c){for(let m of a)i.mergedAttrs=gm(i.mergedAttrs,m.hostAttrs);i.mergedAttrs!==null&&(Tv(i,i.mergedAttrs,!0),d!==null&&y2(c,d,i))}function wj(a,i,d,c,m,r){let T=Hr(),M=m[Fn],F=ys(T,m);D2(M,m,T,d,null,c);for(let Q=0;Q<d.length;Q++){let ue=T.directiveStart+Q,Ae=Uu(m,M,ue,T);lc(Ae,m)}I2(M,m,T),F&&lc(F,m);let $=Uu(m,M,T.directiveStart+T.componentOffset,T);if(a[gs]=m[gs]=$,r!==null)for(let Q of r)Q($,i);return lE(M,T,m),$}function Ej(a,i,d,c){if(c)Y1(a,d,["ng-version","18.0.5"]);else{let{attrs:m,classes:r}=D3(i.selectors[0]);m&&Y1(a,d,m),r&&r.length>0&&_2(a,d,r.join(" "))}}function Tj(a,i,d){let c=a.projection=[];for(let m=0;m<i.length;m++){let r=d[m];c.push(r!=null?Array.from(r):null)}}function Dj(){let a=Hr();Hv(ai()[Fn],a)}var wa=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=Ij;let a=i;return a})();function Ij(){let a=Hr();return H2(a,ai())}var Cj=wa,$2=class extends Cj{constructor(i,d,c){super(),this._lContainer=i,this._hostTNode=d,this._hostLView=c}get element(){return sf(this._hostTNode,this._hostLView)}get injector(){return new Lu(this._hostTNode,this._hostLView)}get parentInjector(){let i=Jw(this._hostTNode,this._hostLView);if($A(i)){let d=hv(i,this._hostLView),c=dv(i),m=d[Fn].data[c+8];return new Lu(m,d)}else return new Lu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(i){let d=$M(this._lContainer);return d!==null&&d[i]||null}get length(){return this._lContainer.length-ko}createEmbeddedView(i,d,c){let m,r;typeof c=="number"?m=c:c!=null&&(m=c.index,r=c.injector);let T=vv(this._lContainer,i.ssrId),M=i.createEmbeddedViewImpl(d||{},r,T);return this.insertImpl(M,m,_v(this._hostTNode,T)),M}createComponent(i,d,c,m,r){let T=i&&!G3(i),M;if(T)M=d;else{let ke=d||{};M=ke.index,c=ke.injector,m=ke.projectableNodes,r=ke.environmentInjector||ke.ngModuleRef}let F=T?i:new Iv(Xh(i)),$=c||this.parentInjector;if(!r&&F.ngModule==null){let Qe=(T?$:this.parentInjector).get(ms,null);Qe&&(r=Qe)}let Q=Xh(F.componentType??{}),ue=vv(this._lContainer,Q?.id??null),Ae=ue?.firstChild??null,xe=F.create($,m,Ae,r);return this.insertImpl(xe.hostView,M,_v(this._hostTNode,ue)),xe}insert(i,d){return this.insertImpl(i,d,!0)}insertImpl(i,d,c){let m=i._lView;if(X3(m)){let M=this.indexOf(i);if(M!==-1)this.detach(M);else{let F=m[io],$=new $2(F,F[Fo],F[io]);$.detach($.indexOf(i))}}let r=this._adjustIndex(d),T=this._lContainer;return gE(T,m,r,c),i.attachToViewContainerRef(),iA(U1(T),r,i),i}move(i,d){return this.insert(i,d)}indexOf(i){let d=$M(this._lContainer);return d!==null?d.indexOf(i):-1}remove(i){let d=this._adjustIndex(i,-1),c=mv(this._lContainer,d);c&&(sv(U1(this._lContainer),d),oE(c[Fn],c))}detach(i){let d=this._adjustIndex(i,-1),c=mv(this._lContainer,d);return c&&sv(U1(this._lContainer),d)!=null?new Gu(c):null}_adjustIndex(i,d=0){return i??this.length+d}};function $M(a){return a[cv]}function U1(a){return a[cv]||(a[cv]=[])}function H2(a,i){let d,c=i[a.index];return al(c)?d=c:(d=C2(c,i,null,a),i[a.index]=d,Kv(i,d)),Mj(d,i,a,c),new $2(d,a,i)}function Sj(a,i){let d=a[Ji],c=d.createComment(""),m=ys(i,a),r=sE(d,m);return gv(d,r,c,aV(d,m),!1),c}var Mj=Rj,Aj=()=>!1;function Pj(a,i,d){return Aj(a,i,d)}function Rj(a,i,d,c){if(a[zu])return;let m;d.type&8?m=ya(c):m=Sj(i,d),a[zu]=m}var bw=class a{constructor(i){this.queryList=i,this.matches=null}clone(){return new a(this.queryList)}setDirty(){this.queryList.setDirty()}},xw=class a{constructor(i=[]){this.queries=i}createEmbeddedView(i){let d=i.queries;if(d!==null){let c=i.contentQueries!==null?i.contentQueries[0]:d.length,m=[];for(let r=0;r<c;r++){let T=d.getByIndex(r),M=this.queries[T.indexInDeclarationView];m.push(M.clone())}return new a(m)}return null}insertView(i){this.dirtyQueriesWithMatches(i)}detachView(i){this.dirtyQueriesWithMatches(i)}finishViewCreation(i){this.dirtyQueriesWithMatches(i)}dirtyQueriesWithMatches(i){for(let d=0;d<this.queries.length;d++)vE(i,d).matches!==null&&this.queries[d].setDirty()}},Cv=class{constructor(i,d,c=null){this.flags=d,this.read=c,typeof i=="string"?this.predicate=Vj(i):this.predicate=i}},ww=class a{constructor(i=[]){this.queries=i}elementStart(i,d){for(let c=0;c<this.queries.length;c++)this.queries[c].elementStart(i,d)}elementEnd(i){for(let d=0;d<this.queries.length;d++)this.queries[d].elementEnd(i)}embeddedTView(i){let d=null;for(let c=0;c<this.length;c++){let m=d!==null?d.length:0,r=this.getByIndex(c).embeddedTView(i,m);r&&(r.indexInDeclarationView=c,d!==null?d.push(r):d=[r])}return d!==null?new a(d):null}template(i,d){for(let c=0;c<this.queries.length;c++)this.queries[c].template(i,d)}getByIndex(i){return this.queries[i]}get length(){return this.queries.length}track(i){this.queries.push(i)}},Ew=class a{constructor(i,d=-1){this.metadata=i,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=d}elementStart(i,d){this.isApplyingToNode(d)&&this.matchTNode(i,d)}elementEnd(i){this._declarationNodeIndex===i.index&&(this._appliesToNextNode=!1)}template(i,d){this.elementStart(i,d)}embeddedTView(i,d){return this.isApplyingToNode(i)?(this.crossesNgTemplate=!0,this.addMatch(-i.index,d),new a(this.metadata)):null}isApplyingToNode(i){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let d=this._declarationNodeIndex,c=i.parent;for(;c!==null&&c.type&8&&c.index!==d;)c=c.parent;return d===(c!==null?c.index:-1)}return this._appliesToNextNode}matchTNode(i,d){let c=this.metadata.predicate;if(Array.isArray(c))for(let m=0;m<c.length;m++){let r=c[m];this.matchTNodeWithReadOption(i,d,kj(d,r)),this.matchTNodeWithReadOption(i,d,tv(d,i,r,!1,!1))}else c===Zs?d.type&4&&this.matchTNodeWithReadOption(i,d,-1):this.matchTNodeWithReadOption(i,d,tv(d,i,c,!1,!1))}matchTNodeWithReadOption(i,d,c){if(c!==null){let m=this.metadata.read;if(m!==null)if(m===ti||m===wa||m===Zs&&d.type&4)this.addMatch(d.index,-2);else{let r=tv(d,i,m,!1,!1);r!==null&&this.addMatch(d.index,r)}else this.addMatch(d.index,c)}}addMatch(i,d){this.matches===null?this.matches=[i,d]:this.matches.push(i,d)}};function kj(a,i){let d=a.localNames;if(d!==null){for(let c=0;c<d.length;c+=2)if(d[c]===i)return d[c+1]}return null}function Oj(a,i){return a.type&11?sf(a,i):a.type&4?Jv(a,i):null}function Fj(a,i,d,c){return d===-1?Oj(i,a):d===-2?Lj(a,i,c):Uu(a,a[Fn],d,i)}function Lj(a,i,d){if(d===ti)return sf(i,a);if(d===Zs)return Jv(i,a);if(d===wa)return H2(i,a)}function q2(a,i,d,c){let m=i[rl].queries[c];if(m.matches===null){let r=a.data,T=d.matches,M=[];for(let F=0;T!==null&&F<T.length;F+=2){let $=T[F];if($<0)M.push(null);else{let Q=r[$];M.push(Fj(i,Q,T[F+1],d.metadata.read))}}m.matches=M}return m.matches}function Tw(a,i,d,c){let m=a.queries.getByIndex(d),r=m.matches;if(r!==null){let T=q2(a,i,m,d);for(let M=0;M<r.length;M+=2){let F=r[M];if(F>0)c.push(T[M/2]);else{let $=r[M+1],Q=i[-F];for(let ue=ko;ue<Q.length;ue++){let Ae=Q[ue];Ae[Nu]===Ae[io]&&Tw(Ae[Fn],Ae,$,c)}if(Q[ef]!==null){let ue=Q[ef];for(let Ae=0;Ae<ue.length;Ae++){let xe=ue[Ae];Tw(xe[Fn],xe,$,c)}}}}}return c}function Nj(a,i){return a[rl].queries[i].queryList}function W2(a,i,d){let c=new pv((d&4)===4);return xV(a,i,c,c.destroy),(i[rl]??=new xw).queries.push(new bw(c))-1}function zj(a,i,d){let c=ir();return c.firstCreatePass&&(Z2(c,new Cv(a,i,d),-1),(i&2)===2&&(c.staticViewQueries=!0)),W2(c,ai(),i)}function Bj(a,i,d,c){let m=ir();if(m.firstCreatePass){let r=Hr();Z2(m,new Cv(i,d,c),r.index),jj(m,a),(d&2)===2&&(m.staticContentQueries=!0)}return W2(m,ai(),d)}function Vj(a){return a.split(",").map(i=>i.trim())}function Z2(a,i,d){a.queries===null&&(a.queries=new ww),a.queries.track(new Ew(i,d))}function jj(a,i){let d=a.contentQueries||(a.contentQueries=[]),c=d.length?d[d.length-1]:-1;i!==c&&d.push(a.queries.length-1,i)}function vE(a,i){return a.queries.getByIndex(i)}function Uj(a,i){let d=a[Fn],c=vE(d,i);return c.crossesNgTemplate?Tw(d,a,i,[]):q2(d,a,c,i)}function Q2(a){return typeof a=="function"&&a[p1]!==void 0}function Y2(a){return Q2(a)&&typeof a.set=="function"}function Gj(a){let i=[],d=new Map;function c(m){let r=d.get(m);if(!r){let T=a(m);d.set(m,r=T.then(Wj))}return r}return Sv.forEach((m,r)=>{let T=[];m.templateUrl&&T.push(c(m.templateUrl).then($=>{m.template=$}));let M=typeof m.styles=="string"?[m.styles]:m.styles||[];if(m.styles=M,m.styleUrl&&m.styleUrls?.length)throw new Error("@Component cannot define both `styleUrl` and `styleUrls`. Use `styleUrl` if the component has one stylesheet, or `styleUrls` if it has multiple");if(m.styleUrls?.length){let $=m.styles.length,Q=m.styleUrls;m.styleUrls.forEach((ue,Ae)=>{M.push(""),T.push(c(ue).then(xe=>{M[$+Ae]=xe,Q.splice(Q.indexOf(ue),1),Q.length==0&&(m.styleUrls=void 0)}))})}else m.styleUrl&&T.push(c(m.styleUrl).then($=>{M.push($),m.styleUrl=void 0}));let F=Promise.all(T).then(()=>Zj(r));i.push(F)}),Hj(),Promise.all(i).then(()=>{})}var Sv=new Map,$j=new Set;function Hj(){let a=Sv;return Sv=new Map,a}function qj(){return Sv.size===0}function Wj(a){return typeof a=="string"?a:a.text()}function Zj(a){$j.delete(a)}function Qj(a){return Object.getPrototypeOf(a.prototype).constructor}function yo(a){let i=Qj(a.type),d=!0,c=[a];for(;i;){let m;if(ol(a))m=i.\u0275cmp||i.\u0275dir;else{if(i.\u0275cmp)throw new kt(903,!1);m=i.\u0275dir}if(m){if(d){c.push(m);let T=a;T.inputs=Qy(a.inputs),T.inputTransforms=Qy(a.inputTransforms),T.declaredInputs=Qy(a.declaredInputs),T.outputs=Qy(a.outputs);let M=m.hostBindings;M&&e5(a,M);let F=m.viewQuery,$=m.contentQueries;if(F&&Kj(a,F),$&&Jj(a,$),Yj(a,m),jz(a.outputs,m.outputs),ol(m)&&m.data.animation){let Q=a.data;Q.animation=(Q.animation||[]).concat(m.data.animation)}}let r=m.features;if(r)for(let T=0;T<r.length;T++){let M=r[T];M&&M.ngInherit&&M(a),M===yo&&(d=!1)}}i=Object.getPrototypeOf(i)}Xj(c)}function Yj(a,i){for(let d in i.inputs){if(!i.inputs.hasOwnProperty(d)||a.inputs.hasOwnProperty(d))continue;let c=i.inputs[d];if(c!==void 0&&(a.inputs[d]=c,a.declaredInputs[d]=i.declaredInputs[d],i.inputTransforms!==null)){let m=Array.isArray(c)?c[0]:c;if(!i.inputTransforms.hasOwnProperty(m))continue;a.inputTransforms??={},a.inputTransforms[m]=i.inputTransforms[m]}}}function Xj(a){let i=0,d=null;for(let c=a.length-1;c>=0;c--){let m=a[c];m.hostVars=i+=m.hostVars,m.hostAttrs=gm(m.hostAttrs,d=gm(d,m.hostAttrs))}}function Qy(a){return a===Qh?{}:a===Ro?[]:a}function Kj(a,i){let d=a.viewQuery;d?a.viewQuery=(c,m)=>{i(c,m),d(c,m)}:a.viewQuery=i}function Jj(a,i){let d=a.contentQueries;d?a.contentQueries=(c,m,r)=>{i(c,m,r),d(c,m,r)}:a.contentQueries=i}function e5(a,i){let d=a.hostBindings;d?a.hostBindings=(c,m)=>{i(c,m),d(c,m)}:a.hostBindings=i}function Ys(a){let i=a.inputConfig,d={};for(let c in i)if(i.hasOwnProperty(c)){let m=i[c];Array.isArray(m)&&m[3]&&(d[c]=m[3])}a.inputTransforms=d}var uc=class{},Dw=class{};var Mv=class extends uc{constructor(i,d,c){super(),this._parent=d,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Dv(this);let m=M3(i);this._bootstrapComponents=ZB(m.bootstrap),this._r3Injector=JA(i,d,[{provide:uc,useValue:this},{provide:ba,useValue:this.componentFactoryResolver},...c],_o(i),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(i)}get injector(){return this._r3Injector}destroy(){let i=this._r3Injector;!i.destroyed&&i.destroy(),this.destroyCbs.forEach(d=>d()),this.destroyCbs=null}onDestroy(i){this.destroyCbs.push(i)}},Iw=class extends Dw{constructor(i){super(),this.moduleType=i}create(i){return new Mv(this.moduleType,i,[])}};function t5(a,i,d){return new Mv(a,i,d)}var Cw=class extends uc{constructor(i){super(),this.componentFactoryResolver=new Dv(this),this.instance=null;let d=new _m([...i.providers,{provide:uc,useValue:this},{provide:ba,useValue:this.componentFactoryResolver}],i.parent||jw(),i.debugName,new Set(["environment"]));this.injector=d,i.runEnvironmentInitializers&&d.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(i){this.injector.onDestroy(i)}};function n5(a,i,d=null){return new Cw({providers:a,parent:i,debugName:d,runEnvironmentInitializers:!0}).injector}function cl(a,i,d){let c=a[i];return Object.is(c,d)?!1:(a[i]=d,!0)}function i5(a){return(a.flags&32)===32}function r5(a,i,d,c,m,r,T,M,F){let $=i.consts,Q=af(i,a,4,T||null,M||null);hE(i,d,Q,tf($,F)),Hv(i,Q);let ue=Q.tView=dE(2,Q,c,m,r,i.directiveRegistry,i.pipeRegistry,null,i.schemas,$,null);return i.queries!==null&&(i.queries.template(i,Q),ue.queries=i.queries.embeddedTView(Q)),Q}function X2(a,i,d,c,m,r,T,M,F,$){let Q=d+Oo,ue=i.firstCreatePass?r5(Q,i,a,c,m,r,T,M,F):i.data[Q];qu(ue,!1);let Ae=o5(i,a,ue,d);Gv()&&Zv(i,a,Ae,ue),lc(Ae,a);let xe=C2(Ae,a,Ae,ue);return a[Q]=xe,Kv(a,xe),Pj(xe,ue,a),Bv(ue)&&cE(i,a,ue),F!=null&&uE(a,ue,$),ue}function rr(a,i,d,c,m,r,T,M){let F=ai(),$=ir(),Q=tf($.consts,r);return X2(F,$,a,i,d,c,m,Q,T,M),rr}var o5=s5;function s5(a,i,d,c){return $v(!0),i[Ji].createComment("")}function Mr(a,i,d,c){let m=ai(),r=Wu();if(cl(m,r,i)){let T=ir(),M=Em();LV(M,m,a,i,d,c)}return Mr}function a5(a,i,d,c){return cl(a,Wu(),d)?i+Ow(d)+c:ll}function Yy(a,i){return a<<17|i<<2}function $u(a){return a>>17&32767}function l5(a){return(a&2)==2}function c5(a,i){return a&131071|i<<17}function Sw(a){return a|2}function rf(a){return(a&131068)>>2}function G1(a,i){return a&-131069|i<<2}function u5(a){return(a&1)===1}function Mw(a){return a|1}function d5(a,i,d,c,m,r){let T=r?i.classBindings:i.styleBindings,M=$u(T),F=rf(T);a[c]=d;let $=!1,Q;if(Array.isArray(d)){let ue=d;Q=ue[1],(Q===null||wm(ue,Q)>0)&&($=!0)}else Q=d;if(m)if(F!==0){let Ae=$u(a[M+1]);a[c+1]=Yy(Ae,M),Ae!==0&&(a[Ae+1]=G1(a[Ae+1],c)),a[M+1]=c5(a[M+1],c)}else a[c+1]=Yy(M,0),M!==0&&(a[M+1]=G1(a[M+1],c)),M=c;else a[c+1]=Yy(F,0),M===0?M=c:a[F+1]=G1(a[F+1],c),F=c;$&&(a[c+1]=Sw(a[c+1])),HM(a,Q,c,!0),HM(a,Q,c,!1),h5(i,Q,a,c,r),T=Yy(M,F),r?i.classBindings=T:i.styleBindings=T}function h5(a,i,d,c,m){let r=m?a.residualClasses:a.residualStyles;r!=null&&typeof i=="string"&&wm(r,i)>=0&&(d[c+1]=Mw(d[c+1]))}function HM(a,i,d,c){let m=a[d+1],r=i===null,T=c?$u(m):rf(m),M=!1;for(;T!==0&&(M===!1||r);){let F=a[T],$=a[T+1];f5(F,i)&&(M=!0,a[T+1]=c?Mw($):Sw($)),T=c?$u($):rf($)}M&&(a[d+1]=c?Sw(m):Mw(m))}function f5(a,i){return a===null||i==null||(Array.isArray(a)?a[1]:a)===i?!0:Array.isArray(a)&&typeof i=="string"?wm(a,i)>=0:!1}var Hs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function p5(a){return a.substring(Hs.key,Hs.keyEnd)}function m5(a){return g5(a),K2(a,J2(a,0,Hs.textEnd))}function K2(a,i){let d=Hs.textEnd;return d===i?-1:(i=Hs.keyEnd=_5(a,Hs.key=i,d),J2(a,i,d))}function g5(a){Hs.key=0,Hs.keyEnd=0,Hs.value=0,Hs.valueEnd=0,Hs.textEnd=a.length}function J2(a,i,d){for(;i<d&&a.charCodeAt(i)<=32;)i++;return i}function _5(a,i,d){for(;i<d&&a.charCodeAt(i)>32;)i++;return i}function qr(a,i,d){let c=ai(),m=Wu();if(cl(c,m,i)){let r=ir(),T=Em();Xv(r,T,c,a,i,c[Ji],d,!1)}return qr}function Aw(a,i,d,c,m){let r=i.inputs,T=m?"class":"style";fE(a,d,r[T],T,c)}function Xu(a,i,d){return eP(a,i,d,!1),Xu}function wr(a,i){return eP(a,i,null,!0),wr}function n0(a){v5(D5,y5,a,!0)}function y5(a,i){for(let d=m5(i);d>=0;d=K2(i,d))Nw(a,p5(i),!0)}function eP(a,i,d,c){let m=ai(),r=ir(),T=OA(2);if(r.firstUpdatePass&&nP(r,a,T,c),i!==ll&&cl(m,T,i)){let M=r.data[Zu()];iP(r,M,m,m[Ji],a,m[T+1]=C5(i,d),c,T)}}function v5(a,i,d,c){let m=ir(),r=OA(2);m.firstUpdatePass&&nP(m,null,r,c);let T=ai();if(d!==ll&&cl(T,r,d)){let M=m.data[Zu()];if(rP(M,c)&&!tP(m,r)){let F=c?M.classesWithoutHost:M.stylesWithoutHost;F!==null&&(d=W1(F,d||"")),Aw(m,M,T,d,c)}else I5(m,M,T,T[Ji],T[r+1],T[r+1]=T5(a,i,d),c,r)}}function tP(a,i){return i>=a.expandoStartIndex}function nP(a,i,d,c){let m=a.data;if(m[d+1]===null){let r=m[Zu()],T=tP(a,d);rP(r,c)&&i===null&&!T&&(i=!1),i=b5(m,r,i,c),d5(m,r,i,d,T,c)}}function b5(a,i,d,c){let m=Zw(a),r=c?i.residualClasses:i.residualStyles;if(m===null)(c?i.classBindings:i.styleBindings)===0&&(d=$1(null,a,i,d,c),d=xm(d,i.attrs,c),r=null);else{let T=i.directiveStylingLast;if(T===-1||a[T]!==m)if(d=$1(m,a,i,d,c),r===null){let F=x5(a,i,c);F!==void 0&&Array.isArray(F)&&(F=$1(null,a,i,F[1],c),F=xm(F,i.attrs,c),w5(a,i,c,F))}else r=E5(a,i,c)}return r!==void 0&&(c?i.residualClasses=r:i.residualStyles=r),d}function x5(a,i,d){let c=d?i.classBindings:i.styleBindings;if(rf(c)!==0)return a[$u(c)]}function w5(a,i,d,c){let m=d?i.classBindings:i.styleBindings;a[$u(m)]=c}function E5(a,i,d){let c,m=i.directiveEnd;for(let r=1+i.directiveStylingLast;r<m;r++){let T=a[r].hostAttrs;c=xm(c,T,d)}return xm(c,i.attrs,d)}function $1(a,i,d,c,m){let r=null,T=d.directiveEnd,M=d.directiveStylingLast;for(M===-1?M=d.directiveStart:M++;M<T&&(r=i[M],c=xm(c,r.hostAttrs,m),r!==a);)M++;return a!==null&&(d.directiveStylingLast=M),c}function xm(a,i,d){let c=d?1:2,m=-1;if(i!==null)for(let r=0;r<i.length;r++){let T=i[r];typeof T=="number"?m=T:m===c&&(Array.isArray(a)||(a=a===void 0?[]:["",a]),Nw(a,T,d?!0:i[++r]))}return a===void 0?null:a}function T5(a,i,d){if(d==null||d==="")return Ro;let c=[],m=Wv(d);if(Array.isArray(m))for(let r=0;r<m.length;r++)a(c,m[r],!0);else if(typeof m=="object")for(let r in m)m.hasOwnProperty(r)&&a(c,r,m[r]);else typeof m=="string"&&i(c,m);return c}function D5(a,i,d){let c=String(i);c!==""&&!c.includes(" ")&&Nw(a,c,d)}function I5(a,i,d,c,m,r,T,M){m===ll&&(m=Ro);let F=0,$=0,Q=0<m.length?m[0]:null,ue=0<r.length?r[0]:null;for(;Q!==null||ue!==null;){let Ae=F<m.length?m[F+1]:void 0,xe=$<r.length?r[$+1]:void 0,ke=null,Qe;Q===ue?(F+=2,$+=2,Ae!==xe&&(ke=ue,Qe=xe)):ue===null||Q!==null&&Q<ue?(F+=2,ke=Q):($+=2,ke=ue,Qe=xe),ke!==null&&iP(a,i,d,c,ke,Qe,T,M),Q=F<m.length?m[F]:null,ue=$<r.length?r[$]:null}}function iP(a,i,d,c,m,r,T,M){if(!(i.type&3))return;let F=a.data,$=F[M+1],Q=u5($)?qM(F,i,d,m,rf($),T):void 0;if(!Av(Q)){Av(r)||l5($)&&(r=qM(F,null,d,m,M,T));let ue=DA(Zu(),d);fV(c,T,ue,m,r)}}function qM(a,i,d,c,m,r){let T=i===null,M;for(;m>0;){let F=a[m],$=Array.isArray(F),Q=$?F[1]:F,ue=Q===null,Ae=d[m+1];Ae===ll&&(Ae=ue?Ro:void 0);let xe=ue?O1(Ae,c):Q===c?Ae:void 0;if($&&!Av(xe)&&(xe=O1(F,c)),Av(xe)&&(M=xe,T))return M;let ke=a[m+1];m=T?$u(ke):rf(ke)}if(i!==null){let F=r?i.residualClasses:i.residualStyles;F!=null&&(M=O1(F,c))}return M}function Av(a){return a!==void 0}function C5(a,i){return a==null||a===""||(typeof i=="string"?a=a+i:typeof a=="object"&&(a=_o(Wv(a)))),a}function rP(a,i){return(a.flags&(i?8:16))!==0}function Wr(a,i){Yu("NgControlFlow");let d=ai(),c=Wu(),m=d[c]!==ll?d[c]:-1,r=m!==-1?WM(d,Oo+m):void 0,T=0;if(cl(d,c,a)){let M=ci(null);try{if(r!==void 0&&HV(r,T),a!==-1){let F=Oo+a,$=WM(d,F),Q=S5(d[Fn],F),ue=vv($,Q.tView.ssrId),Ae=mE(d,Q,i,{dehydratedView:ue});gE($,Ae,T,_v(Q,ue))}}finally{ci(M)}}else if(r!==void 0){let M=$V(r,T);M!==void 0&&(M[gs]=i)}}function WM(a,i){return a[i]}function S5(a,i){return $w(a,i)}function M5(a,i,d,c,m,r){let T=i.consts,M=tf(T,m),F=af(i,a,2,c,M);return hE(i,d,F,tf(T,r)),F.attrs!==null&&Tv(F,F.attrs,!1),F.mergedAttrs!==null&&Tv(F,F.mergedAttrs,!0),i.queries!==null&&i.queries.elementStart(i,F),F}function Hn(a,i,d,c){let m=ai(),r=ir(),T=Oo+a,M=m[Ji],F=r.firstCreatePass?M5(T,r,m,i,d,c):r.data[T],$=A5(r,m,F,M,i,a);m[T]=$;let Q=Bv(F);return qu(F,!0),y2(M,$,F),!i5(F)&&Gv()&&Zv(r,m,$,F),eB()===0&&lc($,m),tB(),Q&&(cE(r,m,F),lE(r,F,m)),c!==null&&uE(m,F),Hn}function qn(){let a=Hr();qw()?Ww():(a=a.parent,qu(a,!1));let i=a;iB(i)&&rB(),nB();let d=ir();return d.firstCreatePass&&(Hv(d,a),Gw(a)&&d.queries.elementEnd(a)),i.classesWithoutHost!=null&&yB(i)&&Aw(d,i,ai(),i.classesWithoutHost,!0),i.stylesWithoutHost!=null&&vB(i)&&Aw(d,i,ai(),i.stylesWithoutHost,!1),qn}function or(a,i,d,c){return Hn(a,i,d,c),qn(),or}var A5=(a,i,d,c,m,r)=>($v(!0),c2(c,m,pB()));function P5(a,i,d,c,m){let r=i.consts,T=tf(r,c),M=af(i,a,8,"ng-container",T);T!==null&&Tv(M,T,!0);let F=tf(r,m);return hE(i,d,M,F),i.queries!==null&&i.queries.elementStart(i,M),M}function oP(a,i,d){let c=ai(),m=ir(),r=a+Oo,T=m.firstCreatePass?P5(r,m,c,i,d):m.data[r];qu(T,!0);let M=R5(m,c,T,a);return c[r]=M,Gv()&&Zv(m,c,M,T),lc(M,c),Bv(T)&&(cE(m,c,T),lE(m,T,c)),d!=null&&uE(c,T),oP}function sP(){let a=Hr(),i=ir();return qw()?Ww():(a=a.parent,qu(a,!1)),i.firstCreatePass&&(Hv(i,a),Gw(a)&&i.queries.elementEnd(a)),sP}function Sm(a,i,d){return oP(a,i,d),sP(),Sm}var R5=(a,i,d,c)=>($v(!0),KB(i[Ji],""));function i0(){return ai()}function lf(a,i,d){let c=ai(),m=Wu();if(cl(c,m,i)){let r=ir(),T=Em();Xv(r,T,c,a,i,c[Ji],d,!0)}return lf}function bE(a,i,d){let c=ai(),m=Wu();if(cl(c,m,i)){let r=ir(),T=Em(),M=Zw(r.data),F=P2(M,T,c);Xv(r,T,c,a,i,F,d,!0)}return bE}var Pv="en-US";var k5=Pv;function O5(a){typeof a=="string"&&(k5=a.toLowerCase().replace(/_/g,"-"))}var F5=(a,i,d)=>{};function Zr(a,i,d,c){let m=ai(),r=ir(),T=Hr();return wE(r,m,m[Ji],T,a,i,c),Zr}function xE(a,i){let d=Hr(),c=ai(),m=ir(),r=Zw(m.data),T=P2(r,d,c);return wE(m,c,T,d,a,i),xE}function L5(a,i,d,c){let m=a.cleanup;if(m!=null)for(let r=0;r<m.length-1;r+=2){let T=m[r];if(T===d&&m[r+1]===c){let M=i[lv],F=m[r+2];return M.length>F?M[F]:null}typeof T=="string"&&(r+=2)}return null}function wE(a,i,d,c,m,r,T){let M=Bv(c),$=a.firstCreatePass&&A2(a),Q=i[gs],ue=M2(i),Ae=!0;if(c.type&3||T){let Qe=ys(c,i),dt=T?T(Qe):Qe,st=ue.length,Nt=T?Xt=>T(ya(Xt[c.index])):c.index,gn=null;if(!T&&M&&(gn=L5(a,i,m,c.index)),gn!==null){let Xt=gn.__ngLastListenerFn__||gn;Xt.__ngNextListenerFn__=r,gn.__ngLastListenerFn__=r,Ae=!1}else{r=QM(c,i,Q,r),F5(Qe,m,r);let Xt=d.listen(dt,m,r);ue.push(r,Xt),$&&$.push(m,Nt,st,st+1)}}else r=QM(c,i,Q,r);let xe=c.outputs,ke;if(Ae&&xe!==null&&(ke=xe[m])){let Qe=ke.length;if(Qe)for(let dt=0;dt<Qe;dt+=2){let st=ke[dt],Nt=ke[dt+1],Ni=i[st][Nt].subscribe(r),Xn=ue.length;ue.push(r,Ni),$&&$.push(m,c.index,Xn,-(Xn+1))}}}function ZM(a,i,d,c){let m=ci(null);try{return ma(6,i,d),d(c)!==!1}catch(r){return R2(a,r),!1}finally{ma(7,i,d),ci(m)}}function QM(a,i,d,c){return function m(r){if(r===Function)return c;let T=a.componentOffset>-1?dc(a.index,i):i;_E(T,5);let M=ZM(i,d,c,r),F=m.__ngNextListenerFn__;for(;F;)M=ZM(i,d,F,r)&&M,F=F.__ngNextListenerFn__;return M}}function vo(a=1){return hB(a)}function N5(a,i){let d=null,c=v3(a);for(let m=0;m<i.length;m++){let r=i[m];if(r==="*"){d=m;continue}if(c===null?lA(a,r,!0):w3(c,r))return m}return d}function Ku(a){let i=ai()[_s][Fo];if(!i.projection){let d=a?a.length:1,c=i.projection=c3(d,null),m=c.slice(),r=i.child;for(;r!==null;){if(r.type!==128){let T=a?N5(r,a):0;T!==null&&(m[T]?m[T].projectionNext=r:c[T]=r,m[T]=r)}r=r.next}}}function Qr(a,i=0,d,c,m,r){let T=ai(),M=ir(),F=c?a+1:null;F!==null&&X2(T,M,F,c,m,r,null,d);let $=af(M,Oo+a,16,null,d||null);$.projection===null&&($.projection=i),Ww();let ue=!T[ym]||PA();T[_s][Fo].projection[$.projection]===null&&F!==null?z5(T,M,F):ue&&($.flags&32)!==32&&dV(M,T,$)}function z5(a,i,d){let c=Oo+d,m=i.data[c],r=a[c],T=vv(r,m.tView.ssrId),M=mE(a,m,void 0,{dehydratedView:T});gE(r,M,0,_v(m,T))}function hc(a,i,d,c){Bj(a,i,d,c)}function bo(a,i,d){zj(a,i,d)}function dr(a){let i=ai(),d=ir(),c=FA();Qw(c+1);let m=vE(d,c);if(a.dirty&&Y3(i)===((m.metadata.flags&2)===2)){if(m.matches===null)a.reset([]);else{let r=Uj(i,c);a.reset(r,RB),a.notifyOnChanges()}return!0}return!1}function hr(){return Nj(ai(),FA())}function Mm(a){let i=sB();return Q3(i,Oo+a)}function ul(a,i=""){let d=ai(),c=ir(),m=a+Oo,r=c.firstCreatePass?af(c,m,1,i,null):c.data[m],T=B5(c,d,r,i,a);d[m]=T,Gv()&&Zv(c,d,T,r),qu(r,!1)}var B5=(a,i,d,c,m)=>($v(!0),YB(i[Ji],c));function EE(a){return cf("",a,""),EE}function cf(a,i,d){let c=ai(),m=a5(c,a,i,d);return m!==ll&&VV(c,Zu(),m),cf}function TE(a,i,d){Y2(i)&&(i=i());let c=ai(),m=Wu();if(cl(c,m,i)){let r=ir(),T=Em();Xv(r,T,c,a,i,c[Ji],d,!1)}return TE}function aP(a,i){let d=Y2(a);return d&&a.set(i),d}function DE(a,i){let d=ai(),c=ir(),m=Hr();return wE(c,d,d[Ji],m,a,i),DE}function V5(a,i,d){let c=ir();if(c.firstCreatePass){let m=ol(a);Pw(d,c.data,c.blueprint,m,!0),Pw(i,c.data,c.blueprint,m,!1)}}function Pw(a,i,d,c,m){if(a=go(a),Array.isArray(a))for(let r=0;r<a.length;r++)Pw(a[r],i,d,c,m);else{let r=ir(),T=ai(),M=Hr(),F=Kh(a)?a:go(a.provide),$=gA(a),Q=M.providerIndexes&1048575,ue=M.directiveStart,Ae=M.providerIndexes>>20;if(Kh(a)||!a.multi){let xe=new ju($,m,Tt),ke=q1(F,i,m?Q:Q+Ae,ue);ke===-1?(sw(fv(M,T),r,F),H1(r,a,i.length),i.push(F),M.directiveStart++,M.directiveEnd++,m&&(M.providerIndexes+=1048576),d.push(xe),T.push(xe)):(d[ke]=xe,T[ke]=xe)}else{let xe=q1(F,i,Q+Ae,ue),ke=q1(F,i,Q,Q+Ae),Qe=xe>=0&&d[xe],dt=ke>=0&&d[ke];if(m&&!dt||!m&&!Qe){sw(fv(M,T),r,F);let st=G5(m?U5:j5,d.length,m,c,$);!m&&dt&&(d[ke].providerFactory=st),H1(r,a,i.length,0),i.push(F),M.directiveStart++,M.directiveEnd++,m&&(M.providerIndexes+=1048576),d.push(st),T.push(st)}else{let st=lP(d[m?ke:xe],$,!m&&c);H1(r,a,xe>-1?xe:ke,st)}!m&&c&&dt&&d[ke].componentProviders++}}}function H1(a,i,d,c){let m=Kh(i),r=F3(i);if(m||r){let F=(r?go(i.useClass):i).prototype.ngOnDestroy;if(F){let $=a.destroyHooks||(a.destroyHooks=[]);if(!m&&i.multi){let Q=$.indexOf(d);Q===-1?$.push(d,[c,F]):$[Q+1].push(c,F)}else $.push(d,F)}}}function lP(a,i,d){return d&&a.componentProviders++,a.multi.push(i)-1}function q1(a,i,d,c){for(let m=d;m<c;m++)if(i[m]===a)return m;return-1}function j5(a,i,d,c){return Rw(this.multi,[])}function U5(a,i,d,c){let m=this.multi,r;if(this.providerFactory){let T=this.providerFactory.componentProviders,M=Uu(d,d[Fn],this.providerFactory.index,c);r=M.slice(0,T),Rw(m,r);for(let F=T;F<M.length;F++)r.push(M[F])}else r=[],Rw(m,r);return r}function Rw(a,i){for(let d=0;d<a.length;d++){let c=a[d];i.push(c())}return i}function G5(a,i,d,c,m){let r=new ju(a,d,Tt);return r.multi=[],r.index=i,r.componentProviders=0,lP(r,m,c&&!d),r}function Ko(a,i=[]){return d=>{d.providersResolver=(c,m)=>V5(c,m?m(a):a,i)}}var $5=(()=>{let i=class i{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let m=fA(!1,c.type),r=m.length>0?n5([m],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,r)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}};i.\u0275prov=Ft({token:i,providedIn:"environment",factory:()=>new i(Ze(ms))});let a=i;return a})();function vs(a){Yu("NgStandalone"),a.getStandaloneInjector=i=>i.get($5).getOrCreateStandaloneInjector(a)}function r0(a,i){return Jv(a,i)}var Xy=null;function H5(a){Xy!==null&&(a.defaultEncapsulation!==Xy.defaultEncapsulation||a.preserveWhitespaces!==Xy.preserveWhitespaces)||(Xy=a)}var IE=new Pt(""),Am=new Pt(""),o0=(()=>{let i=class i{constructor(c,m,r){this._ngZone=c,this.registry=m,this._isZoneStable=!0,this._callbacks=[],this.taskTrackingZone=null,CE||(q5(r),r.addToWindow(m)),this._watchAngularEvents(),c.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Wt.assertNotInAngularZone(),queueMicrotask(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}isStable(){return this._isZoneStable&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())queueMicrotask(()=>{for(;this._callbacks.length!==0;){let c=this._callbacks.pop();clearTimeout(c.timeoutId),c.doneCb()}});else{let c=this.getPendingTasks();this._callbacks=this._callbacks.filter(m=>m.updateCb&&m.updateCb(c)?(clearTimeout(m.timeoutId),!1):!0)}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(c=>({source:c.source,creationLocation:c.creationLocation,data:c.data})):[]}addCallback(c,m,r){let T=-1;m&&m>0&&(T=setTimeout(()=>{this._callbacks=this._callbacks.filter(M=>M.timeoutId!==T),c()},m)),this._callbacks.push({doneCb:c,timeoutId:T,updateCb:r})}whenStable(c,m,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(c,m,r),this._runCallbacksIfReady()}registerApplication(c){this.registry.registerApplication(c,this)}unregisterApplication(c){this.registry.unregisterApplication(c)}findProviders(c,m,r){return[]}};i.\u0275fac=function(m){return new(m||i)(Ze(Wt),Ze(s0),Ze(Am))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),s0=(()=>{let i=class i{constructor(){this._applications=new Map}registerApplication(c,m){this._applications.set(c,m)}unregisterApplication(c){this._applications.delete(c)}unregisterAllApplications(){this._applications.clear()}getTestability(c){return this._applications.get(c)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(c,m=!0){return CE?.findTestabilityInTree(this,c,m)??null}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"platform"});let a=i;return a})();function q5(a){CE=a}var CE;function Pm(a){return!!a&&typeof a.then=="function"}function cP(a){return!!a&&typeof a.subscribe=="function"}var W5=new Pt(""),uP=(()=>{let i=class i{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,m)=>{this.resolve=c,this.reject=m}),this.appInits=Ot(W5,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let r of this.appInits){let T=r();if(Pm(T))c.push(T);else if(cP(T)){let M=new Promise((F,$)=>{T.subscribe({complete:F,error:$})});c.push(M)}}let m=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{m()}).catch(r=>{this.reject(r)}),c.length===0&&m(),this.initialized=!0}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),dP=new Pt("");function Z5(){VS(()=>{throw new kt(600,!1)})}function Q5(a){return a.isBoundToModule}var Y5=10;function X5(a,i,d){try{let c=d();return Pm(c)?c.catch(m=>{throw i.runOutsideAngular(()=>a.handleError(m)),m}):c}catch(c){throw i.runOutsideAngular(()=>a.handleError(c)),c}}function hP(a,i){return Array.isArray(i)?i.reduce(hP,a):Yt(Yt({},a),i)}var fc=(()=>{let i=class i{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=Ot(e2),this.afterRenderEffectManager=Ot(t0),this.zonelessEnabled=Ot(B2),this.externalTestViews=new Set,this.beforeRender=new Tn,this.afterTick=new Tn,this.componentTypes=[],this.components=[],this.isStable=Ot(Qu).hasPendingTasks.pipe(Nr(c=>!c)),this._injector=Ot(ms)}get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,m){let r=c instanceof bv;if(!this._injector.get(uP).done){let xe=!r&&S3(c),ke=!1;throw new kt(405,ke)}let M;r?M=c:M=this._injector.get(ba).resolveComponentFactory(c),this.componentTypes.push(M.componentType);let F=Q5(M)?void 0:this._injector.get(uc),$=m||M.selector,Q=M.create(nr.NULL,[],$,F),ue=Q.location.nativeElement,Ae=Q.injector.get(IE,null);return Ae?.registerApplication(ue),Q.onDestroy(()=>{this.detachView(Q.hostView),iv(this.components,Q),Ae?.unregisterApplication(ue)}),this._loadComponent(Q),Q}tick(){this._tick(!0)}_tick(c){if(this._runningTick)throw new kt(101,!1);let m=ci(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(c)}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,ci(m),this.afterTick.next()}}detectChangesInAttachedViews(c){let m=null;this._injector.destroyed||(m=this._injector.get(cc,null,{optional:!0}));let r=0,T=this.afterRenderEffectManager;for(;r<Y5;){let M=r===0;if(c||!M){this.beforeRender.next(M);for(let{_lView:F,notifyErrorHandler:$}of this._views)K5(F,$,M,this.zonelessEnabled)}else m?.begin?.(),m?.end?.();if(r++,T.executeInternalCallbacks(),!this.allViews.some(({_lView:F})=>bm(F))&&(T.execute(),!this.allViews.some(({_lView:F})=>bm(F))))break}}attachView(c){let m=c;this._views.push(m),m.attachToAppRef(this)}detachView(c){let m=c;iv(this._views,m),m.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let m=this._injector.get(dP,[]);[...this._bootstrapListeners,...m].forEach(r=>r(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>iv(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new kt(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function iv(a,i){let d=a.indexOf(i);d>-1&&a.splice(d,1)}function K5(a,i,d,c){if(!d&&!bm(a))return;F2(a,i,d&&!c?0:1)}var J5=new Pt("");function e4(a,i,d){let c=new Iw(d);return Promise.resolve(c)}function YM(a){for(let i=a.length-1;i>=0;i--)if(a[i]!==void 0)return a[i]}var t4=(()=>{let i=class i{constructor(){this.zone=Ot(Wt),this.changeDetectionScheduler=Ot(nf),this.applicationRef=Ot(fc)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function n4({ngZoneFactory:a,ignoreChangesOutsideZone:i}){return a??=()=>new Wt(fP()),[{provide:Wt,useFactory:a},{provide:mm,multi:!0,useFactory:()=>{let d=Ot(t4,{optional:!0});return()=>d.initialize()}},{provide:mm,multi:!0,useFactory:()=>{let d=Ot(r4);return()=>{d.initialize()}}},{provide:e2,useFactory:i4},i===!0?{provide:V2,useValue:!0}:[]]}function i4(){let a=Ot(Wt),i=Ot(va);return d=>a.runOutsideAngular(()=>i.handleError(d))}function fP(a){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:a?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:a?.runCoalescing??!1}}var r4=(()=>{let i=class i{constructor(){this.subscription=new Ki,this.initialized=!1,this.zone=Ot(Wt),this.pendingTasks=Ot(Qu)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Wt.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Wt.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var o4=(()=>{let i=class i{constructor(){this.appRef=Ot(fc),this.taskService=Ot(Qu),this.ngZone=Ot(Wt),this.zonelessEnabled=Ot(B2),this.disableScheduling=Ot(V2,{optional:!0})??!1,this.zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run,this.schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}],this.subscriptions=new Ki,this.cancelScheduledCallback=null,this.shouldRefreshViews=!1,this.useMicrotaskScheduler=!1,this.runningTick=!1,this.pendingRenderTaskId=null,this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof xv||!this.zoneIsDefined)}notify(c){if(!this.zonelessEnabled&&c===5)return;switch(c){case 3:case 2:case 0:case 4:case 5:case 1:{this.shouldRefreshViews=!0;break}case 8:case 7:case 6:case 9:default:}if(!this.shouldScheduleTick())return;let m=this.useMicrotaskScheduler?BM:j2;this.pendingRenderTaskId=this.taskService.add(),this.zoneIsDefined?Zone.root.run(()=>{this.cancelScheduledCallback=m(()=>{this.tick(this.shouldRefreshViews)})}):this.cancelScheduledCallback=m(()=>{this.tick(this.shouldRefreshViews)})}shouldScheduleTick(){return!(this.disableScheduling||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Wt.isInAngularZone())}tick(c){if(this.runningTick||this.appRef.destroyed)return;let m=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick(c)},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(m),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,BM(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(m)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.shouldRefreshViews=!1,this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let c=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(c)}}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function s4(){return typeof $localize<"u"&&$localize.locale||Pv}var a0=new Pt("",{providedIn:"root",factory:()=>Ot(a0,si.Optional|si.SkipSelf)||s4()});var pP=new Pt(""),mP=(()=>{let i=class i{constructor(c){this._injector=c,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(c,m){let r=_j(m?.ngZone,fP({eventCoalescing:m?.ngZoneEventCoalescing,runCoalescing:m?.ngZoneRunCoalescing}));return r.run(()=>{let T=m?.ignoreChangesOutsideZone,M=t5(c.moduleType,this.injector,[...n4({ngZoneFactory:()=>r,ignoreChangesOutsideZone:T}),{provide:nf,useExisting:o4}]),F=M.injector.get(va,null);return r.runOutsideAngular(()=>{let $=r.onError.subscribe({next:Q=>{F.handleError(Q)}});M.onDestroy(()=>{iv(this._modules,M),$.unsubscribe()})}),X5(F,r,()=>{let $=M.injector.get(uP);return $.runInitializers(),$.donePromise.then(()=>{let Q=M.injector.get(a0,Pv);return O5(Q||Pv),this._moduleDoBootstrap(M),M})})})}bootstrapModule(c,m=[]){let r=hP({},m);return e4(this.injector,r,c).then(T=>this.bootstrapModuleFactory(T,r))}_moduleDoBootstrap(c){let m=c.injector.get(fc);if(c._bootstrapComponents.length>0)c._bootstrapComponents.forEach(r=>m.bootstrap(r));else if(c.instance.ngDoBootstrap)c.instance.ngDoBootstrap(m);else throw new kt(-403,!1);this._modules.push(c)}onDestroy(c){this._destroyListeners.push(c)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new kt(404,!1);this._modules.slice().forEach(m=>m.destroy()),this._destroyListeners.forEach(m=>m());let c=this._injector.get(pP,null);c&&(c.forEach(m=>m()),c.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}};i.\u0275fac=function(m){return new(m||i)(Ze(nr))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"platform"});let a=i;return a})(),fm=null,gP=new Pt("");function a4(a){if(fm&&!fm.get(gP,!1))throw new kt(400,!1);Z5(),fm=a;let i=a.get(mP);return u4(a),i}function SE(a,i,d=[]){let c=`Platform: ${i}`,m=new Pt(c);return(r=[])=>{let T=_P();if(!T||T.injector.get(gP,!1)){let M=[...d,...r,{provide:m,useValue:!0}];a?a(M):a4(l4(M,c))}return c4(m)}}function l4(a=[],i){return nr.create({name:i,providers:[{provide:Fv,useValue:"platform"},{provide:pP,useValue:new Set([()=>fm=null])},...a]})}function c4(a){let i=_P();if(!i)throw new kt(401,!1);return i}function _P(){return fm?.get(mP)??null}function u4(a){a.get(tE,null)?.forEach(d=>d())}var Ea=(()=>{let i=class i{};i.__NG_ELEMENT_ID__=d4;let a=i;return a})();function d4(a){return h4(Hr(),ai(),(a&16)===16)}function h4(a,i,d){if(zv(a)&&!d){let c=dc(a.index,i);return new Gu(c,c)}else if(a.type&175){let c=i[_s];return new Gu(c,i)}return null}var yP=SE(null,"core",[]),vP=(()=>{let i=class i{constructor(c){}};i.\u0275fac=function(m){return new(m||i)(Ze(fc))},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})();function Xs(a){return typeof a=="boolean"?a:a!=null&&a!=="false"}function uf(a,i=NaN){return!isNaN(parseFloat(a))&&!isNaN(Number(a))?Number(a):i}function ME(a){let i=ci(null);try{return a()}finally{ci(i)}}var EP=null;function Ta(){return EP}function TP(a){EP??=a}var l0=class{};var jn=new Pt(""),DP=(()=>{let i=class i{historyGo(c){throw new Error("")}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:()=>Ot(m4),providedIn:"platform"});let a=i;return a})();var m4=(()=>{let i=class i extends DP{constructor(){super(),this._doc=Ot(jn),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ta().getBaseHref(this._doc)}onPopState(c){let m=Ta().getGlobalEventTarget(this._doc,"window");return m.addEventListener("popstate",c,!1),()=>m.removeEventListener("popstate",c)}onHashChange(c){let m=Ta().getGlobalEventTarget(this._doc,"window");return m.addEventListener("hashchange",c,!1),()=>m.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,m,r){this._history.pushState(c,m,r)}replaceState(c,m,r){this._history.replaceState(c,m,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:()=>new i,providedIn:"platform"});let a=i;return a})();function IP(a,i){if(a.length==0)return i;if(i.length==0)return a;let d=0;return a.endsWith("/")&&d++,i.startsWith("/")&&d++,d==2?a+i.substring(1):d==1?a+i:a+"/"+i}function bP(a){let i=a.match(/#|\?|$/),d=i&&i.index||a.length,c=d-(a[d-1]==="/"?1:0);return a.slice(0,c)+a.slice(d)}function Ju(a){return a&&a[0]!=="?"?"?"+a:a}var kE=(()=>{let i=class i{historyGo(c){throw new Error("")}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:()=>Ot(_4),providedIn:"root"});let a=i;return a})(),g4=new Pt(""),_4=(()=>{let i=class i extends kE{constructor(c,m){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=m??this._platformLocation.getBaseHrefFromDOM()??Ot(jn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return IP(this._baseHref,c)}path(c=!1){let m=this._platformLocation.pathname+Ju(this._platformLocation.search),r=this._platformLocation.hash;return r&&c?`${m}${r}`:m}pushState(c,m,r,T){let M=this.prepareExternalUrl(r+Ju(T));this._platformLocation.pushState(c,m,M)}replaceState(c,m,r,T){let M=this.prepareExternalUrl(r+Ju(T));this._platformLocation.replaceState(c,m,M)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}};i.\u0275fac=function(m){return new(m||i)(Ze(DP),Ze(g4,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var OE=(()=>{let i=class i{constructor(c){this._subject=new Ui,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let m=this._locationStrategy.getBaseHref();this._basePath=b4(bP(xP(m))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,m=""){return this.path()==this.normalize(c+Ju(m))}normalize(c){return i.stripTrailingSlash(v4(this._basePath,xP(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,m="",r=null){this._locationStrategy.pushState(r,"",c,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Ju(m)),r)}replaceState(c,m="",r=null){this._locationStrategy.replaceState(r,"",c,m),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+Ju(m)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription??=this.subscribe(m=>{this._notifyUrlChangeListeners(m.url,m.state)}),()=>{let m=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(m,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",m){this._urlChangeListeners.forEach(r=>r(c,m))}subscribe(c,m,r){return this._subject.subscribe({next:c,error:m,complete:r})}};i.normalizeQueryParams=Ju,i.joinWithSlash=IP,i.stripTrailingSlash=bP,i.\u0275fac=function(m){return new(m||i)(Ze(kE))},i.\u0275prov=Ft({token:i,factory:()=>y4(),providedIn:"root"});let a=i;return a})();function y4(){return new OE(Ze(kE))}function v4(a,i){if(!a||!i.startsWith(a))return i;let d=i.substring(a.length);return d===""||["/",";","?","#"].includes(d[0])?d:i}function xP(a){return a.replace(/\/index.html$/,"")}function b4(a){if(new RegExp("^(https?:)?//").test(a)){let[,d]=a.split(/\/\/[^\/]+/);return d}return a}function c0(a,i){i=encodeURIComponent(i);for(let d of a.split(";")){let c=d.indexOf("="),[m,r]=c==-1?[d,""]:[d.slice(0,c),d.slice(c+1)];if(m.trim()===i)return decodeURIComponent(r)}return null}var CP=(()=>{let i=class i{constructor(c,m){this._viewContainer=c,this._context=new PE,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=m}set ngIf(c){this._context.$implicit=this._context.ngIf=c,this._updateView()}set ngIfThen(c){wP("ngIfThen",c),this._thenTemplateRef=c,this._thenViewRef=null,this._updateView()}set ngIfElse(c){wP("ngIfElse",c),this._elseTemplateRef=c,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(c,m){return!0}};i.\u0275fac=function(m){return new(m||i)(Tt(wa),Tt(Zs))},i.\u0275dir=ui({type:i,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let a=i;return a})(),PE=class{constructor(){this.$implicit=null,this.ngIf=null}};function wP(a,i){if(!!!(!i||i.createEmbeddedView))throw new Error(`${a} must be a TemplateRef, but received '${_o(i)}'.`)}var u0=(()=>{let i=class i{constructor(c){this._viewContainerRef=c,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(c){if(this._shouldRecreateView(c)){let m=this._viewContainerRef;if(this._viewRef&&m.remove(m.indexOf(this._viewRef)),!this.ngTemplateOutlet){this._viewRef=null;return}let r=this._createContextForwardProxy();this._viewRef=m.createEmbeddedView(this.ngTemplateOutlet,r,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(c){return!!c.ngTemplateOutlet||!!c.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(c,m,r)=>this.ngTemplateOutletContext?Reflect.set(this.ngTemplateOutletContext,m,r):!1,get:(c,m,r)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,m,r)}})}};i.\u0275fac=function(m){return new(m||i)(Tt(wa))},i.\u0275dir=ui({type:i,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Xo]});let a=i;return a})();var hf=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})(),FE="browser",x4="server";function SP(a){return a===FE}function d0(a){return a===x4}var df=class{};var km=class{},f0=class{},dl=class a{constructor(i){this.normalizedNames=new Map,this.lazyUpdate=null,i?typeof i=="string"?this.lazyInit=()=>{this.headers=new Map,i.split(`
`).forEach(d=>{let c=d.indexOf(":");if(c>0){let m=d.slice(0,c),r=m.toLowerCase(),T=d.slice(c+1).trim();this.maybeSetNormalizedName(m,r),this.headers.has(r)?this.headers.get(r).push(T):this.headers.set(r,[T])}})}:typeof Headers<"u"&&i instanceof Headers?(this.headers=new Map,i.forEach((d,c)=>{this.setHeaderEntries(c,d)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(i).forEach(([d,c])=>{this.setHeaderEntries(d,c)})}:this.headers=new Map}has(i){return this.init(),this.headers.has(i.toLowerCase())}get(i){this.init();let d=this.headers.get(i.toLowerCase());return d&&d.length>0?d[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(i){return this.init(),this.headers.get(i.toLowerCase())||null}append(i,d){return this.clone({name:i,value:d,op:"a"})}set(i,d){return this.clone({name:i,value:d,op:"s"})}delete(i,d){return this.clone({name:i,value:d,op:"d"})}maybeSetNormalizedName(i,d){this.normalizedNames.has(d)||this.normalizedNames.set(d,i)}init(){this.lazyInit&&(this.lazyInit instanceof a?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(i=>this.applyUpdate(i)),this.lazyUpdate=null))}copyFrom(i){i.init(),Array.from(i.headers.keys()).forEach(d=>{this.headers.set(d,i.headers.get(d)),this.normalizedNames.set(d,i.normalizedNames.get(d))})}clone(i){let d=new a;return d.lazyInit=this.lazyInit&&this.lazyInit instanceof a?this.lazyInit:this,d.lazyUpdate=(this.lazyUpdate||[]).concat([i]),d}applyUpdate(i){let d=i.name.toLowerCase();switch(i.op){case"a":case"s":let c=i.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(i.name,d);let m=(i.op==="a"?this.headers.get(d):void 0)||[];m.push(...c),this.headers.set(d,m);break;case"d":let r=i.value;if(!r)this.headers.delete(d),this.normalizedNames.delete(d);else{let T=this.headers.get(d);if(!T)return;T=T.filter(M=>r.indexOf(M)===-1),T.length===0?(this.headers.delete(d),this.normalizedNames.delete(d)):this.headers.set(d,T)}break}}setHeaderEntries(i,d){let c=(Array.isArray(d)?d:[d]).map(r=>r.toString()),m=i.toLowerCase();this.headers.set(m,c),this.maybeSetNormalizedName(i,m)}forEach(i){this.init(),Array.from(this.normalizedNames.keys()).forEach(d=>i(this.normalizedNames.get(d),this.headers.get(d)))}};var zE=class{encodeKey(i){return MP(i)}encodeValue(i){return MP(i)}decodeKey(i){return decodeURIComponent(i)}decodeValue(i){return decodeURIComponent(i)}};function E4(a,i){let d=new Map;return a.length>0&&a.replace(/^\?/,"").split("&").forEach(m=>{let r=m.indexOf("="),[T,M]=r==-1?[i.decodeKey(m),""]:[i.decodeKey(m.slice(0,r)),i.decodeValue(m.slice(r+1))],F=d.get(T)||[];F.push(M),d.set(T,F)}),d}var T4=/%(\d[a-f0-9])/gi,D4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function MP(a){return encodeURIComponent(a).replace(T4,(i,d)=>D4[d]??i)}function h0(a){return`${a}`}var mc=class a{constructor(i={}){if(this.updates=null,this.cloneFrom=null,this.encoder=i.encoder||new zE,i.fromString){if(i.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=E4(i.fromString,this.encoder)}else i.fromObject?(this.map=new Map,Object.keys(i.fromObject).forEach(d=>{let c=i.fromObject[d],m=Array.isArray(c)?c.map(h0):[h0(c)];this.map.set(d,m)})):this.map=null}has(i){return this.init(),this.map.has(i)}get(i){this.init();let d=this.map.get(i);return d?d[0]:null}getAll(i){return this.init(),this.map.get(i)||null}keys(){return this.init(),Array.from(this.map.keys())}append(i,d){return this.clone({param:i,value:d,op:"a"})}appendAll(i){let d=[];return Object.keys(i).forEach(c=>{let m=i[c];Array.isArray(m)?m.forEach(r=>{d.push({param:c,value:r,op:"a"})}):d.push({param:c,value:m,op:"a"})}),this.clone(d)}set(i,d){return this.clone({param:i,value:d,op:"s"})}delete(i,d){return this.clone({param:i,value:d,op:"d"})}toString(){return this.init(),this.keys().map(i=>{let d=this.encoder.encodeKey(i);return this.map.get(i).map(c=>d+"="+this.encoder.encodeValue(c)).join("&")}).filter(i=>i!=="").join("&")}clone(i){let d=new a({encoder:this.encoder});return d.cloneFrom=this.cloneFrom||this,d.updates=(this.updates||[]).concat(i),d}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(i=>this.map.set(i,this.cloneFrom.map.get(i))),this.updates.forEach(i=>{switch(i.op){case"a":case"s":let d=(i.op==="a"?this.map.get(i.param):void 0)||[];d.push(h0(i.value)),this.map.set(i.param,d);break;case"d":if(i.value!==void 0){let c=this.map.get(i.param)||[],m=c.indexOf(h0(i.value));m!==-1&&c.splice(m,1),c.length>0?this.map.set(i.param,c):this.map.delete(i.param)}else{this.map.delete(i.param);break}}}),this.cloneFrom=this.updates=null)}};var BE=class{constructor(){this.map=new Map}set(i,d){return this.map.set(i,d),this}get(i){return this.map.has(i)||this.map.set(i,i.defaultValue()),this.map.get(i)}delete(i){return this.map.delete(i),this}has(i){return this.map.has(i)}keys(){return this.map.keys()}};function I4(a){switch(a){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function AP(a){return typeof ArrayBuffer<"u"&&a instanceof ArrayBuffer}function PP(a){return typeof Blob<"u"&&a instanceof Blob}function RP(a){return typeof FormData<"u"&&a instanceof FormData}function C4(a){return typeof URLSearchParams<"u"&&a instanceof URLSearchParams}var Rm=class a{constructor(i,d,c,m){this.url=d,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=i.toUpperCase();let r;if(I4(this.method)||m?(this.body=c!==void 0?c:null,r=m):r=c,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new dl,this.context??=new BE,!this.params)this.params=new mc,this.urlWithParams=d;else{let T=this.params.toString();if(T.length===0)this.urlWithParams=d;else{let M=d.indexOf("?"),F=M===-1?"?":M<d.length-1?"&":"";this.urlWithParams=d+F+T}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||AP(this.body)||PP(this.body)||RP(this.body)||C4(this.body)?this.body:this.body instanceof mc?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||RP(this.body)?null:PP(this.body)?this.body.type||null:AP(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof mc?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(i={}){let d=i.method||this.method,c=i.url||this.url,m=i.responseType||this.responseType,r=i.transferCache??this.transferCache,T=i.body!==void 0?i.body:this.body,M=i.withCredentials??this.withCredentials,F=i.reportProgress??this.reportProgress,$=i.headers||this.headers,Q=i.params||this.params,ue=i.context??this.context;return i.setHeaders!==void 0&&($=Object.keys(i.setHeaders).reduce((Ae,xe)=>Ae.set(xe,i.setHeaders[xe]),$)),i.setParams&&(Q=Object.keys(i.setParams).reduce((Ae,xe)=>Ae.set(xe,i.setParams[xe]),Q)),new a(d,c,T,{params:Q,headers:$,context:ue,reportProgress:F,responseType:m,withCredentials:M,transferCache:r})}},gc=function(a){return a[a.Sent=0]="Sent",a[a.UploadProgress=1]="UploadProgress",a[a.ResponseHeader=2]="ResponseHeader",a[a.DownloadProgress=3]="DownloadProgress",a[a.Response=4]="Response",a[a.User=5]="User",a}(gc||{}),Om=class{constructor(i,d=200,c="OK"){this.headers=i.headers||new dl,this.status=i.status!==void 0?i.status:d,this.statusText=i.statusText||c,this.url=i.url||null,this.ok=this.status>=200&&this.status<300}},p0=class a extends Om{constructor(i={}){super(i),this.type=gc.ResponseHeader}clone(i={}){return new a({headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},Fm=class a extends Om{constructor(i={}){super(i),this.type=gc.Response,this.body=i.body!==void 0?i.body:null}clone(i={}){return new a({body:i.body!==void 0?i.body:this.body,headers:i.headers||this.headers,status:i.status!==void 0?i.status:this.status,statusText:i.statusText||this.statusText,url:i.url||this.url||void 0})}},pc=class extends Om{constructor(i){super(i,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${i.url||"(unknown url)"}`:this.message=`Http failure response for ${i.url||"(unknown url)"}: ${i.status} ${i.statusText}`,this.error=i.error||null}},NP=200,S4=204;function NE(a,i){return{body:i,headers:a.headers,context:a.context,observe:a.observe,params:a.params,reportProgress:a.reportProgress,responseType:a.responseType,withCredentials:a.withCredentials,transferCache:a.transferCache}}var M4=(()=>{let i=class i{constructor(c){this.handler=c}request(c,m,r={}){let T;if(c instanceof Rm)T=c;else{let $;r.headers instanceof dl?$=r.headers:$=new dl(r.headers);let Q;r.params&&(r.params instanceof mc?Q=r.params:Q=new mc({fromObject:r.params})),T=new Rm(c,m,r.body!==void 0?r.body:null,{headers:$,context:r.context,params:Q,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let M=ic(T).pipe(P1($=>this.handler.handle($)));if(c instanceof Rm||r.observe==="events")return M;let F=M.pipe(hs($=>$ instanceof Fm));switch(r.observe||"body"){case"body":switch(T.responseType){case"arraybuffer":return F.pipe(Nr($=>{if($.body!==null&&!($.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return $.body}));case"blob":return F.pipe(Nr($=>{if($.body!==null&&!($.body instanceof Blob))throw new Error("Response is not a Blob.");return $.body}));case"text":return F.pipe(Nr($=>{if($.body!==null&&typeof $.body!="string")throw new Error("Response is not a string.");return $.body}));case"json":default:return F.pipe(Nr($=>$.body))}case"response":return F;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(c,m={}){return this.request("DELETE",c,m)}get(c,m={}){return this.request("GET",c,m)}head(c,m={}){return this.request("HEAD",c,m)}jsonp(c,m){return this.request("JSONP",c,{params:new mc().append(m,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,m={}){return this.request("OPTIONS",c,m)}patch(c,m,r={}){return this.request("PATCH",c,NE(r,m))}post(c,m,r={}){return this.request("POST",c,NE(r,m))}put(c,m,r={}){return this.request("PUT",c,NE(r,m))}};i.\u0275fac=function(m){return new(m||i)(Ze(km))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),A4=/^\)\]\}',?\n/,P4="X-Request-URL";function kP(a){if(a.url)return a.url;let i=P4.toLocaleLowerCase();return a.headers.get(i)}var R4=(()=>{let i=class i{constructor(){this.fetchImpl=Ot(VE,{optional:!0})?.fetch??fetch.bind(globalThis),this.ngZone=Ot(Wt)}handle(c){return new oi(m=>{let r=new AbortController;return this.doRequest(c,r.signal,m).then(jE,T=>m.error(new pc({error:T}))),()=>r.abort()})}doRequest(c,m,r){return d1(this,null,function*(){let T=this.createRequestInit(c),M;try{let ke=this.fetchImpl(c.urlWithParams,Yt({signal:m},T));k4(ke),r.next({type:gc.Sent}),M=yield ke}catch(ke){r.error(new pc({error:ke,status:ke.status??0,statusText:ke.statusText,url:c.urlWithParams,headers:ke.headers}));return}let F=new dl(M.headers),$=M.statusText,Q=kP(M)??c.urlWithParams,ue=M.status,Ae=null;if(c.reportProgress&&r.next(new p0({headers:F,status:ue,statusText:$,url:Q})),M.body){let ke=M.headers.get("content-length"),Qe=[],dt=M.body.getReader(),st=0,Nt,gn,Xt=typeof Zone<"u"&&Zone.current;yield this.ngZone.runOutsideAngular(()=>d1(this,null,function*(){for(;;){let{done:Xn,value:Gt}=yield dt.read();if(Xn)break;if(Qe.push(Gt),st+=Gt.length,c.reportProgress){gn=c.responseType==="text"?(gn??"")+(Nt??=new TextDecoder).decode(Gt,{stream:!0}):void 0;let vi=()=>r.next({type:gc.DownloadProgress,total:ke?+ke:void 0,loaded:st,partialText:gn});Xt?Xt.run(vi):vi()}}}));let Ni=this.concatChunks(Qe,st);try{let Xn=M.headers.get("Content-Type")??"";Ae=this.parseBody(c,Ni,Xn)}catch(Xn){r.error(new pc({error:Xn,headers:new dl(M.headers),status:M.status,statusText:M.statusText,url:kP(M)??c.urlWithParams}));return}}ue===0&&(ue=Ae?NP:0),ue>=200&&ue<300?(r.next(new Fm({body:Ae,headers:F,status:ue,statusText:$,url:Q})),r.complete()):r.error(new pc({error:Ae,headers:F,status:ue,statusText:$,url:Q}))})}parseBody(c,m,r){switch(c.responseType){case"json":let T=new TextDecoder().decode(m).replace(A4,"");return T===""?null:JSON.parse(T);case"text":return new TextDecoder().decode(m);case"blob":return new Blob([m],{type:r});case"arraybuffer":return m.buffer}}createRequestInit(c){let m={},r=c.withCredentials?"include":void 0;if(c.headers.forEach((T,M)=>m[T]=M.join(",")),m.Accept??="application/json, text/plain, */*",!m["Content-Type"]){let T=c.detectContentTypeHeader();T!==null&&(m["Content-Type"]=T)}return{body:c.serializeBody(),method:c.method,headers:m,credentials:r}}concatChunks(c,m){let r=new Uint8Array(m),T=0;for(let M of c)r.set(M,T),T+=M.length;return r}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),VE=class{};function jE(){}function k4(a){a.then(jE,jE)}function zP(a,i){return i(a)}function O4(a,i){return(d,c)=>i.intercept(d,{handle:m=>a(m,c)})}function F4(a,i,d){return(c,m)=>Lv(d,()=>i(c,r=>a(r,m)))}var L4=new Pt(""),UE=new Pt(""),N4=new Pt(""),BP=new Pt("",{providedIn:"root",factory:()=>!0});function z4(){let a=null;return(i,d)=>{a===null&&(a=(Ot(L4,{optional:!0})??[]).reduceRight(O4,zP));let c=Ot(Qu);if(Ot(BP)){let r=c.add();return a(i,d).pipe(Hy(()=>c.remove(r)))}else return a(i,d)}}var OP=(()=>{let i=class i extends km{constructor(c,m){super(),this.backend=c,this.injector=m,this.chain=null,this.pendingTasks=Ot(Qu),this.contributeToStability=Ot(BP)}handle(c){if(this.chain===null){let m=Array.from(new Set([...this.injector.get(UE),...this.injector.get(N4,[])]));this.chain=m.reduceRight((r,T)=>F4(r,T,this.injector),zP)}if(this.contributeToStability){let m=this.pendingTasks.add();return this.chain(c,r=>this.backend.handle(r)).pipe(Hy(()=>this.pendingTasks.remove(m)))}else return this.chain(c,m=>this.backend.handle(m))}};i.\u0275fac=function(m){return new(m||i)(Ze(f0),Ze(ms))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})();var B4=/^\)\]\}',?\n/;function V4(a){return"responseURL"in a&&a.responseURL?a.responseURL:/^X-Request-URL:/m.test(a.getAllResponseHeaders())?a.getResponseHeader("X-Request-URL"):null}var FP=(()=>{let i=class i{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new kt(-2800,!1);let m=this.xhrFactory;return(m.\u0275loadImpl?Po(m.\u0275loadImpl()):ic(null)).pipe(Zy(()=>new oi(T=>{let M=m.build();if(M.open(c.method,c.urlWithParams),c.withCredentials&&(M.withCredentials=!0),c.headers.forEach((dt,st)=>M.setRequestHeader(dt,st.join(","))),c.headers.has("Accept")||M.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let dt=c.detectContentTypeHeader();dt!==null&&M.setRequestHeader("Content-Type",dt)}if(c.responseType){let dt=c.responseType.toLowerCase();M.responseType=dt!=="json"?dt:"text"}let F=c.serializeBody(),$=null,Q=()=>{if($!==null)return $;let dt=M.statusText||"OK",st=new dl(M.getAllResponseHeaders()),Nt=V4(M)||c.url;return $=new p0({headers:st,status:M.status,statusText:dt,url:Nt}),$},ue=()=>{let{headers:dt,status:st,statusText:Nt,url:gn}=Q(),Xt=null;st!==S4&&(Xt=typeof M.response>"u"?M.responseText:M.response),st===0&&(st=Xt?NP:0);let Ni=st>=200&&st<300;if(c.responseType==="json"&&typeof Xt=="string"){let Xn=Xt;Xt=Xt.replace(B4,"");try{Xt=Xt!==""?JSON.parse(Xt):null}catch(Gt){Xt=Xn,Ni&&(Ni=!1,Xt={error:Gt,text:Xt})}}Ni?(T.next(new Fm({body:Xt,headers:dt,status:st,statusText:Nt,url:gn||void 0})),T.complete()):T.error(new pc({error:Xt,headers:dt,status:st,statusText:Nt,url:gn||void 0}))},Ae=dt=>{let{url:st}=Q(),Nt=new pc({error:dt,status:M.status||0,statusText:M.statusText||"Unknown Error",url:st||void 0});T.error(Nt)},xe=!1,ke=dt=>{xe||(T.next(Q()),xe=!0);let st={type:gc.DownloadProgress,loaded:dt.loaded};dt.lengthComputable&&(st.total=dt.total),c.responseType==="text"&&M.responseText&&(st.partialText=M.responseText),T.next(st)},Qe=dt=>{let st={type:gc.UploadProgress,loaded:dt.loaded};dt.lengthComputable&&(st.total=dt.total),T.next(st)};return M.addEventListener("load",ue),M.addEventListener("error",Ae),M.addEventListener("timeout",Ae),M.addEventListener("abort",Ae),c.reportProgress&&(M.addEventListener("progress",ke),F!==null&&M.upload&&M.upload.addEventListener("progress",Qe)),M.send(F),T.next({type:gc.Sent}),()=>{M.removeEventListener("error",Ae),M.removeEventListener("abort",Ae),M.removeEventListener("load",ue),M.removeEventListener("timeout",Ae),c.reportProgress&&(M.removeEventListener("progress",ke),F!==null&&M.upload&&M.upload.removeEventListener("progress",Qe)),M.readyState!==M.DONE&&M.abort()}})))}};i.\u0275fac=function(m){return new(m||i)(Ze(df))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),VP=new Pt(""),j4="XSRF-TOKEN",U4=new Pt("",{providedIn:"root",factory:()=>j4}),G4="X-XSRF-TOKEN",$4=new Pt("",{providedIn:"root",factory:()=>G4}),m0=class{},H4=(()=>{let i=class i{constructor(c,m,r){this.doc=c,this.platform=m,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=c0(c,this.cookieName),this.lastCookieString=c),this.lastToken}};i.\u0275fac=function(m){return new(m||i)(Ze(jn),Ze(Qs),Ze(U4))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})();function q4(a,i){let d=a.url.toLowerCase();if(!Ot(VP)||a.method==="GET"||a.method==="HEAD"||d.startsWith("http://")||d.startsWith("https://"))return i(a);let c=Ot(m0).getToken(),m=Ot($4);return c!=null&&!a.headers.has(m)&&(a=a.clone({headers:a.headers.set(m,c)})),i(a)}var jP=function(a){return a[a.Interceptors=0]="Interceptors",a[a.LegacyInterceptors=1]="LegacyInterceptors",a[a.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",a[a.NoXsrfProtection=3]="NoXsrfProtection",a[a.JsonpSupport=4]="JsonpSupport",a[a.RequestsMadeViaParent=5]="RequestsMadeViaParent",a[a.Fetch=6]="Fetch",a}(jP||{});function W4(a,i){return{\u0275kind:a,\u0275providers:i}}function UP(...a){let i=[M4,FP,OP,{provide:km,useExisting:OP},{provide:f0,useFactory:()=>Ot(R4,{optional:!0})??Ot(FP)},{provide:UE,useValue:q4,multi:!0},{provide:VP,useValue:!0},{provide:m0,useClass:H4}];for(let d of a)i.push(...d.\u0275providers);return Bw(i)}var LP=new Pt("");function GP(){return W4(jP.LegacyInterceptors,[{provide:LP,useFactory:z4},{provide:UE,useExisting:LP,multi:!0}])}var HE=class extends l0{constructor(){super(...arguments),this.supportsDOMEvents=!0}},qE=class a extends HE{static makeCurrent(){TP(new a)}onAndCancel(i,d,c){return i.addEventListener(d,c),()=>{i.removeEventListener(d,c)}}dispatchEvent(i,d){i.dispatchEvent(d)}remove(i){i.parentNode&&i.parentNode.removeChild(i)}createElement(i,d){return d=d||this.getDefaultDocument(),d.createElement(i)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(i){return i.nodeType===Node.ELEMENT_NODE}isShadowRoot(i){return i instanceof DocumentFragment}getGlobalEventTarget(i,d){return d==="window"?window:d==="document"?i:d==="body"?i.body:null}getBaseHref(i){let d=Q4();return d==null?null:Y4(d)}resetBaseElement(){Lm=null}getUserAgent(){return window.navigator.userAgent}getCookie(i){return c0(document.cookie,i)}},Lm=null;function Q4(){return Lm=Lm||document.querySelector("base"),Lm?Lm.getAttribute("href"):null}function Y4(a){return new URL(a,document.baseURI).pathname}var WE=class{addToWindow(i){Ws.getAngularTestability=(c,m=!0)=>{let r=i.findTestabilityInTree(c,m);if(r==null)throw new kt(5103,!1);return r},Ws.getAllAngularTestabilities=()=>i.getAllTestabilities(),Ws.getAllAngularRootElements=()=>i.getAllRootElements();let d=c=>{let m=Ws.getAllAngularTestabilities(),r=m.length,T=function(){r--,r==0&&c()};m.forEach(M=>{M.whenStable(T)})};Ws.frameworkStabilizers||(Ws.frameworkStabilizers=[]),Ws.frameworkStabilizers.push(d)}findTestabilityInTree(i,d,c){if(d==null)return null;let m=i.getTestability(d);return m??(c?Ta().isShadowRoot(d)?this.findTestabilityInTree(i,d.host,!0):this.findTestabilityInTree(i,d.parentElement,!0):null)}},X4=(()=>{let i=class i{build(){return new XMLHttpRequest}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),ZE=new Pt(""),qP=(()=>{let i=class i{constructor(c,m){this._zone=m,this._eventNameToPlugin=new Map,c.forEach(r=>{r.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,m,r){return this._findPluginFor(m).addEventListener(c,m,r)}getZone(){return this._zone}_findPluginFor(c){let m=this._eventNameToPlugin.get(c);if(m)return m;if(m=this._plugins.find(T=>T.supports(c)),!m)throw new kt(5101,!1);return this._eventNameToPlugin.set(c,m),m}};i.\u0275fac=function(m){return new(m||i)(Ze(ZE),Ze(Wt))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),g0=class{constructor(i){this._doc=i}},GE="ng-app-id",WP=(()=>{let i=class i{constructor(c,m,r,T={}){this.doc=c,this.appId=m,this.nonce=r,this.platformId=T,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=d0(T),this.resetHostNodes()}addStyles(c){for(let m of c)this.changeUsageCount(m,1)===1&&this.onStyleAdded(m)}removeStyles(c){for(let m of c)this.changeUsageCount(m,-1)<=0&&this.onStyleRemoved(m)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(m=>m.remove()),c.clear());for(let m of this.getAllStyles())this.onStyleRemoved(m);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let m of this.getAllStyles())this.addStyleToHost(c,m)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let m of this.hostNodes)this.addStyleToHost(m,c)}onStyleRemoved(c){let m=this.styleRef;m.get(c)?.elements?.forEach(r=>r.remove()),m.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${GE}="${this.appId}"]`);if(c?.length){let m=new Map;return c.forEach(r=>{r.textContent!=null&&m.set(r.textContent,r)}),m}return null}changeUsageCount(c,m){let r=this.styleRef;if(r.has(c)){let T=r.get(c);return T.usage+=m,T.usage}return r.set(c,{usage:m,elements:[]}),m}getStyleElement(c,m){let r=this.styleNodesInDOM,T=r?.get(m);if(T?.parentNode===c)return r.delete(m),T.removeAttribute(GE),T;{let M=this.doc.createElement("style");return this.nonce&&M.setAttribute("nonce",this.nonce),M.textContent=m,this.platformIsServer&&M.setAttribute(GE,this.appId),c.appendChild(M),M}}addStyleToHost(c,m){let r=this.getStyleElement(c,m),T=this.styleRef,M=T.get(m)?.elements;M?M.push(r):T.set(m,{elements:[r],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};i.\u0275fac=function(m){return new(m||i)(Ze(jn),Ze(Tm),Ze(Dm,8),Ze(Qs))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),$E={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},YE=/%COMP%/g,ZP="%COMP%",K4=`_nghost-${ZP}`,J4=`_ngcontent-${ZP}`,eU=!0,tU=new Pt("",{providedIn:"root",factory:()=>eU});function nU(a){return J4.replace(YE,a)}function iU(a){return K4.replace(YE,a)}function QP(a,i){return i.map(d=>d.replace(YE,a))}var _0=(()=>{let i=class i{constructor(c,m,r,T,M,F,$,Q=null){this.eventManager=c,this.sharedStylesHost=m,this.appId=r,this.removeStylesOnCompDestroy=T,this.doc=M,this.platformId=F,this.ngZone=$,this.nonce=Q,this.rendererByCompId=new Map,this.platformIsServer=d0(F),this.defaultRenderer=new Nm(c,M,$,this.platformIsServer)}createRenderer(c,m){if(!c||!m)return this.defaultRenderer;this.platformIsServer&&m.encapsulation===_a.ShadowDom&&(m=tr(Yt({},m),{encapsulation:_a.Emulated}));let r=this.getOrCreateRenderer(c,m);return r instanceof y0?r.applyToHost(c):r instanceof zm&&r.applyStyles(),r}getOrCreateRenderer(c,m){let r=this.rendererByCompId,T=r.get(m.id);if(!T){let M=this.doc,F=this.ngZone,$=this.eventManager,Q=this.sharedStylesHost,ue=this.removeStylesOnCompDestroy,Ae=this.platformIsServer;switch(m.encapsulation){case _a.Emulated:T=new y0($,Q,m,this.appId,ue,M,F,Ae);break;case _a.ShadowDom:return new QE($,Q,c,m,M,F,this.nonce,Ae);default:T=new zm($,Q,m,ue,M,F,Ae);break}r.set(m.id,T)}return T}ngOnDestroy(){this.rendererByCompId.clear()}};i.\u0275fac=function(m){return new(m||i)(Ze(qP),Ze(WP),Ze(Tm),Ze(tU),Ze(jn),Ze(Qs),Ze(Wt),Ze(Dm))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),Nm=class{constructor(i,d,c,m){this.eventManager=i,this.doc=d,this.ngZone=c,this.platformIsServer=m,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(i,d){return d?this.doc.createElementNS($E[d]||d,i):this.doc.createElement(i)}createComment(i){return this.doc.createComment(i)}createText(i){return this.doc.createTextNode(i)}appendChild(i,d){($P(i)?i.content:i).appendChild(d)}insertBefore(i,d,c){i&&($P(i)?i.content:i).insertBefore(d,c)}removeChild(i,d){i&&i.removeChild(d)}selectRootElement(i,d){let c=typeof i=="string"?this.doc.querySelector(i):i;if(!c)throw new kt(-5104,!1);return d||(c.textContent=""),c}parentNode(i){return i.parentNode}nextSibling(i){return i.nextSibling}setAttribute(i,d,c,m){if(m){d=m+":"+d;let r=$E[m];r?i.setAttributeNS(r,d,c):i.setAttribute(d,c)}else i.setAttribute(d,c)}removeAttribute(i,d,c){if(c){let m=$E[c];m?i.removeAttributeNS(m,d):i.removeAttribute(`${c}:${d}`)}else i.removeAttribute(d)}addClass(i,d){i.classList.add(d)}removeClass(i,d){i.classList.remove(d)}setStyle(i,d,c,m){m&(sl.DashCase|sl.Important)?i.style.setProperty(d,c,m&sl.Important?"important":""):i.style[d]=c}removeStyle(i,d,c){c&sl.DashCase?i.style.removeProperty(d):i.style[d]=""}setProperty(i,d,c){i!=null&&(i[d]=c)}setValue(i,d){i.nodeValue=d}listen(i,d,c){if(typeof i=="string"&&(i=Ta().getGlobalEventTarget(this.doc,i),!i))throw new Error(`Unsupported event target ${i} for event ${d}`);return this.eventManager.addEventListener(i,d,this.decoratePreventDefault(c))}decoratePreventDefault(i){return d=>{if(d==="__ngUnwrap__")return i;(this.platformIsServer?this.ngZone.runGuarded(()=>i(d)):i(d))===!1&&d.preventDefault()}}};function $P(a){return a.tagName==="TEMPLATE"&&a.content!==void 0}var QE=class extends Nm{constructor(i,d,c,m,r,T,M,F){super(i,r,T,F),this.sharedStylesHost=d,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let $=QP(m.id,m.styles);for(let Q of $){let ue=document.createElement("style");M&&ue.setAttribute("nonce",M),ue.textContent=Q,this.shadowRoot.appendChild(ue)}}nodeOrShadowRoot(i){return i===this.hostEl?this.shadowRoot:i}appendChild(i,d){return super.appendChild(this.nodeOrShadowRoot(i),d)}insertBefore(i,d,c){return super.insertBefore(this.nodeOrShadowRoot(i),d,c)}removeChild(i,d){return super.removeChild(this.nodeOrShadowRoot(i),d)}parentNode(i){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(i)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},zm=class extends Nm{constructor(i,d,c,m,r,T,M,F){super(i,r,T,M),this.sharedStylesHost=d,this.removeStylesOnCompDestroy=m,this.styles=F?QP(F,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},y0=class extends zm{constructor(i,d,c,m,r,T,M,F){let $=m+"-"+c.id;super(i,d,c,r,T,M,F,$),this.contentAttr=nU($),this.hostAttr=iU($)}applyToHost(i){this.applyStyles(),this.setAttribute(i,this.hostAttr,"")}createElement(i,d){let c=super.createElement(i,d);return super.setAttribute(c,this.contentAttr,""),c}},rU=(()=>{let i=class i extends g0{constructor(c){super(c)}supports(c){return!0}addEventListener(c,m,r){return c.addEventListener(m,r,!1),()=>this.removeEventListener(c,m,r)}removeEventListener(c,m,r){return c.removeEventListener(m,r)}};i.\u0275fac=function(m){return new(m||i)(Ze(jn))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),HP=["alt","control","meta","shift"],oU={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},sU={alt:a=>a.altKey,control:a=>a.ctrlKey,meta:a=>a.metaKey,shift:a=>a.shiftKey},aU=(()=>{let i=class i extends g0{constructor(c){super(c)}supports(c){return i.parseEventName(c)!=null}addEventListener(c,m,r){let T=i.parseEventName(m),M=i.eventCallback(T.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ta().onAndCancel(c,T.domEventName,M))}static parseEventName(c){let m=c.toLowerCase().split("."),r=m.shift();if(m.length===0||!(r==="keydown"||r==="keyup"))return null;let T=i._normalizeKey(m.pop()),M="",F=m.indexOf("code");if(F>-1&&(m.splice(F,1),M="code."),HP.forEach(Q=>{let ue=m.indexOf(Q);ue>-1&&(m.splice(ue,1),M+=Q+".")}),M+=T,m.length!=0||T.length===0)return null;let $={};return $.domEventName=r,$.fullKey=M,$}static matchEventFullKeyCode(c,m){let r=oU[c.key]||c.key,T="";return m.indexOf("code.")>-1&&(r=c.code,T="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),HP.forEach(M=>{if(M!==r){let F=sU[M];F(c)&&(T+=M+".")}}),T+=r,T===m)}static eventCallback(c,m,r){return T=>{i.matchEventFullKeyCode(T,c)&&r.runGuarded(()=>m(T))}}static _normalizeKey(c){return c==="esc"?"escape":c}};i.\u0275fac=function(m){return new(m||i)(Ze(jn))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})();function lU(){qE.makeCurrent()}function cU(){return new va}function uU(){return s2(document),document}var dU=[{provide:Qs,useValue:FE},{provide:tE,useValue:lU,multi:!0},{provide:jn,useFactory:uU,deps:[]}],YP=SE(yP,"browser",dU),hU=new Pt(""),fU=[{provide:Am,useClass:WE,deps:[]},{provide:IE,useClass:o0,deps:[Wt,s0,Am]},{provide:o0,useClass:o0,deps:[Wt,s0,Am]}],pU=[{provide:Fv,useValue:"root"},{provide:va,useFactory:cU,deps:[]},{provide:ZE,useClass:rU,multi:!0,deps:[jn,Wt,Qs]},{provide:ZE,useClass:aU,multi:!0,deps:[jn]},_0,WP,qP,{provide:cc,useExisting:_0},{provide:df,useClass:X4,deps:[]},[]],v0=(()=>{let i=class i{constructor(c){}static withServerTransition(c){return{ngModule:i,providers:[{provide:Tm,useValue:c.appId}]}}};i.\u0275fac=function(m){return new(m||i)(Ze(hU,12))},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({providers:[...pU,...fU],imports:[hf,vP]});let a=i;return a})();var zn=function(a){return a[a.State=0]="State",a[a.Transition=1]="Transition",a[a.Sequence=2]="Sequence",a[a.Group=3]="Group",a[a.Animate=4]="Animate",a[a.Keyframes=5]="Keyframes",a[a.Style=6]="Style",a[a.Trigger=7]="Trigger",a[a.Reference=8]="Reference",a[a.AnimateChild=9]="AnimateChild",a[a.AnimateRef=10]="AnimateRef",a[a.Query=11]="Query",a[a.Stagger=12]="Stagger",a}(zn||{}),Da="*";function b0(a,i){return{type:zn.Trigger,name:a,definitions:i,options:{}}}function Vm(a,i=null){return{type:zn.Animate,styles:i,timings:a}}function XP(a,i=null){return{type:zn.Sequence,steps:a,options:i}}function Ia(a){return{type:zn.Style,styles:a,offset:null}}function jm(a,i,d){return{type:zn.State,name:a,styles:i,options:d}}function Um(a,i,d=null){return{type:zn.Transition,expr:a,animation:i,options:d}}var _c=class{constructor(i=0,d=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=i+d}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){queueMicrotask(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(i=>i()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(i){this._position=this.totalTime?i*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(i){let d=i=="start"?this._onStartFns:this._onDoneFns;d.forEach(c=>c()),d.length=0}},Bm=class{constructor(i){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=i;let d=0,c=0,m=0,r=this.players.length;r==0?queueMicrotask(()=>this._onFinish()):this.players.forEach(T=>{T.onDone(()=>{++d==r&&this._onFinish()}),T.onDestroy(()=>{++c==r&&this._onDestroy()}),T.onStart(()=>{++m==r&&this._onStart()})}),this.totalTime=this.players.reduce((T,M)=>Math.max(T,M.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this.players.forEach(i=>i.init())}onStart(i){this._onStartFns.push(i)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(i=>i()),this._onStartFns=[])}onDone(i){this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(i=>i.play())}pause(){this.players.forEach(i=>i.pause())}restart(){this.players.forEach(i=>i.restart())}finish(){this._onFinish(),this.players.forEach(i=>i.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(i=>i.destroy()),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}reset(){this.players.forEach(i=>i.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(i){let d=i*this.totalTime;this.players.forEach(c=>{let m=c.totalTime?Math.min(1,d/c.totalTime):1;c.setPosition(m)})}getPosition(){let i=this.players.reduce((d,c)=>d===null||c.totalTime>d.totalTime?c:d,null);return i!=null?i.getPosition():0}beforeDestroy(){this.players.forEach(i=>{i.beforeDestroy&&i.beforeDestroy()})}triggerCallback(i){let d=i=="start"?this._onStartFns:this._onDoneFns;d.forEach(c=>c()),d.length=0}},x0="!";function KP(a){return new kt(3e3,!1)}function gU(){return new kt(3100,!1)}function _U(){return new kt(3101,!1)}function yU(a){return new kt(3001,!1)}function vU(a){return new kt(3003,!1)}function bU(a){return new kt(3004,!1)}function xU(a,i){return new kt(3005,!1)}function wU(){return new kt(3006,!1)}function EU(){return new kt(3007,!1)}function TU(a,i){return new kt(3008,!1)}function DU(a){return new kt(3002,!1)}function IU(a,i,d,c,m){return new kt(3010,!1)}function CU(){return new kt(3011,!1)}function SU(){return new kt(3012,!1)}function MU(){return new kt(3200,!1)}function AU(){return new kt(3202,!1)}function PU(){return new kt(3013,!1)}function RU(a){return new kt(3014,!1)}function kU(a){return new kt(3015,!1)}function OU(a){return new kt(3016,!1)}function FU(a,i){return new kt(3404,!1)}function LU(a){return new kt(3502,!1)}function NU(a){return new kt(3503,!1)}function zU(){return new kt(3300,!1)}function BU(a){return new kt(3504,!1)}function VU(a){return new kt(3301,!1)}function jU(a,i){return new kt(3302,!1)}function UU(a){return new kt(3303,!1)}function GU(a,i){return new kt(3400,!1)}function $U(a){return new kt(3401,!1)}function HU(a){return new kt(3402,!1)}function qU(a,i){return new kt(3505,!1)}function yc(a){switch(a.length){case 0:return new _c;case 1:return a[0];default:return new Bm(a)}}function hR(a,i,d=new Map,c=new Map){let m=[],r=[],T=-1,M=null;if(i.forEach(F=>{let $=F.get("offset"),Q=$==T,ue=Q&&M||new Map;F.forEach((Ae,xe)=>{let ke=xe,Qe=Ae;if(xe!=="offset")switch(ke=a.normalizePropertyName(ke,m),Qe){case x0:Qe=d.get(xe);break;case Da:Qe=c.get(xe);break;default:Qe=a.normalizeStyleValue(xe,ke,Qe,m);break}ue.set(ke,Qe)}),Q||r.push(ue),M=ue,T=$}),m.length)throw LU(m);return r}function vT(a,i,d,c){switch(i){case"start":a.onStart(()=>c(d&&XE(d,"start",a)));break;case"done":a.onDone(()=>c(d&&XE(d,"done",a)));break;case"destroy":a.onDestroy(()=>c(d&&XE(d,"destroy",a)));break}}function XE(a,i,d){let c=d.totalTime,m=!!d.disabled,r=bT(a.element,a.triggerName,a.fromState,a.toState,i||a.phaseName,c??a.totalTime,m),T=a._data;return T!=null&&(r._data=T),r}function bT(a,i,d,c,m="",r=0,T){return{element:a,triggerName:i,fromState:d,toState:c,phaseName:m,totalTime:r,disabled:!!T}}function es(a,i,d){let c=a.get(i);return c||a.set(i,c=d),c}function JP(a){let i=a.indexOf(":"),d=a.substring(1,i),c=a.slice(i+1);return[d,c]}var WU=typeof document>"u"?null:document.documentElement;function xT(a){let i=a.parentNode||a.host||null;return i===WU?null:i}function ZU(a){return a.substring(1,6)=="ebkit"}var ed=null,eR=!1;function QU(a){ed||(ed=YU()||{},eR=ed.style?"WebkitAppearance"in ed.style:!1);let i=!0;return ed.style&&!ZU(a)&&(i=a in ed.style,!i&&eR&&(i="Webkit"+a.charAt(0).toUpperCase()+a.slice(1)in ed.style)),i}function YU(){return typeof document<"u"?document.body:null}function fR(a,i){for(;i;){if(i===a)return!0;i=xT(i)}return!1}function pR(a,i,d){if(d)return Array.from(a.querySelectorAll(i));let c=a.querySelector(i);return c?[c]:[]}var wT=(()=>{let i=class i{validateStyleProperty(c){return QU(c)}containsElement(c,m){return fR(c,m)}getParentElement(c){return xT(c)}query(c,m,r){return pR(c,m,r)}computeStyle(c,m,r){return r||""}animate(c,m,r,T,M,F=[],$){return new _c(r,T)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})(),IT=class IT{};IT.NOOP=new wT;var id=IT,rd=class{};var XU=1e3,mR="{{",KU="}}",gR="ng-enter",iT="ng-leave",w0="ng-trigger",C0=".ng-trigger",tR="ng-animating",rT=".ng-animating";function hl(a){if(typeof a=="number")return a;let i=a.match(/^(-?[\.\d]+)(m?s)/);return!i||i.length<2?0:oT(parseFloat(i[1]),i[2])}function oT(a,i){switch(i){case"s":return a*XU;default:return a}}function S0(a,i,d){return a.hasOwnProperty("duration")?a:JU(a,i,d)}function JU(a,i,d){let c=/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i,m,r=0,T="";if(typeof a=="string"){let M=a.match(c);if(M===null)return i.push(KP(a)),{duration:0,delay:0,easing:""};m=oT(parseFloat(M[1]),M[2]);let F=M[3];F!=null&&(r=oT(parseFloat(F),M[4]));let $=M[5];$&&(T=$)}else m=a;if(!d){let M=!1,F=i.length;m<0&&(i.push(gU()),M=!0),r<0&&(i.push(_U()),M=!0),M&&i.splice(F,0,KP(a))}return{duration:m,delay:r,easing:T}}function e6(a){return a.length?a[0]instanceof Map?a:a.map(i=>new Map(Object.entries(i))):[]}function Ca(a,i,d){i.forEach((c,m)=>{let r=ET(m);d&&!d.has(m)&&d.set(m,a.style[r]),a.style[r]=c})}function nd(a,i){i.forEach((d,c)=>{let m=ET(c);a.style[m]=""})}function Gm(a){return Array.isArray(a)?a.length==1?a[0]:XP(a):a}function t6(a,i,d){let c=i.params||{},m=_R(a);m.length&&m.forEach(r=>{c.hasOwnProperty(r)||d.push(yU(r))})}var sT=new RegExp(`${mR}\\s*(.+?)\\s*${KU}`,"g");function _R(a){let i=[];if(typeof a=="string"){let d;for(;d=sT.exec(a);)i.push(d[1]);sT.lastIndex=0}return i}function Hm(a,i,d){let c=`${a}`,m=c.replace(sT,(r,T)=>{let M=i[T];return M==null&&(d.push(vU(T)),M=""),M.toString()});return m==c?a:m}var n6=/-+([a-z0-9])/g;function ET(a){return a.replace(n6,(...i)=>i[1].toUpperCase())}function i6(a,i){return a===0||i===0}function r6(a,i,d){if(d.size&&i.length){let c=i[0],m=[];if(d.forEach((r,T)=>{c.has(T)||m.push(T),c.set(T,r)}),m.length)for(let r=1;r<i.length;r++){let T=i[r];m.forEach(M=>T.set(M,TT(a,M)))}}return i}function Jo(a,i,d){switch(i.type){case zn.Trigger:return a.visitTrigger(i,d);case zn.State:return a.visitState(i,d);case zn.Transition:return a.visitTransition(i,d);case zn.Sequence:return a.visitSequence(i,d);case zn.Group:return a.visitGroup(i,d);case zn.Animate:return a.visitAnimate(i,d);case zn.Keyframes:return a.visitKeyframes(i,d);case zn.Style:return a.visitStyle(i,d);case zn.Reference:return a.visitReference(i,d);case zn.AnimateChild:return a.visitAnimateChild(i,d);case zn.AnimateRef:return a.visitAnimateRef(i,d);case zn.Query:return a.visitQuery(i,d);case zn.Stagger:return a.visitStagger(i,d);default:throw bU(i.type)}}function TT(a,i){return window.getComputedStyle(a)[i]}var o6=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]),M0=class extends rd{normalizePropertyName(i,d){return ET(i)}normalizeStyleValue(i,d,c,m){let r="",T=c.toString().trim();if(o6.has(d)&&c!==0&&c!=="0")if(typeof c=="number")r="px";else{let M=c.match(/^[+-]?[\d\.]+([a-z]*)$/);M&&M[1].length==0&&m.push(xU(i,c))}return T+r}};var A0="*";function s6(a,i){let d=[];return typeof a=="string"?a.split(/\s*,\s*/).forEach(c=>a6(c,d,i)):d.push(a),d}function a6(a,i,d){if(a[0]==":"){let F=l6(a,d);if(typeof F=="function"){i.push(F);return}a=F}let c=a.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(c==null||c.length<4)return d.push(kU(a)),i;let m=c[1],r=c[2],T=c[3];i.push(nR(m,T));let M=m==A0&&T==A0;r[0]=="<"&&!M&&i.push(nR(T,m))}function l6(a,i){switch(a){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(d,c)=>parseFloat(c)>parseFloat(d);case":decrement":return(d,c)=>parseFloat(c)<parseFloat(d);default:return i.push(OU(a)),"* => *"}}var E0=new Set(["true","1"]),T0=new Set(["false","0"]);function nR(a,i){let d=E0.has(a)||T0.has(a),c=E0.has(i)||T0.has(i);return(m,r)=>{let T=a==A0||a==m,M=i==A0||i==r;return!T&&d&&typeof m=="boolean"&&(T=m?E0.has(a):T0.has(a)),!M&&c&&typeof r=="boolean"&&(M=r?E0.has(i):T0.has(i)),T&&M}}var yR=":self",c6=new RegExp(`s*${yR}s*,?`,"g");function vR(a,i,d,c){return new aT(a).build(i,d,c)}var iR="",aT=class{constructor(i){this._driver=i}build(i,d,c){let m=new lT(d);return this._resetContextStyleTimingState(m),Jo(this,Gm(i),m)}_resetContextStyleTimingState(i){i.currentQuerySelector=iR,i.collectedStyles=new Map,i.collectedStyles.set(iR,new Map),i.currentTime=0}visitTrigger(i,d){let c=d.queryCount=0,m=d.depCount=0,r=[],T=[];return i.name.charAt(0)=="@"&&d.errors.push(wU()),i.definitions.forEach(M=>{if(this._resetContextStyleTimingState(d),M.type==zn.State){let F=M,$=F.name;$.toString().split(/\s*,\s*/).forEach(Q=>{F.name=Q,r.push(this.visitState(F,d))}),F.name=$}else if(M.type==zn.Transition){let F=this.visitTransition(M,d);c+=F.queryCount,m+=F.depCount,T.push(F)}else d.errors.push(EU())}),{type:zn.Trigger,name:i.name,states:r,transitions:T,queryCount:c,depCount:m,options:null}}visitState(i,d){let c=this.visitStyle(i.styles,d),m=i.options&&i.options.params||null;if(c.containsDynamicStyles){let r=new Set,T=m||{};c.styles.forEach(M=>{M instanceof Map&&M.forEach(F=>{_R(F).forEach($=>{T.hasOwnProperty($)||r.add($)})})}),r.size&&d.errors.push(TU(i.name,[...r.values()]))}return{type:zn.State,name:i.name,style:c,options:m?{params:m}:null}}visitTransition(i,d){d.queryCount=0,d.depCount=0;let c=Jo(this,Gm(i.animation),d),m=s6(i.expr,d.errors);return{type:zn.Transition,matchers:m,animation:c,queryCount:d.queryCount,depCount:d.depCount,options:td(i.options)}}visitSequence(i,d){return{type:zn.Sequence,steps:i.steps.map(c=>Jo(this,c,d)),options:td(i.options)}}visitGroup(i,d){let c=d.currentTime,m=0,r=i.steps.map(T=>{d.currentTime=c;let M=Jo(this,T,d);return m=Math.max(m,d.currentTime),M});return d.currentTime=m,{type:zn.Group,steps:r,options:td(i.options)}}visitAnimate(i,d){let c=f6(i.timings,d.errors);d.currentAnimateTimings=c;let m,r=i.styles?i.styles:Ia({});if(r.type==zn.Keyframes)m=this.visitKeyframes(r,d);else{let T=i.styles,M=!1;if(!T){M=!0;let $={};c.easing&&($.easing=c.easing),T=Ia($)}d.currentTime+=c.duration+c.delay;let F=this.visitStyle(T,d);F.isEmptyStep=M,m=F}return d.currentAnimateTimings=null,{type:zn.Animate,timings:c,style:m,options:null}}visitStyle(i,d){let c=this._makeStyleAst(i,d);return this._validateStyleAst(c,d),c}_makeStyleAst(i,d){let c=[],m=Array.isArray(i.styles)?i.styles:[i.styles];for(let M of m)typeof M=="string"?M===Da?c.push(M):d.errors.push(DU(M)):c.push(new Map(Object.entries(M)));let r=!1,T=null;return c.forEach(M=>{if(M instanceof Map&&(M.has("easing")&&(T=M.get("easing"),M.delete("easing")),!r)){for(let F of M.values())if(F.toString().indexOf(mR)>=0){r=!0;break}}}),{type:zn.Style,styles:c,easing:T,offset:i.offset,containsDynamicStyles:r,options:null}}_validateStyleAst(i,d){let c=d.currentAnimateTimings,m=d.currentTime,r=d.currentTime;c&&r>0&&(r-=c.duration+c.delay),i.styles.forEach(T=>{typeof T!="string"&&T.forEach((M,F)=>{let $=d.collectedStyles.get(d.currentQuerySelector),Q=$.get(F),ue=!0;Q&&(r!=m&&r>=Q.startTime&&m<=Q.endTime&&(d.errors.push(IU(F,Q.startTime,Q.endTime,r,m)),ue=!1),r=Q.startTime),ue&&$.set(F,{startTime:r,endTime:m}),d.options&&t6(M,d.options,d.errors)})})}visitKeyframes(i,d){let c={type:zn.Keyframes,styles:[],options:null};if(!d.currentAnimateTimings)return d.errors.push(CU()),c;let m=1,r=0,T=[],M=!1,F=!1,$=0,Q=i.steps.map(st=>{let Nt=this._makeStyleAst(st,d),gn=Nt.offset!=null?Nt.offset:h6(Nt.styles),Xt=0;return gn!=null&&(r++,Xt=Nt.offset=gn),F=F||Xt<0||Xt>1,M=M||Xt<$,$=Xt,T.push(Xt),Nt});F&&d.errors.push(SU()),M&&d.errors.push(MU());let ue=i.steps.length,Ae=0;r>0&&r<ue?d.errors.push(AU()):r==0&&(Ae=m/(ue-1));let xe=ue-1,ke=d.currentTime,Qe=d.currentAnimateTimings,dt=Qe.duration;return Q.forEach((st,Nt)=>{let gn=Ae>0?Nt==xe?1:Ae*Nt:T[Nt],Xt=gn*dt;d.currentTime=ke+Qe.delay+Xt,Qe.duration=Xt,this._validateStyleAst(st,d),st.offset=gn,c.styles.push(st)}),c}visitReference(i,d){return{type:zn.Reference,animation:Jo(this,Gm(i.animation),d),options:td(i.options)}}visitAnimateChild(i,d){return d.depCount++,{type:zn.AnimateChild,options:td(i.options)}}visitAnimateRef(i,d){return{type:zn.AnimateRef,animation:this.visitReference(i.animation,d),options:td(i.options)}}visitQuery(i,d){let c=d.currentQuerySelector,m=i.options||{};d.queryCount++,d.currentQuery=i;let[r,T]=u6(i.selector);d.currentQuerySelector=c.length?c+" "+r:r,es(d.collectedStyles,d.currentQuerySelector,new Map);let M=Jo(this,Gm(i.animation),d);return d.currentQuery=null,d.currentQuerySelector=c,{type:zn.Query,selector:r,limit:m.limit||0,optional:!!m.optional,includeSelf:T,animation:M,originalSelector:i.selector,options:td(i.options)}}visitStagger(i,d){d.currentQuery||d.errors.push(PU());let c=i.timings==="full"?{duration:0,delay:0,easing:"full"}:S0(i.timings,d.errors,!0);return{type:zn.Stagger,animation:Jo(this,Gm(i.animation),d),timings:c,options:null}}};function u6(a){let i=!!a.split(/\s*,\s*/).find(d=>d==yR);return i&&(a=a.replace(c6,"")),a=a.replace(/@\*/g,C0).replace(/@\w+/g,d=>C0+"-"+d.slice(1)).replace(/:animating/g,rT),[a,i]}function d6(a){return a?Yt({},a):null}var lT=class{constructor(i){this.errors=i,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}};function h6(a){if(typeof a=="string")return null;let i=null;if(Array.isArray(a))a.forEach(d=>{if(d instanceof Map&&d.has("offset")){let c=d;i=parseFloat(c.get("offset")),c.delete("offset")}});else if(a instanceof Map&&a.has("offset")){let d=a;i=parseFloat(d.get("offset")),d.delete("offset")}return i}function f6(a,i){if(a.hasOwnProperty("duration"))return a;if(typeof a=="number"){let r=S0(a,i).duration;return KE(r,0,"")}let d=a;if(d.split(/\s+/).some(r=>r.charAt(0)=="{"&&r.charAt(1)=="{")){let r=KE(0,0,"");return r.dynamic=!0,r.strValue=d,r}let m=S0(d,i);return KE(m.duration,m.delay,m.easing)}function td(a){return a?(a=Yt({},a),a.params&&(a.params=d6(a.params))):a={},a}function KE(a,i,d){return{duration:a,delay:i,easing:d}}function DT(a,i,d,c,m,r,T=null,M=!1){return{type:1,element:a,keyframes:i,preStyleProps:d,postStyleProps:c,duration:m,delay:r,totalTime:m+r,easing:T,subTimeline:M}}var qm=class{constructor(){this._map=new Map}get(i){return this._map.get(i)||[]}append(i,d){let c=this._map.get(i);c||this._map.set(i,c=[]),c.push(...d)}has(i){return this._map.has(i)}clear(){this._map.clear()}},p6=1,m6=":enter",g6=new RegExp(m6,"g"),_6=":leave",y6=new RegExp(_6,"g");function bR(a,i,d,c,m,r=new Map,T=new Map,M,F,$=[]){return new cT().buildKeyframes(a,i,d,c,m,r,T,M,F,$)}var cT=class{buildKeyframes(i,d,c,m,r,T,M,F,$,Q=[]){$=$||new qm;let ue=new uT(i,d,$,m,r,Q,[]);ue.options=F;let Ae=F.delay?hl(F.delay):0;ue.currentTimeline.delayNextStep(Ae),ue.currentTimeline.setStyles([T],null,ue.errors,F),Jo(this,c,ue);let xe=ue.timelines.filter(ke=>ke.containsAnimation());if(xe.length&&M.size){let ke;for(let Qe=xe.length-1;Qe>=0;Qe--){let dt=xe[Qe];if(dt.element===d){ke=dt;break}}ke&&!ke.allowOnlyTimelineStyles()&&ke.setStyles([M],null,ue.errors,F)}return xe.length?xe.map(ke=>ke.buildKeyframes()):[DT(d,[],[],[],0,Ae,"",!1)]}visitTrigger(i,d){}visitState(i,d){}visitTransition(i,d){}visitAnimateChild(i,d){let c=d.subInstructions.get(d.element);if(c){let m=d.createSubContext(i.options),r=d.currentTimeline.currentTime,T=this._visitSubInstructions(c,m,m.options);r!=T&&d.transformIntoNewTimeline(T)}d.previousNode=i}visitAnimateRef(i,d){let c=d.createSubContext(i.options);c.transformIntoNewTimeline(),this._applyAnimationRefDelays([i.options,i.animation.options],d,c),this.visitReference(i.animation,c),d.transformIntoNewTimeline(c.currentTimeline.currentTime),d.previousNode=i}_applyAnimationRefDelays(i,d,c){for(let m of i){let r=m?.delay;if(r){let T=typeof r=="number"?r:hl(Hm(r,m?.params??{},d.errors));c.delayNextStep(T)}}}_visitSubInstructions(i,d,c){let r=d.currentTimeline.currentTime,T=c.duration!=null?hl(c.duration):null,M=c.delay!=null?hl(c.delay):null;return T!==0&&i.forEach(F=>{let $=d.appendInstructionToTimeline(F,T,M);r=Math.max(r,$.duration+$.delay)}),r}visitReference(i,d){d.updateOptions(i.options,!0),Jo(this,i.animation,d),d.previousNode=i}visitSequence(i,d){let c=d.subContextCount,m=d,r=i.options;if(r&&(r.params||r.delay)&&(m=d.createSubContext(r),m.transformIntoNewTimeline(),r.delay!=null)){m.previousNode.type==zn.Style&&(m.currentTimeline.snapshotCurrentStyles(),m.previousNode=P0);let T=hl(r.delay);m.delayNextStep(T)}i.steps.length&&(i.steps.forEach(T=>Jo(this,T,m)),m.currentTimeline.applyStylesToKeyframe(),m.subContextCount>c&&m.transformIntoNewTimeline()),d.previousNode=i}visitGroup(i,d){let c=[],m=d.currentTimeline.currentTime,r=i.options&&i.options.delay?hl(i.options.delay):0;i.steps.forEach(T=>{let M=d.createSubContext(i.options);r&&M.delayNextStep(r),Jo(this,T,M),m=Math.max(m,M.currentTimeline.currentTime),c.push(M.currentTimeline)}),c.forEach(T=>d.currentTimeline.mergeTimelineCollectedStyles(T)),d.transformIntoNewTimeline(m),d.previousNode=i}_visitTiming(i,d){if(i.dynamic){let c=i.strValue,m=d.params?Hm(c,d.params,d.errors):c;return S0(m,d.errors)}else return{duration:i.duration,delay:i.delay,easing:i.easing}}visitAnimate(i,d){let c=d.currentAnimateTimings=this._visitTiming(i.timings,d),m=d.currentTimeline;c.delay&&(d.incrementTime(c.delay),m.snapshotCurrentStyles());let r=i.style;r.type==zn.Keyframes?this.visitKeyframes(r,d):(d.incrementTime(c.duration),this.visitStyle(r,d),m.applyStylesToKeyframe()),d.currentAnimateTimings=null,d.previousNode=i}visitStyle(i,d){let c=d.currentTimeline,m=d.currentAnimateTimings;!m&&c.hasCurrentStyleProperties()&&c.forwardFrame();let r=m&&m.easing||i.easing;i.isEmptyStep?c.applyEmptyStep(r):c.setStyles(i.styles,r,d.errors,d.options),d.previousNode=i}visitKeyframes(i,d){let c=d.currentAnimateTimings,m=d.currentTimeline.duration,r=c.duration,M=d.createSubContext().currentTimeline;M.easing=c.easing,i.styles.forEach(F=>{let $=F.offset||0;M.forwardTime($*r),M.setStyles(F.styles,F.easing,d.errors,d.options),M.applyStylesToKeyframe()}),d.currentTimeline.mergeTimelineCollectedStyles(M),d.transformIntoNewTimeline(m+r),d.previousNode=i}visitQuery(i,d){let c=d.currentTimeline.currentTime,m=i.options||{},r=m.delay?hl(m.delay):0;r&&(d.previousNode.type===zn.Style||c==0&&d.currentTimeline.hasCurrentStyleProperties())&&(d.currentTimeline.snapshotCurrentStyles(),d.previousNode=P0);let T=c,M=d.invokeQuery(i.selector,i.originalSelector,i.limit,i.includeSelf,!!m.optional,d.errors);d.currentQueryTotal=M.length;let F=null;M.forEach(($,Q)=>{d.currentQueryIndex=Q;let ue=d.createSubContext(i.options,$);r&&ue.delayNextStep(r),$===d.element&&(F=ue.currentTimeline),Jo(this,i.animation,ue),ue.currentTimeline.applyStylesToKeyframe();let Ae=ue.currentTimeline.currentTime;T=Math.max(T,Ae)}),d.currentQueryIndex=0,d.currentQueryTotal=0,d.transformIntoNewTimeline(T),F&&(d.currentTimeline.mergeTimelineCollectedStyles(F),d.currentTimeline.snapshotCurrentStyles()),d.previousNode=i}visitStagger(i,d){let c=d.parentContext,m=d.currentTimeline,r=i.timings,T=Math.abs(r.duration),M=T*(d.currentQueryTotal-1),F=T*d.currentQueryIndex;switch(r.duration<0?"reverse":r.easing){case"reverse":F=M-F;break;case"full":F=c.currentStaggerTime;break}let Q=d.currentTimeline;F&&Q.delayNextStep(F);let ue=Q.currentTime;Jo(this,i.animation,d),d.previousNode=i,c.currentStaggerTime=m.currentTime-ue+(m.startTime-c.currentTimeline.startTime)}},P0={},uT=class a{constructor(i,d,c,m,r,T,M,F){this._driver=i,this.element=d,this.subInstructions=c,this._enterClassName=m,this._leaveClassName=r,this.errors=T,this.timelines=M,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=P0,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=F||new R0(this._driver,d,0),M.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(i,d){if(!i)return;let c=i,m=this.options;c.duration!=null&&(m.duration=hl(c.duration)),c.delay!=null&&(m.delay=hl(c.delay));let r=c.params;if(r){let T=m.params;T||(T=this.options.params={}),Object.keys(r).forEach(M=>{(!d||!T.hasOwnProperty(M))&&(T[M]=Hm(r[M],T,this.errors))})}}_copyOptions(){let i={};if(this.options){let d=this.options.params;if(d){let c=i.params={};Object.keys(d).forEach(m=>{c[m]=d[m]})}}return i}createSubContext(i=null,d,c){let m=d||this.element,r=new a(this._driver,m,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(m,c||0));return r.previousNode=this.previousNode,r.currentAnimateTimings=this.currentAnimateTimings,r.options=this._copyOptions(),r.updateOptions(i),r.currentQueryIndex=this.currentQueryIndex,r.currentQueryTotal=this.currentQueryTotal,r.parentContext=this,this.subContextCount++,r}transformIntoNewTimeline(i){return this.previousNode=P0,this.currentTimeline=this.currentTimeline.fork(this.element,i),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(i,d,c){let m={duration:d??i.duration,delay:this.currentTimeline.currentTime+(c??0)+i.delay,easing:""},r=new dT(this._driver,i.element,i.keyframes,i.preStyleProps,i.postStyleProps,m,i.stretchStartingKeyframe);return this.timelines.push(r),m}incrementTime(i){this.currentTimeline.forwardTime(this.currentTimeline.duration+i)}delayNextStep(i){i>0&&this.currentTimeline.delayNextStep(i)}invokeQuery(i,d,c,m,r,T){let M=[];if(m&&M.push(this.element),i.length>0){i=i.replace(g6,"."+this._enterClassName),i=i.replace(y6,"."+this._leaveClassName);let F=c!=1,$=this._driver.query(this.element,i,F);c!==0&&($=c<0?$.slice($.length+c,$.length):$.slice(0,c)),M.push(...$)}return!r&&M.length==0&&T.push(RU(d)),M}},R0=class a{constructor(i,d,c,m){this._driver=i,this.element=d,this.startTime=c,this._elementTimelineStylesLookup=m,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(d),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(d,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(i){let d=this._keyframes.size===1&&this._pendingStyles.size;this.duration||d?(this.forwardTime(this.currentTime+i),d&&this.snapshotCurrentStyles()):this.startTime+=i}fork(i,d){return this.applyStylesToKeyframe(),new a(this._driver,i,d||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=p6,this._loadKeyframe()}forwardTime(i){this.applyStylesToKeyframe(),this.duration=i,this._loadKeyframe()}_updateStyle(i,d){this._localTimelineStyles.set(i,d),this._globalTimelineStyles.set(i,d),this._styleSummary.set(i,{time:this.currentTime,value:d})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(i){i&&this._previousKeyframe.set("easing",i);for(let[d,c]of this._globalTimelineStyles)this._backFill.set(d,c||Da),this._currentKeyframe.set(d,Da);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(i,d,c,m){d&&this._previousKeyframe.set("easing",d);let r=m&&m.params||{},T=v6(i,this._globalTimelineStyles);for(let[M,F]of T){let $=Hm(F,r,c);this._pendingStyles.set(M,$),this._localTimelineStyles.has(M)||this._backFill.set(M,this._globalTimelineStyles.get(M)??Da),this._updateStyle(M,$)}}applyStylesToKeyframe(){this._pendingStyles.size!=0&&(this._pendingStyles.forEach((i,d)=>{this._currentKeyframe.set(d,i)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((i,d)=>{this._currentKeyframe.has(d)||this._currentKeyframe.set(d,i)}))}snapshotCurrentStyles(){for(let[i,d]of this._localTimelineStyles)this._pendingStyles.set(i,d),this._updateStyle(i,d)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){let i=[];for(let d in this._currentKeyframe)i.push(d);return i}mergeTimelineCollectedStyles(i){i._styleSummary.forEach((d,c)=>{let m=this._styleSummary.get(c);(!m||d.time>m.time)&&this._updateStyle(c,d.value)})}buildKeyframes(){this.applyStylesToKeyframe();let i=new Set,d=new Set,c=this._keyframes.size===1&&this.duration===0,m=[];this._keyframes.forEach((M,F)=>{let $=new Map([...this._backFill,...M]);$.forEach((Q,ue)=>{Q===x0?i.add(ue):Q===Da&&d.add(ue)}),c||$.set("offset",F/this.duration),m.push($)});let r=[...i.values()],T=[...d.values()];if(c){let M=m[0],F=new Map(M);M.set("offset",0),F.set("offset",1),m=[M,F]}return DT(this.element,m,r,T,this.duration,this.startTime,this.easing,!1)}},dT=class extends R0{constructor(i,d,c,m,r,T,M=!1){super(i,d,T.delay),this.keyframes=c,this.preStyleProps=m,this.postStyleProps=r,this._stretchStartingKeyframe=M,this.timings={duration:T.duration,delay:T.delay,easing:T.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let i=this.keyframes,{delay:d,duration:c,easing:m}=this.timings;if(this._stretchStartingKeyframe&&d){let r=[],T=c+d,M=d/T,F=new Map(i[0]);F.set("offset",0),r.push(F);let $=new Map(i[0]);$.set("offset",rR(M)),r.push($);let Q=i.length-1;for(let ue=1;ue<=Q;ue++){let Ae=new Map(i[ue]),xe=Ae.get("offset"),ke=d+xe*c;Ae.set("offset",rR(ke/T)),r.push(Ae)}c=T,d=0,m="",i=r}return DT(this.element,i,this.preStyleProps,this.postStyleProps,c,d,m,!0)}};function rR(a,i=3){let d=Math.pow(10,i-1);return Math.round(a*d)/d}function v6(a,i){let d=new Map,c;return a.forEach(m=>{if(m==="*"){c??=i.keys();for(let r of c)d.set(r,Da)}else for(let[r,T]of m)d.set(r,T)}),d}function oR(a,i,d,c,m,r,T,M,F,$,Q,ue,Ae){return{type:0,element:a,triggerName:i,isRemovalTransition:m,fromState:d,fromStyles:r,toState:c,toStyles:T,timelines:M,queriedElements:F,preStyleProps:$,postStyleProps:Q,totalTime:ue,errors:Ae}}var JE={},k0=class{constructor(i,d,c){this._triggerName=i,this.ast=d,this._stateStyles=c}match(i,d,c,m){return b6(this.ast.matchers,i,d,c,m)}buildStyles(i,d,c){let m=this._stateStyles.get("*");return i!==void 0&&(m=this._stateStyles.get(i?.toString())||m),m?m.buildStyles(d,c):new Map}build(i,d,c,m,r,T,M,F,$,Q){let ue=[],Ae=this.ast.options&&this.ast.options.params||JE,xe=M&&M.params||JE,ke=this.buildStyles(c,xe,ue),Qe=F&&F.params||JE,dt=this.buildStyles(m,Qe,ue),st=new Set,Nt=new Map,gn=new Map,Xt=m==="void",Ni={params:xR(Qe,Ae),delay:this.ast.options?.delay},Xn=Q?[]:bR(i,d,this.ast.animation,r,T,ke,dt,Ni,$,ue),Gt=0;return Xn.forEach(vi=>{Gt=Math.max(vi.duration+vi.delay,Gt)}),ue.length?oR(d,this._triggerName,c,m,Xt,ke,dt,[],[],Nt,gn,Gt,ue):(Xn.forEach(vi=>{let $i=vi.element,oo=es(Nt,$i,new Set);vi.preStyleProps.forEach(Pi=>oo.add(Pi));let Js=es(gn,$i,new Set);vi.postStyleProps.forEach(Pi=>Js.add(Pi)),$i!==d&&st.add($i)}),oR(d,this._triggerName,c,m,Xt,ke,dt,Xn,[...st.values()],Nt,gn,Gt))}};function b6(a,i,d,c,m){return a.some(r=>r(i,d,c,m))}function xR(a,i){let d=Yt({},i);return Object.entries(a).forEach(([c,m])=>{m!=null&&(d[c]=m)}),d}var hT=class{constructor(i,d,c){this.styles=i,this.defaultParams=d,this.normalizer=c}buildStyles(i,d){let c=new Map,m=xR(i,this.defaultParams);return this.styles.styles.forEach(r=>{typeof r!="string"&&r.forEach((T,M)=>{T&&(T=Hm(T,m,d));let F=this.normalizer.normalizePropertyName(M,d);T=this.normalizer.normalizeStyleValue(M,F,T,d),c.set(M,T)})}),c}};function x6(a,i,d){return new fT(a,i,d)}var fT=class{constructor(i,d,c){this.name=i,this.ast=d,this._normalizer=c,this.transitionFactories=[],this.states=new Map,d.states.forEach(m=>{let r=m.options&&m.options.params||{};this.states.set(m.name,new hT(m.style,r,c))}),sR(this.states,"true","1"),sR(this.states,"false","0"),d.transitions.forEach(m=>{this.transitionFactories.push(new k0(i,m,this.states))}),this.fallbackTransition=w6(i,this.states,this._normalizer)}get containsQueries(){return this.ast.queryCount>0}matchTransition(i,d,c,m){return this.transitionFactories.find(T=>T.match(i,d,c,m))||null}matchStyles(i,d,c){return this.fallbackTransition.buildStyles(i,d,c)}};function w6(a,i,d){let c=[(T,M)=>!0],m={type:zn.Sequence,steps:[],options:null},r={type:zn.Transition,animation:m,matchers:c,options:null,queryCount:0,depCount:0};return new k0(a,r,i)}function sR(a,i,d){a.has(i)?a.has(d)||a.set(d,a.get(i)):a.has(d)&&a.set(i,a.get(d))}var E6=new qm,pT=class{constructor(i,d,c){this.bodyNode=i,this._driver=d,this._normalizer=c,this._animations=new Map,this._playersById=new Map,this.players=[]}register(i,d){let c=[],m=[],r=vR(this._driver,d,c,m);if(c.length)throw NU(c);m.length&&void 0,this._animations.set(i,r)}_buildPlayer(i,d,c){let m=i.element,r=hR(this._normalizer,i.keyframes,d,c);return this._driver.animate(m,r,i.duration,i.delay,i.easing,[],!0)}create(i,d,c={}){let m=[],r=this._animations.get(i),T,M=new Map;if(r?(T=bR(this._driver,d,r,gR,iT,new Map,new Map,c,E6,m),T.forEach(Q=>{let ue=es(M,Q.element,new Map);Q.postStyleProps.forEach(Ae=>ue.set(Ae,null))})):(m.push(zU()),T=[]),m.length)throw BU(m);M.forEach((Q,ue)=>{Q.forEach((Ae,xe)=>{Q.set(xe,this._driver.computeStyle(ue,xe,Da))})});let F=T.map(Q=>{let ue=M.get(Q.element);return this._buildPlayer(Q,new Map,ue)}),$=yc(F);return this._playersById.set(i,$),$.onDestroy(()=>this.destroy(i)),this.players.push($),$}destroy(i){let d=this._getPlayer(i);d.destroy(),this._playersById.delete(i);let c=this.players.indexOf(d);c>=0&&this.players.splice(c,1)}_getPlayer(i){let d=this._playersById.get(i);if(!d)throw VU(i);return d}listen(i,d,c,m){let r=bT(d,"","","");return vT(this._getPlayer(i),c,r,m),()=>{}}command(i,d,c,m){if(c=="register"){this.register(i,m[0]);return}if(c=="create"){let T=m[0]||{};this.create(i,d,T);return}let r=this._getPlayer(i);switch(c){case"play":r.play();break;case"pause":r.pause();break;case"reset":r.reset();break;case"restart":r.restart();break;case"finish":r.finish();break;case"init":r.init();break;case"setPosition":r.setPosition(parseFloat(m[0]));break;case"destroy":this.destroy(i);break}}},aR="ng-animate-queued",T6=".ng-animate-queued",eT="ng-animate-disabled",D6=".ng-animate-disabled",I6="ng-star-inserted",C6=".ng-star-inserted",S6=[],wR={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},M6={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Ks="__ng_removed",Wm=class{get params(){return this.options.params}constructor(i,d=""){this.namespaceId=d;let c=i&&i.hasOwnProperty("value"),m=c?i.value:i;if(this.value=P6(m),c){let r=i,{value:T}=r,M=om(r,["value"]);this.options=M}else this.options={};this.options.params||(this.options.params={})}absorbOptions(i){let d=i.params;if(d){let c=this.options.params;Object.keys(d).forEach(m=>{c[m]==null&&(c[m]=d[m])})}}},$m="void",tT=new Wm($m),mT=class{constructor(i,d,c){this.id=i,this.hostElement=d,this._engine=c,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+i,bs(d,this._hostClassName)}listen(i,d,c,m){if(!this._triggers.has(d))throw jU(c,d);if(c==null||c.length==0)throw UU(d);if(!R6(c))throw GU(c,d);let r=es(this._elementListeners,i,[]),T={name:d,phase:c,callback:m};r.push(T);let M=es(this._engine.statesByElement,i,new Map);return M.has(d)||(bs(i,w0),bs(i,w0+"-"+d),M.set(d,tT)),()=>{this._engine.afterFlush(()=>{let F=r.indexOf(T);F>=0&&r.splice(F,1),this._triggers.has(d)||M.delete(d)})}}register(i,d){return this._triggers.has(i)?!1:(this._triggers.set(i,d),!0)}_getTrigger(i){let d=this._triggers.get(i);if(!d)throw $U(i);return d}trigger(i,d,c,m=!0){let r=this._getTrigger(d),T=new Zm(this.id,d,i),M=this._engine.statesByElement.get(i);M||(bs(i,w0),bs(i,w0+"-"+d),this._engine.statesByElement.set(i,M=new Map));let F=M.get(d),$=new Wm(c,this.id);if(!(c&&c.hasOwnProperty("value"))&&F&&$.absorbOptions(F.options),M.set(d,$),F||(F=tT),!($.value===$m)&&F.value===$.value){if(!F6(F.params,$.params)){let Qe=[],dt=r.matchStyles(F.value,F.params,Qe),st=r.matchStyles($.value,$.params,Qe);Qe.length?this._engine.reportError(Qe):this._engine.afterFlush(()=>{nd(i,dt),Ca(i,st)})}return}let Ae=es(this._engine.playersByElement,i,[]);Ae.forEach(Qe=>{Qe.namespaceId==this.id&&Qe.triggerName==d&&Qe.queued&&Qe.destroy()});let xe=r.matchTransition(F.value,$.value,i,$.params),ke=!1;if(!xe){if(!m)return;xe=r.fallbackTransition,ke=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:d,transition:xe,fromState:F,toState:$,player:T,isFallbackTransition:ke}),ke||(bs(i,aR),T.onStart(()=>{ff(i,aR)})),T.onDone(()=>{let Qe=this.players.indexOf(T);Qe>=0&&this.players.splice(Qe,1);let dt=this._engine.playersByElement.get(i);if(dt){let st=dt.indexOf(T);st>=0&&dt.splice(st,1)}}),this.players.push(T),Ae.push(T),T}deregister(i){this._triggers.delete(i),this._engine.statesByElement.forEach(d=>d.delete(i)),this._elementListeners.forEach((d,c)=>{this._elementListeners.set(c,d.filter(m=>m.name!=i))})}clearElementCache(i){this._engine.statesByElement.delete(i),this._elementListeners.delete(i);let d=this._engine.playersByElement.get(i);d&&(d.forEach(c=>c.destroy()),this._engine.playersByElement.delete(i))}_signalRemovalForInnerTriggers(i,d){let c=this._engine.driver.query(i,C0,!0);c.forEach(m=>{if(m[Ks])return;let r=this._engine.fetchNamespacesByElement(m);r.size?r.forEach(T=>T.triggerLeaveAnimation(m,d,!1,!0)):this.clearElementCache(m)}),this._engine.afterFlushAnimationsDone(()=>c.forEach(m=>this.clearElementCache(m)))}triggerLeaveAnimation(i,d,c,m){let r=this._engine.statesByElement.get(i),T=new Map;if(r){let M=[];if(r.forEach((F,$)=>{if(T.set($,F.value),this._triggers.has($)){let Q=this.trigger(i,$,$m,m);Q&&M.push(Q)}}),M.length)return this._engine.markElementAsRemoved(this.id,i,!0,d,T),c&&yc(M).onDone(()=>this._engine.processLeaveNode(i)),!0}return!1}prepareLeaveAnimationListeners(i){let d=this._elementListeners.get(i),c=this._engine.statesByElement.get(i);if(d&&c){let m=new Set;d.forEach(r=>{let T=r.name;if(m.has(T))return;m.add(T);let F=this._triggers.get(T).fallbackTransition,$=c.get(T)||tT,Q=new Wm($m),ue=new Zm(this.id,T,i);this._engine.totalQueuedPlayers++,this._queue.push({element:i,triggerName:T,transition:F,fromState:$,toState:Q,player:ue,isFallbackTransition:!0})})}}removeNode(i,d){let c=this._engine;if(i.childElementCount&&this._signalRemovalForInnerTriggers(i,d),this.triggerLeaveAnimation(i,d,!0))return;let m=!1;if(c.totalAnimations){let r=c.players.length?c.playersByQueriedElement.get(i):[];if(r&&r.length)m=!0;else{let T=i;for(;T=T.parentNode;)if(c.statesByElement.get(T)){m=!0;break}}}if(this.prepareLeaveAnimationListeners(i),m)c.markElementAsRemoved(this.id,i,!1,d);else{let r=i[Ks];(!r||r===wR)&&(c.afterFlush(()=>this.clearElementCache(i)),c.destroyInnerAnimations(i),c._onRemovalComplete(i,d))}}insertNode(i,d){bs(i,this._hostClassName)}drainQueuedTransitions(i){let d=[];return this._queue.forEach(c=>{let m=c.player;if(m.destroyed)return;let r=c.element,T=this._elementListeners.get(r);T&&T.forEach(M=>{if(M.name==c.triggerName){let F=bT(r,c.triggerName,c.fromState.value,c.toState.value);F._data=i,vT(c.player,M.phase,F,M.callback)}}),m.markedForDestroy?this._engine.afterFlush(()=>{m.destroy()}):d.push(c)}),this._queue=[],d.sort((c,m)=>{let r=c.transition.ast.depCount,T=m.transition.ast.depCount;return r==0||T==0?r-T:this._engine.driver.containsElement(c.element,m.element)?1:-1})}destroy(i){this.players.forEach(d=>d.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,i)}},gT=class{_onRemovalComplete(i,d){this.onRemovalComplete(i,d)}constructor(i,d,c){this.bodyNode=i,this.driver=d,this._normalizer=c,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(m,r)=>{}}get queuedPlayers(){let i=[];return this._namespaceList.forEach(d=>{d.players.forEach(c=>{c.queued&&i.push(c)})}),i}createNamespace(i,d){let c=new mT(i,d,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,d)?this._balanceNamespaceList(c,d):(this.newHostElements.set(d,c),this.collectEnterElement(d)),this._namespaceLookup[i]=c}_balanceNamespaceList(i,d){let c=this._namespaceList,m=this.namespacesByHostElement;if(c.length-1>=0){let T=!1,M=this.driver.getParentElement(d);for(;M;){let F=m.get(M);if(F){let $=c.indexOf(F);c.splice($+1,0,i),T=!0;break}M=this.driver.getParentElement(M)}T||c.unshift(i)}else c.push(i);return m.set(d,i),i}register(i,d){let c=this._namespaceLookup[i];return c||(c=this.createNamespace(i,d)),c}registerTrigger(i,d,c){let m=this._namespaceLookup[i];m&&m.register(d,c)&&this.totalAnimations++}destroy(i,d){i&&(this.afterFlush(()=>{}),this.afterFlushAnimationsDone(()=>{let c=this._fetchNamespace(i);this.namespacesByHostElement.delete(c.hostElement);let m=this._namespaceList.indexOf(c);m>=0&&this._namespaceList.splice(m,1),c.destroy(d),delete this._namespaceLookup[i]}))}_fetchNamespace(i){return this._namespaceLookup[i]}fetchNamespacesByElement(i){let d=new Set,c=this.statesByElement.get(i);if(c){for(let m of c.values())if(m.namespaceId){let r=this._fetchNamespace(m.namespaceId);r&&d.add(r)}}return d}trigger(i,d,c,m){if(D0(d)){let r=this._fetchNamespace(i);if(r)return r.trigger(d,c,m),!0}return!1}insertNode(i,d,c,m){if(!D0(d))return;let r=d[Ks];if(r&&r.setForRemoval){r.setForRemoval=!1,r.setForMove=!0;let T=this.collectedLeaveElements.indexOf(d);T>=0&&this.collectedLeaveElements.splice(T,1)}if(i){let T=this._fetchNamespace(i);T&&T.insertNode(d,c)}m&&this.collectEnterElement(d)}collectEnterElement(i){this.collectedEnterElements.push(i)}markElementAsDisabled(i,d){d?this.disabledNodes.has(i)||(this.disabledNodes.add(i),bs(i,eT)):this.disabledNodes.has(i)&&(this.disabledNodes.delete(i),ff(i,eT))}removeNode(i,d,c){if(D0(d)){let m=i?this._fetchNamespace(i):null;m?m.removeNode(d,c):this.markElementAsRemoved(i,d,!1,c);let r=this.namespacesByHostElement.get(d);r&&r.id!==i&&r.removeNode(d,c)}else this._onRemovalComplete(d,c)}markElementAsRemoved(i,d,c,m,r){this.collectedLeaveElements.push(d),d[Ks]={namespaceId:i,setForRemoval:m,hasAnimation:c,removedBeforeQueried:!1,previousTriggersValues:r}}listen(i,d,c,m,r){return D0(d)?this._fetchNamespace(i).listen(d,c,m,r):()=>{}}_buildInstruction(i,d,c,m,r){return i.transition.build(this.driver,i.element,i.fromState.value,i.toState.value,c,m,i.fromState.options,i.toState.options,d,r)}destroyInnerAnimations(i){let d=this.driver.query(i,C0,!0);d.forEach(c=>this.destroyActiveAnimationsForElement(c)),this.playersByQueriedElement.size!=0&&(d=this.driver.query(i,rT,!0),d.forEach(c=>this.finishActiveQueriedAnimationOnElement(c)))}destroyActiveAnimationsForElement(i){let d=this.playersByElement.get(i);d&&d.forEach(c=>{c.queued?c.markedForDestroy=!0:c.destroy()})}finishActiveQueriedAnimationOnElement(i){let d=this.playersByQueriedElement.get(i);d&&d.forEach(c=>c.finish())}whenRenderingDone(){return new Promise(i=>{if(this.players.length)return yc(this.players).onDone(()=>i());i()})}processLeaveNode(i){let d=i[Ks];if(d&&d.setForRemoval){if(i[Ks]=wR,d.namespaceId){this.destroyInnerAnimations(i);let c=this._fetchNamespace(d.namespaceId);c&&c.clearElementCache(i)}this._onRemovalComplete(i,d.setForRemoval)}i.classList?.contains(eT)&&this.markElementAsDisabled(i,!1),this.driver.query(i,D6,!0).forEach(c=>{this.markElementAsDisabled(c,!1)})}flush(i=-1){let d=[];if(this.newHostElements.size&&(this.newHostElements.forEach((c,m)=>this._balanceNamespaceList(c,m)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let c=0;c<this.collectedEnterElements.length;c++){let m=this.collectedEnterElements[c];bs(m,I6)}if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){let c=[];try{d=this._flushAnimations(c,i)}finally{for(let m=0;m<c.length;m++)c[m]()}}else for(let c=0;c<this.collectedLeaveElements.length;c++){let m=this.collectedLeaveElements[c];this.processLeaveNode(m)}if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(c=>c()),this._flushFns=[],this._whenQuietFns.length){let c=this._whenQuietFns;this._whenQuietFns=[],d.length?yc(d).onDone(()=>{c.forEach(m=>m())}):c.forEach(m=>m())}}reportError(i){throw HU(i)}_flushAnimations(i,d){let c=new qm,m=[],r=new Map,T=[],M=new Map,F=new Map,$=new Map,Q=new Set;this.disabledNodes.forEach(St=>{Q.add(St);let Ht=this.driver.query(St,T6,!0);for(let Kt=0;Kt<Ht.length;Kt++)Q.add(Ht[Kt])});let ue=this.bodyNode,Ae=Array.from(this.statesByElement.keys()),xe=uR(Ae,this.collectedEnterElements),ke=new Map,Qe=0;xe.forEach((St,Ht)=>{let Kt=gR+Qe++;ke.set(Ht,Kt),St.forEach(Mt=>bs(Mt,Kt))});let dt=[],st=new Set,Nt=new Set;for(let St=0;St<this.collectedLeaveElements.length;St++){let Ht=this.collectedLeaveElements[St],Kt=Ht[Ks];Kt&&Kt.setForRemoval&&(dt.push(Ht),st.add(Ht),Kt.hasAnimation?this.driver.query(Ht,C6,!0).forEach(Mt=>st.add(Mt)):Nt.add(Ht))}let gn=new Map,Xt=uR(Ae,Array.from(st));Xt.forEach((St,Ht)=>{let Kt=iT+Qe++;gn.set(Ht,Kt),St.forEach(Mt=>bs(Mt,Kt))}),i.push(()=>{xe.forEach((St,Ht)=>{let Kt=ke.get(Ht);St.forEach(Mt=>ff(Mt,Kt))}),Xt.forEach((St,Ht)=>{let Kt=gn.get(Ht);St.forEach(Mt=>ff(Mt,Kt))}),dt.forEach(St=>{this.processLeaveNode(St)})});let Ni=[],Xn=[];for(let St=this._namespaceList.length-1;St>=0;St--)this._namespaceList[St].drainQueuedTransitions(d).forEach(Kt=>{let Mt=Kt.player,Ri=Kt.element;if(Ni.push(Mt),this.collectedEnterElements.length){let mn=Ri[Ks];if(mn&&mn.setForMove){if(mn.previousTriggersValues&&mn.previousTriggersValues.has(Kt.triggerName)){let so=mn.previousTriggersValues.get(Kt.triggerName),fr=this.statesByElement.get(Kt.element);if(fr&&fr.has(Kt.triggerName)){let ao=fr.get(Kt.triggerName);ao.value=so,fr.set(Kt.triggerName,ao)}}Mt.destroy();return}}let wi=!ue||!this.driver.containsElement(ue,Ri),sr=gn.get(Ri),Pr=ke.get(Ri),Zn=this._buildInstruction(Kt,c,Pr,sr,wi);if(Zn.errors&&Zn.errors.length){Xn.push(Zn);return}if(wi){Mt.onStart(()=>nd(Ri,Zn.fromStyles)),Mt.onDestroy(()=>Ca(Ri,Zn.toStyles)),m.push(Mt);return}if(Kt.isFallbackTransition){Mt.onStart(()=>nd(Ri,Zn.fromStyles)),Mt.onDestroy(()=>Ca(Ri,Zn.toStyles)),m.push(Mt);return}let At=[];Zn.timelines.forEach(mn=>{mn.stretchStartingKeyframe=!0,this.disabledNodes.has(mn.element)||At.push(mn)}),Zn.timelines=At,c.append(Ri,Zn.timelines);let Ds={instruction:Zn,player:Mt,element:Ri};T.push(Ds),Zn.queriedElements.forEach(mn=>es(M,mn,[]).push(Mt)),Zn.preStyleProps.forEach((mn,so)=>{if(mn.size){let fr=F.get(so);fr||F.set(so,fr=new Set),mn.forEach((ao,xo)=>fr.add(xo))}}),Zn.postStyleProps.forEach((mn,so)=>{let fr=$.get(so);fr||$.set(so,fr=new Set),mn.forEach((ao,xo)=>fr.add(xo))})});if(Xn.length){let St=[];Xn.forEach(Ht=>{St.push(qU(Ht.triggerName,Ht.errors))}),Ni.forEach(Ht=>Ht.destroy()),this.reportError(St)}let Gt=new Map,vi=new Map;T.forEach(St=>{let Ht=St.element;c.has(Ht)&&(vi.set(Ht,Ht),this._beforeAnimationBuild(St.player.namespaceId,St.instruction,Gt))}),m.forEach(St=>{let Ht=St.element;this._getPreviousPlayers(Ht,!1,St.namespaceId,St.triggerName,null).forEach(Mt=>{es(Gt,Ht,[]).push(Mt),Mt.destroy()})});let $i=dt.filter(St=>dR(St,F,$)),oo=new Map;cR(oo,this.driver,Nt,$,Da).forEach(St=>{dR(St,F,$)&&$i.push(St)});let Pi=new Map;xe.forEach((St,Ht)=>{cR(Pi,this.driver,new Set(St),F,x0)}),$i.forEach(St=>{let Ht=oo.get(St),Kt=Pi.get(St);oo.set(St,new Map([...Ht?.entries()??[],...Kt?.entries()??[]]))});let Wn=[],Ts=[],Ar={};T.forEach(St=>{let{element:Ht,player:Kt,instruction:Mt}=St;if(c.has(Ht)){if(Q.has(Ht)){Kt.onDestroy(()=>Ca(Ht,Mt.toStyles)),Kt.disabled=!0,Kt.overrideTotalTime(Mt.totalTime),m.push(Kt);return}let Ri=Ar;if(vi.size>1){let sr=Ht,Pr=[];for(;sr=sr.parentNode;){let Zn=vi.get(sr);if(Zn){Ri=Zn;break}Pr.push(sr)}Pr.forEach(Zn=>vi.set(Zn,Ri))}let wi=this._buildAnimation(Kt.namespaceId,Mt,Gt,r,Pi,oo);if(Kt.setRealPlayer(wi),Ri===Ar)Wn.push(Kt);else{let sr=this.playersByElement.get(Ri);sr&&sr.length&&(Kt.parentPlayer=yc(sr)),m.push(Kt)}}else nd(Ht,Mt.fromStyles),Kt.onDestroy(()=>Ca(Ht,Mt.toStyles)),Ts.push(Kt),Q.has(Ht)&&m.push(Kt)}),Ts.forEach(St=>{let Ht=r.get(St.element);if(Ht&&Ht.length){let Kt=yc(Ht);St.setRealPlayer(Kt)}}),m.forEach(St=>{St.parentPlayer?St.syncPlayerEvents(St.parentPlayer):St.destroy()});for(let St=0;St<dt.length;St++){let Ht=dt[St],Kt=Ht[Ks];if(ff(Ht,iT),Kt&&Kt.hasAnimation)continue;let Mt=[];if(M.size){let wi=M.get(Ht);wi&&wi.length&&Mt.push(...wi);let sr=this.driver.query(Ht,rT,!0);for(let Pr=0;Pr<sr.length;Pr++){let Zn=M.get(sr[Pr]);Zn&&Zn.length&&Mt.push(...Zn)}}let Ri=Mt.filter(wi=>!wi.destroyed);Ri.length?k6(this,Ht,Ri):this.processLeaveNode(Ht)}return dt.length=0,Wn.forEach(St=>{this.players.push(St),St.onDone(()=>{St.destroy();let Ht=this.players.indexOf(St);this.players.splice(Ht,1)}),St.play()}),Wn}afterFlush(i){this._flushFns.push(i)}afterFlushAnimationsDone(i){this._whenQuietFns.push(i)}_getPreviousPlayers(i,d,c,m,r){let T=[];if(d){let M=this.playersByQueriedElement.get(i);M&&(T=M)}else{let M=this.playersByElement.get(i);if(M){let F=!r||r==$m;M.forEach($=>{$.queued||!F&&$.triggerName!=m||T.push($)})}}return(c||m)&&(T=T.filter(M=>!(c&&c!=M.namespaceId||m&&m!=M.triggerName))),T}_beforeAnimationBuild(i,d,c){let m=d.triggerName,r=d.element,T=d.isRemovalTransition?void 0:i,M=d.isRemovalTransition?void 0:m;for(let F of d.timelines){let $=F.element,Q=$!==r,ue=es(c,$,[]);this._getPreviousPlayers($,Q,T,M,d.toState).forEach(xe=>{let ke=xe.getRealPlayer();ke.beforeDestroy&&ke.beforeDestroy(),xe.destroy(),ue.push(xe)})}nd(r,d.fromStyles)}_buildAnimation(i,d,c,m,r,T){let M=d.triggerName,F=d.element,$=[],Q=new Set,ue=new Set,Ae=d.timelines.map(ke=>{let Qe=ke.element;Q.add(Qe);let dt=Qe[Ks];if(dt&&dt.removedBeforeQueried)return new _c(ke.duration,ke.delay);let st=Qe!==F,Nt=O6((c.get(Qe)||S6).map(Gt=>Gt.getRealPlayer())).filter(Gt=>{let vi=Gt;return vi.element?vi.element===Qe:!1}),gn=r.get(Qe),Xt=T.get(Qe),Ni=hR(this._normalizer,ke.keyframes,gn,Xt),Xn=this._buildPlayer(ke,Ni,Nt);if(ke.subTimeline&&m&&ue.add(Qe),st){let Gt=new Zm(i,M,Qe);Gt.setRealPlayer(Xn),$.push(Gt)}return Xn});$.forEach(ke=>{es(this.playersByQueriedElement,ke.element,[]).push(ke),ke.onDone(()=>A6(this.playersByQueriedElement,ke.element,ke))}),Q.forEach(ke=>bs(ke,tR));let xe=yc(Ae);return xe.onDestroy(()=>{Q.forEach(ke=>ff(ke,tR)),Ca(F,d.toStyles)}),ue.forEach(ke=>{es(m,ke,[]).push(xe)}),xe}_buildPlayer(i,d,c){return d.length>0?this.driver.animate(i.element,d,i.duration,i.delay,i.easing,c):new _c(i.duration,i.delay)}},Zm=class{constructor(i,d,c){this.namespaceId=i,this.triggerName=d,this.element=c,this._player=new _c,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(i){this._containsRealPlayer||(this._player=i,this._queuedCallbacks.forEach((d,c)=>{d.forEach(m=>vT(i,c,void 0,m))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(i.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(i){this.totalTime=i}syncPlayerEvents(i){let d=this._player;d.triggerCallback&&i.onStart(()=>d.triggerCallback("start")),i.onDone(()=>this.finish()),i.onDestroy(()=>this.destroy())}_queueEvent(i,d){es(this._queuedCallbacks,i,[]).push(d)}onDone(i){this.queued&&this._queueEvent("done",i),this._player.onDone(i)}onStart(i){this.queued&&this._queueEvent("start",i),this._player.onStart(i)}onDestroy(i){this.queued&&this._queueEvent("destroy",i),this._player.onDestroy(i)}init(){this._player.init()}hasStarted(){return this.queued?!1:this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(i){this.queued||this._player.setPosition(i)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(i){let d=this._player;d.triggerCallback&&d.triggerCallback(i)}};function A6(a,i,d){let c=a.get(i);if(c){if(c.length){let m=c.indexOf(d);c.splice(m,1)}c.length==0&&a.delete(i)}return c}function P6(a){return a??null}function D0(a){return a&&a.nodeType===1}function R6(a){return a=="start"||a=="done"}function lR(a,i){let d=a.style.display;return a.style.display=i??"none",d}function cR(a,i,d,c,m){let r=[];d.forEach(F=>r.push(lR(F)));let T=[];c.forEach((F,$)=>{let Q=new Map;F.forEach(ue=>{let Ae=i.computeStyle($,ue,m);Q.set(ue,Ae),(!Ae||Ae.length==0)&&($[Ks]=M6,T.push($))}),a.set($,Q)});let M=0;return d.forEach(F=>lR(F,r[M++])),T}function uR(a,i){let d=new Map;if(a.forEach(M=>d.set(M,[])),i.length==0)return d;let c=1,m=new Set(i),r=new Map;function T(M){if(!M)return c;let F=r.get(M);if(F)return F;let $=M.parentNode;return d.has($)?F=$:m.has($)?F=c:F=T($),r.set(M,F),F}return i.forEach(M=>{let F=T(M);F!==c&&d.get(F).push(M)}),d}function bs(a,i){a.classList?.add(i)}function ff(a,i){a.classList?.remove(i)}function k6(a,i,d){yc(d).onDone(()=>a.processLeaveNode(i))}function O6(a){let i=[];return ER(a,i),i}function ER(a,i){for(let d=0;d<a.length;d++){let c=a[d];c instanceof Bm?ER(c.players,i):i.push(c)}}function F6(a,i){let d=Object.keys(a),c=Object.keys(i);if(d.length!=c.length)return!1;for(let m=0;m<d.length;m++){let r=d[m];if(!i.hasOwnProperty(r)||a[r]!==i[r])return!1}return!0}function dR(a,i,d){let c=d.get(a);if(!c)return!1;let m=i.get(a);return m?c.forEach(r=>m.add(r)):i.set(a,c),d.delete(a),!0}var mf=class{constructor(i,d,c){this._driver=d,this._normalizer=c,this._triggerCache={},this.onRemovalComplete=(m,r)=>{},this._transitionEngine=new gT(i.body,d,c),this._timelineEngine=new pT(i.body,d,c),this._transitionEngine.onRemovalComplete=(m,r)=>this.onRemovalComplete(m,r)}registerTrigger(i,d,c,m,r){let T=i+"-"+m,M=this._triggerCache[T];if(!M){let F=[],$=[],Q=vR(this._driver,r,F,$);if(F.length)throw FU(m,F);$.length&&void 0,M=x6(m,Q,this._normalizer),this._triggerCache[T]=M}this._transitionEngine.registerTrigger(d,m,M)}register(i,d){this._transitionEngine.register(i,d)}destroy(i,d){this._transitionEngine.destroy(i,d)}onInsert(i,d,c,m){this._transitionEngine.insertNode(i,d,c,m)}onRemove(i,d,c){this._transitionEngine.removeNode(i,d,c)}disableAnimations(i,d){this._transitionEngine.markElementAsDisabled(i,d)}process(i,d,c,m){if(c.charAt(0)=="@"){let[r,T]=JP(c),M=m;this._timelineEngine.command(r,d,T,M)}else this._transitionEngine.trigger(i,d,c,m)}listen(i,d,c,m,r){if(c.charAt(0)=="@"){let[T,M]=JP(c);return this._timelineEngine.listen(T,d,M,r)}return this._transitionEngine.listen(i,d,c,m,r)}flush(i=-1){this._transitionEngine.flush(i)}get players(){return[...this._transitionEngine.players,...this._timelineEngine.players]}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}afterFlushAnimationsDone(i){this._transitionEngine.afterFlushAnimationsDone(i)}};function L6(a,i){let d=null,c=null;return Array.isArray(i)&&i.length?(d=nT(i[0]),i.length>1&&(c=nT(i[i.length-1]))):i instanceof Map&&(d=nT(i)),d||c?new _T(a,d,c):null}var pf=class pf{constructor(i,d,c){this._element=i,this._startStyles=d,this._endStyles=c,this._state=0;let m=pf.initialStylesByElement.get(i);m||pf.initialStylesByElement.set(i,m=new Map),this._initialStyles=m}start(){this._state<1&&(this._startStyles&&Ca(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(Ca(this._element,this._initialStyles),this._endStyles&&(Ca(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(pf.initialStylesByElement.delete(this._element),this._startStyles&&(nd(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(nd(this._element,this._endStyles),this._endStyles=null),Ca(this._element,this._initialStyles),this._state=3)}};pf.initialStylesByElement=new WeakMap;var _T=pf;function nT(a){let i=null;return a.forEach((d,c)=>{N6(c)&&(i=i||new Map,i.set(c,d))}),i}function N6(a){return a==="display"||a==="position"}var O0=class{constructor(i,d,c,m){this.element=i,this.keyframes=d,this.options=c,this._specialStyles=m,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=c.duration,this._delay=c.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(i=>i()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;let i=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,i,this.options),this._finalKeyframe=i.length?i[i.length-1]:new Map;let d=()=>this._onFinish();this.domPlayer.addEventListener("finish",d),this.onDestroy(()=>{this.domPlayer.removeEventListener("finish",d)})}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(i){let d=[];return i.forEach(c=>{d.push(Object.fromEntries(c))}),d}_triggerWebAnimation(i,d,c){return i.animate(this._convertKeyframesToObject(d),c)}onStart(i){this._originalOnStartFns.push(i),this._onStartFns.push(i)}onDone(i){this._originalOnDoneFns.push(i),this._onDoneFns.push(i)}onDestroy(i){this._onDestroyFns.push(i)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(i=>i()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(i=>i()),this._onDestroyFns=[])}setPosition(i){this.domPlayer===void 0&&this.init(),this.domPlayer.currentTime=i*this.time}getPosition(){return+(this.domPlayer.currentTime??0)/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){let i=new Map;this.hasStarted()&&this._finalKeyframe.forEach((c,m)=>{m!=="offset"&&i.set(m,this._finished?c:TT(this.element,m))}),this.currentSnapshot=i}triggerCallback(i){let d=i==="start"?this._onStartFns:this._onDoneFns;d.forEach(c=>c()),d.length=0}},F0=class{validateStyleProperty(i){return!0}validateAnimatableStyleProperty(i){return!0}containsElement(i,d){return fR(i,d)}getParentElement(i){return xT(i)}query(i,d,c){return pR(i,d,c)}computeStyle(i,d,c){return TT(i,d)}animate(i,d,c,m,r,T=[]){let M=m==0?"both":"forwards",F={duration:c,delay:m,fill:M};r&&(F.easing=r);let $=new Map,Q=T.filter(xe=>xe instanceof O0);i6(c,m)&&Q.forEach(xe=>{xe.currentSnapshot.forEach((ke,Qe)=>$.set(Qe,ke))});let ue=e6(d).map(xe=>new Map(xe));ue=r6(i,ue,$);let Ae=L6(i,ue);return new O0(i,ue,F,Ae)}};var I0="@",TR="@.disabled",L0=class{constructor(i,d,c,m){this.namespaceId=i,this.delegate=d,this.engine=c,this._onDestroy=m,this.\u0275type=0}get data(){return this.delegate.data}destroyNode(i){this.delegate.destroyNode?.(i)}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.engine.afterFlushAnimationsDone(()=>{queueMicrotask(()=>{this.delegate.destroy()})}),this._onDestroy?.()}createElement(i,d){return this.delegate.createElement(i,d)}createComment(i){return this.delegate.createComment(i)}createText(i){return this.delegate.createText(i)}appendChild(i,d){this.delegate.appendChild(i,d),this.engine.onInsert(this.namespaceId,d,i,!1)}insertBefore(i,d,c,m=!0){this.delegate.insertBefore(i,d,c),this.engine.onInsert(this.namespaceId,d,i,m)}removeChild(i,d,c){this.engine.onRemove(this.namespaceId,d,this.delegate)}selectRootElement(i,d){return this.delegate.selectRootElement(i,d)}parentNode(i){return this.delegate.parentNode(i)}nextSibling(i){return this.delegate.nextSibling(i)}setAttribute(i,d,c,m){this.delegate.setAttribute(i,d,c,m)}removeAttribute(i,d,c){this.delegate.removeAttribute(i,d,c)}addClass(i,d){this.delegate.addClass(i,d)}removeClass(i,d){this.delegate.removeClass(i,d)}setStyle(i,d,c,m){this.delegate.setStyle(i,d,c,m)}removeStyle(i,d,c){this.delegate.removeStyle(i,d,c)}setProperty(i,d,c){d.charAt(0)==I0&&d==TR?this.disableAnimations(i,!!c):this.delegate.setProperty(i,d,c)}setValue(i,d){this.delegate.setValue(i,d)}listen(i,d,c){return this.delegate.listen(i,d,c)}disableAnimations(i,d){this.engine.disableAnimations(i,d)}},yT=class extends L0{constructor(i,d,c,m,r){super(d,c,m,r),this.factory=i,this.namespaceId=d}setProperty(i,d,c){d.charAt(0)==I0?d.charAt(1)=="."&&d==TR?(c=c===void 0?!0:!!c,this.disableAnimations(i,c)):this.engine.process(this.namespaceId,i,d.slice(1),c):this.delegate.setProperty(i,d,c)}listen(i,d,c){if(d.charAt(0)==I0){let m=z6(i),r=d.slice(1),T="";return r.charAt(0)!=I0&&([r,T]=B6(r)),this.engine.listen(this.namespaceId,m,r,T,M=>{let F=M._data||-1;this.factory.scheduleListenerCallback(F,c,M)})}return this.delegate.listen(i,d,c)}};function z6(a){switch(a){case"body":return document.body;case"document":return document;case"window":return window;default:return a}}function B6(a){let i=a.indexOf("."),d=a.substring(0,i),c=a.slice(i+1);return[d,c]}var N0=class{constructor(i,d,c){this.delegate=i,this.engine=d,this._zone=c,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,d.onRemovalComplete=(m,r)=>{let T=r?.parentNode(m);T&&r.removeChild(T,m)}}createRenderer(i,d){let c="",m=this.delegate.createRenderer(i,d);if(!i||!d?.data?.animation){let $=this._rendererCache,Q=$.get(m);if(!Q){let ue=()=>$.delete(m);Q=new L0(c,m,this.engine,ue),$.set(m,Q)}return Q}let r=d.id,T=d.id+"-"+this._currentId;this._currentId++,this.engine.register(T,i);let M=$=>{Array.isArray($)?$.forEach(M):this.engine.registerTrigger(r,T,i,$.name,$)};return d.data.animation.forEach(M),new yT(this,T,m,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){queueMicrotask(()=>{this._microtaskId++})}scheduleListenerCallback(i,d,c){if(i>=0&&i<this._microtaskId){this._zone.run(()=>d(c));return}let m=this._animationCallbacksBuffer;m.length==0&&queueMicrotask(()=>{this._zone.run(()=>{m.forEach(r=>{let[T,M]=r;T(M)}),this._animationCallbacksBuffer=[]})}),m.push([d,c])}end(){this._cdRecurDepth--,this._cdRecurDepth==0&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}};var j6=(()=>{let i=class i extends mf{constructor(c,m,r){super(c,m,r)}ngOnDestroy(){this.flush()}};i.\u0275fac=function(m){return new(m||i)(Ze(jn),Ze(id),Ze(rd))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac});let a=i;return a})();function U6(){return new M0}function G6(a,i,d){return new N0(a,i,d)}var IR=[{provide:rd,useFactory:U6},{provide:mf,useClass:j6},{provide:cc,useFactory:G6,deps:[_0,mf,Wt]}],DR=[{provide:id,useFactory:()=>new F0},{provide:Lo,useValue:"BrowserAnimations"},...IR],$6=[{provide:id,useClass:wT},{provide:Lo,useValue:"NoopAnimations"},...IR],CR=(()=>{let i=class i{static withConfig(c){return{ngModule:i,providers:c.disableAnimations?$6:DR}}};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({providers:DR,imports:[v0]});let a=i;return a})();function od(a){return a!=null&&`${a}`!="false"}function gf(a){return Array.isArray(a)?a:[a]}function gr(a){return a==null?"":typeof a=="string"?a:`${a}px`}function xs(a){return a instanceof ti?a.nativeElement:a}var ST;try{ST=typeof Intl<"u"&&Intl.v8BreakIterator}catch{ST=!1}var Ai=(()=>{let i=class i{constructor(c){this._platformId=c,this.isBrowser=this._platformId?SP(this._platformId):typeof document=="object"&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!!(window.chrome||ST)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}};i.\u0275fac=function(m){return new(m||i)(Ze(Qs))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var _f,SR=["color","button","checkbox","date","datetime-local","email","file","hidden","image","month","number","password","radio","range","reset","search","submit","tel","text","time","url","week"];function MT(){if(_f)return _f;if(typeof document!="object"||!document)return _f=new Set(SR),_f;let a=document.createElement("input");return _f=new Set(SR.filter(i=>(a.setAttribute("type",i),a.type===i))),_f}var Qm;function H6(){if(Qm==null&&typeof window<"u")try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>Qm=!0}))}finally{Qm=Qm||!1}return Qm}function vc(a){return H6()?a:!!a.capture}var sd;function MR(){if(sd==null){if(typeof document!="object"||!document||typeof Element!="function"||!Element)return sd=!1,sd;if("scrollBehavior"in document.documentElement.style)sd=!0;else{let a=Element.prototype.scrollTo;a?sd=!/\{\s*\[native code\]\s*\}/.test(a.toString()):sd=!1}}return sd}var CT;function q6(){if(CT==null){let a=typeof document<"u"?document.head:null;CT=!!(a&&(a.createShadowRoot||a.attachShadow))}return CT}function AR(a){if(q6()){let i=a.getRootNode?a.getRootNode():null;if(typeof ShadowRoot<"u"&&ShadowRoot&&i instanceof ShadowRoot)return i}return null}function ws(a){return a.composedPath?a.composedPath()[0]:a.target}function Ym(){return typeof __karma__<"u"&&!!__karma__||typeof jasmine<"u"&&!!jasmine||typeof jest<"u"&&!!jest||typeof Mocha<"u"&&!!Mocha}var PR=vc({passive:!0}),kR=(()=>{let i=class i{constructor(c,m){this._platform=c,this._ngZone=m,this._monitoredElements=new Map}monitor(c){if(!this._platform.isBrowser)return Ru;let m=xs(c),r=this._monitoredElements.get(m);if(r)return r.subject;let T=new Tn,M="cdk-text-field-autofilled",F=$=>{$.animationName==="cdk-text-field-autofill-start"&&!m.classList.contains(M)?(m.classList.add(M),this._ngZone.run(()=>T.next({target:$.target,isAutofilled:!0}))):$.animationName==="cdk-text-field-autofill-end"&&m.classList.contains(M)&&(m.classList.remove(M),this._ngZone.run(()=>T.next({target:$.target,isAutofilled:!1})))};return this._ngZone.runOutsideAngular(()=>{m.addEventListener("animationstart",F,PR),m.classList.add("cdk-text-field-autofill-monitored")}),this._monitoredElements.set(m,{subject:T,unlisten:()=>{m.removeEventListener("animationstart",F,PR)}}),T}stopMonitoring(c){let m=xs(c),r=this._monitoredElements.get(m);r&&(r.unlisten(),r.subject.complete(),m.classList.remove("cdk-text-field-autofill-monitored"),m.classList.remove("cdk-text-field-autofilled"),this._monitoredElements.delete(m))}ngOnDestroy(){this._monitoredElements.forEach((c,m)=>this.stopMonitoring(m))}};i.\u0275fac=function(m){return new(m||i)(Ze(Ai),Ze(Wt))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var OR=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})();var UR=(()=>{let i=class i{constructor(c,m){this._renderer=c,this._elementRef=m,this.onChange=r=>{},this.onTouched=()=>{}}setProperty(c,m){this._renderer.setProperty(this._elementRef.nativeElement,c,m)}registerOnTouched(c){this.onTouched=c}registerOnChange(c){this.onChange=c}setDisabledState(c){this.setProperty("disabled",c)}};i.\u0275fac=function(m){return new(m||i)(Tt(Im),Tt(ti))},i.\u0275dir=ui({type:i});let a=i;return a})(),Z6=(()=>{let i=class i extends UR{};i.\u0275fac=(()=>{let c;return function(r){return(c||(c=eE(i)))(r||i)}})(),i.\u0275dir=ui({type:i,features:[yo]});let a=i;return a})(),GR=new Pt("");var Q6={provide:GR,useExisting:Hu(()=>Z0),multi:!0};function Y6(){let a=Ta()?Ta().getUserAgent():"";return/android (\d+)/.test(a.toLowerCase())}var X6=new Pt(""),Z0=(()=>{let i=class i extends UR{constructor(c,m,r){super(c,m),this._compositionMode=r,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!Y6())}writeValue(c){let m=c??"";this.setProperty("value",m)}_handleInput(c){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(c)}_compositionStart(){this._composing=!0}_compositionEnd(c){this._composing=!1,this._compositionMode&&this.onChange(c)}};i.\u0275fac=function(m){return new(m||i)(Tt(Im),Tt(ti),Tt(X6,8))},i.\u0275dir=ui({type:i,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(m,r){m&1&&Zr("input",function(M){return r._handleInput(M.target.value)})("blur",function(){return r.onTouched()})("compositionstart",function(){return r._compositionStart()})("compositionend",function(M){return r._compositionEnd(M.target.value)})},features:[Ko([Q6]),yo]});let a=i;return a})();function bc(a){return a==null||(typeof a=="string"||Array.isArray(a))&&a.length===0}function $R(a){return a!=null&&typeof a.length=="number"}var OT=new Pt(""),FT=new Pt(""),K6=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,B0=class{static min(i){return J6(i)}static max(i){return e8(i)}static required(i){return t8(i)}static requiredTrue(i){return n8(i)}static email(i){return i8(i)}static minLength(i){return r8(i)}static maxLength(i){return o8(i)}static pattern(i){return s8(i)}static nullValidator(i){return HR(i)}static compose(i){return XR(i)}static composeAsync(i){return KR(i)}};function J6(a){return i=>{if(bc(i.value)||bc(a))return null;let d=parseFloat(i.value);return!isNaN(d)&&d<a?{min:{min:a,actual:i.value}}:null}}function e8(a){return i=>{if(bc(i.value)||bc(a))return null;let d=parseFloat(i.value);return!isNaN(d)&&d>a?{max:{max:a,actual:i.value}}:null}}function t8(a){return bc(a.value)?{required:!0}:null}function n8(a){return a.value===!0?null:{required:!0}}function i8(a){return bc(a.value)||K6.test(a.value)?null:{email:!0}}function r8(a){return i=>bc(i.value)||!$R(i.value)?null:i.value.length<a?{minlength:{requiredLength:a,actualLength:i.value.length}}:null}function o8(a){return i=>$R(i.value)&&i.value.length>a?{maxlength:{requiredLength:a,actualLength:i.value.length}}:null}function s8(a){if(!a)return HR;let i,d;return typeof a=="string"?(d="",a.charAt(0)!=="^"&&(d+="^"),d+=a,a.charAt(a.length-1)!=="$"&&(d+="$"),i=new RegExp(d)):(d=a.toString(),i=a),c=>{if(bc(c.value))return null;let m=c.value;return i.test(m)?null:{pattern:{requiredPattern:d,actualValue:m}}}}function HR(a){return null}function qR(a){return a!=null}function WR(a){return Pm(a)?Po(a):a}function ZR(a){let i={};return a.forEach(d=>{i=d!=null?Yt(Yt({},i),d):i}),Object.keys(i).length===0?null:i}function QR(a,i){return i.map(d=>d(a))}function a8(a){return!a.validate}function YR(a){return a.map(i=>a8(i)?i:d=>i.validate(d))}function XR(a){if(!a)return null;let i=a.filter(qR);return i.length==0?null:function(d){return ZR(QR(d,i))}}function LT(a){return a!=null?XR(YR(a)):null}function KR(a){if(!a)return null;let i=a.filter(qR);return i.length==0?null:function(d){let c=QR(d,i).map(WR);return A1(c).pipe(Nr(ZR))}}function NT(a){return a!=null?KR(YR(a)):null}function FR(a,i){return a===null?[i]:Array.isArray(a)?[...a,i]:[a,i]}function JR(a){return a._rawValidators}function ek(a){return a._rawAsyncValidators}function AT(a){return a?Array.isArray(a)?a:[a]:[]}function V0(a,i){return Array.isArray(a)?a.includes(i):a===i}function LR(a,i){let d=AT(i);return AT(a).forEach(m=>{V0(d,m)||d.push(m)}),d}function NR(a,i){return AT(i).filter(d=>!V0(a,d))}var j0=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(i){this._rawValidators=i||[],this._composedValidatorFn=LT(this._rawValidators)}_setAsyncValidators(i){this._rawAsyncValidators=i||[],this._composedAsyncValidatorFn=NT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(i){this._onDestroyCallbacks.push(i)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(i=>i()),this._onDestroyCallbacks=[]}reset(i=void 0){this.control&&this.control.reset(i)}hasError(i,d){return this.control?this.control.hasError(i,d):!1}getError(i,d){return this.control?this.control.getError(i,d):null}},ad=class extends j0{get formDirective(){return null}get path(){return null}},ld=class extends j0{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},PT=class{constructor(i){this._cd=i}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},l8={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},sY=tr(Yt({},l8),{"[class.ng-submitted]":"isSubmitted"}),tk=(()=>{let i=class i extends PT{constructor(c){super(c)}};i.\u0275fac=function(m){return new(m||i)(Tt(ld,2))},i.\u0275dir=ui({type:i,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(m,r){m&2&&wr("ng-untouched",r.isUntouched)("ng-touched",r.isTouched)("ng-pristine",r.isPristine)("ng-dirty",r.isDirty)("ng-valid",r.isValid)("ng-invalid",r.isInvalid)("ng-pending",r.isPending)},features:[yo]});let a=i;return a})();var Xm="VALID",z0="INVALID",yf="PENDING",Km="DISABLED",xc=class{},U0=class extends xc{constructor(i,d){super(),this.value=i,this.source=d}},eg=class extends xc{constructor(i,d){super(),this.pristine=i,this.source=d}},tg=class extends xc{constructor(i,d){super(),this.touched=i,this.source=d}},vf=class extends xc{constructor(i,d){super(),this.status=i,this.source=d}},RT=class extends xc{constructor(i){super(),this.source=i}},kT=class extends xc{constructor(i){super(),this.source=i}};function nk(a){return(Q0(a)?a.validators:a)||null}function c8(a){return Array.isArray(a)?LT(a):a||null}function ik(a,i){return(Q0(i)?i.asyncValidators:a)||null}function u8(a){return Array.isArray(a)?NT(a):a||null}function Q0(a){return a!=null&&!Array.isArray(a)&&typeof a=="object"}function d8(a,i,d){let c=a.controls;if(!(i?Object.keys(c):c).length)throw new kt(1e3,"");if(!c[d])throw new kt(1001,"")}function h8(a,i,d){a._forEachChild((c,m)=>{if(d[m]===void 0)throw new kt(1002,"")})}var G0=class{constructor(i,d){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._events=new Tn,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(i),this._assignAsyncValidators(d)}get validator(){return this._composedValidatorFn}set validator(i){this._rawValidators=this._composedValidatorFn=i}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(i){this._rawAsyncValidators=this._composedAsyncValidatorFn=i}get parent(){return this._parent}get valid(){return this.status===Xm}get invalid(){return this.status===z0}get pending(){return this.status==yf}get disabled(){return this.status===Km}get enabled(){return this.status!==Km}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(i){this._assignValidators(i)}setAsyncValidators(i){this._assignAsyncValidators(i)}addValidators(i){this.setValidators(LR(i,this._rawValidators))}addAsyncValidators(i){this.setAsyncValidators(LR(i,this._rawAsyncValidators))}removeValidators(i){this.setValidators(NR(i,this._rawValidators))}removeAsyncValidators(i){this.setAsyncValidators(NR(i,this._rawAsyncValidators))}hasValidator(i){return V0(this._rawValidators,i)}hasAsyncValidator(i){return V0(this._rawAsyncValidators,i)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(i={}){let d=this.touched===!1;this.touched=!0;let c=i.sourceControl??this;this._parent&&!i.onlySelf&&this._parent.markAsTouched(tr(Yt({},i),{sourceControl:c})),d&&i.emitEvent!==!1&&this._events.next(new tg(!0,c))}markAllAsTouched(i={}){this.markAsTouched({onlySelf:!0,emitEvent:i.emitEvent,sourceControl:this}),this._forEachChild(d=>d.markAllAsTouched(i))}markAsUntouched(i={}){let d=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let c=i.sourceControl??this;this._forEachChild(m=>{m.markAsUntouched({onlySelf:!0,emitEvent:i.emitEvent,sourceControl:c})}),this._parent&&!i.onlySelf&&this._parent._updateTouched(i,c),d&&i.emitEvent!==!1&&this._events.next(new tg(!1,c))}markAsDirty(i={}){let d=this.pristine===!0;this.pristine=!1;let c=i.sourceControl??this;this._parent&&!i.onlySelf&&this._parent.markAsDirty(tr(Yt({},i),{sourceControl:c})),d&&i.emitEvent!==!1&&this._events.next(new eg(!1,c))}markAsPristine(i={}){let d=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let c=i.sourceControl??this;this._forEachChild(m=>{m.markAsPristine({onlySelf:!0,emitEvent:i.emitEvent})}),this._parent&&!i.onlySelf&&this._parent._updatePristine(i,c),d&&i.emitEvent!==!1&&this._events.next(new eg(!0,c))}markAsPending(i={}){this.status=yf;let d=i.sourceControl??this;i.emitEvent!==!1&&(this._events.next(new vf(this.status,d)),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.markAsPending(tr(Yt({},i),{sourceControl:d}))}disable(i={}){let d=this._parentMarkedDirty(i.onlySelf);this.status=Km,this.errors=null,this._forEachChild(m=>{m.disable(tr(Yt({},i),{onlySelf:!0}))}),this._updateValue();let c=i.sourceControl??this;i.emitEvent!==!1&&(this._events.next(new U0(this.value,c)),this._events.next(new vf(this.status,c)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(tr(Yt({},i),{skipPristineCheck:d}),this),this._onDisabledChange.forEach(m=>m(!0))}enable(i={}){let d=this._parentMarkedDirty(i.onlySelf);this.status=Xm,this._forEachChild(c=>{c.enable(tr(Yt({},i),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent}),this._updateAncestors(tr(Yt({},i),{skipPristineCheck:d}),this),this._onDisabledChange.forEach(c=>c(!1))}_updateAncestors(i,d){this._parent&&!i.onlySelf&&(this._parent.updateValueAndValidity(i),i.skipPristineCheck||this._parent._updatePristine({},d),this._parent._updateTouched({},d))}setParent(i){this._parent=i}getRawValue(){return this.value}updateValueAndValidity(i={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let c=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Xm||this.status===yf)&&this._runAsyncValidator(c,i.emitEvent)}let d=i.sourceControl??this;i.emitEvent!==!1&&(this._events.next(new U0(this.value,d)),this._events.next(new vf(this.status,d)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!i.onlySelf&&this._parent.updateValueAndValidity(tr(Yt({},i),{sourceControl:d}))}_updateTreeValidity(i={emitEvent:!0}){this._forEachChild(d=>d._updateTreeValidity(i)),this.updateValueAndValidity({onlySelf:!0,emitEvent:i.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Km:Xm}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(i,d){if(this.asyncValidator){this.status=yf,this._hasOwnPendingAsyncValidator={emitEvent:d!==!1};let c=WR(this.asyncValidator(this));this._asyncValidationSubscription=c.subscribe(m=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(m,{emitEvent:d,shouldHaveEmitted:i})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let i=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,i}return!1}setErrors(i,d={}){this.errors=i,this._updateControlsErrors(d.emitEvent!==!1,this,d.shouldHaveEmitted)}get(i){let d=i;return d==null||(Array.isArray(d)||(d=d.split(".")),d.length===0)?null:d.reduce((c,m)=>c&&c._find(m),this)}getError(i,d){let c=d?this.get(d):this;return c&&c.errors?c.errors[i]:null}hasError(i,d){return!!this.getError(i,d)}get root(){let i=this;for(;i._parent;)i=i._parent;return i}_updateControlsErrors(i,d,c){this.status=this._calculateStatus(),i&&this.statusChanges.emit(this.status),(i||c)&&this._events.next(new vf(this.status,d)),this._parent&&this._parent._updateControlsErrors(i,d,c)}_initObservables(){this.valueChanges=new Ui,this.statusChanges=new Ui}_calculateStatus(){return this._allControlsDisabled()?Km:this.errors?z0:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yf)?yf:this._anyControlsHaveStatus(z0)?z0:Xm}_anyControlsHaveStatus(i){return this._anyControls(d=>d.status===i)}_anyControlsDirty(){return this._anyControls(i=>i.dirty)}_anyControlsTouched(){return this._anyControls(i=>i.touched)}_updatePristine(i,d){let c=!this._anyControlsDirty(),m=this.pristine!==c;this.pristine=c,this._parent&&!i.onlySelf&&this._parent._updatePristine(i,d),m&&this._events.next(new eg(this.pristine,d))}_updateTouched(i={},d){this.touched=this._anyControlsTouched(),this._events.next(new tg(this.touched,d)),this._parent&&!i.onlySelf&&this._parent._updateTouched(i,d)}_registerOnCollectionChange(i){this._onCollectionChange=i}_setUpdateStrategy(i){Q0(i)&&i.updateOn!=null&&(this._updateOn=i.updateOn)}_parentMarkedDirty(i){let d=this._parent&&this._parent.dirty;return!i&&!!d&&!this._parent._anyControlsDirty()}_find(i){return null}_assignValidators(i){this._rawValidators=Array.isArray(i)?i.slice():i,this._composedValidatorFn=c8(this._rawValidators)}_assignAsyncValidators(i){this._rawAsyncValidators=Array.isArray(i)?i.slice():i,this._composedAsyncValidatorFn=u8(this._rawAsyncValidators)}},$0=class extends G0{constructor(i,d,c){super(nk(d),ik(c,d)),this.controls=i,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(i,d){return this.controls[i]?this.controls[i]:(this.controls[i]=d,d.setParent(this),d._registerOnCollectionChange(this._onCollectionChange),d)}addControl(i,d,c={}){this.registerControl(i,d),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}removeControl(i,d={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}setControl(i,d,c={}){this.controls[i]&&this.controls[i]._registerOnCollectionChange(()=>{}),delete this.controls[i],d&&this.registerControl(i,d),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}contains(i){return this.controls.hasOwnProperty(i)&&this.controls[i].enabled}setValue(i,d={}){h8(this,!0,i),Object.keys(i).forEach(c=>{d8(this,!0,c),this.controls[c].setValue(i[c],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(i,d={}){i!=null&&(Object.keys(i).forEach(c=>{let m=this.controls[c];m&&m.patchValue(i[c],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(i={},d={}){this._forEachChild((c,m)=>{c.reset(i?i[m]:null,{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d,this),this._updateTouched(d,this),this.updateValueAndValidity(d)}getRawValue(){return this._reduceChildren({},(i,d,c)=>(i[c]=d.getRawValue(),i))}_syncPendingControls(){let i=this._reduceChildren(!1,(d,c)=>c._syncPendingControls()?!0:d);return i&&this.updateValueAndValidity({onlySelf:!0}),i}_forEachChild(i){Object.keys(this.controls).forEach(d=>{let c=this.controls[d];c&&i(c,d)})}_setUpControls(){this._forEachChild(i=>{i.setParent(this),i._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(i){for(let[d,c]of Object.entries(this.controls))if(this.contains(d)&&i(c))return!0;return!1}_reduceValue(){let i={};return this._reduceChildren(i,(d,c,m)=>((c.enabled||this.disabled)&&(d[m]=c.value),d))}_reduceChildren(i,d){let c=i;return this._forEachChild((m,r)=>{c=d(c,m,r)}),c}_allControlsDisabled(){for(let i of Object.keys(this.controls))if(this.controls[i].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(i){return this.controls.hasOwnProperty(i)?this.controls[i]:null}};var Y0=new Pt("CallSetDisabledState",{providedIn:"root",factory:()=>zT}),zT="always";function f8(a,i){return[...i.path,a]}function H0(a,i,d=zT){BT(a,i),i.valueAccessor.writeValue(a.value),(a.disabled||d==="always")&&i.valueAccessor.setDisabledState?.(a.disabled),m8(a,i),_8(a,i),g8(a,i),p8(a,i)}function zR(a,i,d=!0){let c=()=>{};i.valueAccessor&&(i.valueAccessor.registerOnChange(c),i.valueAccessor.registerOnTouched(c)),W0(a,i),a&&(i._invokeOnDestroyCallbacks(),a._registerOnCollectionChange(()=>{}))}function q0(a,i){a.forEach(d=>{d.registerOnValidatorChange&&d.registerOnValidatorChange(i)})}function p8(a,i){if(i.valueAccessor.setDisabledState){let d=c=>{i.valueAccessor.setDisabledState(c)};a.registerOnDisabledChange(d),i._registerOnDestroy(()=>{a._unregisterOnDisabledChange(d)})}}function BT(a,i){let d=JR(a);i.validator!==null?a.setValidators(FR(d,i.validator)):typeof d=="function"&&a.setValidators([d]);let c=ek(a);i.asyncValidator!==null?a.setAsyncValidators(FR(c,i.asyncValidator)):typeof c=="function"&&a.setAsyncValidators([c]);let m=()=>a.updateValueAndValidity();q0(i._rawValidators,m),q0(i._rawAsyncValidators,m)}function W0(a,i){let d=!1;if(a!==null){if(i.validator!==null){let m=JR(a);if(Array.isArray(m)&&m.length>0){let r=m.filter(T=>T!==i.validator);r.length!==m.length&&(d=!0,a.setValidators(r))}}if(i.asyncValidator!==null){let m=ek(a);if(Array.isArray(m)&&m.length>0){let r=m.filter(T=>T!==i.asyncValidator);r.length!==m.length&&(d=!0,a.setAsyncValidators(r))}}}let c=()=>{};return q0(i._rawValidators,c),q0(i._rawAsyncValidators,c),d}function m8(a,i){i.valueAccessor.registerOnChange(d=>{a._pendingValue=d,a._pendingChange=!0,a._pendingDirty=!0,a.updateOn==="change"&&rk(a,i)})}function g8(a,i){i.valueAccessor.registerOnTouched(()=>{a._pendingTouched=!0,a.updateOn==="blur"&&a._pendingChange&&rk(a,i),a.updateOn!=="submit"&&a.markAsTouched()})}function rk(a,i){a._pendingDirty&&a.markAsDirty(),a.setValue(a._pendingValue,{emitModelToViewChange:!1}),i.viewToModelUpdate(a._pendingValue),a._pendingChange=!1}function _8(a,i){let d=(c,m)=>{i.valueAccessor.writeValue(c),m&&i.viewToModelUpdate(c)};a.registerOnChange(d),i._registerOnDestroy(()=>{a._unregisterOnChange(d)})}function ok(a,i){a==null,BT(a,i)}function y8(a,i){return W0(a,i)}function v8(a,i){if(!a.hasOwnProperty("model"))return!1;let d=a.model;return d.isFirstChange()?!0:!Object.is(i,d.currentValue)}function b8(a){return Object.getPrototypeOf(a.constructor)===Z6}function sk(a,i){a._syncPendingControls(),i.forEach(d=>{let c=d.control;c.updateOn==="submit"&&c._pendingChange&&(d.viewToModelUpdate(c._pendingValue),c._pendingChange=!1)})}function x8(a,i){if(!i)return null;Array.isArray(i);let d,c,m;return i.forEach(r=>{r.constructor===Z0?d=r:b8(r)?c=r:m=r}),m||c||d||null}function w8(a,i){let d=a.indexOf(i);d>-1&&a.splice(d,1)}var E8={provide:ad,useExisting:Hu(()=>VT)},Jm=Promise.resolve(),VT=(()=>{let i=class i extends ad{constructor(c,m,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Ui,this.form=new $0({},LT(c),NT(m))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(c){Jm.then(()=>{let m=this._findContainer(c.path);c.control=m.registerControl(c.name,c.control),H0(c.control,c,this.callSetDisabledState),c.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(c)})}getControl(c){return this.form.get(c.path)}removeControl(c){Jm.then(()=>{let m=this._findContainer(c.path);m&&m.removeControl(c.name),this._directives.delete(c)})}addFormGroup(c){Jm.then(()=>{let m=this._findContainer(c.path),r=new $0({});ok(r,c),m.registerControl(c.name,r),r.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(c){Jm.then(()=>{let m=this._findContainer(c.path);m&&m.removeControl(c.name)})}getFormGroup(c){return this.form.get(c.path)}updateModel(c,m){Jm.then(()=>{this.form.get(c.path).setValue(m)})}setValue(c){this.control.setValue(c)}onSubmit(c){return this.submitted=!0,sk(this.form,this._directives),this.ngSubmit.emit(c),c?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(c=void 0){this.form.reset(c),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(c){return c.pop(),c.length?this.form.get(c):this.form}};i.\u0275fac=function(m){return new(m||i)(Tt(OT,10),Tt(FT,10),Tt(Y0,8))},i.\u0275dir=ui({type:i,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(m,r){m&1&&Zr("submit",function(M){return r.onSubmit(M)})("reset",function(){return r.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ko([E8]),yo]});let a=i;return a})();function BR(a,i){let d=a.indexOf(i);d>-1&&a.splice(d,1)}function VR(a){return typeof a=="object"&&a!==null&&Object.keys(a).length===2&&"value"in a&&"disabled"in a}var ak=class extends G0{constructor(i=null,d,c){super(nk(d),ik(c,d)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(i),this._setUpdateStrategy(d),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Q0(d)&&(d.nonNullable||d.initialValueIsDefault)&&(VR(i)?this.defaultValue=i.value:this.defaultValue=i)}setValue(i,d={}){this.value=this._pendingValue=i,this._onChange.length&&d.emitModelToViewChange!==!1&&this._onChange.forEach(c=>c(this.value,d.emitViewToModelChange!==!1)),this.updateValueAndValidity(d)}patchValue(i,d={}){this.setValue(i,d)}reset(i=this.defaultValue,d={}){this._applyFormState(i),this.markAsPristine(d),this.markAsUntouched(d),this.setValue(this.value,d),this._pendingChange=!1}_updateValue(){}_anyControls(i){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(i){this._onChange.push(i)}_unregisterOnChange(i){BR(this._onChange,i)}registerOnDisabledChange(i){this._onDisabledChange.push(i)}_unregisterOnDisabledChange(i){BR(this._onDisabledChange,i)}_forEachChild(i){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(i){VR(i)?(this.value=this._pendingValue=i.value,i.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=i}};var T8=a=>a instanceof ak;var D8={provide:ld,useExisting:Hu(()=>jT)},jR=Promise.resolve(),jT=(()=>{let i=class i extends ld{constructor(c,m,r,T,M,F){super(),this._changeDetectorRef=M,this.callSetDisabledState=F,this.control=new ak,this._registered=!1,this.name="",this.update=new Ui,this._parent=c,this._setValidators(m),this._setAsyncValidators(r),this.valueAccessor=x8(this,T)}ngOnChanges(c){if(this._checkForErrors(),!this._registered||"name"in c){if(this._registered&&(this._checkName(),this.formDirective)){let m=c.name.previousValue;this.formDirective.removeControl({name:m,path:this._getPath(m)})}this._setUpControl()}"isDisabled"in c&&this._updateDisabled(c),v8(c,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(c){this.viewModel=c,this.update.emit(c)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){H0(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(c){jR.then(()=>{this.control.setValue(c,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(c){let m=c.isDisabled.currentValue,r=m!==0&&Xs(m);jR.then(()=>{r&&!this.control.disabled?this.control.disable():!r&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(c){return this._parent?f8(c,this._parent):[c]}};i.\u0275fac=function(m){return new(m||i)(Tt(ad,9),Tt(OT,10),Tt(FT,10),Tt(GR,10),Tt(Ea,8),Tt(Y0,8))},i.\u0275dir=ui({type:i,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Ko([D8]),yo,Xo]});let a=i;return a})();var I8={provide:ad,useExisting:Hu(()=>UT)},UT=(()=>{let i=class i extends ad{constructor(c,m,r){super(),this.callSetDisabledState=r,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Ui,this._setValidators(c),this._setAsyncValidators(m)}ngOnChanges(c){this._checkFormPresent(),c.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(W0(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(c){let m=this.form.get(c.path);return H0(m,c,this.callSetDisabledState),m.updateValueAndValidity({emitEvent:!1}),this.directives.push(c),m}getControl(c){return this.form.get(c.path)}removeControl(c){zR(c.control||null,c,!1),w8(this.directives,c)}addFormGroup(c){this._setUpFormContainer(c)}removeFormGroup(c){this._cleanUpFormContainer(c)}getFormGroup(c){return this.form.get(c.path)}addFormArray(c){this._setUpFormContainer(c)}removeFormArray(c){this._cleanUpFormContainer(c)}getFormArray(c){return this.form.get(c.path)}updateModel(c,m){this.form.get(c.path).setValue(m)}onSubmit(c){return this.submitted=!0,sk(this.form,this.directives),this.ngSubmit.emit(c),this.form._events.next(new RT(this.control)),c?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(c=void 0){this.form.reset(c),this.submitted=!1,this.form._events.next(new kT(this.form))}_updateDomValue(){this.directives.forEach(c=>{let m=c.control,r=this.form.get(c.path);m!==r&&(zR(m||null,c),T8(r)&&(H0(r,c,this.callSetDisabledState),c.control=r))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(c){let m=this.form.get(c.path);ok(m,c),m.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(c){if(this.form){let m=this.form.get(c.path);m&&y8(m,c)&&m.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){BT(this.form,this),this._oldForm&&W0(this._oldForm,this)}_checkFormPresent(){this.form}};i.\u0275fac=function(m){return new(m||i)(Tt(OT,10),Tt(FT,10),Tt(Y0,8))},i.\u0275dir=ui({type:i,selectors:[["","formGroup",""]],hostBindings:function(m,r){m&1&&Zr("submit",function(M){return r.onSubmit(M)})("reset",function(){return r.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Ko([I8]),yo,Xo]});let a=i;return a})();var C8=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})();var lk=(()=>{let i=class i{static withConfig(c){return{ngModule:i,providers:[{provide:Y0,useValue:c.callSetDisabledState??zT}]}}};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[C8]});let a=i;return a})();var S8=(()=>{let i=class i{create(c){return typeof MutationObserver>"u"?null:new MutationObserver(c)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var uk=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({providers:[S8]});let a=i;return a})();var dk=new Set,cd,M8=(()=>{let i=class i{constructor(c,m){this._platform=c,this._nonce=m,this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):P8}matchMedia(c){return(this._platform.WEBKIT||this._platform.BLINK)&&A8(c,this._nonce),this._matchMedia(c)}};i.\u0275fac=function(m){return new(m||i)(Ze(Ai),Ze(Dm,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function A8(a,i){if(!dk.has(a))try{cd||(cd=document.createElement("style"),i&&cd.setAttribute("nonce",i),cd.setAttribute("type","text/css"),document.head.appendChild(cd)),cd.sheet&&(cd.sheet.insertRule(`@media ${a} {body{ }}`,0),dk.add(a))}catch(d){console.error(d)}}function P8(a){return{matches:a==="all"||a==="",media:a,addListener:()=>{},removeListener:()=>{}}}var X0=(()=>{let i=class i{constructor(c,m){this._mediaMatcher=c,this._zone=m,this._queries=new Map,this._destroySubject=new Tn}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(c){return hk(gf(c)).some(r=>this._registerQuery(r).mql.matches)}observe(c){let r=hk(gf(c)).map(M=>this._registerQuery(M).observable),T=M1(r);return T=jh(T.pipe(R1(1)),T.pipe(dm(1),Gy(0))),T.pipe(Nr(M=>{let F={matches:!1,breakpoints:{}};return M.forEach(({matches:$,query:Q})=>{F.matches=F.matches||$,F.breakpoints[Q]=$}),F}))}_registerQuery(c){if(this._queries.has(c))return this._queries.get(c);let m=this._mediaMatcher.matchMedia(c),T={observable:new oi(M=>{let F=$=>this._zone.run(()=>M.next($));return m.addListener(F),()=>{m.removeListener(F)}}).pipe(Wy(m),Nr(({matches:M})=>({query:c,matches:M})),mo(this._destroySubject)),mql:m};return this._queries.set(c,T),T}};i.\u0275fac=function(m){return new(m||i)(Ze(M8),Ze(Wt))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function hk(a){return a.map(i=>i.split(",")).reduce((i,d)=>i.concat(d)).map(i=>i.trim())}var fk={XSmall:"(max-width: 599.98px)",Small:"(min-width: 600px) and (max-width: 959.98px)",Medium:"(min-width: 960px) and (max-width: 1279.98px)",Large:"(min-width: 1280px) and (max-width: 1919.98px)",XLarge:"(min-width: 1920px)",Handset:"(max-width: 599.98px) and (orientation: portrait), (max-width: 959.98px) and (orientation: landscape)",Tablet:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait), (min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",Web:"(min-width: 840px) and (orientation: portrait), (min-width: 1280px) and (orientation: landscape)",HandsetPortrait:"(max-width: 599.98px) and (orientation: portrait)",TabletPortrait:"(min-width: 600px) and (max-width: 839.98px) and (orientation: portrait)",WebPortrait:"(min-width: 840px) and (orientation: portrait)",HandsetLandscape:"(max-width: 959.98px) and (orientation: landscape)",TabletLandscape:"(min-width: 960px) and (max-width: 1279.98px) and (orientation: landscape)",WebLandscape:"(min-width: 1280px) and (orientation: landscape)"};function $T(a){return a.buttons===0||a.detail===0}function HT(a){let i=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0];return!!i&&i.identifier===-1&&(i.radiusX==null||i.radiusX===1)&&(i.radiusY==null||i.radiusY===1)}var k8=new Pt("cdk-input-modality-detector-options"),O8={ignoreKeys:[18,17,224,91,16]},gk=650,bf=vc({passive:!0,capture:!0}),F8=(()=>{let i=class i{get mostRecentModality(){return this._modality.value}constructor(c,m,r,T){this._platform=c,this._mostRecentTarget=null,this._modality=new Pu(null),this._lastTouchMs=0,this._onKeydown=M=>{this._options?.ignoreKeys?.some(F=>F===M.keyCode)||(this._modality.next("keyboard"),this._mostRecentTarget=ws(M))},this._onMousedown=M=>{Date.now()-this._lastTouchMs<gk||(this._modality.next($T(M)?"keyboard":"mouse"),this._mostRecentTarget=ws(M))},this._onTouchstart=M=>{if(HT(M)){this._modality.next("keyboard");return}this._lastTouchMs=Date.now(),this._modality.next("touch"),this._mostRecentTarget=ws(M)},this._options=Yt(Yt({},O8),T),this.modalityDetected=this._modality.pipe(dm(1)),this.modalityChanged=this.modalityDetected.pipe($y()),c.isBrowser&&m.runOutsideAngular(()=>{r.addEventListener("keydown",this._onKeydown,bf),r.addEventListener("mousedown",this._onMousedown,bf),r.addEventListener("touchstart",this._onTouchstart,bf)})}ngOnDestroy(){this._modality.complete(),this._platform.isBrowser&&(document.removeEventListener("keydown",this._onKeydown,bf),document.removeEventListener("mousedown",this._onMousedown,bf),document.removeEventListener("touchstart",this._onTouchstart,bf))}};i.\u0275fac=function(m){return new(m||i)(Ze(Ai),Ze(Wt),Ze(jn),Ze(k8,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),L8=new Pt("liveAnnouncerElement",{providedIn:"root",factory:N8});function N8(){return null}var z8=new Pt("LIVE_ANNOUNCER_DEFAULT_OPTIONS"),B8=0,_k=(()=>{let i=class i{constructor(c,m,r,T){this._ngZone=m,this._defaultOptions=T,this._document=r,this._liveElement=c||this._createLiveElement()}announce(c,...m){let r=this._defaultOptions,T,M;return m.length===1&&typeof m[0]=="number"?M=m[0]:[T,M]=m,this.clear(),clearTimeout(this._previousTimeout),T||(T=r&&r.politeness?r.politeness:"polite"),M==null&&r&&(M=r.duration),this._liveElement.setAttribute("aria-live",T),this._liveElement.id&&this._exposeAnnouncerToModals(this._liveElement.id),this._ngZone.runOutsideAngular(()=>(this._currentPromise||(this._currentPromise=new Promise(F=>this._currentResolve=F)),clearTimeout(this._previousTimeout),this._previousTimeout=setTimeout(()=>{this._liveElement.textContent=c,typeof M=="number"&&(this._previousTimeout=setTimeout(()=>this.clear(),M)),this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0},100),this._currentPromise))}clear(){this._liveElement&&(this._liveElement.textContent="")}ngOnDestroy(){clearTimeout(this._previousTimeout),this._liveElement?.remove(),this._liveElement=null,this._currentResolve?.(),this._currentPromise=this._currentResolve=void 0}_createLiveElement(){let c="cdk-live-announcer-element",m=this._document.getElementsByClassName(c),r=this._document.createElement("div");for(let T=0;T<m.length;T++)m[T].remove();return r.classList.add(c),r.classList.add("cdk-visually-hidden"),r.setAttribute("aria-atomic","true"),r.setAttribute("aria-live","polite"),r.id=`cdk-live-announcer-${B8++}`,this._document.body.appendChild(r),r}_exposeAnnouncerToModals(c){let m=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<m.length;r++){let T=m[r],M=T.getAttribute("aria-owns");M?M.indexOf(c)===-1&&T.setAttribute("aria-owns",M+" "+c):T.setAttribute("aria-owns",c)}}};i.\u0275fac=function(m){return new(m||i)(Ze(L8,8),Ze(Wt),Ze(jn),Ze(z8,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var J0=function(a){return a[a.IMMEDIATE=0]="IMMEDIATE",a[a.EVENTUAL=1]="EVENTUAL",a}(J0||{}),V8=new Pt("cdk-focus-monitor-default-options"),K0=vc({passive:!0,capture:!0}),yk=(()=>{let i=class i{constructor(c,m,r,T,M){this._ngZone=c,this._platform=m,this._inputModalityDetector=r,this._origin=null,this._windowFocused=!1,this._originFromTouchInteraction=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._windowFocusListener=()=>{this._windowFocused=!0,this._windowFocusTimeoutId=window.setTimeout(()=>this._windowFocused=!1)},this._stopInputModalityDetector=new Tn,this._rootNodeFocusAndBlurListener=F=>{let $=ws(F);for(let Q=$;Q;Q=Q.parentElement)F.type==="focus"?this._onFocus(F,Q):this._onBlur(F,Q)},this._document=T,this._detectionMode=M?.detectionMode||J0.IMMEDIATE}monitor(c,m=!1){let r=xs(c);if(!this._platform.isBrowser||r.nodeType!==1)return ic();let T=AR(r)||this._getDocument(),M=this._elementInfo.get(r);if(M)return m&&(M.checkChildren=!0),M.subject;let F={checkChildren:m,subject:new Tn,rootNode:T};return this._elementInfo.set(r,F),this._registerGlobalListeners(F),F.subject}stopMonitoring(c){let m=xs(c),r=this._elementInfo.get(m);r&&(r.subject.complete(),this._setClasses(m),this._elementInfo.delete(m),this._removeGlobalListeners(r))}focusVia(c,m,r){let T=xs(c),M=this._getDocument().activeElement;T===M?this._getClosestElementsInfo(T).forEach(([F,$])=>this._originChanged(F,m,$)):(this._setOrigin(m),typeof T.focus=="function"&&T.focus(r))}ngOnDestroy(){this._elementInfo.forEach((c,m)=>this.stopMonitoring(m))}_getDocument(){return this._document||document}_getWindow(){return this._getDocument().defaultView||window}_getFocusOrigin(c){return this._origin?this._originFromTouchInteraction?this._shouldBeAttributedToTouch(c)?"touch":"program":this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:c&&this._isLastInteractionFromInputLabel(c)?"mouse":"program"}_shouldBeAttributedToTouch(c){return this._detectionMode===J0.EVENTUAL||!!c?.contains(this._inputModalityDetector._mostRecentTarget)}_setClasses(c,m){c.classList.toggle("cdk-focused",!!m),c.classList.toggle("cdk-touch-focused",m==="touch"),c.classList.toggle("cdk-keyboard-focused",m==="keyboard"),c.classList.toggle("cdk-mouse-focused",m==="mouse"),c.classList.toggle("cdk-program-focused",m==="program")}_setOrigin(c,m=!1){this._ngZone.runOutsideAngular(()=>{if(this._origin=c,this._originFromTouchInteraction=c==="touch"&&m,this._detectionMode===J0.IMMEDIATE){clearTimeout(this._originTimeoutId);let r=this._originFromTouchInteraction?gk:1;this._originTimeoutId=setTimeout(()=>this._origin=null,r)}})}_onFocus(c,m){let r=this._elementInfo.get(m),T=ws(c);!r||!r.checkChildren&&m!==T||this._originChanged(m,this._getFocusOrigin(T),r)}_onBlur(c,m){let r=this._elementInfo.get(m);!r||r.checkChildren&&c.relatedTarget instanceof Node&&m.contains(c.relatedTarget)||(this._setClasses(m),this._emitOrigin(r,null))}_emitOrigin(c,m){c.subject.observers.length&&this._ngZone.run(()=>c.subject.next(m))}_registerGlobalListeners(c){if(!this._platform.isBrowser)return;let m=c.rootNode,r=this._rootNodeFocusListenerCount.get(m)||0;r||this._ngZone.runOutsideAngular(()=>{m.addEventListener("focus",this._rootNodeFocusAndBlurListener,K0),m.addEventListener("blur",this._rootNodeFocusAndBlurListener,K0)}),this._rootNodeFocusListenerCount.set(m,r+1),++this._monitoredElementCount===1&&(this._ngZone.runOutsideAngular(()=>{this._getWindow().addEventListener("focus",this._windowFocusListener)}),this._inputModalityDetector.modalityDetected.pipe(mo(this._stopInputModalityDetector)).subscribe(T=>{this._setOrigin(T,!0)}))}_removeGlobalListeners(c){let m=c.rootNode;if(this._rootNodeFocusListenerCount.has(m)){let r=this._rootNodeFocusListenerCount.get(m);r>1?this._rootNodeFocusListenerCount.set(m,r-1):(m.removeEventListener("focus",this._rootNodeFocusAndBlurListener,K0),m.removeEventListener("blur",this._rootNodeFocusAndBlurListener,K0),this._rootNodeFocusListenerCount.delete(m))}--this._monitoredElementCount||(this._getWindow().removeEventListener("focus",this._windowFocusListener),this._stopInputModalityDetector.next(),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._originTimeoutId))}_originChanged(c,m,r){this._setClasses(c,m),this._emitOrigin(r,m),this._lastFocusOrigin=m}_getClosestElementsInfo(c){let m=[];return this._elementInfo.forEach((r,T)=>{(T===c||r.checkChildren&&T.contains(c))&&m.push([T,r])}),m}_isLastInteractionFromInputLabel(c){let{_mostRecentTarget:m,mostRecentModality:r}=this._inputModalityDetector;if(r!=="mouse"||!m||m===c||c.nodeName!=="INPUT"&&c.nodeName!=="TEXTAREA"||c.disabled)return!1;let T=c.labels;if(T){for(let M=0;M<T.length;M++)if(T[M].contains(m))return!0}return!1}};i.\u0275fac=function(m){return new(m||i)(Ze(Wt),Ze(Ai),Ze(F8),Ze(jn,8),Ze(V8,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var ud=function(a){return a[a.NONE=0]="NONE",a[a.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",a[a.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",a}(ud||{}),pk="cdk-high-contrast-black-on-white",mk="cdk-high-contrast-white-on-black",GT="cdk-high-contrast-active",vk=(()=>{let i=class i{constructor(c,m){this._platform=c,this._document=m,this._breakpointSubscription=Ot(X0).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return ud.NONE;let c=this._document.createElement("div");c.style.backgroundColor="rgb(1,2,3)",c.style.position="absolute",this._document.body.appendChild(c);let m=this._document.defaultView||window,r=m&&m.getComputedStyle?m.getComputedStyle(c):null,T=(r&&r.backgroundColor||"").replace(/ /g,"");switch(c.remove(),T){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return ud.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return ud.BLACK_ON_WHITE}return ud.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let c=this._document.body.classList;c.remove(GT,pk,mk),this._hasCheckedHighContrastMode=!0;let m=this.getHighContrastMode();m===ud.BLACK_ON_WHITE?c.add(GT,pk):m===ud.WHITE_ON_BLACK&&c.add(GT,mk)}}};i.\u0275fac=function(m){return new(m||i)(Ze(Ai),Ze(jn))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var j8=new Pt("cdk-dir-doc",{providedIn:"root",factory:U8});function U8(){return Ot(jn)}var G8=/^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Adlm|Arab|Hebr|Nkoo|Rohg|Thaa))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)/i;function $8(a){let i=a?.toLowerCase()||"";return i==="auto"&&typeof navigator<"u"&&navigator?.language?G8.test(navigator.language)?"rtl":"ltr":i==="rtl"?"rtl":"ltr"}var eb=(()=>{let i=class i{constructor(c){if(this.value="ltr",this.change=new Ui,c){let m=c.body?c.body.dir:null,r=c.documentElement?c.documentElement.dir:null;this.value=$8(m||r||"ltr")}}ngOnDestroy(){this.change.complete()}};i.\u0275fac=function(m){return new(m||i)(Ze(j8,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var wc=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})();function H8(){return!0}var q8=new Pt("mat-sanity-checks",{providedIn:"root",factory:H8}),ro=(()=>{let i=class i{constructor(c,m,r){this._sanityChecks=m,this._document=r,this._hasDoneGlobalChecks=!1,c._applyBodyHighContrastModeCssClasses(),this._hasDoneGlobalChecks||(this._hasDoneGlobalChecks=!0)}_checkIsEnabled(c){return Ym()?!1:typeof this._sanityChecks=="boolean"?this._sanityChecks:!!this._sanityChecks[c]}};i.\u0275fac=function(m){return new(m||i)(Ze(vk),Ze(q8,8),Ze(jn))},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[wc,wc]});let a=i;return a})();var nb=class{constructor(i,d,c,m,r){this._defaultMatcher=i,this.ngControl=d,this._parentFormGroup=c,this._parentForm=m,this._stateChanges=r,this.errorState=!1}updateErrorState(){let i=this.errorState,d=this._parentFormGroup||this._parentForm,c=this.matcher||this._defaultMatcher,m=this.ngControl?this.ngControl.control:null,r=c?.isErrorState(m,d)??!1;r!==i&&(this.errorState=r,this._stateChanges.next())}};var Ak=(()=>{let i=class i{isErrorState(c,m){return!!(c&&c.invalid&&(c.touched||m&&m.submitted))}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var Es=function(a){return a[a.FADING_IN=0]="FADING_IN",a[a.VISIBLE=1]="VISIBLE",a[a.FADING_OUT=2]="FADING_OUT",a[a.HIDDEN=3]="HIDDEN",a}(Es||{}),ZT=class{constructor(i,d,c,m=!1){this._renderer=i,this.element=d,this.config=c,this._animationForciblyDisabledThroughCss=m,this.state=Es.HIDDEN}fadeOut(){this._renderer.fadeOutRipple(this)}},wk=vc({passive:!0,capture:!0}),QT=class{constructor(){this._events=new Map,this._delegateEventHandler=i=>{let d=ws(i);d&&this._events.get(i.type)?.forEach((c,m)=>{(m===d||m.contains(d))&&c.forEach(r=>r.handleEvent(i))})}}addHandler(i,d,c,m){let r=this._events.get(d);if(r){let T=r.get(c);T?T.add(m):r.set(c,new Set([m]))}else this._events.set(d,new Map([[c,new Set([m])]])),i.runOutsideAngular(()=>{document.addEventListener(d,this._delegateEventHandler,wk)})}removeHandler(i,d,c){let m=this._events.get(i);if(!m)return;let r=m.get(d);r&&(r.delete(c),r.size===0&&m.delete(d),m.size===0&&(this._events.delete(i),document.removeEventListener(i,this._delegateEventHandler,wk)))}},Ek={enterDuration:225,exitDuration:150},W8=800,Tk=vc({passive:!0,capture:!0}),Dk=["mousedown","touchstart"],Ik=["mouseup","mouseleave","touchend","touchcancel"],ng=class ng{constructor(i,d,c,m){this._target=i,this._ngZone=d,this._platform=m,this._isPointerDown=!1,this._activeRipples=new Map,this._pointerUpEventsRegistered=!1,m.isBrowser&&(this._containerElement=xs(c))}fadeInRipple(i,d,c={}){let m=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),r=Yt(Yt({},Ek),c.animation);c.centered&&(i=m.left+m.width/2,d=m.top+m.height/2);let T=c.radius||Z8(i,d,m),M=i-m.left,F=d-m.top,$=r.enterDuration,Q=document.createElement("div");Q.classList.add("mat-ripple-element"),Q.style.left=`${M-T}px`,Q.style.top=`${F-T}px`,Q.style.height=`${T*2}px`,Q.style.width=`${T*2}px`,c.color!=null&&(Q.style.backgroundColor=c.color),Q.style.transitionDuration=`${$}ms`,this._containerElement.appendChild(Q);let ue=window.getComputedStyle(Q),Ae=ue.transitionProperty,xe=ue.transitionDuration,ke=Ae==="none"||xe==="0s"||xe==="0s, 0s"||m.width===0&&m.height===0,Qe=new ZT(this,Q,c,ke);Q.style.transform="scale3d(1, 1, 1)",Qe.state=Es.FADING_IN,c.persistent||(this._mostRecentTransientRipple=Qe);let dt=null;return!ke&&($||r.exitDuration)&&this._ngZone.runOutsideAngular(()=>{let st=()=>this._finishRippleTransition(Qe),Nt=()=>this._destroyRipple(Qe);Q.addEventListener("transitionend",st),Q.addEventListener("transitioncancel",Nt),dt={onTransitionEnd:st,onTransitionCancel:Nt}}),this._activeRipples.set(Qe,dt),(ke||!$)&&this._finishRippleTransition(Qe),Qe}fadeOutRipple(i){if(i.state===Es.FADING_OUT||i.state===Es.HIDDEN)return;let d=i.element,c=Yt(Yt({},Ek),i.config.animation);d.style.transitionDuration=`${c.exitDuration}ms`,d.style.opacity="0",i.state=Es.FADING_OUT,(i._animationForciblyDisabledThroughCss||!c.exitDuration)&&this._finishRippleTransition(i)}fadeOutAll(){this._getActiveRipples().forEach(i=>i.fadeOut())}fadeOutAllNonPersistent(){this._getActiveRipples().forEach(i=>{i.config.persistent||i.fadeOut()})}setupTriggerEvents(i){let d=xs(i);!this._platform.isBrowser||!d||d===this._triggerElement||(this._removeTriggerEvents(),this._triggerElement=d,Dk.forEach(c=>{ng._eventManager.addHandler(this._ngZone,c,d,this)}))}handleEvent(i){i.type==="mousedown"?this._onMousedown(i):i.type==="touchstart"?this._onTouchStart(i):this._onPointerUp(),this._pointerUpEventsRegistered||(this._ngZone.runOutsideAngular(()=>{Ik.forEach(d=>{this._triggerElement.addEventListener(d,this,Tk)})}),this._pointerUpEventsRegistered=!0)}_finishRippleTransition(i){i.state===Es.FADING_IN?this._startFadeOutTransition(i):i.state===Es.FADING_OUT&&this._destroyRipple(i)}_startFadeOutTransition(i){let d=i===this._mostRecentTransientRipple,{persistent:c}=i.config;i.state=Es.VISIBLE,!c&&(!d||!this._isPointerDown)&&i.fadeOut()}_destroyRipple(i){let d=this._activeRipples.get(i)??null;this._activeRipples.delete(i),this._activeRipples.size||(this._containerRect=null),i===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),i.state=Es.HIDDEN,d!==null&&(i.element.removeEventListener("transitionend",d.onTransitionEnd),i.element.removeEventListener("transitioncancel",d.onTransitionCancel)),i.element.remove()}_onMousedown(i){let d=$T(i),c=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+W8;!this._target.rippleDisabled&&!d&&!c&&(this._isPointerDown=!0,this.fadeInRipple(i.clientX,i.clientY,this._target.rippleConfig))}_onTouchStart(i){if(!this._target.rippleDisabled&&!HT(i)){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;let d=i.changedTouches;if(d)for(let c=0;c<d.length;c++)this.fadeInRipple(d[c].clientX,d[c].clientY,this._target.rippleConfig)}}_onPointerUp(){this._isPointerDown&&(this._isPointerDown=!1,this._getActiveRipples().forEach(i=>{let d=i.state===Es.VISIBLE||i.config.terminateOnPointerUp&&i.state===Es.FADING_IN;!i.config.persistent&&d&&i.fadeOut()}))}_getActiveRipples(){return Array.from(this._activeRipples.keys())}_removeTriggerEvents(){let i=this._triggerElement;i&&(Dk.forEach(d=>ng._eventManager.removeHandler(d,i,this)),this._pointerUpEventsRegistered&&(Ik.forEach(d=>i.removeEventListener(d,this,Tk)),this._pointerUpEventsRegistered=!1))}};ng._eventManager=new QT;var YT=ng;function Z8(a,i,d){let c=Math.max(Math.abs(a-d.left),Math.abs(a-d.right)),m=Math.max(Math.abs(i-d.top),Math.abs(i-d.bottom));return Math.sqrt(c*c+m*m)}var Pk=new Pt("mat-ripple-global-options"),Q8=(()=>{let i=class i{get disabled(){return this._disabled}set disabled(c){c&&this.fadeOutAllNonPersistent(),this._disabled=c,this._setupTriggerEventsIfEnabled()}get trigger(){return this._trigger||this._elementRef.nativeElement}set trigger(c){this._trigger=c,this._setupTriggerEventsIfEnabled()}constructor(c,m,r,T,M){this._elementRef=c,this._animationMode=M,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=T||{},this._rippleRenderer=new YT(this,m,c,r)}ngOnInit(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}ngOnDestroy(){this._rippleRenderer._removeTriggerEvents()}fadeOutAll(){this._rippleRenderer.fadeOutAll()}fadeOutAllNonPersistent(){this._rippleRenderer.fadeOutAllNonPersistent()}get rippleConfig(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Yt(Yt(Yt({},this._globalOptions.animation),this._animationMode==="NoopAnimations"?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}get rippleDisabled(){return this.disabled||!!this._globalOptions.disabled}_setupTriggerEventsIfEnabled(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}launch(c,m=0,r){return typeof c=="number"?this._rippleRenderer.fadeInRipple(c,m,Yt(Yt({},this.rippleConfig),r)):this._rippleRenderer.fadeInRipple(0,0,Yt(Yt({},this.rippleConfig),c))}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Wt),Tt(Ai),Tt(Pk,8),Tt(Lo,8))},i.\u0275dir=ui({type:i,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(m,r){m&2&&wr("mat-ripple-unbounded",r.unbounded)},inputs:{color:[0,"matRippleColor","color"],unbounded:[0,"matRippleUnbounded","unbounded"],centered:[0,"matRippleCentered","centered"],radius:[0,"matRippleRadius","radius"],animation:[0,"matRippleAnimation","animation"],disabled:[0,"matRippleDisabled","disabled"],trigger:[0,"matRippleTrigger","trigger"]},exportAs:["matRipple"],standalone:!0});let a=i;return a})(),Rk=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[ro,ro]});let a=i;return a})();var Ck={capture:!0},Sk=["focus","mousedown","mouseenter","touchstart"],qT="mat-ripple-loader-uninitialized",WT="mat-ripple-loader-class-name",Mk="mat-ripple-loader-centered",tb="mat-ripple-loader-disabled",kk=(()=>{let i=class i{constructor(){this._document=Ot(jn,{optional:!0}),this._animationMode=Ot(Lo,{optional:!0}),this._globalRippleOptions=Ot(Pk,{optional:!0}),this._platform=Ot(Ai),this._ngZone=Ot(Wt),this._hosts=new Map,this._onInteraction=c=>{let m=ws(c);if(m instanceof HTMLElement){let r=m.closest(`[${qT}="${this._globalRippleOptions?.namespace??""}"]`);r&&this._createRipple(r)}},this._ngZone.runOutsideAngular(()=>{for(let c of Sk)this._document?.addEventListener(c,this._onInteraction,Ck)})}ngOnDestroy(){let c=this._hosts.keys();for(let m of c)this.destroyRipple(m);for(let m of Sk)this._document?.removeEventListener(m,this._onInteraction,Ck)}configureRipple(c,m){c.setAttribute(qT,this._globalRippleOptions?.namespace??""),(m.className||!c.hasAttribute(WT))&&c.setAttribute(WT,m.className||""),m.centered&&c.setAttribute(Mk,""),m.disabled&&c.setAttribute(tb,"")}getRipple(c){return this._hosts.get(c)||this._createRipple(c)}setDisabled(c,m){let r=this._hosts.get(c);if(r){r.disabled=m;return}m?c.setAttribute(tb,""):c.removeAttribute(tb)}_createRipple(c){if(!this._document)return;let m=this._hosts.get(c);if(m)return m;c.querySelector(".mat-ripple")?.remove();let r=this._document.createElement("span");r.classList.add("mat-ripple",c.getAttribute(WT)),c.append(r);let T=new Q8(new ti(r),this._ngZone,this._platform,this._globalRippleOptions?this._globalRippleOptions:void 0,this._animationMode?this._animationMode:void 0);return T._isInitialized=!0,T.trigger=c,T.centered=c.hasAttribute(Mk),T.disabled=c.hasAttribute(tb),this.attachRipple(c,T),T}attachRipple(c,m){c.removeAttribute(qT),this._hosts.set(c,m)}destroyRipple(c){let m=this._hosts.get(c);m&&(m.ngOnDestroy(),this._hosts.delete(c))}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var XT=class{constructor(i){this._box=i,this._destroyed=new Tn,this._resizeSubject=new Tn,this._elementObservables=new Map,typeof ResizeObserver<"u"&&(this._resizeObserver=new ResizeObserver(d=>this._resizeSubject.next(d)))}observe(i){return this._elementObservables.has(i)||this._elementObservables.set(i,new oi(d=>{let c=this._resizeSubject.subscribe(d);return this._resizeObserver?.observe(i,{box:this._box}),()=>{this._resizeObserver?.unobserve(i),c.unsubscribe(),this._elementObservables.delete(i)}}).pipe(hs(d=>d.some(c=>c.target===i)),qy({bufferSize:1,refCount:!0}),mo(this._destroyed))),this._elementObservables.get(i)}destroy(){this._destroyed.next(),this._destroyed.complete(),this._resizeSubject.complete(),this._elementObservables.clear()}},Ok=(()=>{let i=class i{constructor(){this._observers=new Map,this._ngZone=Ot(Wt),typeof ResizeObserver<"u"}ngOnDestroy(){for(let[,c]of this._observers)c.destroy();this._observers.clear(),typeof ResizeObserver<"u"}observe(c,m){let r=m?.box||"content-box";return this._observers.has(r)||this._observers.set(r,new XT(r)),this._observers.get(r).observe(c)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var X8=["notch"],K8=["matFormFieldNotchedOutline",""],J8=["*"],eG=["textField"],tG=["iconPrefixContainer"],nG=["textPrefixContainer"],iG=["*",[["mat-label"]],[["","matPrefix",""],["","matIconPrefix",""]],[["","matTextPrefix",""]],[["","matTextSuffix",""]],[["","matSuffix",""],["","matIconSuffix",""]],[["mat-error"],["","matError",""]],[["mat-hint",3,"align","end"]],[["mat-hint","align","end"]]],rG=["*","mat-label","[matPrefix], [matIconPrefix]","[matTextPrefix]","[matTextSuffix]","[matSuffix], [matIconSuffix]","mat-error, [matError]","mat-hint:not([align='end'])","mat-hint[align='end']"];function oG(a,i){a&1&&or(0,"span",19)}function sG(a,i){if(a&1&&(Hn(0,"label",18),Qr(1,1),rr(2,oG,1,0,"span",19),qn()),a&2){let d=vo(2);qr("floating",d._shouldLabelFloat())("monitorResize",d._hasOutline())("id",d._labelId),Mr("for",d._control.disableAutomaticLabeling?null:d._control.id),di(2),Wr(!d.hideRequiredMarker&&d._control.required?2:-1)}}function aG(a,i){if(a&1&&rr(0,sG,3,5,"label",18),a&2){let d=vo();Wr(d._hasFloatingLabel()?0:-1)}}function lG(a,i){a&1&&or(0,"div",5)}function cG(a,i){}function uG(a,i){if(a&1&&rr(0,cG,0,0,"ng-template",11),a&2){vo(2);let d=Mm(1);qr("ngTemplateOutlet",d)}}function dG(a,i){if(a&1&&(Hn(0,"div",7),rr(1,uG,1,1,null,11),qn()),a&2){let d=vo();qr("matFormFieldNotchedOutlineOpen",d._shouldLabelFloat()),di(),Wr(d._forceDisplayInfixLabel()?-1:1)}}function hG(a,i){a&1&&(Hn(0,"div",8,2),Qr(2,2),qn())}function fG(a,i){a&1&&(Hn(0,"div",9,3),Qr(2,3),qn())}function pG(a,i){}function mG(a,i){if(a&1&&rr(0,pG,0,0,"ng-template",11),a&2){vo();let d=Mm(1);qr("ngTemplateOutlet",d)}}function gG(a,i){a&1&&(Hn(0,"div",12),Qr(1,4),qn())}function _G(a,i){a&1&&(Hn(0,"div",13),Qr(1,5),qn())}function yG(a,i){a&1&&or(0,"div",14)}function vG(a,i){if(a&1&&(Hn(0,"div",16),Qr(1,6),qn()),a&2){let d=vo();qr("@transitionMessages",d._subscriptAnimationState)}}function bG(a,i){if(a&1&&(Hn(0,"mat-hint",20),ul(1),qn()),a&2){let d=vo(2);qr("id",d._hintLabelId),di(),EE(d.hintLabel)}}function xG(a,i){if(a&1&&(Hn(0,"div",17),rr(1,bG,2,2,"mat-hint",20),Qr(2,7),or(3,"div",21),Qr(4,8),qn()),a&2){let d=vo();qr("@transitionMessages",d._subscriptAnimationState),di(),Wr(d.hintLabel?1:-1)}}var rb=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=ui({type:i,selectors:[["mat-label"]],standalone:!0});let a=i;return a})();var wG=new Pt("MatError");var EG=0,Fk=(()=>{let i=class i{constructor(){this.align="start",this.id=`mat-mdc-hint-${EG++}`}};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=ui({type:i,selectors:[["mat-hint"]],hostAttrs:[1,"mat-mdc-form-field-hint","mat-mdc-form-field-bottom-align"],hostVars:4,hostBindings:function(m,r){m&2&&(lf("id",r.id),Mr("align",null),wr("mat-mdc-form-field-hint-end",r.align==="end"))},inputs:{align:"align",id:"id"},standalone:!0});let a=i;return a})(),TG=new Pt("MatPrefix");var DG=new Pt("MatSuffix");var Gk=new Pt("FloatingLabelParent"),Lk=(()=>{let i=class i{get floating(){return this._floating}set floating(c){this._floating=c,this.monitorResize&&this._handleResize()}get monitorResize(){return this._monitorResize}set monitorResize(c){this._monitorResize=c,this._monitorResize?this._subscribeToResize():this._resizeSubscription.unsubscribe()}constructor(c){this._elementRef=c,this._floating=!1,this._monitorResize=!1,this._resizeObserver=Ot(Ok),this._ngZone=Ot(Wt),this._parent=Ot(Gk),this._resizeSubscription=new Ki}ngOnDestroy(){this._resizeSubscription.unsubscribe()}getWidth(){return IG(this._elementRef.nativeElement)}get element(){return this._elementRef.nativeElement}_handleResize(){setTimeout(()=>this._parent._handleLabelResized())}_subscribeToResize(){this._resizeSubscription.unsubscribe(),this._ngZone.runOutsideAngular(()=>{this._resizeSubscription=this._resizeObserver.observe(this._elementRef.nativeElement,{box:"border-box"}).subscribe(()=>this._handleResize())})}};i.\u0275fac=function(m){return new(m||i)(Tt(ti))},i.\u0275dir=ui({type:i,selectors:[["label","matFormFieldFloatingLabel",""]],hostAttrs:[1,"mdc-floating-label","mat-mdc-floating-label"],hostVars:2,hostBindings:function(m,r){m&2&&wr("mdc-floating-label--float-above",r.floating)},inputs:{floating:"floating",monitorResize:"monitorResize"},standalone:!0});let a=i;return a})();function IG(a){let i=a;if(i.offsetParent!==null)return i.scrollWidth;let d=i.cloneNode(!0);d.style.setProperty("position","absolute"),d.style.setProperty("transform","translate(-9999px, -9999px)"),document.documentElement.appendChild(d);let c=d.scrollWidth;return d.remove(),c}var Nk="mdc-line-ripple--active",ib="mdc-line-ripple--deactivating",zk=(()=>{let i=class i{constructor(c,m){this._elementRef=c,this._handleTransitionEnd=r=>{let T=this._elementRef.nativeElement.classList,M=T.contains(ib);r.propertyName==="opacity"&&M&&T.remove(Nk,ib)},m.runOutsideAngular(()=>{c.nativeElement.addEventListener("transitionend",this._handleTransitionEnd)})}activate(){let c=this._elementRef.nativeElement.classList;c.remove(ib),c.add(Nk)}deactivate(){this._elementRef.nativeElement.classList.add(ib)}ngOnDestroy(){this._elementRef.nativeElement.removeEventListener("transitionend",this._handleTransitionEnd)}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Wt))},i.\u0275dir=ui({type:i,selectors:[["div","matFormFieldLineRipple",""]],hostAttrs:[1,"mdc-line-ripple"],standalone:!0});let a=i;return a})(),Bk=(()=>{let i=class i{constructor(c,m){this._elementRef=c,this._ngZone=m,this.open=!1}ngAfterViewInit(){let c=this._elementRef.nativeElement.querySelector(".mdc-floating-label");c?(this._elementRef.nativeElement.classList.add("mdc-notched-outline--upgraded"),typeof requestAnimationFrame=="function"&&(c.style.transitionDuration="0s",this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>c.style.transitionDuration="")}))):this._elementRef.nativeElement.classList.add("mdc-notched-outline--no-label")}_setNotchWidth(c){!this.open||!c?this._notch.nativeElement.style.width="":this._notch.nativeElement.style.width=`calc(${c}px * var(--mat-mdc-form-field-floating-label-scale, 0.75) + 9px)`}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Wt))},i.\u0275cmp=zr({type:i,selectors:[["div","matFormFieldNotchedOutline",""]],viewQuery:function(m,r){if(m&1&&bo(X8,5),m&2){let T;dr(T=hr())&&(r._notch=T.first)}},hostAttrs:[1,"mdc-notched-outline"],hostVars:2,hostBindings:function(m,r){m&2&&wr("mdc-notched-outline--notched",r.open)},inputs:{open:[0,"matFormFieldNotchedOutlineOpen","open"]},standalone:!0,features:[vs],attrs:K8,ngContentSelectors:J8,decls:5,vars:0,consts:[["notch",""],[1,"mdc-notched-outline__leading"],[1,"mdc-notched-outline__notch"],[1,"mdc-notched-outline__trailing"]],template:function(m,r){m&1&&(Ku(),or(0,"div",1),Hn(1,"div",2,0),Qr(3),qn(),or(4,"div",3))},encapsulation:2,changeDetection:0});let a=i;return a})(),CG={transitionMessages:b0("transitionMessages",[jm("enter",Ia({opacity:1,transform:"translateY(0%)"})),Um("void => enter",[Ia({opacity:0,transform:"translateY(-5px)"}),Vm("300ms cubic-bezier(0.55, 0, 0.55, 0.2)")])])},KT=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=ui({type:i});let a=i;return a})();var JT=new Pt("MatFormField"),SG=new Pt("MAT_FORM_FIELD_DEFAULT_OPTIONS"),Vk=0,jk="fill",MG="auto",Uk="fixed",AG="translateY(-50%)",$k=(()=>{let i=class i{get hideRequiredMarker(){return this._hideRequiredMarker}set hideRequiredMarker(c){this._hideRequiredMarker=od(c)}get floatLabel(){return this._floatLabel||this._defaults?.floatLabel||MG}set floatLabel(c){c!==this._floatLabel&&(this._floatLabel=c,this._changeDetectorRef.markForCheck())}get appearance(){return this._appearance}set appearance(c){let m=this._appearance,r=c||this._defaults?.appearance||jk;this._appearance=r,this._appearance==="outline"&&this._appearance!==m&&(this._needsOutlineLabelOffsetUpdate=!0)}get subscriptSizing(){return this._subscriptSizing||this._defaults?.subscriptSizing||Uk}set subscriptSizing(c){this._subscriptSizing=c||this._defaults?.subscriptSizing||Uk}get hintLabel(){return this._hintLabel}set hintLabel(c){this._hintLabel=c,this._processHints()}get _control(){return this._explicitFormFieldControl||this._formFieldControl}set _control(c){this._explicitFormFieldControl=c}constructor(c,m,r,T,M,F,$,Q){this._elementRef=c,this._changeDetectorRef=m,this._dir=T,this._platform=M,this._defaults=F,this._animationMode=$,this._hideRequiredMarker=!1,this.color="primary",this._appearance=jk,this._subscriptSizing=null,this._hintLabel="",this._hasIconPrefix=!1,this._hasTextPrefix=!1,this._hasIconSuffix=!1,this._hasTextSuffix=!1,this._labelId=`mat-mdc-form-field-label-${Vk++}`,this._hintLabelId=`mat-mdc-hint-${Vk++}`,this._subscriptAnimationState="",this._destroyed=new Tn,this._isFocused=null,this._needsOutlineLabelOffsetUpdate=!1,this._injector=Ot(nr),F&&(F.appearance&&(this.appearance=F.appearance),this._hideRequiredMarker=!!F?.hideRequiredMarker,F.color&&(this.color=F.color))}ngAfterViewInit(){this._updateFocusState(),this._subscriptAnimationState="enter",this._changeDetectorRef.detectChanges()}ngAfterContentInit(){this._assertFormFieldControl(),this._initializeControl(),this._initializeSubscript(),this._initializePrefixAndSuffix(),this._initializeOutlineLabelOffsetSubscriptions()}ngAfterContentChecked(){this._assertFormFieldControl()}ngOnDestroy(){this._destroyed.next(),this._destroyed.complete()}getLabelId(){return this._hasFloatingLabel()?this._labelId:null}getConnectedOverlayOrigin(){return this._textField||this._elementRef}_animateAndLockLabel(){this._hasFloatingLabel()&&(this.floatLabel="always")}_initializeControl(){let c=this._control;c.controlType&&this._elementRef.nativeElement.classList.add(`mat-mdc-form-field-type-${c.controlType}`),c.stateChanges.subscribe(()=>{this._updateFocusState(),this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),c.ngControl&&c.ngControl.valueChanges&&c.ngControl.valueChanges.pipe(mo(this._destroyed)).subscribe(()=>this._changeDetectorRef.markForCheck())}_checkPrefixAndSuffixTypes(){this._hasIconPrefix=!!this._prefixChildren.find(c=>!c._isText),this._hasTextPrefix=!!this._prefixChildren.find(c=>c._isText),this._hasIconSuffix=!!this._suffixChildren.find(c=>!c._isText),this._hasTextSuffix=!!this._suffixChildren.find(c=>c._isText)}_initializePrefixAndSuffix(){this._checkPrefixAndSuffixTypes(),um(this._prefixChildren.changes,this._suffixChildren.changes).subscribe(()=>{this._checkPrefixAndSuffixTypes(),this._changeDetectorRef.markForCheck()})}_initializeSubscript(){this._hintChildren.changes.subscribe(()=>{this._processHints(),this._changeDetectorRef.markForCheck()}),this._errorChildren.changes.subscribe(()=>{this._syncDescribedByIds(),this._changeDetectorRef.markForCheck()}),this._validateHints(),this._syncDescribedByIds()}_assertFormFieldControl(){this._control}_updateFocusState(){this._control.focused&&!this._isFocused?(this._isFocused=!0,this._lineRipple?.activate()):!this._control.focused&&(this._isFocused||this._isFocused===null)&&(this._isFocused=!1,this._lineRipple?.deactivate()),this._textField?.nativeElement.classList.toggle("mdc-text-field--focused",this._control.focused)}_initializeOutlineLabelOffsetSubscriptions(){this._prefixChildren.changes.subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0),Cm(()=>{this._needsOutlineLabelOffsetUpdate&&(this._needsOutlineLabelOffsetUpdate=!1,this._updateOutlineLabelOffset())},{injector:this._injector}),this._dir.change.pipe(mo(this._destroyed)).subscribe(()=>this._needsOutlineLabelOffsetUpdate=!0)}_shouldAlwaysFloat(){return this.floatLabel==="always"}_hasOutline(){return this.appearance==="outline"}_forceDisplayInfixLabel(){return!this._platform.isBrowser&&this._prefixChildren.length&&!this._shouldLabelFloat()}_hasFloatingLabel(){return!!this._labelChildNonStatic||!!this._labelChildStatic}_shouldLabelFloat(){return this._control.shouldLabelFloat||this._shouldAlwaysFloat()}_shouldForward(c){let m=this._control?this._control.ngControl:null;return m&&m[c]}_getDisplayedMessages(){return this._errorChildren&&this._errorChildren.length>0&&this._control.errorState?"error":"hint"}_handleLabelResized(){this._refreshOutlineNotchWidth()}_refreshOutlineNotchWidth(){!this._hasOutline()||!this._floatingLabel||!this._shouldLabelFloat()?this._notchedOutline?._setNotchWidth(0):this._notchedOutline?._setNotchWidth(this._floatingLabel.getWidth())}_processHints(){this._validateHints(),this._syncDescribedByIds()}_validateHints(){this._hintChildren}_syncDescribedByIds(){if(this._control){let c=[];if(this._control.userAriaDescribedBy&&typeof this._control.userAriaDescribedBy=="string"&&c.push(...this._control.userAriaDescribedBy.split(" ")),this._getDisplayedMessages()==="hint"){let m=this._hintChildren?this._hintChildren.find(T=>T.align==="start"):null,r=this._hintChildren?this._hintChildren.find(T=>T.align==="end"):null;m?c.push(m.id):this._hintLabel&&c.push(this._hintLabelId),r&&c.push(r.id)}else this._errorChildren&&c.push(...this._errorChildren.map(m=>m.id));this._control.setDescribedByIds(c)}}_updateOutlineLabelOffset(){if(!this._hasOutline()||!this._floatingLabel)return;let c=this._floatingLabel.element;if(!(this._iconPrefixContainer||this._textPrefixContainer)){c.style.transform="";return}if(!this._isAttachedToDom()){this._needsOutlineLabelOffsetUpdate=!0;return}let m=this._iconPrefixContainer?.nativeElement,r=this._textPrefixContainer?.nativeElement,T=m?.getBoundingClientRect().width??0,M=r?.getBoundingClientRect().width??0,F=this._dir.value==="rtl"?"-1":"1",$=`${T+M}px`,ue=`calc(${F} * (${$} + var(--mat-mdc-form-field-label-offset-x, 0px)))`;c.style.transform=`var(
        --mat-mdc-form-field-label-transform,
        ${AG} translateX(${ue})
    )`}_isAttachedToDom(){let c=this._elementRef.nativeElement;if(c.getRootNode){let m=c.getRootNode();return m&&m!==c}return document.documentElement.contains(c)}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Ea),Tt(Wt),Tt(eb),Tt(Ai),Tt(SG,8),Tt(Lo,8),Tt(jn))},i.\u0275cmp=zr({type:i,selectors:[["mat-form-field"]],contentQueries:function(m,r,T){if(m&1&&(hc(T,rb,5),hc(T,rb,7),hc(T,KT,5),hc(T,TG,5),hc(T,DG,5),hc(T,wG,5),hc(T,Fk,5)),m&2){let M;dr(M=hr())&&(r._labelChildNonStatic=M.first),dr(M=hr())&&(r._labelChildStatic=M.first),dr(M=hr())&&(r._formFieldControl=M.first),dr(M=hr())&&(r._prefixChildren=M),dr(M=hr())&&(r._suffixChildren=M),dr(M=hr())&&(r._errorChildren=M),dr(M=hr())&&(r._hintChildren=M)}},viewQuery:function(m,r){if(m&1&&(bo(eG,5),bo(tG,5),bo(nG,5),bo(Lk,5),bo(Bk,5),bo(zk,5)),m&2){let T;dr(T=hr())&&(r._textField=T.first),dr(T=hr())&&(r._iconPrefixContainer=T.first),dr(T=hr())&&(r._textPrefixContainer=T.first),dr(T=hr())&&(r._floatingLabel=T.first),dr(T=hr())&&(r._notchedOutline=T.first),dr(T=hr())&&(r._lineRipple=T.first)}},hostAttrs:[1,"mat-mdc-form-field"],hostVars:42,hostBindings:function(m,r){m&2&&wr("mat-mdc-form-field-label-always-float",r._shouldAlwaysFloat())("mat-mdc-form-field-has-icon-prefix",r._hasIconPrefix)("mat-mdc-form-field-has-icon-suffix",r._hasIconSuffix)("mat-form-field-invalid",r._control.errorState)("mat-form-field-disabled",r._control.disabled)("mat-form-field-autofilled",r._control.autofilled)("mat-form-field-no-animations",r._animationMode==="NoopAnimations")("mat-form-field-appearance-fill",r.appearance=="fill")("mat-form-field-appearance-outline",r.appearance=="outline")("mat-form-field-hide-placeholder",r._hasFloatingLabel()&&!r._shouldLabelFloat())("mat-focused",r._control.focused)("mat-primary",r.color!=="accent"&&r.color!=="warn")("mat-accent",r.color==="accent")("mat-warn",r.color==="warn")("ng-untouched",r._shouldForward("untouched"))("ng-touched",r._shouldForward("touched"))("ng-pristine",r._shouldForward("pristine"))("ng-dirty",r._shouldForward("dirty"))("ng-valid",r._shouldForward("valid"))("ng-invalid",r._shouldForward("invalid"))("ng-pending",r._shouldForward("pending"))},inputs:{hideRequiredMarker:"hideRequiredMarker",color:"color",floatLabel:"floatLabel",appearance:"appearance",subscriptSizing:"subscriptSizing",hintLabel:"hintLabel"},exportAs:["matFormField"],standalone:!0,features:[Ko([{provide:JT,useExisting:i},{provide:Gk,useExisting:i}]),vs],ngContentSelectors:rG,decls:18,vars:21,consts:[["labelTemplate",""],["textField",""],["iconPrefixContainer",""],["textPrefixContainer",""],[1,"mat-mdc-text-field-wrapper","mdc-text-field",3,"click"],[1,"mat-mdc-form-field-focus-overlay"],[1,"mat-mdc-form-field-flex"],["matFormFieldNotchedOutline","",3,"matFormFieldNotchedOutlineOpen"],[1,"mat-mdc-form-field-icon-prefix"],[1,"mat-mdc-form-field-text-prefix"],[1,"mat-mdc-form-field-infix"],[3,"ngTemplateOutlet"],[1,"mat-mdc-form-field-text-suffix"],[1,"mat-mdc-form-field-icon-suffix"],["matFormFieldLineRipple",""],[1,"mat-mdc-form-field-subscript-wrapper","mat-mdc-form-field-bottom-align"],[1,"mat-mdc-form-field-error-wrapper"],[1,"mat-mdc-form-field-hint-wrapper"],["matFormFieldFloatingLabel","",3,"floating","monitorResize","id"],["aria-hidden","true",1,"mat-mdc-form-field-required-marker","mdc-floating-label--required"],[3,"id"],[1,"mat-mdc-form-field-hint-spacer"]],template:function(m,r){if(m&1){let T=i0();Ku(iG),rr(0,aG,1,1,"ng-template",null,0,r0),Hn(2,"div",4,1),Zr("click",function(F){return jv(T),Uv(r._control.onContainerClick(F))}),rr(4,lG,1,0,"div",5),Hn(5,"div",6),rr(6,dG,2,2,"div",7)(7,hG,3,0,"div",8)(8,fG,3,0,"div",9),Hn(9,"div",10),rr(10,mG,1,1,null,11),Qr(11),qn(),rr(12,gG,2,0,"div",12)(13,_G,2,0,"div",13),qn(),rr(14,yG,1,0,"div",14),qn(),Hn(15,"div",15),rr(16,vG,2,1,"div",16)(17,xG,5,2,"div",17),qn()}if(m&2){let T;di(2),wr("mdc-text-field--filled",!r._hasOutline())("mdc-text-field--outlined",r._hasOutline())("mdc-text-field--no-label",!r._hasFloatingLabel())("mdc-text-field--disabled",r._control.disabled)("mdc-text-field--invalid",r._control.errorState),di(2),Wr(!r._hasOutline()&&!r._control.disabled?4:-1),di(2),Wr(r._hasOutline()?6:-1),di(),Wr(r._hasIconPrefix?7:-1),di(),Wr(r._hasTextPrefix?8:-1),di(2),Wr(!r._hasOutline()||r._forceDisplayInfixLabel()?10:-1),di(2),Wr(r._hasTextSuffix?12:-1),di(),Wr(r._hasIconSuffix?13:-1),di(),Wr(r._hasOutline()?-1:14),di(),wr("mat-mdc-form-field-subscript-dynamic-size",r.subscriptSizing==="dynamic"),di(),Wr((T=r._getDisplayedMessages())==="error"?16:T==="hint"?17:-1)}},dependencies:[Lk,Bk,u0,zk,Fk],styles:['.mdc-text-field{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:0;border-bottom-left-radius:0;display:inline-flex;align-items:baseline;padding:0 16px;position:relative;box-sizing:border-box;overflow:hidden;will-change:opacity,transform,color}.mdc-text-field .mdc-floating-label{top:50%;transform:translateY(-50%);pointer-events:none}.mdc-text-field__input{height:28px;width:100%;min-width:0;border:none;border-radius:0;background:none;appearance:none;padding:0}.mdc-text-field__input::-ms-clear{display:none}.mdc-text-field__input::-webkit-calendar-picker-indicator{display:none}.mdc-text-field__input:focus{outline:none}.mdc-text-field__input:invalid{box-shadow:none}@media all{.mdc-text-field__input::placeholder{opacity:0}}@media all{.mdc-text-field__input:-ms-input-placeholder{opacity:0}}@media all{.mdc-text-field--no-label .mdc-text-field__input::placeholder,.mdc-text-field--focused .mdc-text-field__input::placeholder{opacity:1}}@media all{.mdc-text-field--no-label .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mdc-text-field__input:-ms-input-placeholder{opacity:1}}.mdc-text-field__affix{height:28px;opacity:0;white-space:nowrap}.mdc-text-field--label-floating .mdc-text-field__affix,.mdc-text-field--no-label .mdc-text-field__affix{opacity:1}@supports(-webkit-hyphens: none){.mdc-text-field--outlined .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field__affix--prefix,.mdc-text-field__affix--prefix[dir=rtl]{padding-left:2px;padding-right:0}.mdc-text-field--end-aligned .mdc-text-field__affix--prefix{padding-left:0;padding-right:12px}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--end-aligned .mdc-text-field__affix--prefix[dir=rtl]{padding-left:12px;padding-right:0}.mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field__affix--suffix,.mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:12px}.mdc-text-field--end-aligned .mdc-text-field__affix--suffix{padding-left:2px;padding-right:0}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--end-aligned .mdc-text-field__affix--suffix[dir=rtl]{padding-left:0;padding-right:2px}.mdc-text-field--filled{height:56px}.mdc-text-field--filled::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}.mdc-text-field--filled .mdc-floating-label{left:16px;right:initial}[dir=rtl] .mdc-text-field--filled .mdc-floating-label,.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:16px}.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{height:100%}.mdc-text-field--filled.mdc-text-field--no-label .mdc-floating-label{display:none}.mdc-text-field--filled.mdc-text-field--no-label::before{display:none}@supports(-webkit-hyphens: none){.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__affix{align-items:center;align-self:center;display:inline-flex;height:100%}}.mdc-text-field--outlined{height:56px;overflow:visible}.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) scale(1)}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) scale(0.75)}.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--outlined .mdc-text-field__input{height:100%}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-shape-small, 4px))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:4px;border-top-right-radius:var(--mdc-shape-small, 4px);border-bottom-right-radius:4px;border-bottom-right-radius:var(--mdc-shape-small, 4px);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:4px;border-top-left-radius:var(--mdc-shape-small, 4px);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:4px;border-bottom-left-radius:var(--mdc-shape-small, 4px)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-shape-small, 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-shape-small, 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-shape-small, 4px))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-shape-small, 4px) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:1px}.mdc-text-field--outlined .mdc-floating-label{left:4px;right:initial}[dir=rtl] .mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:4px}.mdc-text-field--outlined .mdc-text-field__input{display:flex;border:none !important;background-color:rgba(0,0,0,0)}.mdc-text-field--outlined .mdc-notched-outline{z-index:1}.mdc-text-field--textarea{flex-direction:column;align-items:center;width:auto;height:auto;padding:0}.mdc-text-field--textarea .mdc-floating-label{top:19px}.mdc-text-field--textarea .mdc-floating-label:not(.mdc-floating-label--float-above){transform:none}.mdc-text-field--textarea .mdc-text-field__input{flex-grow:1;height:auto;min-height:1.5rem;overflow-x:hidden;overflow-y:auto;box-sizing:border-box;resize:none;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--filled::before{display:none}.mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--float-above{transform:translateY(-10.25px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--filled .mdc-text-field__input{margin-top:23px;margin-bottom:9px}.mdc-text-field--textarea.mdc-text-field--filled.mdc-text-field--no-label .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-27.25px) scale(1)}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-24.75px) scale(0.75)}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-text-field__input{margin-top:16px;margin-bottom:16px}.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label{top:18px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field__input{margin-bottom:2px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter{align-self:flex-end;padding:0 16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::after{display:inline-block;width:0;height:16px;content:"";vertical-align:-16px}.mdc-text-field--textarea.mdc-text-field--with-internal-counter .mdc-text-field-character-counter::before{display:none}.mdc-text-field__resizer{align-self:stretch;display:inline-flex;flex-direction:column;flex-grow:1;max-height:100%;max-width:100%;min-height:56px;min-width:fit-content;min-width:-moz-available;min-width:-webkit-fill-available;overflow:hidden;resize:both}.mdc-text-field--filled .mdc-text-field__resizer{transform:translateY(-1px)}.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--filled .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateY(1px)}.mdc-text-field--outlined .mdc-text-field__resizer{transform:translateX(-1px) translateY(-1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer,.mdc-text-field--outlined .mdc-text-field__resizer[dir=rtl]{transform:translateX(1px) translateY(-1px)}.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter{transform:translateX(1px) translateY(1px)}[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input,[dir=rtl] .mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter,.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field__input[dir=rtl],.mdc-text-field--outlined .mdc-text-field__resizer .mdc-text-field-character-counter[dir=rtl]{transform:translateX(-1px) translateY(1px)}.mdc-text-field--with-leading-icon{padding-left:0;padding-right:16px}[dir=rtl] .mdc-text-field--with-leading-icon,.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:16px;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 48px);left:48px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label[dir=rtl]{left:initial;right:48px}.mdc-text-field--with-leading-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label{left:36px;right:initial}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label[dir=rtl]{left:initial;right:36px}.mdc-text-field--with-leading-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{transform:translateY(-37.25px) translateX(-32px) scale(1)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-37.25px) translateX(32px) scale(1)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{transform:translateY(-34.75px) translateX(-32px) scale(0.75)}[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,[dir=rtl] .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl],.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above[dir=rtl]{transform:translateY(-34.75px) translateX(32px) scale(0.75)}.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:.75rem}.mdc-text-field--with-leading-icon.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:1rem}.mdc-text-field--with-trailing-icon{padding-left:16px;padding-right:0}[dir=rtl] .mdc-text-field--with-trailing-icon,.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0;padding-right:16px}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 64px)}.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 64px/0.75)}.mdc-text-field--with-trailing-icon.mdc-text-field--outlined :not(.mdc-notched-outline--notched) .mdc-notched-outline__notch{max-width:calc(100% - 60px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label{max-width:calc(100% - 96px)}.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon.mdc-text-field--filled .mdc-floating-label--float-above{max-width:calc(100%/0.75 - 96px/0.75)}.mdc-text-field-helper-line{display:flex;justify-content:space-between;box-sizing:border-box}.mdc-text-field+.mdc-text-field-helper-line{padding-right:16px;padding-left:16px}.mdc-form-field>.mdc-text-field+label{align-self:flex-start}.mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--focused .mdc-notched-outline__trailing{border-width:2px}.mdc-text-field--focused+.mdc-text-field-helper-line .mdc-text-field-helper-text:not(.mdc-text-field-helper-text--validation-msg){opacity:1}.mdc-text-field--focused.mdc-text-field--outlined .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:2px}.mdc-text-field--focused.mdc-text-field--outlined.mdc-text-field--textarea .mdc-notched-outline--notched .mdc-notched-outline__notch{padding-top:0}.mdc-text-field--invalid+.mdc-text-field-helper-line .mdc-text-field-helper-text--validation-msg{opacity:1}.mdc-text-field--disabled{pointer-events:none}@media screen and (forced-colors: active){.mdc-text-field--disabled .mdc-text-field__input{background-color:Window}.mdc-text-field--disabled .mdc-floating-label{z-index:1}}.mdc-text-field--disabled .mdc-floating-label{cursor:default}.mdc-text-field--disabled.mdc-text-field--filled .mdc-text-field__ripple{display:none}.mdc-text-field--disabled .mdc-text-field__input{pointer-events:auto}.mdc-text-field--end-aligned .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--end-aligned .mdc-text-field__input[dir=rtl]{text-align:left}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix{direction:ltr}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{padding-left:0;padding-right:2px}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{padding-left:12px;padding-right:0}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--leading,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--leading{order:1}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--suffix{order:2}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__input,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__input{order:3}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__affix--prefix{order:4}[dir=rtl] .mdc-text-field--ltr-text .mdc-text-field__icon--trailing,.mdc-text-field--ltr-text[dir=rtl] .mdc-text-field__icon--trailing{order:5}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__input,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__input{text-align:right}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--prefix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--prefix{padding-right:12px}[dir=rtl] .mdc-text-field--ltr-text.mdc-text-field--end-aligned .mdc-text-field__affix--suffix,.mdc-text-field--ltr-text.mdc-text-field--end-aligned[dir=rtl] .mdc-text-field__affix--suffix{padding-left:2px}.mdc-floating-label{position:absolute;left:0;-webkit-transform-origin:left top;transform-origin:left top;line-height:1.15rem;text-align:left;text-overflow:ellipsis;white-space:nowrap;cursor:text;overflow:hidden;will-change:transform}[dir=rtl] .mdc-floating-label,.mdc-floating-label[dir=rtl]{right:0;left:auto;-webkit-transform-origin:right top;transform-origin:right top;text-align:right}.mdc-floating-label--float-above{cursor:auto}.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after{margin-left:1px;margin-right:0px;content:"*"}[dir=rtl] .mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)::after,.mdc-floating-label--required:not(.mdc-floating-label--hide-required-marker)[dir=rtl]::after{margin-left:0;margin-right:1px}.mdc-notched-outline{display:flex;position:absolute;top:0;right:0;left:0;box-sizing:border-box;width:100%;max-width:100%;height:100%;text-align:left;pointer-events:none}[dir=rtl] .mdc-notched-outline,.mdc-notched-outline[dir=rtl]{text-align:right}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{box-sizing:border-box;height:100%;pointer-events:none}.mdc-notched-outline__trailing{flex-grow:1}.mdc-notched-outline__notch{flex:0 0 auto;width:auto}.mdc-notched-outline .mdc-floating-label{display:inline-block;position:relative;max-width:100%}.mdc-notched-outline .mdc-floating-label--float-above{text-overflow:clip}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:133.3333333333%}.mdc-notched-outline--notched .mdc-notched-outline__notch{padding-left:0;padding-right:8px;border-top:none}[dir=rtl] .mdc-notched-outline--notched .mdc-notched-outline__notch,.mdc-notched-outline--notched .mdc-notched-outline__notch[dir=rtl]{padding-left:8px;padding-right:0}.mdc-notched-outline--no-label .mdc-notched-outline__notch{display:none}.mdc-line-ripple::before,.mdc-line-ripple::after{position:absolute;bottom:0;left:0;width:100%;border-bottom-style:solid;content:""}.mdc-line-ripple::before{z-index:1}.mdc-line-ripple::after{transform:scaleX(0);opacity:0;z-index:2}.mdc-line-ripple--active::after{transform:scaleX(1);opacity:1}.mdc-line-ripple--deactivating::after{opacity:0}.mdc-floating-label--float-above{transform:translateY(-106%) scale(0.75)}.mdc-notched-outline__leading,.mdc-notched-outline__notch,.mdc-notched-outline__trailing{border-top:1px solid;border-bottom:1px solid}.mdc-notched-outline__leading{border-left:1px solid;border-right:none;width:12px}[dir=rtl] .mdc-notched-outline__leading,.mdc-notched-outline__leading[dir=rtl]{border-left:none;border-right:1px solid}.mdc-notched-outline__trailing{border-left:none;border-right:1px solid}[dir=rtl] .mdc-notched-outline__trailing,.mdc-notched-outline__trailing[dir=rtl]{border-left:1px solid;border-right:none}.mdc-notched-outline__notch{max-width:calc(100% - 12px*2)}.mdc-line-ripple::before{border-bottom-width:1px}.mdc-line-ripple::after{border-bottom-width:2px}.mdc-text-field--filled{border-top-left-radius:var(--mdc-filled-text-field-container-shape);border-top-right-radius:var(--mdc-filled-text-field-container-shape);border-bottom-right-radius:0;border-bottom-left-radius:0}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-caret-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-filled-text-field-error-caret-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-filled-text-field-input-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-filled-text-field-disabled-input-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-focus-label-text-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-hover-label-text-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-disabled-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-focus-label-text-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-filled-text-field-error-hover-label-text-color)}.mdc-text-field--filled .mdc-floating-label{font-family:var(--mdc-filled-text-field-label-text-font);font-size:var(--mdc-filled-text-field-label-text-size);font-weight:var(--mdc-filled-text-field-label-text-weight);letter-spacing:var(--mdc-filled-text-field-label-text-tracking)}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-filled-text-field-input-text-placeholder-color)}}.mdc-text-field--filled:not(.mdc-text-field--disabled){background-color:var(--mdc-filled-text-field-container-color)}.mdc-text-field--filled.mdc-text-field--disabled{background-color:var(--mdc-filled-text-field-disabled-container-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-hover-active-indicator-color)}.mdc-text-field--filled:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-focus-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--disabled .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-disabled-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-line-ripple::before{border-bottom-color:var(--mdc-filled-text-field-error-hover-active-indicator-color)}.mdc-text-field--filled.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-line-ripple::after{border-bottom-color:var(--mdc-filled-text-field-error-focus-active-indicator-color)}.mdc-text-field--filled .mdc-line-ripple::before{border-bottom-width:var(--mdc-filled-text-field-active-indicator-height)}.mdc-text-field--filled .mdc-line-ripple::after{border-bottom-width:var(--mdc-filled-text-field-focus-active-indicator-height)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-caret-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-text-field__input{caret-color:var(--mdc-outlined-text-field-error-caret-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input{color:var(--mdc-outlined-text-field-input-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-text-field__input{color:var(--mdc-outlined-text-field-disabled-input-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-focus-label-text-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-hover-label-text-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-disabled-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-focus-label-text-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-floating-label--float-above{color:var(--mdc-outlined-text-field-error-hover-label-text-color)}.mdc-text-field--outlined .mdc-floating-label{font-family:var(--mdc-outlined-text-field-label-text-font);font-size:var(--mdc-outlined-text-field-label-text-size);font-weight:var(--mdc-outlined-text-field-label-text-weight);letter-spacing:var(--mdc-outlined-text-field-label-text-tracking)}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input::placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}@media all{.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-text-field__input:-ms-input-placeholder{color:var(--mdc-outlined-text-field-input-text-placeholder-color)}}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(.75*var(--mdc-outlined-text-field-label-text-size))}.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined.mdc-notched-outline--upgraded .mdc-floating-label--float-above,.mdc-text-field--outlined.mdc-text-field--textarea.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mdc-outlined-text-field-label-text-size)}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading[dir=rtl]{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__leading{width:max(12px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__notch{max-width:calc(100% - max(12px,var(--mdc-outlined-text-field-container-shape))*2)}}.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing{border-top-left-radius:0;border-top-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-right-radius:var(--mdc-outlined-text-field-container-shape);border-bottom-left-radius:0}[dir=rtl] .mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing,.mdc-text-field--outlined .mdc-notched-outline .mdc-notched-outline__trailing[dir=rtl]{border-top-left-radius:var(--mdc-outlined-text-field-container-shape);border-top-right-radius:0;border-bottom-right-radius:0;border-bottom-left-radius:var(--mdc-outlined-text-field-container-shape)}@supports(top: max(0%)){.mdc-text-field--outlined{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}@supports(top: max(0%)){.mdc-text-field--outlined+.mdc-text-field-helper-line{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-left:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-leading-icon{padding-right:max(16px,var(--mdc-outlined-text-field-container-shape))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-right:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-leading-icon,.mdc-text-field--outlined.mdc-text-field--with-leading-icon[dir=rtl]{padding-left:max(16px,var(--mdc-outlined-text-field-container-shape))}}.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-right:0}@supports(top: max(0%)){.mdc-text-field--outlined.mdc-text-field--with-trailing-icon{padding-left:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-left:0}@supports(top: max(0%)){[dir=rtl] .mdc-text-field--outlined.mdc-text-field--with-trailing-icon,.mdc-text-field--outlined.mdc-text-field--with-trailing-icon[dir=rtl]{padding-right:max(16px,calc(var(--mdc-outlined-text-field-container-shape) + 4px))}}.mdc-text-field--outlined.mdc-text-field--with-leading-icon.mdc-text-field--with-trailing-icon{padding-left:0;padding-right:0}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-hover-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-focus-outline-color)}.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--disabled .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-disabled-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled) .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled):not(.mdc-text-field--focused):hover .mdc-notched-outline .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-hover-outline-color)}.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch,.mdc-text-field--outlined.mdc-text-field--invalid:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:var(--mdc-outlined-text-field-error-focus-outline-color)}.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled) .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-outline-width)}.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__leading,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__notch,.mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline .mdc-notched-outline__trailing{border-width:var(--mdc-outlined-text-field-focus-outline-width)}.mat-mdc-form-field-textarea-control{vertical-align:middle;resize:vertical;box-sizing:border-box;height:auto;margin:0;padding:0;border:none;overflow:auto}.mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font:inherit;letter-spacing:inherit;text-decoration:inherit;text-transform:inherit;border:none}.mat-mdc-form-field .mat-mdc-floating-label.mdc-floating-label{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;line-height:normal;pointer-events:all;will-change:auto}.mat-mdc-form-field:not(.mat-form-field-disabled) .mat-mdc-floating-label.mdc-floating-label{cursor:inherit}.mdc-text-field--no-label:not(.mdc-text-field--textarea) .mat-mdc-form-field-input-control.mdc-text-field__input,.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control{height:auto}.mat-mdc-text-field-wrapper .mat-mdc-form-field-input-control.mdc-text-field__input[type=color]{height:23px}.mat-mdc-text-field-wrapper{height:auto;flex:auto;will-change:auto}.mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-left:0;--mat-mdc-form-field-label-offset-x: -16px}.mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-right:0}[dir=rtl] .mat-mdc-text-field-wrapper{padding-left:16px;padding-right:16px}[dir=rtl] .mat-mdc-form-field-has-icon-suffix .mat-mdc-text-field-wrapper{padding-left:0}[dir=rtl] .mat-mdc-form-field-has-icon-prefix .mat-mdc-text-field-wrapper{padding-right:0}.mat-form-field-disabled .mdc-text-field__input::placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-moz-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input::-webkit-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-form-field-disabled .mdc-text-field__input:-ms-input-placeholder{color:var(--mat-form-field-disabled-input-text-placeholder-color)}.mat-mdc-form-field-label-always-float .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms;opacity:1}.mat-mdc-text-field-wrapper .mat-mdc-form-field-infix .mat-mdc-floating-label{left:auto;right:auto}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-text-field__input{display:inline-block}.mat-mdc-form-field .mat-mdc-text-field-wrapper.mdc-text-field .mdc-notched-outline__notch{padding-top:0}.mat-mdc-text-field-wrapper::before{content:none}.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:1px solid rgba(0,0,0,0)}[dir=rtl] .mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field.mat-mdc-form-field .mdc-notched-outline__notch{border-left:none;border-right:1px solid rgba(0,0,0,0)}.mat-mdc-form-field-infix{min-height:var(--mat-form-field-container-height);padding-top:var(--mat-form-field-filled-with-label-container-padding-top);padding-bottom:var(--mat-form-field-filled-with-label-container-padding-bottom)}.mdc-text-field--outlined .mat-mdc-form-field-infix,.mdc-text-field--no-label .mat-mdc-form-field-infix{padding-top:var(--mat-form-field-container-vertical-padding);padding-bottom:var(--mat-form-field-container-vertical-padding)}.mat-mdc-text-field-wrapper .mat-mdc-form-field-flex .mat-mdc-floating-label{top:calc(var(--mat-form-field-container-height)/2)}.mdc-text-field--filled .mat-mdc-floating-label{display:var(--mat-form-field-filled-label-display, block)}.mat-mdc-text-field-wrapper.mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{--mat-mdc-form-field-label-transform: translateY(calc(calc(6.75px + var(--mat-form-field-container-height) / 2) * -1)) scale(var(--mat-mdc-form-field-floating-label-scale, 0.75));transform:var(--mat-mdc-form-field-label-transform)}.mat-mdc-form-field-subscript-wrapper{box-sizing:border-box;width:100%;position:relative}.mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-error-wrapper{position:absolute;top:0;left:0;right:0;padding:0 16px}.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-hint-wrapper,.mat-mdc-form-field-subscript-dynamic-size .mat-mdc-form-field-error-wrapper{position:static}.mat-mdc-form-field-bottom-align::before{content:"";display:inline-block;height:16px}.mat-mdc-form-field-bottom-align.mat-mdc-form-field-subscript-dynamic-size::before{content:unset}.mat-mdc-form-field-hint-end{order:1}.mat-mdc-form-field-hint-wrapper{display:flex}.mat-mdc-form-field-hint-spacer{flex:1 0 1em}.mat-mdc-form-field-error{display:block;color:var(--mat-form-field-error-text-color)}.mat-mdc-form-field-subscript-wrapper,.mat-mdc-form-field-bottom-align::before{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-subscript-text-font);line-height:var(--mat-form-field-subscript-text-line-height);font-size:var(--mat-form-field-subscript-text-size);letter-spacing:var(--mat-form-field-subscript-text-tracking);font-weight:var(--mat-form-field-subscript-text-weight)}.mat-mdc-form-field-focus-overlay{top:0;left:0;right:0;bottom:0;position:absolute;opacity:0;pointer-events:none;background-color:var(--mat-form-field-state-layer-color)}.mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-hover-state-layer-opacity)}.mat-mdc-form-field.mat-focused .mat-mdc-form-field-focus-overlay{opacity:var(--mat-form-field-focus-state-layer-opacity)}select.mat-mdc-form-field-input-control{-moz-appearance:none;-webkit-appearance:none;background-color:rgba(0,0,0,0);display:inline-flex;box-sizing:border-box}select.mat-mdc-form-field-input-control:not(:disabled){cursor:pointer}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option{color:var(--mat-form-field-select-option-text-color)}select.mat-mdc-form-field-input-control:not(.mat-mdc-native-select-inline) option:disabled{color:var(--mat-form-field-select-disabled-option-text-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{content:"";width:0;height:0;border-left:5px solid rgba(0,0,0,0);border-right:5px solid rgba(0,0,0,0);border-top:5px solid;position:absolute;right:0;top:50%;margin-top:-2.5px;pointer-events:none;color:var(--mat-form-field-enabled-select-arrow-color)}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-infix::after{right:auto;left:0}.mat-mdc-form-field-type-mat-native-select.mat-focused .mat-mdc-form-field-infix::after{color:var(--mat-form-field-focus-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select.mat-form-field-disabled .mat-mdc-form-field-infix::after{color:var(--mat-form-field-disabled-select-arrow-color)}.mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:15px}[dir=rtl] .mat-mdc-form-field-type-mat-native-select .mat-mdc-form-field-input-control{padding-right:0;padding-left:15px}.cdk-high-contrast-active .mat-form-field-appearance-fill .mat-mdc-text-field-wrapper{outline:solid 1px}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-form-field-disabled .mat-mdc-text-field-wrapper{outline-color:GrayText}.cdk-high-contrast-active .mat-form-field-appearance-fill.mat-focused .mat-mdc-text-field-wrapper{outline:dashed 3px}.cdk-high-contrast-active .mat-mdc-form-field.mat-focused .mdc-notched-outline{border:dashed 3px}.mat-mdc-form-field-input-control[type=date],.mat-mdc-form-field-input-control[type=datetime],.mat-mdc-form-field-input-control[type=datetime-local],.mat-mdc-form-field-input-control[type=month],.mat-mdc-form-field-input-control[type=week],.mat-mdc-form-field-input-control[type=time]{line-height:1}.mat-mdc-form-field-input-control::-webkit-datetime-edit{line-height:1;padding:0;margin-bottom:-2px}.mat-mdc-form-field{--mat-mdc-form-field-floating-label-scale: 0.75;display:inline-flex;flex-direction:column;min-width:0;text-align:left;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-form-field-container-text-font);line-height:var(--mat-form-field-container-text-line-height);font-size:var(--mat-form-field-container-text-size);letter-spacing:var(--mat-form-field-container-text-tracking);font-weight:var(--mat-form-field-container-text-weight)}[dir=rtl] .mat-mdc-form-field{text-align:right}.mat-mdc-form-field .mdc-text-field--outlined .mdc-floating-label--float-above{font-size:calc(var(--mat-form-field-outlined-label-text-populated-size)*var(--mat-mdc-form-field-floating-label-scale))}.mat-mdc-form-field .mdc-text-field--outlined .mdc-notched-outline--upgraded .mdc-floating-label--float-above{font-size:var(--mat-form-field-outlined-label-text-populated-size)}.mat-mdc-form-field-flex{display:inline-flex;align-items:baseline;box-sizing:border-box;width:100%}.mat-mdc-text-field-wrapper{width:100%;z-index:0}.mat-mdc-form-field-icon-prefix,.mat-mdc-form-field-icon-suffix{align-self:center;line-height:0;pointer-events:auto;position:relative;z-index:1}.mat-mdc-form-field-icon-prefix>.mat-icon,.mat-mdc-form-field-icon-suffix>.mat-icon{padding:0 12px;box-sizing:content-box}.mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-leading-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-prefix{color:var(--mat-form-field-disabled-leading-icon-color)}.mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-trailing-icon-color)}.mat-form-field-disabled .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-disabled-trailing-icon-color)}.mat-form-field-invalid .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-trailing-icon-color)}.mat-form-field-invalid:not(.mat-focused):not(.mat-form-field-disabled) .mat-mdc-text-field-wrapper:hover .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-hover-trailing-icon-color)}.mat-form-field-invalid.mat-focused .mat-mdc-text-field-wrapper .mat-mdc-form-field-icon-suffix{color:var(--mat-form-field-error-focus-trailing-icon-color)}.mat-mdc-form-field-icon-prefix,[dir=rtl] .mat-mdc-form-field-icon-suffix{padding:0 4px 0 0}.mat-mdc-form-field-icon-suffix,[dir=rtl] .mat-mdc-form-field-icon-prefix{padding:0 0 0 4px}.mat-mdc-form-field-subscript-wrapper .mat-icon,.mat-mdc-form-field label .mat-icon{width:1em;height:1em;font-size:inherit}.mat-mdc-form-field-infix{flex:auto;min-width:0;width:180px;position:relative;box-sizing:border-box}.mat-mdc-form-field .mdc-notched-outline__notch{margin-left:-1px;-webkit-clip-path:inset(-9em -999em -9em 1px);clip-path:inset(-9em -999em -9em 1px)}[dir=rtl] .mat-mdc-form-field .mdc-notched-outline__notch{margin-left:0;margin-right:-1px;-webkit-clip-path:inset(-9em 1px -9em -999em);clip-path:inset(-9em 1px -9em -999em)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition:opacity 67ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input::placeholder{transition-delay:40ms;transition-duration:110ms}}@media all{.mdc-text-field--no-label .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder,.mdc-text-field--focused .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__input:-ms-input-placeholder{transition-delay:40ms;transition-duration:110ms}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field__affix{transition:opacity 150ms 0ms cubic-bezier(0.4, 0, 0.2, 1)}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled.mdc-ripple-upgraded--background-focused .mdc-text-field__ripple::before,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--filled:not(.mdc-ripple-upgraded):focus .mdc-text-field__ripple::before{transition-duration:75ms}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea{transition:none}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--filled .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-filled 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-filled{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 10.25px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--textarea.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-textarea-outlined 250ms 1}@keyframes mdc-floating-label-shake-float-above-textarea-outlined{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 24.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon{0%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - 32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}[dir=rtl] .mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined .mdc-floating-label--shake,.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-text-field--with-leading-icon.mdc-text-field--outlined[dir=rtl] .mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-text-field-outlined-leading-icon 250ms 1}@keyframes mdc-floating-label-shake-float-above-text-field-outlined-leading-icon-rtl{0%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}100%{transform:translateX(calc(0% - -32px)) translateY(calc(0% - 34.75px)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-floating-label{transition:transform 150ms cubic-bezier(0.4, 0, 0.2, 1),color 150ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-floating-label--shake{animation:mdc-floating-label-shake-float-above-standard 250ms 1}@keyframes mdc-floating-label-shake-float-above-standard{0%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}33%{animation-timing-function:cubic-bezier(0.5, 0, 0.701732, 0.495819);transform:translateX(calc(4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}66%{animation-timing-function:cubic-bezier(0.302435, 0.381352, 0.55, 0.956352);transform:translateX(calc(-4% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}100%{transform:translateX(calc(0% - 0%)) translateY(calc(0% - 106%)) scale(0.75)}}.mat-mdc-form-field:not(.mat-form-field-no-animations) .mdc-line-ripple::after{transition:transform 180ms cubic-bezier(0.4, 0, 0.2, 1),opacity 180ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-notched-outline .mdc-floating-label{max-width:calc(100% + 1px)}.mdc-notched-outline--upgraded .mdc-floating-label--float-above{max-width:calc(133.3333333333% + 1px)}'],encapsulation:2,data:{animation:[CG.transitionMessages]},changeDetection:0});let a=i;return a})(),eD=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[ro,hf,uk,ro]});let a=i;return a})();var RG=new Pt("MAT_INPUT_VALUE_ACCESSOR"),kG=["button","checkbox","file","hidden","image","radio","range","reset","submit"],OG=0,Hk=(()=>{let i=class i{get disabled(){return this._disabled}set disabled(c){this._disabled=od(c),this.focused&&(this.focused=!1,this.stateChanges.next())}get id(){return this._id}set id(c){this._id=c||this._uid}get required(){return this._required??this.ngControl?.control?.hasValidator(B0.required)??!1}set required(c){this._required=od(c)}get type(){return this._type}set type(c){this._type=c||"text",this._validateType(),!this._isTextarea&&MT().has(this._type)&&(this._elementRef.nativeElement.type=this._type)}get errorStateMatcher(){return this._errorStateTracker.matcher}set errorStateMatcher(c){this._errorStateTracker.matcher=c}get value(){return this._inputValueAccessor.value}set value(c){c!==this.value&&(this._inputValueAccessor.value=c,this.stateChanges.next())}get readonly(){return this._readonly}set readonly(c){this._readonly=od(c)}get errorState(){return this._errorStateTracker.errorState}set errorState(c){this._errorStateTracker.errorState=c}constructor(c,m,r,T,M,F,$,Q,ue,Ae){this._elementRef=c,this._platform=m,this.ngControl=r,this._autofillMonitor=Q,this._formField=Ae,this._uid=`mat-input-${OG++}`,this.focused=!1,this.stateChanges=new Tn,this.controlType="mat-input",this.autofilled=!1,this._disabled=!1,this._type="text",this._readonly=!1,this._neverEmptyInputTypes=["date","datetime","datetime-local","month","time","week"].filter(Qe=>MT().has(Qe)),this._iOSKeyupListener=Qe=>{let dt=Qe.target;!dt.value&&dt.selectionStart===0&&dt.selectionEnd===0&&(dt.setSelectionRange(1,1),dt.setSelectionRange(0,0))};let xe=this._elementRef.nativeElement,ke=xe.nodeName.toLowerCase();this._inputValueAccessor=$||xe,this._previousNativeValue=this.value,this.id=this.id,m.IOS&&ue.runOutsideAngular(()=>{c.nativeElement.addEventListener("keyup",this._iOSKeyupListener)}),this._errorStateTracker=new nb(F,r,M,T,this.stateChanges),this._isServer=!this._platform.isBrowser,this._isNativeSelect=ke==="select",this._isTextarea=ke==="textarea",this._isInFormField=!!Ae,this._isNativeSelect&&(this.controlType=xe.multiple?"mat-native-select-multiple":"mat-native-select")}ngAfterViewInit(){this._platform.isBrowser&&this._autofillMonitor.monitor(this._elementRef.nativeElement).subscribe(c=>{this.autofilled=c.isAutofilled,this.stateChanges.next()})}ngOnChanges(){this.stateChanges.next()}ngOnDestroy(){this.stateChanges.complete(),this._platform.isBrowser&&this._autofillMonitor.stopMonitoring(this._elementRef.nativeElement),this._platform.IOS&&this._elementRef.nativeElement.removeEventListener("keyup",this._iOSKeyupListener)}ngDoCheck(){this.ngControl&&(this.updateErrorState(),this.ngControl.disabled!==null&&this.ngControl.disabled!==this.disabled&&(this.disabled=this.ngControl.disabled,this.stateChanges.next())),this._dirtyCheckNativeValue(),this._dirtyCheckPlaceholder()}focus(c){this._elementRef.nativeElement.focus(c)}updateErrorState(){this._errorStateTracker.updateErrorState()}_focusChanged(c){c!==this.focused&&(this.focused=c,this.stateChanges.next())}_onInput(){}_dirtyCheckNativeValue(){let c=this._elementRef.nativeElement.value;this._previousNativeValue!==c&&(this._previousNativeValue=c,this.stateChanges.next())}_dirtyCheckPlaceholder(){let c=this._getPlaceholder();if(c!==this._previousPlaceholder){let m=this._elementRef.nativeElement;this._previousPlaceholder=c,c?m.setAttribute("placeholder",c):m.removeAttribute("placeholder")}}_getPlaceholder(){return this.placeholder||null}_validateType(){kG.indexOf(this._type)>-1}_isNeverEmpty(){return this._neverEmptyInputTypes.indexOf(this._type)>-1}_isBadInput(){let c=this._elementRef.nativeElement.validity;return c&&c.badInput}get empty(){return!this._isNeverEmpty()&&!this._elementRef.nativeElement.value&&!this._isBadInput()&&!this.autofilled}get shouldLabelFloat(){if(this._isNativeSelect){let c=this._elementRef.nativeElement,m=c.options[0];return this.focused||c.multiple||!this.empty||!!(c.selectedIndex>-1&&m&&m.label)}else return this.focused||!this.empty}setDescribedByIds(c){c.length?this._elementRef.nativeElement.setAttribute("aria-describedby",c.join(" ")):this._elementRef.nativeElement.removeAttribute("aria-describedby")}onContainerClick(){this.focused||this.focus()}_isInlineSelect(){let c=this._elementRef.nativeElement;return this._isNativeSelect&&(c.multiple||c.size>1)}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Ai),Tt(ld,10),Tt(VT,8),Tt(UT,8),Tt(Ak),Tt(RG,10),Tt(kR),Tt(Wt),Tt(JT,8))},i.\u0275dir=ui({type:i,selectors:[["input","matInput",""],["textarea","matInput",""],["select","matNativeControl",""],["input","matNativeControl",""],["textarea","matNativeControl",""]],hostAttrs:[1,"mat-mdc-input-element"],hostVars:18,hostBindings:function(m,r){m&1&&Zr("focus",function(){return r._focusChanged(!0)})("blur",function(){return r._focusChanged(!1)})("input",function(){return r._onInput()}),m&2&&(lf("id",r.id)("disabled",r.disabled)("required",r.required),Mr("name",r.name||null)("readonly",r.readonly&&!r._isNativeSelect||null)("aria-invalid",r.empty&&r.required?null:r.errorState)("aria-required",r.required)("id",r.id),wr("mat-input-server",r._isServer)("mat-mdc-form-field-textarea-control",r._isInFormField&&r._isTextarea)("mat-mdc-form-field-input-control",r._isInFormField)("mdc-text-field__input",r._isInFormField)("mat-mdc-native-select-inline",r._isInlineSelect()))},inputs:{disabled:"disabled",id:"id",placeholder:"placeholder",name:"name",required:"required",type:"type",errorStateMatcher:"errorStateMatcher",userAriaDescribedBy:[0,"aria-describedby","userAriaDescribedBy"],value:"value",readonly:"readonly"},exportAs:["matInput"],standalone:!0,features:[Ko([{provide:KT,useExisting:i}]),Xo]});let a=i;return a})(),qk=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[ro,eD,eD,OR,ro]});let a=i;return a})();var LG=["mat-button",""],NG=[[["",8,"material-icons",3,"iconPositionEnd",""],["mat-icon",3,"iconPositionEnd",""],["","matButtonIcon","",3,"iconPositionEnd",""]],"*",[["","iconPositionEnd","",8,"material-icons"],["mat-icon","iconPositionEnd",""],["","matButtonIcon","","iconPositionEnd",""]]],zG=[".material-icons:not([iconPositionEnd]), mat-icon:not([iconPositionEnd]), [matButtonIcon]:not([iconPositionEnd])","*",".material-icons[iconPositionEnd], mat-icon[iconPositionEnd], [matButtonIcon][iconPositionEnd]"];var BG=new Pt("MAT_BUTTON_CONFIG");var VG=[{attribute:"mat-button",mdcClasses:["mdc-button","mat-mdc-button"]},{attribute:"mat-flat-button",mdcClasses:["mdc-button","mdc-button--unelevated","mat-mdc-unelevated-button"]},{attribute:"mat-raised-button",mdcClasses:["mdc-button","mdc-button--raised","mat-mdc-raised-button"]},{attribute:"mat-stroked-button",mdcClasses:["mdc-button","mdc-button--outlined","mat-mdc-outlined-button"]},{attribute:"mat-fab",mdcClasses:["mdc-fab","mat-mdc-fab"]},{attribute:"mat-mini-fab",mdcClasses:["mdc-fab","mdc-fab--mini","mat-mdc-mini-fab"]},{attribute:"mat-icon-button",mdcClasses:["mdc-icon-button","mat-mdc-icon-button"]}],jG=(()=>{let i=class i{get ripple(){return this._rippleLoader?.getRipple(this._elementRef.nativeElement)}set ripple(c){this._rippleLoader?.attachRipple(this._elementRef.nativeElement,c)}get disableRipple(){return this._disableRipple}set disableRipple(c){this._disableRipple=c,this._updateRippleDisabled()}get disabled(){return this._disabled}set disabled(c){this._disabled=c,this._updateRippleDisabled()}constructor(c,m,r,T){this._elementRef=c,this._platform=m,this._ngZone=r,this._animationMode=T,this._focusMonitor=Ot(yk),this._rippleLoader=Ot(kk),this._isFab=!1,this._disableRipple=!1,this._disabled=!1;let M=Ot(BG,{optional:!0}),F=c.nativeElement,$=F.classList;this.disabledInteractive=M?.disabledInteractive??!1,this._rippleLoader?.configureRipple(F,{className:"mat-mdc-button-ripple"});for(let{attribute:Q,mdcClasses:ue}of VG)F.hasAttribute(Q)&&$.add(...ue)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef),this._rippleLoader?.destroyRipple(this._elementRef.nativeElement)}focus(c="program",m){c?this._focusMonitor.focusVia(this._elementRef.nativeElement,c,m):this._elementRef.nativeElement.focus(m)}_getAriaDisabled(){return this.ariaDisabled!=null?this.ariaDisabled:this.disabled&&this.disabledInteractive?!0:null}_getDisabledAttribute(){return this.disabledInteractive||!this.disabled?null:!0}_updateRippleDisabled(){this._rippleLoader?.setDisabled(this._elementRef.nativeElement,this.disableRipple||this.disabled)}};i.\u0275fac=function(m){b2()},i.\u0275dir=ui({type:i,inputs:{color:"color",disableRipple:[2,"disableRipple","disableRipple",Xs],disabled:[2,"disabled","disabled",Xs],ariaDisabled:[2,"aria-disabled","ariaDisabled",Xs],disabledInteractive:[2,"disabledInteractive","disabledInteractive",Xs]},features:[Ys]});let a=i;return a})();var ob=(()=>{let i=class i extends jG{constructor(c,m,r,T){super(c,m,r,T)}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Ai),Tt(Wt),Tt(Lo,8))},i.\u0275cmp=zr({type:i,selectors:[["button","mat-button",""],["button","mat-raised-button",""],["button","mat-flat-button",""],["button","mat-stroked-button",""]],hostVars:14,hostBindings:function(m,r){m&2&&(Mr("disabled",r._getDisabledAttribute())("aria-disabled",r._getAriaDisabled()),n0(r.color?"mat-"+r.color:""),wr("mat-mdc-button-disabled",r.disabled)("mat-mdc-button-disabled-interactive",r.disabledInteractive)("_mat-animation-noopable",r._animationMode==="NoopAnimations")("mat-unthemed",!r.color)("mat-mdc-button-base",!0))},exportAs:["matButton"],standalone:!0,features:[yo,vs],attrs:LG,ngContentSelectors:zG,decls:7,vars:4,consts:[[1,"mat-mdc-button-persistent-ripple"],[1,"mdc-button__label"],[1,"mat-mdc-focus-indicator"],[1,"mat-mdc-button-touch-target"]],template:function(m,r){m&1&&(Ku(NG),or(0,"span",0),Qr(1),Hn(2,"span",1),Qr(3,1),qn(),Qr(4,2),or(5,"span",2)(6,"span",3)),m&2&&wr("mdc-button__ripple",!r._isFab)("mdc-fab__ripple",r._isFab)},styles:['.mdc-touch-target-wrapper{display:inline}.mdc-elevation-overlay{position:absolute;border-radius:inherit;pointer-events:none;opacity:var(--mdc-elevation-overlay-opacity, 0);transition:opacity 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button{position:relative;display:inline-flex;align-items:center;justify-content:center;box-sizing:border-box;min-width:64px;border:none;outline:none;line-height:inherit;user-select:none;-webkit-appearance:none;overflow:visible;vertical-align:middle;background:rgba(0,0,0,0)}.mdc-button .mdc-elevation-overlay{width:100%;height:100%;top:0;left:0}.mdc-button::-moz-focus-inner{padding:0;border:0}.mdc-button:active{outline:none}.mdc-button:hover{cursor:pointer}.mdc-button:disabled{cursor:default;pointer-events:none}.mdc-button[hidden]{display:none}.mdc-button .mdc-button__icon{margin-left:0;margin-right:8px;display:inline-block;position:relative;vertical-align:top}[dir=rtl] .mdc-button .mdc-button__icon,.mdc-button .mdc-button__icon[dir=rtl]{margin-left:8px;margin-right:0}.mdc-button .mdc-button__progress-indicator{font-size:0;position:absolute;transform:translate(-50%, -50%);top:50%;left:50%;line-height:initial}.mdc-button .mdc-button__label{position:relative}.mdc-button .mdc-button__focus-ring{pointer-events:none;border:2px solid rgba(0,0,0,0);border-radius:6px;box-sizing:content-box;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px);display:none}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring{border-color:CanvasText}}.mdc-button .mdc-button__focus-ring::after{content:"";border:2px solid rgba(0,0,0,0);border-radius:8px;display:block;position:absolute;top:50%;left:50%;transform:translate(-50%, -50%);height:calc(100% + 4px);width:calc(100% + 4px)}@media screen and (forced-colors: active){.mdc-button .mdc-button__focus-ring::after{border-color:CanvasText}}@media screen and (forced-colors: active){.mdc-button.mdc-ripple-upgraded--background-focused .mdc-button__focus-ring,.mdc-button:not(.mdc-ripple-upgraded):focus .mdc-button__focus-ring{display:block}}.mdc-button .mdc-button__touch{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%)}.mdc-button__label+.mdc-button__icon{margin-left:8px;margin-right:0}[dir=rtl] .mdc-button__label+.mdc-button__icon,.mdc-button__label+.mdc-button__icon[dir=rtl]{margin-left:0;margin-right:8px}svg.mdc-button__icon{fill:currentColor}.mdc-button--touch{margin-top:6px;margin-bottom:6px}.mdc-button{padding:0 8px 0 8px}.mdc-button--unelevated{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--unelevated.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--unelevated.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--raised{transition:box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);padding:0 16px 0 16px}.mdc-button--raised.mdc-button--icon-trailing{padding:0 12px 0 16px}.mdc-button--raised.mdc-button--icon-leading{padding:0 16px 0 12px}.mdc-button--outlined{border-style:solid;transition:border 280ms cubic-bezier(0.4, 0, 0.2, 1)}.mdc-button--outlined .mdc-button__ripple{border-style:solid;border-color:rgba(0,0,0,0)}.mat-mdc-button{font-family:var(--mdc-text-button-label-text-font);font-size:var(--mdc-text-button-label-text-size);letter-spacing:var(--mdc-text-button-label-text-tracking);font-weight:var(--mdc-text-button-label-text-weight);text-transform:var(--mdc-text-button-label-text-transform);height:var(--mdc-text-button-container-height);border-radius:var(--mdc-text-button-container-shape);padding:0 var(--mat-text-button-horizontal-padding, 8px)}.mat-mdc-button:not(:disabled){color:var(--mdc-text-button-label-text-color)}.mat-mdc-button:disabled{color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button .mdc-button__ripple{border-radius:var(--mdc-text-button-container-shape)}.mat-mdc-button:has(.material-icons,mat-icon,[matButtonIcon]){padding:0 var(--mat-text-button-with-icon-horizontal-padding, 8px)}.mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}[dir=rtl] .mat-mdc-button>.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}.mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-offset, 0);margin-left:var(--mat-text-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-button .mdc-button__label+.mat-icon{margin-right:var(--mat-text-button-icon-spacing, 8px);margin-left:var(--mat-text-button-icon-offset, 0)}.mat-mdc-button .mat-ripple-element{background-color:var(--mat-text-button-ripple-color)}.mat-mdc-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-state-layer-color)}.mat-mdc-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-text-button-disabled-state-layer-color)}.mat-mdc-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-hover-state-layer-opacity)}.mat-mdc-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-focus-state-layer-opacity)}.mat-mdc-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-text-button-pressed-state-layer-opacity)}.mat-mdc-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-text-button-touch-target-display)}.mat-mdc-button[disabled],.mat-mdc-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-text-button-disabled-label-text-color)}.mat-mdc-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-unelevated-button{font-family:var(--mdc-filled-button-label-text-font);font-size:var(--mdc-filled-button-label-text-size);letter-spacing:var(--mdc-filled-button-label-text-tracking);font-weight:var(--mdc-filled-button-label-text-weight);text-transform:var(--mdc-filled-button-label-text-transform);height:var(--mdc-filled-button-container-height);border-radius:var(--mdc-filled-button-container-shape);padding:0 var(--mat-filled-button-horizontal-padding, 16px)}.mat-mdc-unelevated-button:not(:disabled){background-color:var(--mdc-filled-button-container-color)}.mat-mdc-unelevated-button:disabled{background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button:not(:disabled){color:var(--mdc-filled-button-label-text-color)}.mat-mdc-unelevated-button:disabled{color:var(--mdc-filled-button-disabled-label-text-color)}.mat-mdc-unelevated-button .mdc-button__ripple{border-radius:var(--mdc-filled-button-container-shape)}.mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-unelevated-button>.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}.mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-offset, -4px);margin-left:var(--mat-filled-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-unelevated-button .mdc-button__label+.mat-icon{margin-right:var(--mat-filled-button-icon-spacing, 8px);margin-left:var(--mat-filled-button-icon-offset, -4px)}.mat-mdc-unelevated-button .mat-ripple-element{background-color:var(--mat-filled-button-ripple-color)}.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-state-layer-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-filled-button-disabled-state-layer-color)}.mat-mdc-unelevated-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-hover-state-layer-opacity)}.mat-mdc-unelevated-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-focus-state-layer-opacity)}.mat-mdc-unelevated-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-filled-button-pressed-state-layer-opacity)}.mat-mdc-unelevated-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-filled-button-touch-target-display)}.mat-mdc-unelevated-button[disabled],.mat-mdc-unelevated-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-filled-button-disabled-label-text-color);background-color:var(--mdc-filled-button-disabled-container-color)}.mat-mdc-unelevated-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-raised-button{font-family:var(--mdc-protected-button-label-text-font);font-size:var(--mdc-protected-button-label-text-size);letter-spacing:var(--mdc-protected-button-label-text-tracking);font-weight:var(--mdc-protected-button-label-text-weight);text-transform:var(--mdc-protected-button-label-text-transform);height:var(--mdc-protected-button-container-height);border-radius:var(--mdc-protected-button-container-shape);padding:0 var(--mat-protected-button-horizontal-padding, 16px);box-shadow:var(--mdc-protected-button-container-elevation-shadow)}.mat-mdc-raised-button:not(:disabled){background-color:var(--mdc-protected-button-container-color)}.mat-mdc-raised-button:disabled{background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button:not(:disabled){color:var(--mdc-protected-button-label-text-color)}.mat-mdc-raised-button:disabled{color:var(--mdc-protected-button-disabled-label-text-color)}.mat-mdc-raised-button .mdc-button__ripple{border-radius:var(--mdc-protected-button-container-shape)}.mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-raised-button>.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}.mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-offset, -4px);margin-left:var(--mat-protected-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-raised-button .mdc-button__label+.mat-icon{margin-right:var(--mat-protected-button-icon-spacing, 8px);margin-left:var(--mat-protected-button-icon-offset, -4px)}.mat-mdc-raised-button .mat-ripple-element{background-color:var(--mat-protected-button-ripple-color)}.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-state-layer-color)}.mat-mdc-raised-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-protected-button-disabled-state-layer-color)}.mat-mdc-raised-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-hover-state-layer-opacity)}.mat-mdc-raised-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-focus-state-layer-opacity)}.mat-mdc-raised-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-protected-button-pressed-state-layer-opacity)}.mat-mdc-raised-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-protected-button-touch-target-display)}.mat-mdc-raised-button:hover{box-shadow:var(--mdc-protected-button-hover-container-elevation-shadow)}.mat-mdc-raised-button:focus{box-shadow:var(--mdc-protected-button-focus-container-elevation-shadow)}.mat-mdc-raised-button:active,.mat-mdc-raised-button:focus:active{box-shadow:var(--mdc-protected-button-pressed-container-elevation-shadow)}.mat-mdc-raised-button[disabled],.mat-mdc-raised-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-protected-button-disabled-label-text-color);background-color:var(--mdc-protected-button-disabled-container-color)}.mat-mdc-raised-button[disabled].mat-mdc-button-disabled,.mat-mdc-raised-button.mat-mdc-button-disabled.mat-mdc-button-disabled{box-shadow:var(--mdc-protected-button-disabled-container-elevation-shadow)}.mat-mdc-raised-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-outlined-button{font-family:var(--mdc-outlined-button-label-text-font);font-size:var(--mdc-outlined-button-label-text-size);letter-spacing:var(--mdc-outlined-button-label-text-tracking);font-weight:var(--mdc-outlined-button-label-text-weight);text-transform:var(--mdc-outlined-button-label-text-transform);height:var(--mdc-outlined-button-container-height);border-radius:var(--mdc-outlined-button-container-shape);padding:0 15px 0 15px;border-width:var(--mdc-outlined-button-outline-width);padding:0 var(--mat-outlined-button-horizontal-padding, 15px)}.mat-mdc-outlined-button:not(:disabled){color:var(--mdc-outlined-button-label-text-color)}.mat-mdc-outlined-button:disabled{color:var(--mdc-outlined-button-disabled-label-text-color)}.mat-mdc-outlined-button .mdc-button__ripple{border-radius:var(--mdc-outlined-button-container-shape)}.mat-mdc-outlined-button:not(:disabled){border-color:var(--mdc-outlined-button-outline-color)}.mat-mdc-outlined-button:disabled{border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mdc-button--icon-trailing{padding:0 11px 0 15px}.mat-mdc-outlined-button.mdc-button--icon-leading{padding:0 15px 0 11px}.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:var(--mdc-outlined-button-outline-width)}.mat-mdc-outlined-button .mdc-button__touch{left:calc(-1 * var(--mdc-outlined-button-outline-width));width:calc(100% + 2 * var(--mdc-outlined-button-outline-width))}.mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}[dir=rtl] .mat-mdc-outlined-button>.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}.mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-offset, -4px);margin-left:var(--mat-outlined-button-icon-spacing, 8px)}[dir=rtl] .mat-mdc-outlined-button .mdc-button__label+.mat-icon{margin-right:var(--mat-outlined-button-icon-spacing, 8px);margin-left:var(--mat-outlined-button-icon-offset, -4px)}.mat-mdc-outlined-button .mat-ripple-element{background-color:var(--mat-outlined-button-ripple-color)}.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-state-layer-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled .mat-mdc-button-persistent-ripple::before{background-color:var(--mat-outlined-button-disabled-state-layer-color)}.mat-mdc-outlined-button:hover .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-hover-state-layer-opacity)}.mat-mdc-outlined-button.cdk-program-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.cdk-keyboard-focused .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive:focus .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-focus-state-layer-opacity)}.mat-mdc-outlined-button:active .mat-mdc-button-persistent-ripple::before{opacity:var(--mat-outlined-button-pressed-state-layer-opacity)}.mat-mdc-outlined-button .mat-mdc-button-touch-target{position:absolute;top:50%;height:48px;left:0;right:0;transform:translateY(-50%);display:var(--mat-outlined-button-touch-target-display)}.mat-mdc-outlined-button[disabled],.mat-mdc-outlined-button.mat-mdc-button-disabled{cursor:default;pointer-events:none;color:var(--mdc-outlined-button-disabled-label-text-color);border-color:var(--mdc-outlined-button-disabled-outline-color)}.mat-mdc-outlined-button.mat-mdc-button-disabled-interactive{pointer-events:auto}.mat-mdc-button-base{text-decoration:none}.mat-mdc-button,.mat-mdc-unelevated-button,.mat-mdc-raised-button,.mat-mdc-outlined-button{-webkit-tap-highlight-color:rgba(0,0,0,0)}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple,.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none;border-radius:inherit}.mat-mdc-button .mat-mdc-button-ripple,.mat-mdc-unelevated-button .mat-mdc-button-ripple,.mat-mdc-raised-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mat-mdc-button-ripple{overflow:hidden}.mat-mdc-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-unelevated-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-raised-button .mat-mdc-button-persistent-ripple::before,.mat-mdc-outlined-button .mat-mdc-button-persistent-ripple::before{content:"";opacity:0}.mat-mdc-button .mdc-button__label,.mat-mdc-button .mat-icon,.mat-mdc-unelevated-button .mdc-button__label,.mat-mdc-unelevated-button .mat-icon,.mat-mdc-raised-button .mdc-button__label,.mat-mdc-raised-button .mat-icon,.mat-mdc-outlined-button .mdc-button__label,.mat-mdc-outlined-button .mat-icon{z-index:1;position:relative}.mat-mdc-button .mat-mdc-focus-indicator,.mat-mdc-unelevated-button .mat-mdc-focus-indicator,.mat-mdc-raised-button .mat-mdc-focus-indicator,.mat-mdc-outlined-button .mat-mdc-focus-indicator{top:0;left:0;right:0;bottom:0;position:absolute}.mat-mdc-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-unelevated-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-raised-button:focus .mat-mdc-focus-indicator::before,.mat-mdc-outlined-button:focus .mat-mdc-focus-indicator::before{content:""}.mat-mdc-button._mat-animation-noopable,.mat-mdc-unelevated-button._mat-animation-noopable,.mat-mdc-raised-button._mat-animation-noopable,.mat-mdc-outlined-button._mat-animation-noopable{transition:none !important;animation:none !important}.mat-mdc-button>.mat-icon,.mat-mdc-unelevated-button>.mat-icon,.mat-mdc-raised-button>.mat-icon,.mat-mdc-outlined-button>.mat-icon{display:inline-block;position:relative;vertical-align:top;font-size:1.125rem;height:1.125rem;width:1.125rem}.mat-mdc-outlined-button .mat-mdc-button-ripple,.mat-mdc-outlined-button .mdc-button__ripple{top:-1px;left:-1px;bottom:-1px;right:-1px;border-width:-1px}.mat-mdc-unelevated-button .mat-mdc-focus-indicator::before,.mat-mdc-raised-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 2px)*-1)}.mat-mdc-outlined-button .mat-mdc-focus-indicator::before{margin:calc(calc(var(--mat-mdc-focus-indicator-border-width, 3px) + 3px)*-1)}',".cdk-high-contrast-active .mat-mdc-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-unelevated-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-raised-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-outlined-button:not(.mdc-button--outlined),.cdk-high-contrast-active .mat-mdc-icon-button{outline:solid 1px}"],encapsulation:2,changeDetection:0});let a=i;return a})();var sb=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[ro,Rk,ro]});let a=i;return a})();var GG=["determinateSpinner"];function $G(a,i){if(a&1&&(Kw(),Hn(0,"svg",11),or(1,"circle",12),qn()),a&2){let d=vo();Mr("viewBox",d._viewBox()),di(),Xu("stroke-dasharray",d._strokeCircumference(),"px")("stroke-dashoffset",d._strokeCircumference()/2,"px")("stroke-width",d._circleStrokeWidth(),"%"),Mr("r",d._circleRadius())}}var HG=new Pt("mat-progress-spinner-default-options",{providedIn:"root",factory:qG});function qG(){return{diameter:Wk}}var Wk=100,WG=10,Zk=(()=>{let i=class i{get color(){return this._color||this._defaultColor}set color(c){this._color=c}constructor(c,m,r){this._elementRef=c,this._defaultColor="primary",this._value=0,this._diameter=Wk,this._noopAnimations=m==="NoopAnimations"&&!!r&&!r._forceAnimations,this.mode=c.nativeElement.nodeName.toLowerCase()==="mat-spinner"?"indeterminate":"determinate",r&&(r.color&&(this.color=this._defaultColor=r.color),r.diameter&&(this.diameter=r.diameter),r.strokeWidth&&(this.strokeWidth=r.strokeWidth))}get value(){return this.mode==="determinate"?this._value:0}set value(c){this._value=Math.max(0,Math.min(100,c||0))}get diameter(){return this._diameter}set diameter(c){this._diameter=c||0}get strokeWidth(){return this._strokeWidth??this.diameter/10}set strokeWidth(c){this._strokeWidth=c||0}_circleRadius(){return(this.diameter-WG)/2}_viewBox(){let c=this._circleRadius()*2+this.strokeWidth;return`0 0 ${c} ${c}`}_strokeCircumference(){return 2*Math.PI*this._circleRadius()}_strokeDashOffset(){return this.mode==="determinate"?this._strokeCircumference()*(100-this._value)/100:null}_circleStrokeWidth(){return this.strokeWidth/this.diameter*100}};i.\u0275fac=function(m){return new(m||i)(Tt(ti),Tt(Lo,8),Tt(HG))},i.\u0275cmp=zr({type:i,selectors:[["mat-progress-spinner"],["mat-spinner"]],viewQuery:function(m,r){if(m&1&&bo(GG,5),m&2){let T;dr(T=hr())&&(r._determinateCircle=T.first)}},hostAttrs:["role","progressbar","tabindex","-1",1,"mat-mdc-progress-spinner","mdc-circular-progress"],hostVars:18,hostBindings:function(m,r){m&2&&(Mr("aria-valuemin",0)("aria-valuemax",100)("aria-valuenow",r.mode==="determinate"?r.value:null)("mode",r.mode),n0("mat-"+r.color),Xu("width",r.diameter,"px")("height",r.diameter,"px")("--mdc-circular-progress-size",r.diameter+"px")("--mdc-circular-progress-active-indicator-width",r.diameter+"px"),wr("_mat-animation-noopable",r._noopAnimations)("mdc-circular-progress--indeterminate",r.mode==="indeterminate"))},inputs:{color:"color",mode:"mode",value:[2,"value","value",uf],diameter:[2,"diameter","diameter",uf],strokeWidth:[2,"strokeWidth","strokeWidth",uf]},exportAs:["matProgressSpinner"],standalone:!0,features:[Ys,vs],decls:14,vars:11,consts:[["circle",""],["determinateSpinner",""],["aria-hidden","true",1,"mdc-circular-progress__determinate-container"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__determinate-circle-graphic"],["cx","50%","cy","50%",1,"mdc-circular-progress__determinate-circle"],["aria-hidden","true",1,"mdc-circular-progress__indeterminate-container"],[1,"mdc-circular-progress__spinner-layer"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-left"],[3,"ngTemplateOutlet"],[1,"mdc-circular-progress__gap-patch"],[1,"mdc-circular-progress__circle-clipper","mdc-circular-progress__circle-right"],["xmlns","http://www.w3.org/2000/svg","focusable","false",1,"mdc-circular-progress__indeterminate-circle-graphic"],["cx","50%","cy","50%"]],template:function(m,r){if(m&1&&(rr(0,$G,2,8,"ng-template",null,0,r0),Hn(2,"div",2,1),Kw(),Hn(4,"svg",3),or(5,"circle",4),qn()(),jA(),Hn(6,"div",5)(7,"div",6)(8,"div",7),Sm(9,8),qn(),Hn(10,"div",9),Sm(11,8),qn(),Hn(12,"div",10),Sm(13,8),qn()()()),m&2){let T=Mm(1);di(4),Mr("viewBox",r._viewBox()),di(),Xu("stroke-dasharray",r._strokeCircumference(),"px")("stroke-dashoffset",r._strokeDashOffset(),"px")("stroke-width",r._circleStrokeWidth(),"%"),Mr("r",r._circleRadius()),di(4),qr("ngTemplateOutlet",T),di(2),qr("ngTemplateOutlet",T),di(2),qr("ngTemplateOutlet",T)}},dependencies:[u0],styles:["@keyframes mdc-circular-progress-container-rotate{to{transform:rotate(360deg)}}@keyframes mdc-circular-progress-spinner-layer-rotate{12.5%{transform:rotate(135deg)}25%{transform:rotate(270deg)}37.5%{transform:rotate(405deg)}50%{transform:rotate(540deg)}62.5%{transform:rotate(675deg)}75%{transform:rotate(810deg)}87.5%{transform:rotate(945deg)}100%{transform:rotate(1080deg)}}@keyframes mdc-circular-progress-color-1-fade-in-out{from{opacity:.99}25%{opacity:.99}26%{opacity:0}89%{opacity:0}90%{opacity:.99}to{opacity:.99}}@keyframes mdc-circular-progress-color-2-fade-in-out{from{opacity:0}15%{opacity:0}25%{opacity:.99}50%{opacity:.99}51%{opacity:0}to{opacity:0}}@keyframes mdc-circular-progress-color-3-fade-in-out{from{opacity:0}40%{opacity:0}50%{opacity:.99}75%{opacity:.99}76%{opacity:0}to{opacity:0}}@keyframes mdc-circular-progress-color-4-fade-in-out{from{opacity:0}65%{opacity:0}75%{opacity:.99}90%{opacity:.99}to{opacity:0}}@keyframes mdc-circular-progress-left-spin{from{transform:rotate(265deg)}50%{transform:rotate(130deg)}to{transform:rotate(265deg)}}@keyframes mdc-circular-progress-right-spin{from{transform:rotate(-265deg)}50%{transform:rotate(-130deg)}to{transform:rotate(-265deg)}}.mdc-circular-progress{display:inline-flex;position:relative;direction:ltr;line-height:0;transition:opacity 250ms 0ms cubic-bezier(0.4, 0, 0.6, 1)}.mdc-circular-progress__determinate-container,.mdc-circular-progress__indeterminate-circle-graphic,.mdc-circular-progress__indeterminate-container,.mdc-circular-progress__spinner-layer{position:absolute;width:100%;height:100%}.mdc-circular-progress__determinate-container{transform:rotate(-90deg)}.mdc-circular-progress__indeterminate-container{font-size:0;letter-spacing:0;white-space:nowrap;opacity:0}.mdc-circular-progress__determinate-circle-graphic,.mdc-circular-progress__indeterminate-circle-graphic{fill:rgba(0,0,0,0)}.mdc-circular-progress__determinate-circle{transition:stroke-dashoffset 500ms 0ms cubic-bezier(0, 0, 0.2, 1)}.mdc-circular-progress__gap-patch{position:absolute;top:0;left:47.5%;box-sizing:border-box;width:5%;height:100%;overflow:hidden}.mdc-circular-progress__gap-patch .mdc-circular-progress__indeterminate-circle-graphic{left:-900%;width:2000%;transform:rotate(180deg)}.mdc-circular-progress__circle-clipper{display:inline-flex;position:relative;width:50%;height:100%;overflow:hidden}.mdc-circular-progress__circle-clipper .mdc-circular-progress__indeterminate-circle-graphic{width:200%}.mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{left:-100%}.mdc-circular-progress--indeterminate .mdc-circular-progress__determinate-container{opacity:0}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{opacity:1}.mdc-circular-progress--indeterminate .mdc-circular-progress__indeterminate-container{animation:mdc-circular-progress-container-rotate 1568.2352941176ms linear infinite}.mdc-circular-progress--indeterminate .mdc-circular-progress__spinner-layer{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-1{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-1-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-2{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-2-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-3{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-3-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__color-4{animation:mdc-circular-progress-spinner-layer-rotate 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both,mdc-circular-progress-color-4-fade-in-out 5332ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-left .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-left-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--indeterminate .mdc-circular-progress__circle-right .mdc-circular-progress__indeterminate-circle-graphic{animation:mdc-circular-progress-right-spin 1333ms cubic-bezier(0.4, 0, 0.2, 1) infinite both}.mdc-circular-progress--closed{opacity:0}.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:var(--mdc-circular-progress-active-indicator-color)}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle,.mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mat-mdc-progress-spinner circle{stroke-width:var(--mdc-circular-progress-active-indicator-width)}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-1 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-2 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-3 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}@media screen and (forced-colors: active),(-ms-high-contrast: active){.mat-mdc-progress-spinner .mdc-circular-progress--four-color .mdc-circular-progress__color-4 .mdc-circular-progress__indeterminate-circle-graphic{stroke:CanvasText}}.mat-mdc-progress-spinner .mdc-circular-progress{width:var(--mdc-circular-progress-size) !important;height:var(--mdc-circular-progress-size) !important}.mat-mdc-progress-spinner{display:block;overflow:hidden;line-height:0}.mat-mdc-progress-spinner._mat-animation-noopable,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__determinate-circle{transition:none}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-circle-graphic,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__spinner-layer,.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container{animation:none}.mat-mdc-progress-spinner._mat-animation-noopable .mdc-circular-progress__indeterminate-container circle{stroke-dasharray:0 !important}.cdk-high-contrast-active .mat-mdc-progress-spinner .mdc-circular-progress__indeterminate-circle-graphic,.cdk-high-contrast-active .mat-mdc-progress-spinner .mdc-circular-progress__determinate-circle{stroke:currentColor;stroke:CanvasText}"],encapsulation:2,changeDetection:0});let a=i;return a})();var Qk=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[hf,ro]});let a=i;return a})();var ig=class{attach(i){return this._attachedHost=i,i.attach(this)}detach(){let i=this._attachedHost;i!=null&&(this._attachedHost=null,i.detach())}get isAttached(){return this._attachedHost!=null}setAttachedHost(i){this._attachedHost=i}},xf=class extends ig{constructor(i,d,c,m,r){super(),this.component=i,this.viewContainerRef=d,this.injector=c,this.componentFactoryResolver=m,this.projectableNodes=r}},wf=class extends ig{constructor(i,d,c,m){super(),this.templateRef=i,this.viewContainerRef=d,this.context=c,this.injector=m}get origin(){return this.templateRef.elementRef}attach(i,d=this.context){return this.context=d,super.attach(i)}detach(){return this.context=void 0,super.detach()}},tD=class extends ig{constructor(i){super(),this.element=i instanceof ti?i.nativeElement:i}},Ef=class{constructor(){this._isDisposed=!1,this.attachDomPortal=null}hasAttached(){return!!this._attachedPortal}attach(i){if(i instanceof xf)return this._attachedPortal=i,this.attachComponentPortal(i);if(i instanceof wf)return this._attachedPortal=i,this.attachTemplatePortal(i);if(this.attachDomPortal&&i instanceof tD)return this._attachedPortal=i,this.attachDomPortal(i)}detach(){this._attachedPortal&&(this._attachedPortal.setAttachedHost(null),this._attachedPortal=null),this._invokeDisposeFn()}dispose(){this.hasAttached()&&this.detach(),this._invokeDisposeFn(),this._isDisposed=!0}setDisposeFn(i){this._disposeFn=i}_invokeDisposeFn(){this._disposeFn&&(this._disposeFn(),this._disposeFn=null)}};var ab=class extends Ef{constructor(i,d,c,m,r){super(),this.outletElement=i,this._componentFactoryResolver=d,this._appRef=c,this._defaultInjector=m,this.attachDomPortal=T=>{this._document;let M=T.element;M.parentNode;let F=this._document.createComment("dom-portal");M.parentNode.insertBefore(F,M),this.outletElement.appendChild(M),this._attachedPortal=T,super.setDisposeFn(()=>{F.parentNode&&F.parentNode.replaceChild(M,F)})},this._document=r}attachComponentPortal(i){let c=(i.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(i.component),m;return i.viewContainerRef?(m=i.viewContainerRef.createComponent(c,i.viewContainerRef.length,i.injector||i.viewContainerRef.injector,i.projectableNodes||void 0),this.setDisposeFn(()=>m.destroy())):(m=c.create(i.injector||this._defaultInjector||nr.NULL),this._appRef.attachView(m.hostView),this.setDisposeFn(()=>{this._appRef.viewCount>0&&this._appRef.detachView(m.hostView),m.destroy()})),this.outletElement.appendChild(this._getComponentRootNode(m)),this._attachedPortal=i,m}attachTemplatePortal(i){let d=i.viewContainerRef,c=d.createEmbeddedView(i.templateRef,i.context,{injector:i.injector});return c.rootNodes.forEach(m=>this.outletElement.appendChild(m)),c.detectChanges(),this.setDisposeFn(()=>{let m=d.indexOf(c);m!==-1&&d.remove(m)}),this._attachedPortal=i,c}dispose(){super.dispose(),this.outletElement.remove()}_getComponentRootNode(i){return i.hostView.rootNodes[0]}};var nD=(()=>{let i=class i extends Ef{constructor(c,m,r){super(),this._componentFactoryResolver=c,this._viewContainerRef=m,this._isInitialized=!1,this.attached=new Ui,this.attachDomPortal=T=>{this._document;let M=T.element;M.parentNode;let F=this._document.createComment("dom-portal");T.setAttachedHost(this),M.parentNode.insertBefore(F,M),this._getRootNode().appendChild(M),this._attachedPortal=T,super.setDisposeFn(()=>{F.parentNode&&F.parentNode.replaceChild(M,F)})},this._document=r}get portal(){return this._attachedPortal}set portal(c){this.hasAttached()&&!c&&!this._isInitialized||(this.hasAttached()&&super.detach(),c&&super.attach(c),this._attachedPortal=c||null)}get attachedRef(){return this._attachedRef}ngOnInit(){this._isInitialized=!0}ngOnDestroy(){super.dispose(),this._attachedRef=this._attachedPortal=null}attachComponentPortal(c){c.setAttachedHost(this);let m=c.viewContainerRef!=null?c.viewContainerRef:this._viewContainerRef,T=(c.componentFactoryResolver||this._componentFactoryResolver).resolveComponentFactory(c.component),M=m.createComponent(T,m.length,c.injector||m.injector,c.projectableNodes||void 0);return m!==this._viewContainerRef&&this._getRootNode().appendChild(M.hostView.rootNodes[0]),super.setDisposeFn(()=>M.destroy()),this._attachedPortal=c,this._attachedRef=M,this.attached.emit(M),M}attachTemplatePortal(c){c.setAttachedHost(this);let m=this._viewContainerRef.createEmbeddedView(c.templateRef,c.context,{injector:c.injector});return super.setDisposeFn(()=>this._viewContainerRef.clear()),this._attachedPortal=c,this._attachedRef=m,this.attached.emit(m),m}_getRootNode(){let c=this._viewContainerRef.element.nativeElement;return c.nodeType===c.ELEMENT_NODE?c:c.parentNode}};i.\u0275fac=function(m){return new(m||i)(Tt(ba),Tt(wa),Tt(jn))},i.\u0275dir=ui({type:i,selectors:[["","cdkPortalOutlet",""]],inputs:{portal:[0,"cdkPortalOutlet","portal"]},outputs:{attached:"attached"},exportAs:["cdkPortalOutlet"],standalone:!0,features:[yo]});let a=i;return a})();var lb=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})();var QG=20,Xk=(()=>{let i=class i{constructor(c,m,r){this._ngZone=c,this._platform=m,this._scrolled=new Tn,this._globalSubscription=null,this._scrolledCount=0,this.scrollContainers=new Map,this._document=r}register(c){this.scrollContainers.has(c)||this.scrollContainers.set(c,c.elementScrolled().subscribe(()=>this._scrolled.next(c)))}deregister(c){let m=this.scrollContainers.get(c);m&&(m.unsubscribe(),this.scrollContainers.delete(c))}scrolled(c=QG){return this._platform.isBrowser?new oi(m=>{this._globalSubscription||this._addGlobalListener();let r=c>0?this._scrolled.pipe(Uy(c)).subscribe(m):this._scrolled.subscribe(m);return this._scrolledCount++,()=>{r.unsubscribe(),this._scrolledCount--,this._scrolledCount||this._removeGlobalListener()}}):ic()}ngOnDestroy(){this._removeGlobalListener(),this.scrollContainers.forEach((c,m)=>this.deregister(m)),this._scrolled.complete()}ancestorScrolled(c,m){let r=this.getAncestorScrollContainers(c);return this.scrolled(m).pipe(hs(T=>!T||r.indexOf(T)>-1))}getAncestorScrollContainers(c){let m=[];return this.scrollContainers.forEach((r,T)=>{this._scrollableContainsElement(T,c)&&m.push(T)}),m}_getWindow(){return this._document.defaultView||window}_scrollableContainsElement(c,m){let r=xs(m),T=c.getElementRef().nativeElement;do if(r==T)return!0;while(r=r.parentElement);return!1}_addGlobalListener(){this._globalSubscription=this._ngZone.runOutsideAngular(()=>{let c=this._getWindow();return Uh(c.document,"scroll").subscribe(()=>this._scrolled.next())})}_removeGlobalListener(){this._globalSubscription&&(this._globalSubscription.unsubscribe(),this._globalSubscription=null)}};i.\u0275fac=function(m){return new(m||i)(Ze(Wt),Ze(Ai),Ze(jn,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var YG=20,iD=(()=>{let i=class i{constructor(c,m,r){this._platform=c,this._change=new Tn,this._changeListener=T=>{this._change.next(T)},this._document=r,m.runOutsideAngular(()=>{if(c.isBrowser){let T=this._getWindow();T.addEventListener("resize",this._changeListener),T.addEventListener("orientationchange",this._changeListener)}this.change().subscribe(()=>this._viewportSize=null)})}ngOnDestroy(){if(this._platform.isBrowser){let c=this._getWindow();c.removeEventListener("resize",this._changeListener),c.removeEventListener("orientationchange",this._changeListener)}this._change.complete()}getViewportSize(){this._viewportSize||this._updateViewportSize();let c={width:this._viewportSize.width,height:this._viewportSize.height};return this._platform.isBrowser||(this._viewportSize=null),c}getViewportRect(){let c=this.getViewportScrollPosition(),{width:m,height:r}=this.getViewportSize();return{top:c.top,left:c.left,bottom:c.top+r,right:c.left+m,height:r,width:m}}getViewportScrollPosition(){if(!this._platform.isBrowser)return{top:0,left:0};let c=this._document,m=this._getWindow(),r=c.documentElement,T=r.getBoundingClientRect(),M=-T.top||c.body.scrollTop||m.scrollY||r.scrollTop||0,F=-T.left||c.body.scrollLeft||m.scrollX||r.scrollLeft||0;return{top:M,left:F}}change(c=YG){return c>0?this._change.pipe(Uy(c)):this._change}_getWindow(){return this._document.defaultView||window}_updateViewportSize(){let c=this._getWindow();this._viewportSize=this._platform.isBrowser?{width:c.innerWidth,height:c.innerHeight}:{width:0,height:0}}};i.\u0275fac=function(m){return new(m||i)(Ze(Ai),Ze(Wt),Ze(jn,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var Yk=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({});let a=i;return a})(),rD=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({imports:[wc,Yk,wc,Yk]});let a=i;return a})();var Kk=MR(),oD=class{constructor(i,d){this._viewportRuler=i,this._previousHTMLStyles={top:"",left:""},this._isEnabled=!1,this._document=d}attach(){}enable(){if(this._canBeEnabled()){let i=this._document.documentElement;this._previousScrollPosition=this._viewportRuler.getViewportScrollPosition(),this._previousHTMLStyles.left=i.style.left||"",this._previousHTMLStyles.top=i.style.top||"",i.style.left=gr(-this._previousScrollPosition.left),i.style.top=gr(-this._previousScrollPosition.top),i.classList.add("cdk-global-scrollblock"),this._isEnabled=!0}}disable(){if(this._isEnabled){let i=this._document.documentElement,d=this._document.body,c=i.style,m=d.style,r=c.scrollBehavior||"",T=m.scrollBehavior||"";this._isEnabled=!1,c.left=this._previousHTMLStyles.left,c.top=this._previousHTMLStyles.top,i.classList.remove("cdk-global-scrollblock"),Kk&&(c.scrollBehavior=m.scrollBehavior="auto"),window.scroll(this._previousScrollPosition.left,this._previousScrollPosition.top),Kk&&(c.scrollBehavior=r,m.scrollBehavior=T)}}_canBeEnabled(){if(this._document.documentElement.classList.contains("cdk-global-scrollblock")||this._isEnabled)return!1;let d=this._document.body,c=this._viewportRuler.getViewportSize();return d.scrollHeight>c.height||d.scrollWidth>c.width}};var sD=class{constructor(i,d,c,m){this._scrollDispatcher=i,this._ngZone=d,this._viewportRuler=c,this._config=m,this._scrollSubscription=null,this._detach=()=>{this.disable(),this._overlayRef.hasAttached()&&this._ngZone.run(()=>this._overlayRef.detach())}}attach(i){this._overlayRef,this._overlayRef=i}enable(){if(this._scrollSubscription)return;let i=this._scrollDispatcher.scrolled(0).pipe(hs(d=>!d||!this._overlayRef.overlayElement.contains(d.getElementRef().nativeElement)));this._config&&this._config.threshold&&this._config.threshold>1?(this._initialScrollPosition=this._viewportRuler.getViewportScrollPosition().top,this._scrollSubscription=i.subscribe(()=>{let d=this._viewportRuler.getViewportScrollPosition().top;Math.abs(d-this._initialScrollPosition)>this._config.threshold?this._detach():this._overlayRef.updatePosition()})):this._scrollSubscription=i.subscribe(this._detach)}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},cb=class{enable(){}disable(){}attach(){}};function aD(a,i){return i.some(d=>{let c=a.bottom<d.top,m=a.top>d.bottom,r=a.right<d.left,T=a.left>d.right;return c||m||r||T})}function Jk(a,i){return i.some(d=>{let c=a.top<d.top,m=a.bottom>d.bottom,r=a.left<d.left,T=a.right>d.right;return c||m||r||T})}var lD=class{constructor(i,d,c,m){this._scrollDispatcher=i,this._viewportRuler=d,this._ngZone=c,this._config=m,this._scrollSubscription=null}attach(i){this._overlayRef,this._overlayRef=i}enable(){if(!this._scrollSubscription){let i=this._config?this._config.scrollThrottle:0;this._scrollSubscription=this._scrollDispatcher.scrolled(i).subscribe(()=>{if(this._overlayRef.updatePosition(),this._config&&this._config.autoClose){let d=this._overlayRef.overlayElement.getBoundingClientRect(),{width:c,height:m}=this._viewportRuler.getViewportSize();aD(d,[{width:c,height:m,bottom:m,right:c,top:0,left:0}])&&(this.disable(),this._ngZone.run(()=>this._overlayRef.detach()))}})}}disable(){this._scrollSubscription&&(this._scrollSubscription.unsubscribe(),this._scrollSubscription=null)}detach(){this.disable(),this._overlayRef=null}},KG=(()=>{let i=class i{constructor(c,m,r,T){this._scrollDispatcher=c,this._viewportRuler=m,this._ngZone=r,this.noop=()=>new cb,this.close=M=>new sD(this._scrollDispatcher,this._ngZone,this._viewportRuler,M),this.block=()=>new oD(this._viewportRuler,this._document),this.reposition=M=>new lD(this._scrollDispatcher,this._viewportRuler,this._ngZone,M),this._document=T}};i.\u0275fac=function(m){return new(m||i)(Ze(Xk),Ze(iD),Ze(Wt),Ze(jn))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),rg=class{constructor(i){if(this.scrollStrategy=new cb,this.panelClass="",this.hasBackdrop=!1,this.backdropClass="cdk-overlay-dark-backdrop",this.disposeOnNavigation=!1,i){let d=Object.keys(i);for(let c of d)i[c]!==void 0&&(this[c]=i[c])}}};var cD=class{constructor(i,d){this.connectionPair=i,this.scrollableViewProperties=d}};var oO=(()=>{let i=class i{constructor(c){this._attachedOverlays=[],this._document=c}ngOnDestroy(){this.detach()}add(c){this.remove(c),this._attachedOverlays.push(c)}remove(c){let m=this._attachedOverlays.indexOf(c);m>-1&&this._attachedOverlays.splice(m,1),this._attachedOverlays.length===0&&this.detach()}};i.\u0275fac=function(m){return new(m||i)(Ze(jn))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),JG=(()=>{let i=class i extends oO{constructor(c,m){super(c),this._ngZone=m,this._keydownListener=r=>{let T=this._attachedOverlays;for(let M=T.length-1;M>-1;M--)if(T[M]._keydownEvents.observers.length>0){let F=T[M]._keydownEvents;this._ngZone?this._ngZone.run(()=>F.next(r)):F.next(r);break}}}add(c){super.add(c),this._isAttached||(this._ngZone?this._ngZone.runOutsideAngular(()=>this._document.body.addEventListener("keydown",this._keydownListener)):this._document.body.addEventListener("keydown",this._keydownListener),this._isAttached=!0)}detach(){this._isAttached&&(this._document.body.removeEventListener("keydown",this._keydownListener),this._isAttached=!1)}};i.\u0275fac=function(m){return new(m||i)(Ze(jn),Ze(Wt,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),e$=(()=>{let i=class i extends oO{constructor(c,m,r){super(c),this._platform=m,this._ngZone=r,this._cursorStyleIsSet=!1,this._pointerDownListener=T=>{this._pointerDownEventTarget=ws(T)},this._clickListener=T=>{let M=ws(T),F=T.type==="click"&&this._pointerDownEventTarget?this._pointerDownEventTarget:M;this._pointerDownEventTarget=null;let $=this._attachedOverlays.slice();for(let Q=$.length-1;Q>-1;Q--){let ue=$[Q];if(ue._outsidePointerEvents.observers.length<1||!ue.hasAttached())continue;if(eO(ue.overlayElement,M)||eO(ue.overlayElement,F))break;let Ae=ue._outsidePointerEvents;this._ngZone?this._ngZone.run(()=>Ae.next(T)):Ae.next(T)}}}add(c){if(super.add(c),!this._isAttached){let m=this._document.body;this._ngZone?this._ngZone.runOutsideAngular(()=>this._addEventListeners(m)):this._addEventListeners(m),this._platform.IOS&&!this._cursorStyleIsSet&&(this._cursorOriginalValue=m.style.cursor,m.style.cursor="pointer",this._cursorStyleIsSet=!0),this._isAttached=!0}}detach(){if(this._isAttached){let c=this._document.body;c.removeEventListener("pointerdown",this._pointerDownListener,!0),c.removeEventListener("click",this._clickListener,!0),c.removeEventListener("auxclick",this._clickListener,!0),c.removeEventListener("contextmenu",this._clickListener,!0),this._platform.IOS&&this._cursorStyleIsSet&&(c.style.cursor=this._cursorOriginalValue,this._cursorStyleIsSet=!1),this._isAttached=!1}}_addEventListeners(c){c.addEventListener("pointerdown",this._pointerDownListener,!0),c.addEventListener("click",this._clickListener,!0),c.addEventListener("auxclick",this._clickListener,!0),c.addEventListener("contextmenu",this._clickListener,!0)}};i.\u0275fac=function(m){return new(m||i)(Ze(jn),Ze(Ai),Ze(Wt,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();function eO(a,i){let d=typeof ShadowRoot<"u"&&ShadowRoot,c=i;for(;c;){if(c===a)return!0;c=d&&c instanceof ShadowRoot?c.host:c.parentNode}return!1}var sO=(()=>{let i=class i{constructor(c,m){this._platform=m,this._document=c}ngOnDestroy(){this._containerElement?.remove()}getContainerElement(){return this._containerElement||this._createContainer(),this._containerElement}_createContainer(){let c="cdk-overlay-container";if(this._platform.isBrowser||Ym()){let r=this._document.querySelectorAll(`.${c}[platform="server"], .${c}[platform="test"]`);for(let T=0;T<r.length;T++)r[T].remove()}let m=this._document.createElement("div");m.classList.add(c),Ym()?m.setAttribute("platform","test"):this._platform.isBrowser||m.setAttribute("platform","server"),this._document.body.appendChild(m),this._containerElement=m}};i.\u0275fac=function(m){return new(m||i)(Ze(jn),Ze(Ai))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),uD=class{constructor(i,d,c,m,r,T,M,F,$,Q=!1,ue){this._portalOutlet=i,this._host=d,this._pane=c,this._config=m,this._ngZone=r,this._keyboardDispatcher=T,this._document=M,this._location=F,this._outsideClickDispatcher=$,this._animationsDisabled=Q,this._injector=ue,this._backdropElement=null,this._backdropClick=new Tn,this._attachments=new Tn,this._detachments=new Tn,this._locationChanges=Ki.EMPTY,this._backdropClickHandler=Ae=>this._backdropClick.next(Ae),this._backdropTransitionendHandler=Ae=>{this._disposeBackdrop(Ae.target)},this._keydownEvents=new Tn,this._outsidePointerEvents=new Tn,this._renders=new Tn,m.scrollStrategy&&(this._scrollStrategy=m.scrollStrategy,this._scrollStrategy.attach(this)),this._positionStrategy=m.positionStrategy,this._afterRenderRef=ME(()=>Cm(()=>{this._renders.next()},{injector:this._injector}))}get overlayElement(){return this._pane}get backdropElement(){return this._backdropElement}get hostElement(){return this._host}attach(i){!this._host.parentElement&&this._previousHostParent&&this._previousHostParent.appendChild(this._host);let d=this._portalOutlet.attach(i);return this._positionStrategy&&this._positionStrategy.attach(this),this._updateStackingOrder(),this._updateElementSize(),this._updateElementDirection(),this._scrollStrategy&&this._scrollStrategy.enable(),e0(()=>{this.hasAttached()&&this.updatePosition()},{injector:this._injector}),this._togglePointerEvents(!0),this._config.hasBackdrop&&this._attachBackdrop(),this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!0),this._attachments.next(),this._keyboardDispatcher.add(this),this._config.disposeOnNavigation&&(this._locationChanges=this._location.subscribe(()=>this.dispose())),this._outsideClickDispatcher.add(this),typeof d?.onDestroy=="function"&&d.onDestroy(()=>{this.hasAttached()&&this._ngZone.runOutsideAngular(()=>Promise.resolve().then(()=>this.detach()))}),d}detach(){if(!this.hasAttached())return;this.detachBackdrop(),this._togglePointerEvents(!1),this._positionStrategy&&this._positionStrategy.detach&&this._positionStrategy.detach(),this._scrollStrategy&&this._scrollStrategy.disable();let i=this._portalOutlet.detach();return this._detachments.next(),this._keyboardDispatcher.remove(this),this._detachContentWhenEmpty(),this._locationChanges.unsubscribe(),this._outsideClickDispatcher.remove(this),i}dispose(){let i=this.hasAttached();this._positionStrategy&&this._positionStrategy.dispose(),this._disposeScrollStrategy(),this._disposeBackdrop(this._backdropElement),this._locationChanges.unsubscribe(),this._keyboardDispatcher.remove(this),this._portalOutlet.dispose(),this._attachments.complete(),this._backdropClick.complete(),this._keydownEvents.complete(),this._outsidePointerEvents.complete(),this._outsideClickDispatcher.remove(this),this._host?.remove(),this._previousHostParent=this._pane=this._host=null,i&&this._detachments.next(),this._detachments.complete(),this._afterRenderRef.destroy(),this._renders.complete()}hasAttached(){return this._portalOutlet.hasAttached()}backdropClick(){return this._backdropClick}attachments(){return this._attachments}detachments(){return this._detachments}keydownEvents(){return this._keydownEvents}outsidePointerEvents(){return this._outsidePointerEvents}getConfig(){return this._config}updatePosition(){this._positionStrategy&&this._positionStrategy.apply()}updatePositionStrategy(i){i!==this._positionStrategy&&(this._positionStrategy&&this._positionStrategy.dispose(),this._positionStrategy=i,this.hasAttached()&&(i.attach(this),this.updatePosition()))}updateSize(i){this._config=Yt(Yt({},this._config),i),this._updateElementSize()}setDirection(i){this._config=tr(Yt({},this._config),{direction:i}),this._updateElementDirection()}addPanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!0)}removePanelClass(i){this._pane&&this._toggleClasses(this._pane,i,!1)}getDirection(){let i=this._config.direction;return i?typeof i=="string"?i:i.value:"ltr"}updateScrollStrategy(i){i!==this._scrollStrategy&&(this._disposeScrollStrategy(),this._scrollStrategy=i,this.hasAttached()&&(i.attach(this),i.enable()))}_updateElementDirection(){this._host.setAttribute("dir",this.getDirection())}_updateElementSize(){if(!this._pane)return;let i=this._pane.style;i.width=gr(this._config.width),i.height=gr(this._config.height),i.minWidth=gr(this._config.minWidth),i.minHeight=gr(this._config.minHeight),i.maxWidth=gr(this._config.maxWidth),i.maxHeight=gr(this._config.maxHeight)}_togglePointerEvents(i){this._pane.style.pointerEvents=i?"":"none"}_attachBackdrop(){let i="cdk-overlay-backdrop-showing";this._backdropElement=this._document.createElement("div"),this._backdropElement.classList.add("cdk-overlay-backdrop"),this._animationsDisabled&&this._backdropElement.classList.add("cdk-overlay-backdrop-noop-animation"),this._config.backdropClass&&this._toggleClasses(this._backdropElement,this._config.backdropClass,!0),this._host.parentElement.insertBefore(this._backdropElement,this._host),this._backdropElement.addEventListener("click",this._backdropClickHandler),!this._animationsDisabled&&typeof requestAnimationFrame<"u"?this._ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this._backdropElement&&this._backdropElement.classList.add(i)})}):this._backdropElement.classList.add(i)}_updateStackingOrder(){this._host.nextSibling&&this._host.parentNode.appendChild(this._host)}detachBackdrop(){let i=this._backdropElement;if(i){if(this._animationsDisabled){this._disposeBackdrop(i);return}i.classList.remove("cdk-overlay-backdrop-showing"),this._ngZone.runOutsideAngular(()=>{i.addEventListener("transitionend",this._backdropTransitionendHandler)}),i.style.pointerEvents="none",this._backdropTimeout=this._ngZone.runOutsideAngular(()=>setTimeout(()=>{this._disposeBackdrop(i)},500))}}_toggleClasses(i,d,c){let m=gf(d||[]).filter(r=>!!r);m.length&&(c?i.classList.add(...m):i.classList.remove(...m))}_detachContentWhenEmpty(){this._ngZone.runOutsideAngular(()=>{let i=this._renders.pipe(mo(um(this._attachments,this._detachments))).subscribe(()=>{(!this._pane||!this._host||this._pane.children.length===0)&&(this._pane&&this._config.panelClass&&this._toggleClasses(this._pane,this._config.panelClass,!1),this._host&&this._host.parentElement&&(this._previousHostParent=this._host.parentElement,this._host.remove()),i.unsubscribe())})})}_disposeScrollStrategy(){let i=this._scrollStrategy;i&&(i.disable(),i.detach&&i.detach())}_disposeBackdrop(i){i&&(i.removeEventListener("click",this._backdropClickHandler),i.removeEventListener("transitionend",this._backdropTransitionendHandler),i.remove(),this._backdropElement===i&&(this._backdropElement=null)),this._backdropTimeout&&(clearTimeout(this._backdropTimeout),this._backdropTimeout=void 0)}},tO="cdk-overlay-connected-position-bounding-box",t$=/([A-Za-z%]+)$/,dD=class{get positions(){return this._preferredPositions}constructor(i,d,c,m,r){this._viewportRuler=d,this._document=c,this._platform=m,this._overlayContainer=r,this._lastBoundingBoxSize={width:0,height:0},this._isPushed=!1,this._canPush=!0,this._growAfterOpen=!1,this._hasFlexibleDimensions=!0,this._positionLocked=!1,this._viewportMargin=0,this._scrollables=[],this._preferredPositions=[],this._positionChanges=new Tn,this._resizeSubscription=Ki.EMPTY,this._offsetX=0,this._offsetY=0,this._appliedPanelClasses=[],this.positionChanges=this._positionChanges,this.setOrigin(i)}attach(i){this._overlayRef&&this._overlayRef,this._validatePositions(),i.hostElement.classList.add(tO),this._overlayRef=i,this._boundingBox=i.hostElement,this._pane=i.overlayElement,this._isDisposed=!1,this._isInitialRender=!0,this._lastPosition=null,this._resizeSubscription.unsubscribe(),this._resizeSubscription=this._viewportRuler.change().subscribe(()=>{this._isInitialRender=!0,this.apply()})}apply(){if(this._isDisposed||!this._platform.isBrowser)return;if(!this._isInitialRender&&this._positionLocked&&this._lastPosition){this.reapplyLastPosition();return}this._clearPanelClasses(),this._resetOverlayElementStyles(),this._resetBoundingBoxStyles(),this._viewportRect=this._getNarrowedViewportRect(),this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let i=this._originRect,d=this._overlayRect,c=this._viewportRect,m=this._containerRect,r=[],T;for(let M of this._preferredPositions){let F=this._getOriginPoint(i,m,M),$=this._getOverlayPoint(F,d,M),Q=this._getOverlayFit($,d,c,M);if(Q.isCompletelyWithinViewport){this._isPushed=!1,this._applyPosition(M,F);return}if(this._canFitWithFlexibleDimensions(Q,$,c)){r.push({position:M,origin:F,overlayRect:d,boundingBoxRect:this._calculateBoundingBoxRect(F,M)});continue}(!T||T.overlayFit.visibleArea<Q.visibleArea)&&(T={overlayFit:Q,overlayPoint:$,originPoint:F,position:M,overlayRect:d})}if(r.length){let M=null,F=-1;for(let $ of r){let Q=$.boundingBoxRect.width*$.boundingBoxRect.height*($.position.weight||1);Q>F&&(F=Q,M=$)}this._isPushed=!1,this._applyPosition(M.position,M.origin);return}if(this._canPush){this._isPushed=!0,this._applyPosition(T.position,T.originPoint);return}this._applyPosition(T.position,T.originPoint)}detach(){this._clearPanelClasses(),this._lastPosition=null,this._previousPushAmount=null,this._resizeSubscription.unsubscribe()}dispose(){this._isDisposed||(this._boundingBox&&dd(this._boundingBox.style,{top:"",left:"",right:"",bottom:"",height:"",width:"",alignItems:"",justifyContent:""}),this._pane&&this._resetOverlayElementStyles(),this._overlayRef&&this._overlayRef.hostElement.classList.remove(tO),this.detach(),this._positionChanges.complete(),this._overlayRef=this._boundingBox=null,this._isDisposed=!0)}reapplyLastPosition(){if(this._isDisposed||!this._platform.isBrowser)return;let i=this._lastPosition;if(i){this._originRect=this._getOriginRect(),this._overlayRect=this._pane.getBoundingClientRect(),this._viewportRect=this._getNarrowedViewportRect(),this._containerRect=this._overlayContainer.getContainerElement().getBoundingClientRect();let d=this._getOriginPoint(this._originRect,this._containerRect,i);this._applyPosition(i,d)}else this.apply()}withScrollableContainers(i){return this._scrollables=i,this}withPositions(i){return this._preferredPositions=i,i.indexOf(this._lastPosition)===-1&&(this._lastPosition=null),this._validatePositions(),this}withViewportMargin(i){return this._viewportMargin=i,this}withFlexibleDimensions(i=!0){return this._hasFlexibleDimensions=i,this}withGrowAfterOpen(i=!0){return this._growAfterOpen=i,this}withPush(i=!0){return this._canPush=i,this}withLockedPosition(i=!0){return this._positionLocked=i,this}setOrigin(i){return this._origin=i,this}withDefaultOffsetX(i){return this._offsetX=i,this}withDefaultOffsetY(i){return this._offsetY=i,this}withTransformOriginOn(i){return this._transformOriginSelector=i,this}_getOriginPoint(i,d,c){let m;if(c.originX=="center")m=i.left+i.width/2;else{let T=this._isRtl()?i.right:i.left,M=this._isRtl()?i.left:i.right;m=c.originX=="start"?T:M}d.left<0&&(m-=d.left);let r;return c.originY=="center"?r=i.top+i.height/2:r=c.originY=="top"?i.top:i.bottom,d.top<0&&(r-=d.top),{x:m,y:r}}_getOverlayPoint(i,d,c){let m;c.overlayX=="center"?m=-d.width/2:c.overlayX==="start"?m=this._isRtl()?-d.width:0:m=this._isRtl()?0:-d.width;let r;return c.overlayY=="center"?r=-d.height/2:r=c.overlayY=="top"?0:-d.height,{x:i.x+m,y:i.y+r}}_getOverlayFit(i,d,c,m){let r=iO(d),{x:T,y:M}=i,F=this._getOffset(m,"x"),$=this._getOffset(m,"y");F&&(T+=F),$&&(M+=$);let Q=0-T,ue=T+r.width-c.width,Ae=0-M,xe=M+r.height-c.height,ke=this._subtractOverflows(r.width,Q,ue),Qe=this._subtractOverflows(r.height,Ae,xe),dt=ke*Qe;return{visibleArea:dt,isCompletelyWithinViewport:r.width*r.height===dt,fitsInViewportVertically:Qe===r.height,fitsInViewportHorizontally:ke==r.width}}_canFitWithFlexibleDimensions(i,d,c){if(this._hasFlexibleDimensions){let m=c.bottom-d.y,r=c.right-d.x,T=nO(this._overlayRef.getConfig().minHeight),M=nO(this._overlayRef.getConfig().minWidth),F=i.fitsInViewportVertically||T!=null&&T<=m,$=i.fitsInViewportHorizontally||M!=null&&M<=r;return F&&$}return!1}_pushOverlayOnScreen(i,d,c){if(this._previousPushAmount&&this._positionLocked)return{x:i.x+this._previousPushAmount.x,y:i.y+this._previousPushAmount.y};let m=iO(d),r=this._viewportRect,T=Math.max(i.x+m.width-r.width,0),M=Math.max(i.y+m.height-r.height,0),F=Math.max(r.top-c.top-i.y,0),$=Math.max(r.left-c.left-i.x,0),Q=0,ue=0;return m.width<=r.width?Q=$||-T:Q=i.x<this._viewportMargin?r.left-c.left-i.x:0,m.height<=r.height?ue=F||-M:ue=i.y<this._viewportMargin?r.top-c.top-i.y:0,this._previousPushAmount={x:Q,y:ue},{x:i.x+Q,y:i.y+ue}}_applyPosition(i,d){if(this._setTransformOrigin(i),this._setOverlayElementStyles(d,i),this._setBoundingBoxStyles(d,i),i.panelClass&&this._addPanelClasses(i.panelClass),this._positionChanges.observers.length){let c=this._getScrollVisibility();if(i!==this._lastPosition||!this._lastScrollVisibility||!n$(this._lastScrollVisibility,c)){let m=new cD(i,c);this._positionChanges.next(m)}this._lastScrollVisibility=c}this._lastPosition=i,this._isInitialRender=!1}_setTransformOrigin(i){if(!this._transformOriginSelector)return;let d=this._boundingBox.querySelectorAll(this._transformOriginSelector),c,m=i.overlayY;i.overlayX==="center"?c="center":this._isRtl()?c=i.overlayX==="start"?"right":"left":c=i.overlayX==="start"?"left":"right";for(let r=0;r<d.length;r++)d[r].style.transformOrigin=`${c} ${m}`}_calculateBoundingBoxRect(i,d){let c=this._viewportRect,m=this._isRtl(),r,T,M;if(d.overlayY==="top")T=i.y,r=c.height-T+this._viewportMargin;else if(d.overlayY==="bottom")M=c.height-i.y+this._viewportMargin*2,r=c.height-M+this._viewportMargin;else{let xe=Math.min(c.bottom-i.y+c.top,i.y),ke=this._lastBoundingBoxSize.height;r=xe*2,T=i.y-xe,r>ke&&!this._isInitialRender&&!this._growAfterOpen&&(T=i.y-ke/2)}let F=d.overlayX==="start"&&!m||d.overlayX==="end"&&m,$=d.overlayX==="end"&&!m||d.overlayX==="start"&&m,Q,ue,Ae;if($)Ae=c.width-i.x+this._viewportMargin*2,Q=i.x-this._viewportMargin;else if(F)ue=i.x,Q=c.right-i.x;else{let xe=Math.min(c.right-i.x+c.left,i.x),ke=this._lastBoundingBoxSize.width;Q=xe*2,ue=i.x-xe,Q>ke&&!this._isInitialRender&&!this._growAfterOpen&&(ue=i.x-ke/2)}return{top:T,left:ue,bottom:M,right:Ae,width:Q,height:r}}_setBoundingBoxStyles(i,d){let c=this._calculateBoundingBoxRect(i,d);!this._isInitialRender&&!this._growAfterOpen&&(c.height=Math.min(c.height,this._lastBoundingBoxSize.height),c.width=Math.min(c.width,this._lastBoundingBoxSize.width));let m={};if(this._hasExactPosition())m.top=m.left="0",m.bottom=m.right=m.maxHeight=m.maxWidth="",m.width=m.height="100%";else{let r=this._overlayRef.getConfig().maxHeight,T=this._overlayRef.getConfig().maxWidth;m.height=gr(c.height),m.top=gr(c.top),m.bottom=gr(c.bottom),m.width=gr(c.width),m.left=gr(c.left),m.right=gr(c.right),d.overlayX==="center"?m.alignItems="center":m.alignItems=d.overlayX==="end"?"flex-end":"flex-start",d.overlayY==="center"?m.justifyContent="center":m.justifyContent=d.overlayY==="bottom"?"flex-end":"flex-start",r&&(m.maxHeight=gr(r)),T&&(m.maxWidth=gr(T))}this._lastBoundingBoxSize=c,dd(this._boundingBox.style,m)}_resetBoundingBoxStyles(){dd(this._boundingBox.style,{top:"0",left:"0",right:"0",bottom:"0",height:"",width:"",alignItems:"",justifyContent:""})}_resetOverlayElementStyles(){dd(this._pane.style,{top:"",left:"",bottom:"",right:"",position:"",transform:""})}_setOverlayElementStyles(i,d){let c={},m=this._hasExactPosition(),r=this._hasFlexibleDimensions,T=this._overlayRef.getConfig();if(m){let Q=this._viewportRuler.getViewportScrollPosition();dd(c,this._getExactOverlayY(d,i,Q)),dd(c,this._getExactOverlayX(d,i,Q))}else c.position="static";let M="",F=this._getOffset(d,"x"),$=this._getOffset(d,"y");F&&(M+=`translateX(${F}px) `),$&&(M+=`translateY(${$}px)`),c.transform=M.trim(),T.maxHeight&&(m?c.maxHeight=gr(T.maxHeight):r&&(c.maxHeight="")),T.maxWidth&&(m?c.maxWidth=gr(T.maxWidth):r&&(c.maxWidth="")),dd(this._pane.style,c)}_getExactOverlayY(i,d,c){let m={top:"",bottom:""},r=this._getOverlayPoint(d,this._overlayRect,i);if(this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,c)),i.overlayY==="bottom"){let T=this._document.documentElement.clientHeight;m.bottom=`${T-(r.y+this._overlayRect.height)}px`}else m.top=gr(r.y);return m}_getExactOverlayX(i,d,c){let m={left:"",right:""},r=this._getOverlayPoint(d,this._overlayRect,i);this._isPushed&&(r=this._pushOverlayOnScreen(r,this._overlayRect,c));let T;if(this._isRtl()?T=i.overlayX==="end"?"left":"right":T=i.overlayX==="end"?"right":"left",T==="right"){let M=this._document.documentElement.clientWidth;m.right=`${M-(r.x+this._overlayRect.width)}px`}else m.left=gr(r.x);return m}_getScrollVisibility(){let i=this._getOriginRect(),d=this._pane.getBoundingClientRect(),c=this._scrollables.map(m=>m.getElementRef().nativeElement.getBoundingClientRect());return{isOriginClipped:Jk(i,c),isOriginOutsideView:aD(i,c),isOverlayClipped:Jk(d,c),isOverlayOutsideView:aD(d,c)}}_subtractOverflows(i,...d){return d.reduce((c,m)=>c-Math.max(m,0),i)}_getNarrowedViewportRect(){let i=this._document.documentElement.clientWidth,d=this._document.documentElement.clientHeight,c=this._viewportRuler.getViewportScrollPosition();return{top:c.top+this._viewportMargin,left:c.left+this._viewportMargin,right:c.left+i-this._viewportMargin,bottom:c.top+d-this._viewportMargin,width:i-2*this._viewportMargin,height:d-2*this._viewportMargin}}_isRtl(){return this._overlayRef.getDirection()==="rtl"}_hasExactPosition(){return!this._hasFlexibleDimensions||this._isPushed}_getOffset(i,d){return d==="x"?i.offsetX==null?this._offsetX:i.offsetX:i.offsetY==null?this._offsetY:i.offsetY}_validatePositions(){}_addPanelClasses(i){this._pane&&gf(i).forEach(d=>{d!==""&&this._appliedPanelClasses.indexOf(d)===-1&&(this._appliedPanelClasses.push(d),this._pane.classList.add(d))})}_clearPanelClasses(){this._pane&&(this._appliedPanelClasses.forEach(i=>{this._pane.classList.remove(i)}),this._appliedPanelClasses=[])}_getOriginRect(){let i=this._origin;if(i instanceof ti)return i.nativeElement.getBoundingClientRect();if(i instanceof Element)return i.getBoundingClientRect();let d=i.width||0,c=i.height||0;return{top:i.y,bottom:i.y+c,left:i.x,right:i.x+d,height:c,width:d}}};function dd(a,i){for(let d in i)i.hasOwnProperty(d)&&(a[d]=i[d]);return a}function nO(a){if(typeof a!="number"&&a!=null){let[i,d]=a.split(t$);return!d||d==="px"?parseFloat(i):null}return a||null}function iO(a){return{top:Math.floor(a.top),right:Math.floor(a.right),bottom:Math.floor(a.bottom),left:Math.floor(a.left),width:Math.floor(a.width),height:Math.floor(a.height)}}function n$(a,i){return a===i?!0:a.isOriginClipped===i.isOriginClipped&&a.isOriginOutsideView===i.isOriginOutsideView&&a.isOverlayClipped===i.isOverlayClipped&&a.isOverlayOutsideView===i.isOverlayOutsideView}var rO="cdk-global-overlay-wrapper",hD=class{constructor(){this._cssPosition="static",this._topOffset="",this._bottomOffset="",this._alignItems="",this._xPosition="",this._xOffset="",this._width="",this._height="",this._isDisposed=!1}attach(i){let d=i.getConfig();this._overlayRef=i,this._width&&!d.width&&i.updateSize({width:this._width}),this._height&&!d.height&&i.updateSize({height:this._height}),i.hostElement.classList.add(rO),this._isDisposed=!1}top(i=""){return this._bottomOffset="",this._topOffset=i,this._alignItems="flex-start",this}left(i=""){return this._xOffset=i,this._xPosition="left",this}bottom(i=""){return this._topOffset="",this._bottomOffset=i,this._alignItems="flex-end",this}right(i=""){return this._xOffset=i,this._xPosition="right",this}start(i=""){return this._xOffset=i,this._xPosition="start",this}end(i=""){return this._xOffset=i,this._xPosition="end",this}width(i=""){return this._overlayRef?this._overlayRef.updateSize({width:i}):this._width=i,this}height(i=""){return this._overlayRef?this._overlayRef.updateSize({height:i}):this._height=i,this}centerHorizontally(i=""){return this.left(i),this._xPosition="center",this}centerVertically(i=""){return this.top(i),this._alignItems="center",this}apply(){if(!this._overlayRef||!this._overlayRef.hasAttached())return;let i=this._overlayRef.overlayElement.style,d=this._overlayRef.hostElement.style,c=this._overlayRef.getConfig(),{width:m,height:r,maxWidth:T,maxHeight:M}=c,F=(m==="100%"||m==="100vw")&&(!T||T==="100%"||T==="100vw"),$=(r==="100%"||r==="100vh")&&(!M||M==="100%"||M==="100vh"),Q=this._xPosition,ue=this._xOffset,Ae=this._overlayRef.getConfig().direction==="rtl",xe="",ke="",Qe="";F?Qe="flex-start":Q==="center"?(Qe="center",Ae?ke=ue:xe=ue):Ae?Q==="left"||Q==="end"?(Qe="flex-end",xe=ue):(Q==="right"||Q==="start")&&(Qe="flex-start",ke=ue):Q==="left"||Q==="start"?(Qe="flex-start",xe=ue):(Q==="right"||Q==="end")&&(Qe="flex-end",ke=ue),i.position=this._cssPosition,i.marginLeft=F?"0":xe,i.marginTop=$?"0":this._topOffset,i.marginBottom=this._bottomOffset,i.marginRight=F?"0":ke,d.justifyContent=Qe,d.alignItems=$?"flex-start":this._alignItems}dispose(){if(this._isDisposed||!this._overlayRef)return;let i=this._overlayRef.overlayElement.style,d=this._overlayRef.hostElement,c=d.style;d.classList.remove(rO),c.justifyContent=c.alignItems=i.marginTop=i.marginBottom=i.marginLeft=i.marginRight=i.position="",this._overlayRef=null,this._isDisposed=!0}},i$=(()=>{let i=class i{constructor(c,m,r,T){this._viewportRuler=c,this._document=m,this._platform=r,this._overlayContainer=T}global(){return new hD}flexibleConnectedTo(c){return new dD(c,this._viewportRuler,this._document,this._platform,this._overlayContainer)}};i.\u0275fac=function(m){return new(m||i)(Ze(iD),Ze(jn),Ze(Ai),Ze(sO))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})(),r$=0,og=(()=>{let i=class i{constructor(c,m,r,T,M,F,$,Q,ue,Ae,xe,ke){this.scrollStrategies=c,this._overlayContainer=m,this._componentFactoryResolver=r,this._positionBuilder=T,this._keyboardDispatcher=M,this._injector=F,this._ngZone=$,this._document=Q,this._directionality=ue,this._location=Ae,this._outsideClickDispatcher=xe,this._animationsModuleType=ke}create(c){let m=this._createHostElement(),r=this._createPaneElement(m),T=this._createPortalOutlet(r),M=new rg(c);return M.direction=M.direction||this._directionality.value,new uD(T,m,r,M,this._ngZone,this._keyboardDispatcher,this._document,this._location,this._outsideClickDispatcher,this._animationsModuleType==="NoopAnimations",this._injector.get(ms))}position(){return this._positionBuilder}_createPaneElement(c){let m=this._document.createElement("div");return m.id=`cdk-overlay-${r$++}`,m.classList.add("cdk-overlay-pane"),c.appendChild(m),m}_createHostElement(){let c=this._document.createElement("div");return this._overlayContainer.getContainerElement().appendChild(c),c}_createPortalOutlet(c){return this._appRef||(this._appRef=this._injector.get(fc)),new ab(c,this._componentFactoryResolver,this._appRef,this._injector,this._document)}};i.\u0275fac=function(m){return new(m||i)(Ze(KG),Ze(sO),Ze(ba),Ze(i$),Ze(JG),Ze(nr),Ze(Wt),Ze(jn),Ze(eb),Ze(OE),Ze(e$),Ze(Lo,8))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var o$=new Pt("cdk-connected-overlay-scroll-strategy",{providedIn:"root",factory:()=>{let a=Ot(og);return()=>a.scrollStrategies.reposition()}});function s$(a){return()=>a.scrollStrategies.reposition()}var a$={provide:o$,deps:[og],useFactory:s$},aO=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({providers:[og,a$],imports:[wc,lb,rD,rD]});let a=i;return a})();function c$(a,i){if(a&1){let d=i0();Hn(0,"div",1)(1,"button",2),Zr("click",function(){jv(d);let m=vo();return Uv(m.action())}),ul(2),qn()()}if(a&2){let d=vo();di(2),cf(" ",d.data.action," ")}}var u$=["label"];function d$(a,i){}var h$=Math.pow(2,31)-1,sg=class{constructor(i,d){this._overlayRef=d,this._afterDismissed=new Tn,this._afterOpened=new Tn,this._onAction=new Tn,this._dismissedByAction=!1,this.containerInstance=i,i._onExit.subscribe(()=>this._finishDismiss())}dismiss(){this._afterDismissed.closed||this.containerInstance.exit(),clearTimeout(this._durationTimeoutId)}dismissWithAction(){this._onAction.closed||(this._dismissedByAction=!0,this._onAction.next(),this._onAction.complete(),this.dismiss()),clearTimeout(this._durationTimeoutId)}closeWithAction(){this.dismissWithAction()}_dismissAfter(i){this._durationTimeoutId=setTimeout(()=>this.dismiss(),Math.min(i,h$))}_open(){this._afterOpened.closed||(this._afterOpened.next(),this._afterOpened.complete())}_finishDismiss(){this._overlayRef.dispose(),this._onAction.closed||this._onAction.complete(),this._afterDismissed.next({dismissedByAction:this._dismissedByAction}),this._afterDismissed.complete(),this._dismissedByAction=!1}afterDismissed(){return this._afterDismissed}afterOpened(){return this.containerInstance._onEnter}onAction(){return this._onAction}},lO=new Pt("MatSnackBarData"),Tf=class{constructor(){this.politeness="assertive",this.announcementMessage="",this.duration=0,this.data=null,this.horizontalPosition="center",this.verticalPosition="bottom"}},f$=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=ui({type:i,selectors:[["","matSnackBarLabel",""]],hostAttrs:[1,"mat-mdc-snack-bar-label","mdc-snackbar__label"],standalone:!0});let a=i;return a})(),p$=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=ui({type:i,selectors:[["","matSnackBarActions",""]],hostAttrs:[1,"mat-mdc-snack-bar-actions","mdc-snackbar__actions"],standalone:!0});let a=i;return a})(),m$=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275dir=ui({type:i,selectors:[["","matSnackBarAction",""]],hostAttrs:[1,"mat-mdc-snack-bar-action","mdc-snackbar__action"],standalone:!0});let a=i;return a})(),cO=(()=>{let i=class i{constructor(c,m){this.snackBarRef=c,this.data=m}action(){this.snackBarRef.dismissWithAction()}get hasAction(){return!!this.data.action}};i.\u0275fac=function(m){return new(m||i)(Tt(sg),Tt(lO))},i.\u0275cmp=zr({type:i,selectors:[["simple-snack-bar"]],hostAttrs:[1,"mat-mdc-simple-snack-bar"],exportAs:["matSnackBar"],standalone:!0,features:[vs],decls:3,vars:2,consts:[["matSnackBarLabel",""],["matSnackBarActions",""],["mat-button","","matSnackBarAction","",3,"click"]],template:function(m,r){m&1&&(Hn(0,"div",0),ul(1),qn(),rr(2,c$,3,1,"div",1)),m&2&&(di(),cf(" ",r.data.message,`
`),di(),Wr(r.hasAction?2:-1))},dependencies:[ob,f$,p$,m$],styles:[".mat-mdc-simple-snack-bar{display:flex}"],encapsulation:2,changeDetection:0});let a=i;return a})(),g$={snackBarState:b0("state",[jm("void, hidden",Ia({transform:"scale(0.8)",opacity:0})),jm("visible",Ia({transform:"scale(1)",opacity:1})),Um("* => visible",Vm("150ms cubic-bezier(0, 0, 0.2, 1)")),Um("* => void, * => hidden",Vm("75ms cubic-bezier(0.4, 0.0, 1, 1)",Ia({opacity:0})))])},_$=0,y$=(()=>{let i=class i extends Ef{constructor(c,m,r,T,M){super(),this._ngZone=c,this._elementRef=m,this._changeDetectorRef=r,this._platform=T,this.snackBarConfig=M,this._document=Ot(jn),this._trackedModals=new Set,this._announceDelay=150,this._destroyed=!1,this._onAnnounce=new Tn,this._onExit=new Tn,this._onEnter=new Tn,this._animationState="void",this._liveElementId=`mat-snack-bar-container-live-${_$++}`,this.attachDomPortal=F=>{this._assertNotAttached();let $=this._portalOutlet.attachDomPortal(F);return this._afterPortalAttached(),$},M.politeness==="assertive"&&!M.announcementMessage?this._live="assertive":M.politeness==="off"?this._live="off":this._live="polite",this._platform.FIREFOX&&(this._live==="polite"&&(this._role="status"),this._live==="assertive"&&(this._role="alert"))}attachComponentPortal(c){this._assertNotAttached();let m=this._portalOutlet.attachComponentPortal(c);return this._afterPortalAttached(),m}attachTemplatePortal(c){this._assertNotAttached();let m=this._portalOutlet.attachTemplatePortal(c);return this._afterPortalAttached(),m}onAnimationEnd(c){let{fromState:m,toState:r}=c;if((r==="void"&&m!=="void"||r==="hidden")&&this._completeExit(),r==="visible"){let T=this._onEnter;this._ngZone.run(()=>{T.next(),T.complete()})}}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.markForCheck(),this._changeDetectorRef.detectChanges(),this._screenReaderAnnounce())}exit(){return this._ngZone.run(()=>{this._animationState="hidden",this._changeDetectorRef.markForCheck(),this._elementRef.nativeElement.setAttribute("mat-exit",""),clearTimeout(this._announceTimeoutId)}),this._onExit}ngOnDestroy(){this._destroyed=!0,this._clearFromModals(),this._completeExit()}_completeExit(){queueMicrotask(()=>{this._onExit.next(),this._onExit.complete()})}_afterPortalAttached(){let c=this._elementRef.nativeElement,m=this.snackBarConfig.panelClass;m&&(Array.isArray(m)?m.forEach(M=>c.classList.add(M)):c.classList.add(m)),this._exposeToModals();let r=this._label.nativeElement,T="mdc-snackbar__label";r.classList.toggle(T,!r.querySelector(`.${T}`))}_exposeToModals(){let c=this._liveElementId,m=this._document.querySelectorAll('body > .cdk-overlay-container [aria-modal="true"]');for(let r=0;r<m.length;r++){let T=m[r],M=T.getAttribute("aria-owns");this._trackedModals.add(T),M?M.indexOf(c)===-1&&T.setAttribute("aria-owns",M+" "+c):T.setAttribute("aria-owns",c)}}_clearFromModals(){this._trackedModals.forEach(c=>{let m=c.getAttribute("aria-owns");if(m){let r=m.replace(this._liveElementId,"").trim();r.length>0?c.setAttribute("aria-owns",r):c.removeAttribute("aria-owns")}}),this._trackedModals.clear()}_assertNotAttached(){this._portalOutlet.hasAttached()}_screenReaderAnnounce(){this._announceTimeoutId||this._ngZone.runOutsideAngular(()=>{this._announceTimeoutId=setTimeout(()=>{let c=this._elementRef.nativeElement.querySelector("[aria-hidden]"),m=this._elementRef.nativeElement.querySelector("[aria-live]");if(c&&m){let r=null;this._platform.isBrowser&&document.activeElement instanceof HTMLElement&&c.contains(document.activeElement)&&(r=document.activeElement),c.removeAttribute("aria-hidden"),m.appendChild(c),r?.focus(),this._onAnnounce.next(),this._onAnnounce.complete()}},this._announceDelay)})}};i.\u0275fac=function(m){return new(m||i)(Tt(Wt),Tt(ti),Tt(Ea),Tt(Ai),Tt(Tf))},i.\u0275cmp=zr({type:i,selectors:[["mat-snack-bar-container"]],viewQuery:function(m,r){if(m&1&&(bo(nD,7),bo(u$,7)),m&2){let T;dr(T=hr())&&(r._portalOutlet=T.first),dr(T=hr())&&(r._label=T.first)}},hostAttrs:[1,"mdc-snackbar","mat-mdc-snack-bar-container"],hostVars:1,hostBindings:function(m,r){m&1&&xE("@state.done",function(M){return r.onAnimationEnd(M)}),m&2&&bE("@state",r._animationState)},standalone:!0,features:[yo,vs],decls:6,vars:3,consts:[["label",""],[1,"mdc-snackbar__surface","mat-mdc-snackbar-surface"],[1,"mat-mdc-snack-bar-label"],["aria-hidden","true"],["cdkPortalOutlet",""]],template:function(m,r){m&1&&(Hn(0,"div",1)(1,"div",2,0)(3,"div",3),rr(4,d$,0,0,"ng-template",4),qn(),or(5,"div"),qn()()),m&2&&(di(5),Mr("aria-live",r._live)("role",r._role)("id",r._liveElementId))},dependencies:[nD],styles:[".mat-mdc-snack-bar-container{display:flex;align-items:center;justify-content:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0);margin:8px}.mat-mdc-snack-bar-handset .mat-mdc-snack-bar-container{width:100vw}.mat-mdc-snackbar-surface{box-shadow:0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 6px 10px 0px rgba(0, 0, 0, 0.14), 0px 1px 18px 0px rgba(0, 0, 0, 0.12);display:flex;align-items:center;justify-content:flex-start;box-sizing:border-box;padding-left:0;padding-right:8px}[dir=rtl] .mat-mdc-snackbar-surface{padding-right:0;padding-left:8px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{min-width:344px;max-width:672px}.mat-mdc-snack-bar-handset .mat-mdc-snackbar-surface{width:100%;min-width:0}.cdk-high-contrast-active .mat-mdc-snackbar-surface{outline:solid 1px}.mat-mdc-snack-bar-container .mat-mdc-snackbar-surface{color:var(--mdc-snackbar-supporting-text-color);border-radius:var(--mdc-snackbar-container-shape);background-color:var(--mdc-snackbar-container-color)}.mdc-snackbar__label{width:100%;flex-grow:1;box-sizing:border-box;margin:0;padding:14px 8px 14px 16px}[dir=rtl] .mdc-snackbar__label{padding-left:8px;padding-right:16px}.mat-mdc-snack-bar-container .mdc-snackbar__label{font-family:var(--mdc-snackbar-supporting-text-font);font-size:var(--mdc-snackbar-supporting-text-size);font-weight:var(--mdc-snackbar-supporting-text-weight);line-height:var(--mdc-snackbar-supporting-text-line-height)}.mat-mdc-snack-bar-actions{display:flex;flex-shrink:0;align-items:center;box-sizing:border-box}.mat-mdc-snack-bar-handset,.mat-mdc-snack-bar-container,.mat-mdc-snack-bar-label{flex:1 1 auto}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled){color:var(--mat-snack-bar-button-color);--mat-text-button-state-layer-color:currentColor;--mat-text-button-ripple-color:currentColor}.mat-mdc-snack-bar-container .mat-mdc-button.mat-mdc-snack-bar-action:not(:disabled) .mat-ripple-element{opacity:.1}"],encapsulation:2,data:{animation:[g$.snackBarState]}});let a=i;return a})();function v$(){return new Tf}var b$=new Pt("mat-snack-bar-default-options",{providedIn:"root",factory:v$}),x$=(()=>{let i=class i{get _openedSnackBarRef(){let c=this._parentSnackBar;return c?c._openedSnackBarRef:this._snackBarRefAtThisLevel}set _openedSnackBarRef(c){this._parentSnackBar?this._parentSnackBar._openedSnackBarRef=c:this._snackBarRefAtThisLevel=c}constructor(c,m,r,T,M,F){this._overlay=c,this._live=m,this._injector=r,this._breakpointObserver=T,this._parentSnackBar=M,this._defaultConfig=F,this._snackBarRefAtThisLevel=null,this.simpleSnackBarComponent=cO,this.snackBarContainerComponent=y$,this.handsetCssClass="mat-mdc-snack-bar-handset"}openFromComponent(c,m){return this._attach(c,m)}openFromTemplate(c,m){return this._attach(c,m)}open(c,m="",r){let T=Yt(Yt({},this._defaultConfig),r);return T.data={message:c,action:m},T.announcementMessage===c&&(T.announcementMessage=void 0),this.openFromComponent(this.simpleSnackBarComponent,T)}dismiss(){this._openedSnackBarRef&&this._openedSnackBarRef.dismiss()}ngOnDestroy(){this._snackBarRefAtThisLevel&&this._snackBarRefAtThisLevel.dismiss()}_attachSnackBarContainer(c,m){let r=m&&m.viewContainerRef&&m.viewContainerRef.injector,T=nr.create({parent:r||this._injector,providers:[{provide:Tf,useValue:m}]}),M=new xf(this.snackBarContainerComponent,m.viewContainerRef,T),F=c.attach(M);return F.instance.snackBarConfig=m,F.instance}_attach(c,m){let r=Yt(Yt(Yt({},new Tf),this._defaultConfig),m),T=this._createOverlay(r),M=this._attachSnackBarContainer(T,r),F=new sg(M,T);if(c instanceof Zs){let $=new wf(c,null,{$implicit:r.data,snackBarRef:F});F.instance=M.attachTemplatePortal($)}else{let $=this._createInjector(r,F),Q=new xf(c,void 0,$),ue=M.attachComponentPortal(Q);F.instance=ue.instance}return this._breakpointObserver.observe(fk.HandsetPortrait).pipe(mo(T.detachments())).subscribe($=>{T.overlayElement.classList.toggle(this.handsetCssClass,$.matches)}),r.announcementMessage&&M._onAnnounce.subscribe(()=>{this._live.announce(r.announcementMessage,r.politeness)}),this._animateSnackBar(F,r),this._openedSnackBarRef=F,this._openedSnackBarRef}_animateSnackBar(c,m){c.afterDismissed().subscribe(()=>{this._openedSnackBarRef==c&&(this._openedSnackBarRef=null),m.announcementMessage&&this._live.clear()}),this._openedSnackBarRef?(this._openedSnackBarRef.afterDismissed().subscribe(()=>{c.containerInstance.enter()}),this._openedSnackBarRef.dismiss()):c.containerInstance.enter(),m.duration&&m.duration>0&&c.afterOpened().subscribe(()=>c._dismissAfter(m.duration))}_createOverlay(c){let m=new rg;m.direction=c.direction;let r=this._overlay.position().global(),T=c.direction==="rtl",M=c.horizontalPosition==="left"||c.horizontalPosition==="start"&&!T||c.horizontalPosition==="end"&&T,F=!M&&c.horizontalPosition!=="center";return M?r.left("0"):F?r.right("0"):r.centerHorizontally(),c.verticalPosition==="top"?r.top("0"):r.bottom("0"),m.positionStrategy=r,this._overlay.create(m)}_createInjector(c,m){let r=c&&c.viewContainerRef&&c.viewContainerRef.injector;return nr.create({parent:r||this._injector,providers:[{provide:sg,useValue:m},{provide:lO,useValue:c.data}]})}};i.\u0275fac=function(m){return new(m||i)(Ze(og),Ze(_k),Ze(nr),Ze(X0),Ze(i,12),Ze(b$))},i.\u0275prov=Ft({token:i,factory:i.\u0275fac,providedIn:"root"});let a=i;return a})();var uO=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i}),i.\u0275inj=Ln({providers:[x$],imports:[aO,lb,sb,ro,cO,ro]});let a=i;return a})();var dO=(()=>{let i=class i{constructor(){this.zipCodeSubmit=new Ui,this.zipCode=""}onSubmit(){this.zipCodeSubmit.emit(this.zipCode)}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=zr({type:i,selectors:[["app-zip-code-input"]],outputs:{zipCodeSubmit:"zipCodeSubmit"},decls:7,vars:1,consts:[[1,"zip-code-input"],["matInput","","placeholder","Enter zip code",3,"ngModelChange","ngModel"],["mat-raised-button","","color","primary",3,"click"]],template:function(m,r){m&1&&(Hn(0,"div",0)(1,"mat-form-field")(2,"mat-label"),ul(3,"Zip code"),qn(),Hn(4,"input",1),DE("ngModelChange",function(M){return aP(r.zipCode,M)||(r.zipCode=M),M}),qn()(),Hn(5,"button",2),Zr("click",function(){return r.onSubmit()}),ul(6,"Submit"),qn()()),m&2&&(di(4),TE("ngModel",r.zipCode))},dependencies:[Hk,$k,rb,ob,Z0,tk,jT]});let a=i;return a})();var ub=sz(fO());var pO=(()=>{let i=class i{constructor(){this.map=null,this.style="mapbox://styles/mapbox/streets-v11",this.mapboxAccessToken="pk.eyJ1IjoidGFsc2hpcmFuIiwiYSI6ImNseHhsOXNuZzAzenIya3NtZXkwc3Q0eGgifQ.raHngc-xnDradTl4ibZQFQ"}ngOnInit(){this.map=new ub.Map({container:"map",style:this.style,zoom:5,center:[-98.35,39.5],accessToken:this.mapboxAccessToken})}ngOnChanges(c){c.geoJsonData&&this.geoJsonData&&this.updateMap(this.geoJsonData)}updateMap(c){if(this.map){let m=this.map.getSource("zipBoundary");m?m.setData(c):(this.map.addSource("zipBoundary",{type:"geojson",data:c}),this.map.addLayer({id:"zipBoundary",type:"fill",source:"zipBoundary",layout:{},paint:{"fill-color":"#888888","fill-opacity":.4}}));let r=new ub.LngLatBounds;c.features.forEach(T=>{T.geometry.coordinates[0].forEach(M=>{r.extend(M)})}),this.map.fitBounds(r,{padding:20})}}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=zr({type:i,selectors:[["app-map-view"]],inputs:{geoJsonData:"geoJsonData"},features:[Xo],decls:1,vars:0,consts:[["id","map",1,"map-container"]],template:function(m,r){m&1&&or(0,"div",0)},styles:[".map-container[_ngcontent-%COMP%]{height:500px;width:100%}"]});let a=i;return a})();function T$(a,i){a&1&&or(0,"mat-progress-spinner",5)}var mO=(()=>{let i=class i{constructor(){this.loading=!1}onZipCodeSubmit(c){this.loading=!0,this.geoJsonData={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[[-118.4164,34.0668],[-118.4164,34.103],[-118.3944,34.103],[-118.3944,34.0668],[-118.4164,34.0668]]]},properties:{zipcode:"90210"}}]},this.loading=!1}};i.\u0275fac=function(m){return new(m||i)},i.\u0275cmp=zr({type:i,selectors:[["app-root"]],decls:5,vars:2,consts:[[1,"zip-code-input"],[3,"zipCodeSubmit"],[1,"map-view"],["mode","indeterminate",4,"ngIf"],[3,"geoJsonData"],["mode","indeterminate"]],template:function(m,r){m&1&&(Hn(0,"div",0)(1,"app-zip-code-input",1),Zr("zipCodeSubmit",function(M){return r.onZipCodeSubmit(M)}),qn()(),Hn(2,"div",2),rr(3,T$,1,0,"mat-progress-spinner",3),or(4,"app-map-view",4),qn()),m&2&&(di(3),qr("ngIf",r.loading),di(),qr("geoJsonData",r.geoJsonData))},dependencies:[CP,Zk,dO,pO],styles:[".app-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:20px}"]});let a=i;return a})();var gO=(()=>{let i=class i{};i.\u0275fac=function(m){return new(m||i)},i.\u0275mod=Nn({type:i,bootstrap:[mO]}),i.\u0275inj=Ln({providers:[UP(GP())],imports:[v0,CR,qk,sb,Qk,uO,lk]});let a=i;return a})();YP().bootstrapModule(gO).catch(a=>console.error(a));
